/**@license
 * LIPS is Pretty Simple - version DEV
 *
 * Copyright (c) 2018 Jakub Jankiewicz <http://jcubic.pl/me>
 * Released under the MIT license
 *
 * build: Sat, 07 Jul 2018 13:20:10 +0000
 */
"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var n=0,r=Array(e.length);n<e.length;n++){r[n]=e[n]}return r}else{return Array.from(e)}}(function(e,n){if(typeof define==="function"&&define.amd){define(["bn.js"],function(r){return e.lips=n(e,r)})}else if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&module.exports){module.exports=n(e,require("bn.js"))}else{e.lips=n(e,e.BN)}})(typeof window!=="undefined"?window:global,function(e,n,r){var t=/^\/((?:\\\/|[^/]|\[[^\]]*\/[^\]]*\])+)\/([gimy]*)$/;var i=/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/;function a(e){function n(e){if(e.match(/^['"]/)){if(e==='""'||e==="''"){return""}var n=e[0];var r=new RegExp("((^|[^\\\\])(?:\\\\\\\\)*)"+n,"g");e=e.replace(r,"$1")}return JSON.parse('"'+e+'"')}var r=e.match(t);if(r){return new RegExp(r[1],r[2])}else if(e.match(/['"]/)){return n(e)}else if(e.match(/^-?[0-9]+$/)){return m(parseInt(e,10))}else if(e.match(i)){return m(parseFloat(e))}else if(e==="nil"){return p}else{return new h(e)}}var o=/("[^"\\]*(?:\\[\S\s][^"\\]*)*"|\/[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|;.*|\(|\)|'|\.|,@|,|`|[^(\s)]+)/gi;function f(e,n){if(n){return u(e)}else{return u(e).map(function(e){return e.token.trim()}).filter(function(e){return e&&!e.match(/^;/)})}}function u(e){var n=0;return e.split("\n").map(function(e,r){var t=0;n+=r===0?0:1;return e.split(o).filter(Boolean).map(function(e){var i={col:t,line:r,token:e,offset:n};t+=e.length;n+=e.length;return i})}).reduce(function(e,n){return e.concat(n)},[])}var c={"'":new h("quote"),"`":new h("quasiquote"),",":new h("unquote"),",@":new h("unquote-splicing")};function s(e){var n=[];var r=[];var t=null;var i=Object.keys(c);var o=i.map(function(e){return c[e].name});var f=0;var u=false;var s=[];var l=[];function v(){var e=n[n.length-1];if(e instanceof Array&&e[0]instanceof h&&o.includes(e[0].name)&&n.length>1){n.pop();if(n[n.length-1].length===1&&n[n.length-1][0]instanceof h){n[n.length-1].push(e)}else if(n[n.length-1].length===0){n[n.length-1]=e}else if(n[n.length-1]instanceof d){if(n[n.length-1].cdr instanceof d){n[n.length-1]=new d(n[n.length-1],d.fromArray(e))}else{n[n.length-1].cdr=d.fromArray(e)}}else{n[n.length-1].push(e)}}}e.forEach(function(e){var o=n[n.length-1];if(i.indexOf(e)!==-1){t=e;n.push([c[t]]);if(!t){l=[]}l.push(t)}else if(e==="("){u=true;f++;if(t){s.push(l);l=[]}n.push([]);t=null}else if(e==="."&&!u){n[n.length-1]=d.fromArray(o)}else if(e===")"){f--;if(!n.length){throw new Error("Unbalanced parenthesis 1")}if(n.length===1){r.push(n.pop())}else if(n.length>1){var h=n.pop();o=n[n.length-1];if(o instanceof Array){o.push(h)}else if(o instanceof d){o.append(d.fromArray(h))}if(s.length){l=s.pop();while(l.length){v();l.pop()}}else{v()}}if(f===0&&n.length){r.push(n.pop())}}else{u=false;var y=a(e);if(t){n[n.length-1][1]=y;y=n.pop();t=false}o=n[n.length-1];if(o instanceof d){var m=o;while(true){if(m.cdr===p){if(y instanceof Array){m.cdr=d.fromArray(y)}else{m.cdr=y}break}else{m=m.cdr}}}else if(!n.length){r.push(y)}else{o.push(y)}}});if(n.length){console.log({end:n.slice()});throw new Error("Unbalanced parenthesis 2")}return r.map(function(e){if(e instanceof Array){return d.fromArray(e)}return e})}function l(e,n){var t=Object.prototype.toString;var i="[object Array]";var a=[];var o=n&&e||e.slice();var f;if(!e.length){return a}f=o.pop();do{if(t.call(f)===i){o.push.apply(o,f)}else{a.push(f)}}while(o.length&&(f=o.pop())!==r);a.reverse();return a}function h(e){this.name=e}h.is=function(e,n){return e instanceof h&&typeof n==="string"&&e.name===n};h.prototype.toJSON=h.prototype.toString=function(){return this.name};function v(){}v.prototype.toString=function(){return"nil"};var p=new v;function d(e,n){this.car=e;this.cdr=n}d.prototype.flatten=function(){return d.fromArray(l(this.toArray()))};d.prototype.length=function(){var e=0;var n=this;while(true){if(n===p){break}e++;n=n.cdr}return e};d.prototype.clone=function(){var e=this.cdr;var n=this.car;if(n instanceof d){n=n.clone()}if(e instanceof d){e=this.cdr.clone()}return new d(n,e)};d.prototype.toArray=function(){if(this.cdr===p&&this.car===p){return[]}var e=[];if(this.car instanceof d){e.push(this.car.toArray())}else{e.push(this.car)}if(this.cdr instanceof d){e=e.concat(this.cdr.toArray())}return e};d.prototype.isEmptyList=function(){return typeof this.car==="undefined"&&this.cdr===p};d.fromArray=function(e){if(e instanceof d){return e}if(e.length&&!e instanceof Array){e=[].concat(_toConsumableArray(e))}if(e.length===0){return new d(r,p)}else{var n;if(e[0]instanceof Array){n=d.fromArray(e[0])}else{n=e[0]}if(e.length===1){return new d(n,p)}else{return new d(n,d.fromArray(e.slice(1)))}}};d.prototype.toObject=function(){var e=this;var n={};while(true){if(e instanceof d&&e.car instanceof d){var r=e.car;var t=r.car;if(t instanceof h){t=t.name}n[t]=r.cdr;e=e.cdr}else{break}}return n};d.fromPairs=function(e){return e.reduce(function(e,n){return new d(new d(new h(n[0]),n[1]),e)},p)};d.fromObject=function(e){var n=Object.keys(e).map(function(n){return[n,e[n]]});return d.fromPairs(n)};d.prototype.reduce=function(e){var n=this;var r=p;while(true){if(n!==p){r=e(r,n.car);n=n.cdr}else{break}}return r};d.prototype.reverse=function(){var e=this;var n=p;while(e!==p){var r=e.cdr;e.cdr=n;n=e;e=r}return n};d.prototype.transform=function(e){var n=[];function r(t){if(t instanceof d){if(t.replace){delete t.replace;return t}var i=e(t.car);if(i instanceof d){i=r(i);n.push(i)}var a=e(t.cdr);if(a instanceof d){a=r(a);n.push(a)}return new d(i,a)}return t}return r(this)};d.prototype.toString=function(){var e=["("];if(this.car!==r){if(typeof this.car==="function"){e.push("<#function "+(this.car.name||"anonymous")+">")}else if(typeof this.car==="string"){e.push(JSON.stringify(this.car))}else if(typeof this.car!=="undefined"){e.push(this.car)}if(this.cdr instanceof d){e.push(" ");e.push(this.cdr.toString().replace(/^\(|\)$/g,""))}else if(typeof this.cdr!=="undefined"&&this.cdr!==p){if(typeof this.cdr==="string"){e=e.concat([" . ",JSON.stringify(this.cdr)])}else{e=e.concat([" . ",this.cdr])}}}e.push(")");return e.join("")};d.prototype.append=function(e){if(e instanceof Array){return this.append(d.fromArray(e))}var n=this;if(n.car===r){if(e instanceof d){this.car=e.car;this.cdr=e.cdr}else{return e}}else{while(true){if(n instanceof d&&n.cdr!==p){n=n.cdr}else{break}}n.cdr=e}return this};function y(e){this.fn=e}y.prototype.invoke=function(e,n,r,t){return this.fn.call(r,n,t,e)};function m(e){if(e instanceof m){return e}if(typeof this!=="undefined"&&this.constructor!==m||typeof this==="undefined"){return new m(e)}if(!m.isNumber(e)){throw new Error("You can't create LNumber from "+(typeof e==="undefined"?"undefined":_typeof(e)))}if(e===null){e=0}if(m.isFloat(e)){this.value=e}else if(typeof BigInt!=="undefined"){if(typeof e!=="bigint"){this.value=BigInt(e)}else{this.value=e}}else if(typeof n!=="undefined"&&!(e instanceof n)){this.value=new n(e)}else{this.value=e}}m.isFloat=function e(n){return Number(n)===n&&n%1!==0};m.isNumber=function(e){return e instanceof m||m.isNative(e)||m.isBN(e)};m.isNative=function(e){return typeof e==="bigint"||typeof e==="number"};m.isBN=function(e){return typeof n!=="undefined"&&e instanceof n};m.prototype.toString=function(){console.log(this.value);return this.value.toString()};m.prototype.valueOf=function(){if(m.isNative(this.value)){return Number(this.value)}else if(m.isBN(this.value)){return this.value.toNumber()}};m.prototype.coerce=function(e){if(e===null){e=0}var r;if(e instanceof m){r=e.value}else{r=e}if(m.isFloat(r)){}else if(typeof this.value==="bigint"&&typeof r!=="bigint"){r=BigInt(r)}else if(typeof n!=="undefined"&&this.value instanceof n&&!r instanceof n){r=new n(r)}return m(r)};m.prototype.add=function(e){e=this.coerce(e);if(m.isNative(e.value)){e.value=this.value+e.value}else if(m.isBN(this.value)){e.value.iadd(this.value)}return e};m.prototype.sub=function(e){e=this.coerce(e);if(m.isNative(e.value)){e.value=this.value-e.value}else if(m.isBN(this.value)){e.value.isub(this.value)}return e};m.prototype.mul=function(e){e=this.coerce(e);if(m.isNative(e.value)){e.value=this.value*e.value}else if(m.isBN(this.value)){e.value.imul(this.value)}return e};m.prototype.div=function(e){e=this.coerce(e);if(m.isNative(e.value)){e.value=this.value/e.value}else if(m.isBN(this.value)){e.value.idiv(this.value)}return e};m.prototype.mod=function(e){e=this.coerce(e);if(m.isNative(e.value)){e.value=this.value%e.value}else if(m.isBN(this.value)){e.value.imod(this.value)}return e};m.prototype.sqrt=function(){var e;if(this.isNative()){e=Math.sqrt(this.value)}else if(m.isBN(this.value)){e=this.value.sqrt()}return new m(e)};m.prototype.pow=function(e){e=this.coerce(e);if(this.isNative()){e.value=Math.pow(this.value,e.value)}else if(m.isBN(this.value)){e.value=this.value.pow(e.value)}return e};m.prototype.isOdd=function(){if(this.isNative()){return this.value%2===1}else if(m.isBN(this.value)){return this.value.isOdd()}};m.prototype.isEven=function(){return!this.isOdd()};m.prototype.cmp=function(e){e=this.coerce(e);if(this.isNative()){if(this.value<e.value){return-1}else if(this.value===e.value){return 0}else{return 1}}else if(m.isBN(this.value)){return this.value.cmp(e.value)}};function w(e,n,r){this.env=e;this.parent=n;this.name=r}w.prototype.inherit=function(e,n){if(typeof e==="string"){n=e;e={}}if(!n){n="child of "+(this.name||"unknown")}return new w(e||{},this,n)};w.prototype.get=function(n){var r;if(n instanceof h){if(typeof this.env[n.name]!=="undefined"){r=this.env[n.name]}}else if(typeof n==="string"){if(typeof this.env[n]!=="undefined"){r=this.env[n]}}if(typeof r!=="undefined"){if(m.isNumber(r)){return m(r)}return r}if(this.parent instanceof w){return this.parent.get(n)}else{var t;if(n instanceof h){t=n.name}else if(typeof n==="string"){t=n}if(t){var i=_typeof(e[t]);if(i==="function"){return e[t].bind(e)}else if(i!=="undefined"){return e[t]}}}};w.prototype.set=function(e,n){if(m.isNumber(n)){n=m(n)}if(e instanceof h){e=e.name}this.env[e]=n};function g(e){this.value=e}function b(e,n){this.value=e;this.count=n}b.prototype.toString=function(){return"<#unquote["+this.count+"] "+this.value+">"};function A(e){return new y(function(n,r){var t=this.get("list->array")(n.car);var i=this.inherit("let");return new Promise(function(a){var o=[];var f=0;(function u(){var c=t[f++];function s(e){if(e instanceof Promise){o.push(e);return e.then(s)}else{i.set(c.car,e)}}if(!c){var l=new d(new h("begin"),n.cdr);a(new g(q(l,i,r?i:r)))}else{var v=q(c.cdr.car,e?i:this,r);var p=s(v);if(p instanceof Promise){p.then(function(){Promise.all(o).then(u)})}else{u()}}})()})})}var N=function(){var e=0;return function(){e++;return new h("#"+e)}}();function E(e){var n=arguments.length>1&&arguments[1]!==r?arguments[1]:"GET";var t=arguments.length>2&&arguments[2]!==r?arguments[2]:{};var i=arguments.length>3&&arguments[3]!==r?arguments[3]:null;var a=new XMLHttpRequest;a.open(n,e,true);Object.keys(t).forEach(function(e){a.setRequestHeader(e,t[e])});return new Promise(function(e){a.onreadystatechange=function(){if(a.readyState===4&&a.status===200){e(a.responseText)}};if(i!==null){a.send(i)}else{a.send()}})}var S=new w({nil:p,true:true,false:false,stdout:{write:function e(){var n;(n=console).log.apply(n,arguments)}},stdin:{read:function e(){return new Promise(function(e){e(prompt(""))})}},cons:function e(n,r){return new d(n,r)},car:function e(n){if(n instanceof d){return n.car}else{throw new Error("argument to car need to be a list")}},cdr:function e(n){if(n instanceof d){return n.cdr}else{throw new Error("argument to cdr need to be a list")}},"set-car":function e(n,r){n.car=r},"set-cdr":function e(n,r){n.cdr=r},assoc:function e(n,r){var t=n;var i=r instanceof h?r.name:r;while(true){var a=t.car.car;if(a instanceof h&&a.name===i||a.name===i){return t.car}else{t=t.cdr}}},gensym:N,load:function e(n){var r=this;E(n).then(function(e){r.get("eval")(r.get("read")(e))})},while:new y(function(e){var n=this;var r=new d(new h("begin"),e.cdr);return new Promise(function(t){var i;(function a(){function o(e){if(e){var o=q(r,n);if(o instanceof Promise){o.then(function(e){i=e;a()})}else{i=o;a()}}else{t(i)}}var f=q(e.car,n);if(f instanceof Promise){f.then(o)}else{o(f)}})()})}),if:new y(function(e){var n=this;var r=function r(t){if(t){var i=q(e.cdr.car,n);if(typeof i==="undefined"){return}return i}else if(e.cdr.cdr.car instanceof d){var a=q(e.cdr.cdr.car,n);if(typeof a==="undefined"){return false}return a}else{return false}};var t=q(e.car,this);if(t instanceof Promise){return t.then(r)}else{return r(t)}}),"let*":A(true),let:A(false),begin:new y(function(e,n){var r=this;var t=this.get("list->array")(e);return t.reduce(function(e,t){return q(t,r,n)},0)}),timer:new y(function(e){var n=this;return new Promise(function(r){setTimeout(function(){r(new g(q(e.cdr,n)))},e.car)})}),define:new y(function(e,n){var r=this;if(e.car instanceof d&&e.car.car instanceof h){var t=new d(new h("define"),new d(e.car.car,new d(new d(new h("lambda"),new d(e.car.cdr,e.cdr)))));return t}var i=e.cdr.car;if(i instanceof d){i=q(i,this,n)}if(e.car instanceof h){if(i instanceof Promise){return i.then(function(n){r.set(e.car,n)})}else{this.set(e.car,i)}}}),set:function e(n,r,t){n[r]=t},eval:function e(n,r){var t=this;if(n instanceof d){return q(n,this,r)}if(n instanceof Array){var i;n.forEach(function(e){i=q(e,t,r)});return i}},lambda:new y(function(e,n){var t=this;return function(){var i=(n?this:t).inherit("lambda");var a=e.car;var o=0;var f;if(!a.isEmptyList()){for(var u=arguments.length,c=Array(u),s=0;s<u;s++){c[s]=arguments[s]}while(true){if(a.car!==p){if(a instanceof h){f=d.fromArray(c.slice(o));i.env[a.name]=f;break}else{if(typeof c[o]==="undefined"){f=p}else{f=c[o]}i.env[a.car.name]=f}}if(a.cdr===p){break}o++;a=a.cdr}}return q(e.cdr.car,i,n?i:r)}}),defmacro:new y(function(e){if(e.car.car instanceof h){this.env[e.car.car.name]=new y(function(n){var r=new w({},this,"defmacro");var t=e.car.cdr;var i=n;while(true){if(t.car!==p&&i.car!==p){r.env[t.car.name]=i.car}if(t.cdr===p){break}i=i.cdr;t=t.cdr}return q(e.cdr.car,r)})}}),quote:new y(function(e){return new g(e.car)}),quasiquote:new y(function(e){var n=this;var r=0;function t(e){if(e instanceof d){var i;if(h.is(e.car.car,"unquote-splicing")){i=q(e.car.cdr.car,n);if(!i instanceof d){throw new Error("Value of unquote-splicing need"+" to be pair")}if(e.cdr instanceof d){if(i instanceof d){i.cdr.append(t(e.cdr))}else{i=new d(i,t(e.cdr))}}return i}if(h.is(e.car,"unquote")){var a=e.cdr;var o=a;var f=o;var u=1;while(h.is(o.car.car,"unquote")){f=o;u++;o=o.car.cdr.car}if(u>r){r=u}if(f===o){if(e.cdr.cdr!==p){return new d(new b(e.cdr.car,u),e.cdr.cdr)}else{return new b(e.cdr.car,u)}}else if(f.cdr.cdr!==p){f.car.cdr=new d(new b(o,u),f.cdr===p?p:f.cdr.cdr)}else{f.car.cdr=new b(o,u)}return a.car}var c=e.car;if(c instanceof d){c=t(c)}var s=e.cdr;if(s instanceof d){s=t(s)}return new d(c,s)}return e}function i(e){if(e instanceof b){if(r===e.count){return q(e.value,n)}else{return new d(new h("unquote"),new d(i(e.value),p))}}if(e instanceof d){var t=e.car;if(t instanceof d||t instanceof b){t=i(t)}var a=e.cdr;if(a instanceof d||a instanceof b){a=i(a)}return new d(t,a)}return e}return new g(i(t(e.car)))}),clone:function e(n){return n.clone()},append:function e(n,r){return this.get("append!")(n.clone(),r)},"append!":function e(n,r){return n.append(r)},list:function e(){return d.fromArray([].slice.call(arguments))},concat:function e(){return[].join.call(arguments,"")},join:function e(n,r){return this.get("list->array")(r).join(n)},split:function e(n,r){return this.get("array->list")(n.split(r))},replace:function e(n,r,t){return n.replace(r,t)},match:function e(n,r){return this.get("array->list")(n.match(r))},search:function e(n,r){return n.search(r)},string:function e(n){if(typeof jQuery!=="undefined"&&n instanceof jQuery.fn.init){return"<#jQuery>"}if(n instanceof y){}if(n instanceof m){return n.value.toString()}if(typeof n==="undefined"){return"<#undefined>"}if(typeof n==="function"){return"<#function>"}if(n===p){return"nil"}if(n instanceof Array||n===null){return JSON.stringify(n)}if(n instanceof d){return n.toString()}if((typeof n==="undefined"?"undefined":_typeof(n))==="object"){var r=n.constructor.name;if(r!==""){return"<#"+r+">"}return"<#Object>"}if(typeof n!=="string"){return n.toString()}return n},env:function e(n){n=n||this;var t=Object.keys(n.env);var i;if(t.length){i=d.fromArray(t)}else{i=p}if(n.parent!==r){return this.get("env").call(this,n.parent).append(i)}return i},".":function e(n,r){var t=r instanceof h?r.name:r;var i=n[t];if(typeof i==="function"){return i.bind(n)}return i},type:function e(n){return typeof n==="undefined"?"undefined":_typeof(n)},instanceof:function e(n,r){return n instanceof r},read:function e(n){var r=this;if(typeof n==="string"){return s(f(n))}return this.get("stdin").read().then(function(e){return r.get("read").call(r,e)})},print:function e(){var n,r=this;for(var t=arguments.length,i=Array(t),a=0;a<t;a++){i[a]=arguments[a]}(n=this.get("stdout")).write.apply(n,_toConsumableArray(i.map(function(e){return r.get("string")(e)})))},flatten:function e(n){return n.flatten()},"array->list":function e(n){return d.fromArray(n)},"list->array":function e(n){var r=[];var t=n;while(true){if(t instanceof d){r.push(t.car);t=t.cdr}else{break}}return r},filter:function e(n,r){return d.fromArray(this.get("list->array")(r).filter(n))},apply:function e(n,r){var t=this.get("list->array")(r);return n.apply(null,t)},map:function e(n,r){var t=this.get("list->array")(r).map(n);if(t.length){return d.fromArray(t)}else{return p}},reduce:function e(n,t){var i=arguments.length>2&&arguments[2]!==r?arguments[2]:null;var a=this.get("list->array")(t);if(i===null){return a.slice(1).reduce(function(e,r){return n(e,r)},a[0])}else{return a.reduce(function(e,r){return n(e,r)},i)}},curry:function e(n){for(var r=arguments.length,t=Array(r>1?r-1:0),i=1;i<r;i++){t[i-1]=arguments[i]}var a=n.length;return function(){var e=t.slice();function r(){for(var t=arguments.length,i=Array(t),o=0;o<t;o++){i[o]=arguments[o]}e=e.concat(i);if(e.length>=a){return n.apply(this,e)}else{return r}}return r.apply(this,arguments)}},odd:function e(n){return m(n).isOdd()},even:function e(n){return m(n).isEvent()},range:function e(n){if(n instanceof m){n=n.valueOf()}return d.fromArray(new Array(n).fill(0).map(function(e,n){return m(n)}))},"*":function e(){for(var n=arguments.length,r=Array(n),t=0;t<n;t++){r[t]=arguments[t]}return r.reduce(function(e,n){return m(e).mul(n)})},"+":function e(){for(var n=arguments.length,r=Array(n),t=0;t<n;t++){r[t]=arguments[t]}return r.reduce(function(e,n){if(m.isNumber(e)&&m.isNumber(n)){return m(e).add(n)}else if(typeof e==="string"){return e+n}})},"-":function e(){for(var n=arguments.length,r=Array(n),t=0;t<n;t++){r[t]=arguments[t]}return r.reduce(function(e,n){return m(e).sub(n)})},"/":function e(){for(var n=arguments.length,r=Array(n),t=0;t<n;t++){r[t]=arguments[t]}return r.reduce(function(e,n){return m(e).div(n)})},"1+":function e(n){return m(n).add(1)},"1-":function e(n){return m(n).sub(1)},"++":new y(function(e){var n=this.get(e.car);var r=m(n).add(1);this.set(e.car,r);return r}),"--":new y(function(e){var n=this.get(e.car);var r=m(n).sub(1);this.set(e.car,r);return r}),"%":function e(n,r){return m(n).mod(r)},"==":function e(n,r){return m(n).cmp(r)===0},">":function e(n,r){return m(n).cmp(r)===1},"<":function e(n,r){return m(n).cmp(r)===-1},"<=":function e(n,r){return[0,-1].includes(m(n).cmp(r))},">=":function e(n,r){[0,1].includes(m(n).cmp(r))},or:new y(function(e){var n=this.get("list->array")(e);var r=this;return new Promise(function(e){var t;(function i(){function a(n){t=n;if(t){e(n)}i()}var o=n.shift();if(typeof o==="undefined"){if(t){e(t)}else{e(false)}}else{var f=q(o,r);if(f instanceof Promise){f.then(a)}else{a(f)}}})()})}),and:new y(function(e){var n=this.get("list->array")(e);var r=this;return new Promise(function(e){var t;(function i(){function a(n){t=n;if(!t){e(false)}i()}var o=n.shift();if(typeof o==="undefined"){if(t){e(t)}else{e(false)}}else{var f=q(o,r);if(f instanceof Promise){f.then(a)}else{a(f)}}})()})}),not:function e(n){if(n===p){return true}return!n},"->":function e(n,r){for(var t=arguments.length,i=Array(t>2?t-2:0),a=2;a<t;a++){i[a-2]=arguments[a]}return n[r].apply(n,i)}},r,"global");function P(e){if(e.length===1){return e[0]}else{var n=[];var r=P(e.slice(1));for(var t=0;t<r.length;t++){for(var i=0;i<e[0].length;i++){n.push(e[0][i]+r[t])}}return n}}function k(e,n,r){var t=[];for(var i=n;i<=r;++i){var a=[];for(var o=0;o<i;++o){a.push(e)}t=t.concat(P(a))}return t}k(["d","a"],2,5).forEach(function(e){var n=e.split("").reverse();S.set("c"+e+"r",function(e){return n.reduce(function(e,n){if(n==="a"){return e.car}else{return e.cdr}},e)})});if(typeof global!=="undefined"){S.set("global",global)}else if(typeof window!=="undefined"){S.set("window",window)}function q(e,n,r){if(r===true){n=r=n||S}else if(n===true){n=r=S}else{n=n||S}var t;if(typeof e==="undefined"){return}var i=e.car;var a=e.cdr;if(i instanceof d){t=q(i,n,r);if(t instanceof Promise){return t.then(function(t){return q(new d(t,e.cdr),n,r)})}else if(typeof t!=="function"){throw new Error(n.get("string")(t)+" is not a function")}}if(typeof i==="function"){t=i}if(i instanceof h){t=n.get(i);if(t instanceof y){t=t.invoke(i,a,n,r);if(t instanceof g){return t.value}else if(t instanceof Promise){return t.then(function(e){if(e instanceof g){return e.value}return q(e,n,r)})}return q(t,n,r)}else if(typeof t!=="function"){throw new Error("Unknown function `"+i.name+"'")}}if(typeof t==="function"){var o=[];var f=a;while(true){if(f instanceof d){o.push(q(f.car,n,r));f=f.cdr}else{break}}var u=o.filter(function(e){return e instanceof Promise});if(u.length){return Promise.all(o).then(function(e){return t.apply(r||n,e)})}return t.apply(r||n,o)}else if(e instanceof h){t=n.get(e);if(t==="undefined"){throw new Error("Unbound variable `"+e.name+"'")}return t}else{return e}}function j(e,n,r){if(r===true){n=r=n||S}else if(n===true){n=r=S}else{n=n||S}var t=s(f(e));return new Promise(function(e,i){var a=[];(function o(){function f(e){a.push(e);o()}var u=t.shift();if(!u){e(a)}else{try{var c=q(u,n,r)}catch(e){return i(e)}if(c instanceof Promise){c.then(f).catch(i)}else{f(c)}}})()})}function O(e){var n=/[()]/;var r=f(e).filter(function(e){return e.match(n)});var t=r.filter(function(e){return e===")"});var i=r.filter(function(e){return e==="("});return t.length===i.length}d.unDry=function(e){return new d(e.car,e.cdr)};d.prototype.toDry=function(){return{value:{car:this.car,cdr:this.cdr}}};v.prototype.toDry=function(){return{value:null}};v.unDry=function(){return p};h.prototype.toDry=function(){return{value:{name:this.name}}};h.unDry=function(e){return new h(e.name)};function B(){var e="text-x/lips";if(window.document){Array.from(document.querySelectorAll("script")).forEach(function(n){var r=n.getAttribute("type");if(r===e){j(n.innerHTML)}else if(r==="text-x/lisp"){console.warn("Expecting "+e+" found "+r)}})}}function x(e){if(typeof window!=="undefined"){if(window.addEventListener){window.addEventListener("load",e,false)}else if(window.attachEvent){window.attachEvent("onload",e)}else if(typeof window.onload==="function"){(function(n){window.onload=function(){e();n()}})(window.onload)}else{window.onload=e}}}x(function(){setTimeout(B,0)});return{version:"DEV",exec:j,parse:s,tokenize:f,evaluate:q,Environment:w,global_environment:S,balanced_parenthesis:O,Macro:y,Quote:g,Pair:d,nil:p,Symbol:h,LNumber:m}});