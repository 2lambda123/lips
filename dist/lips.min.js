/**@license
 * LIPS is Pretty Simple - version DEV
 *
 * Copyright (c) 2018 Jakub Jankiewicz <http://jcubic.pl/me>
 * Released under the MIT license
 *
 * build: Tue, 27 Feb 2018 18:35:56 +0000
 */
"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol==="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};function _toConsumableArray(n){if(Array.isArray(n)){for(var r=0,e=Array(n.length);r<n.length;r++){e[r]=n[r]}return e}else{return Array.from(n)}}(function(n,r){if(typeof define==="function"&&define.amd){define([],function(){return n.lips=r()})}else if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&module.exports){module.exports=r()}else{n.lips=r()}})(typeof self!=="undefined"?self:undefined,function(n){var r=/^\/((?:\\\/|[^/]|\[[^\]]*\/[^\]]*\])+)\/([gimy]*)$/;var e=/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/;function t(n){function t(n){if(n.match(/^['"]/)){if(n==='""'||n==="''"){return""}var r=n[0];var e=new RegExp("((^|[^\\\\])(?:\\\\\\\\)*)"+r,"g");n=n.replace(e,"$1")}return JSON.parse('"'+n+'"')}var i=n.match(r);if(i){return new RegExp(i[1],i[2])}else if(n.match(/['"]/)){return t(n)}else if(n.match(/^-?[0-9]+$/)){return parseInt(n,10)}else if(n.match(e)){return parseFloat(n)}else if(n==="nil"){return l}else{return new c(n)}}var i=/("[^"\\]*(?:\\[\S\s][^"\\]*)*"|\/[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|;.*|\(|\)|'|\.|,@|,|`|[^(\s)]+)/gi;function f(n){return n.split("\n").map(function(n){return n.split(i).map(function(n){if(n.match(/^;/)){return null}return n.trim()}).filter(Boolean)}).reduce(function(n,r){return n.concat(r)},[])}var a={"'":new c("quote"),"`":new c("quasiquote"),",":new c("unquote"),",@":new c("unquote-splicing")};function o(n){var r=[];var e=[];var i=null;var f=Object.keys(a);var o=f.map(function(n){return a[n].name});var s=0;var h=false;n.forEach(function(n){var p=r[r.length-1];if(f.indexOf(n)!==-1){i=n}else if(n==="("){h=true;s++;if(i){r.push([a[i]]);i=null}r.push([])}else if(n==="."&&!h){r[r.length-1]=u.fromArray(p)}else if(n===")"){s--;if(!r.length){throw new Error("Unbalanced parenthesis 1")}if(r.length===1){e.push(r.pop())}else if(r.length>1){var d=r.pop();p=r[r.length-1];p.push(d);if(p instanceof Array&&p[0]instanceof c&&o.includes(p[0].name)&&r.length>1){r.pop();if(r[r.length-1].length===0){r[r.length-1]=p}else if(r[r.length-1]instanceof u){console.log(r[r.length-1].toString());if(r[r.length-1].cdr instanceof u){console.log("top: "+JSON.stringify(p));r[r.length-1]=new u(r[r.length-1],u.fromArray(p))}else{r[r.length-1].cdr=u.fromArray(p)}}else{r[r.length-1].push(p)}}}if(s===0&&r.length){e.push(r.pop())}}else{h=false;var v=t(n);if(i){v=[a[i],v];i=false}if(p instanceof u){var y=p;while(true){if(y.cdr===l){y.cdr=v;break}else{y=y.cdr}}}else if(!r.length){e.push(v)}else{p.push(v)}}});if(r.length){throw new Error("Unbalanced parenthesis 2")}return e.map(function(n){if(n instanceof Array){return u.fromArray(n)}return n})}function c(n){this.name=n}c.is=function(n,r){return n instanceof c&&typeof r==="string"&&n.name===r};c.prototype.toJSON=c.prototype.toString=function(){return this.name};function u(n,r){this.car=n;this.cdr=r}u.prototype.length=function(){var n=0;var r=this;while(true){if(r===l){return}n++;r=r.cdr}return n};u.prototype.clone=function(){var n;if(this.cdr===l){n=l}else{n=this.cdr.clone()}return new u(this.car,n)};u.prototype.toArray=function(){if(this.cdr===l&&this.car===l){return[]}var n=[];if(this.car instanceof u){n.push(this.car.toArray())}else{n.push(this.car)}if(this.cdr instanceof u){n=n.concat(this.cdr.toArray())}return n};u.fromArray=function(n){if(n instanceof u){return n}if(n.length&&!n instanceof Array){n=[].concat(_toConsumableArray(n))}if(n.length===0){return new u(l,l)}else{var r;if(n[0]instanceof Array){r=u.fromArray(n[0])}else{r=n[0]}if(n.length===1){return new u(r,l)}else{return new u(r,u.fromArray(n.slice(1)))}}};u.prototype.transform=function(n){var r=[];function e(t){if(t instanceof u){if(t.replace){delete t.replace;return t}var i=n(t.car);if(i instanceof u){i=e(i);r.push(i)}var f=n(t.cdr);if(f instanceof u){f=e(f);r.push(f)}return new u(i,f)}return t}return e(this)};u.prototype.toString=function(){var n=["("];if(typeof this.car==="string"){n.push(JSON.stringify(this.car))}else if(typeof this.car!=="undefined"){n.push(this.car)}if(this.cdr instanceof u){n.push(" ");n.push(this.cdr.toString().replace(/^\(|\)$/g,""))}else if(typeof this.cdr!=="undefined"&&this.cdr!==l){if(typeof this.cdr==="string"){n=n.concat([" . ",JSON.stringify(this.cdr)])}else{n=n.concat([" . ",this.cdr])}}n.push(")");return n.join("")};u.prototype.append=function(n){var r=this;while(true){if(r instanceof u&&r.cdr!==l){r=r.cdr}else{break}}r.cdr=n;return this};function s(){}s.prototype.toString=function(){return"nil"};var l=new s;function h(n){this.fn=n}h.prototype.invoke=function(n,r){return this.fn.call(r,n)};function p(n,r){this.env=n;this.parent=r}p.prototype.get=function(n){if(n instanceof c){if(typeof this.env[n.name]!=="undefined"){return this.env[n.name]}}else if(typeof n==="string"){if(typeof this.env[n]!=="undefined"){return this.env[n]}}if(this.parent instanceof p){return this.parent.get(n)}else if(n instanceof c){if(typeof window[n.name]!=="undefined"){return window[n.name]}}else if(typeof n==="string"){if(typeof window[n]!=="undefined"){return window[n]}}};p.prototype.set=function(n,r){this.env[n]=r};function d(n){this.value=n}function v(n){return new h(function(r){var e=this;var t=this.get("list->array")(r.car);var i=new p({},this);t.forEach(function(r){i.set(r.car,m(r.cdr.car,n?i:e))});var f=new u(new c("begin"),r.cdr);return new d(m(f,i))})}var y=new p({nil:l,window:window,true:true,false:false,stdout:{write:function n(){var r;(r=console).log.apply(r,arguments)}},stdin:{read:function n(){return new Promise(function(n){n(prompt(""))})}},cons:function n(r,e){return new u(r,e)},car:function n(r){if(r instanceof u){return r.car}},cdr:function n(r){if(r instanceof u){return r.cdr}},"set-car":function n(r,e){r.car=e},"set-cdr":function n(r,e){r.cdr=e},assoc:function n(r,e){var t=r;var i=e instanceof c?e.name:e;while(true){var f=t.car.car;if(f instanceof c&&f.name===i||f.name===i){return t.car}else{t=t.cdr}}},while:new h(function(n){var r=this;var e=new u(new c("begin"),n.cdr);return new Promise(function(t){var i;(function f(){function a(n){if(n){var a=m(e,r);if(a instanceof Promise){a.then(function(n){i=n;f()})}else{i=a;f()}}else{t(i)}}var o=m(n.car,r);if(o instanceof Promise){o.then(a)}else{a(o)}})()})}),if:new h(function(n){var r=this;var e=function e(t){if(t){var i=m(n.cdr.car,r);if(typeof i==="undefined"){return}return i}else if(n.cdr.cdr.car instanceof u){var f=m(n.cdr.cdr.car,r);if(typeof f==="undefined"){return false}return f}else{return false}};var t=m(n.car,this);if(t instanceof Promise){return t.then(e)}else{return e(t)}}),"let*":v(true),let:v(false),begin:new h(function(n){var r=this;var e=this.get("list->array")(n);return e.reduce(function(n,e){return m(e,r)},0)}),timer:new h(function(n){var r=this;return new Promise(function(e){setTimeout(function(){e(new d(m(n.cdr,r)))},n.car)})}),define:new h(function(n){if(n.car instanceof u&&n.car.car instanceof c){var r=new u(new c("define"),new u(n.car.car,new u(new u(new c("lambda"),new u(n.car.cdr,n.cdr)))));return r}var e=n.cdr.car;if(e instanceof u){e=m(e,this)}if(n.car instanceof c){this.env[n.car.name]=e}}),set:function n(r,e,t){r[e]=t},eval:function n(r){var e=this;if(r instanceof u){return m(r,this)}if(r instanceof Array){var t;r.forEach(function(n){t=m(n,e)});return t}},lambda:new h(function(r){var e=this;return function(){var t=new p({},e);var i=r.car;var f=0;var a;while(true){if(i.car!==l){if(typeof(arguments.length<=f?n:arguments[f])==="undefined"){a=l}else{a=arguments.length<=f?n:arguments[f]}t.env[i.car.name]=a}if(i.cdr===l){break}f++;i=i.cdr}return m(r.cdr.car,t)}}),defmacro:new h(function(n){if(n.car.car instanceof c){this.env[n.car.car.name]=new h(function(r){var e=new p({},this);var t=n.car.cdr;var i=r;while(true){if(t.car!==l&&i.car!==l){e.env[t.car.name]=i.car}if(t.cdr===l){break}i=i.cdr;t=t.cdr}return m(n.cdr.car,e)})}}),quote:new h(function(n){return new d(n.car)}),quasiquote:new h(function(n){var r=this;function e(n){if(n instanceof u){var t;if(c.is(n.car.car,"unquote-splicing")){t=m(n.car.cdr.car,r);if(!t instanceof u){throw new Error("Value of unquote-splicing need"+" to be pair")}if(n.cdr instanceof u){if(t instanceof u){t.cdr.append(e(n.cdr))}else{t=new u(t,e(n.cdr))}}return t}if(c.is(n.car,"unquote-splicing")){t=m(n.cdr.car,r);if(!t instanceof u){throw new Error("Value of unquote-splicing"+" need to be pair")}return t}if(c.is(n.car,"unquote")){return m(n.cdr.car,r)}var i=n.car;if(i instanceof u){i=e(i)}var f=n.cdr;if(f instanceof u){f=e(f)}return new u(i,f)}return n}return new d(e(n.car))}),clone:function n(r){return r.clone()},append:function n(r,e){return this.get("append!")(r.clone(),e)},"append!":function n(r,e){var t=r;while(true){if(t.cdr===l){t.cdr=e;break}t=t.cdr}return r},list:function n(){return u.fromArray([].slice.call(arguments))},concat:function n(){return[].join.call(arguments,"")},string:function n(r){if(typeof jQuery!=="undefined"&&r instanceof jQuery.fn.init){return"<#jQuery>"}if(typeof r==="undefined"){return"<#undefined>"}if(typeof r==="function"){return"<#function>"}if(typeof r!=="string"){return r.toString()}return r},env:function r(e){e=e||this;var t=Object.keys(e.env);var i;if(t.length){i=u.fromArray(t)}else{i=l}if(e.parent!==n){return this.get("env").call(this,e.parent).append(i)}return i},".":function n(r,e){var t=e instanceof c?e.name:e;var i=r[t];if(typeof i==="function"){return i.bind(r)}return i},read:function n(r){var e=this;if(typeof r==="string"){return o(f(r))}return this.get("stdin").read().then(function(n){return e.get("read").call(e,n)})},print:function n(){var r,e=this;for(var t=arguments.length,i=Array(t),f=0;f<t;f++){i[f]=arguments[f]}(r=this.get("stdout")).write.apply(r,_toConsumableArray(i.map(function(n){return e.get("string")(n)})))},"array->list":function n(r){return u.fromArray(r)},"list->array":function n(r){var e=[];var t=r;while(true){if(t instanceof u){e.push(t.car);t=t.cdr}else{break}}return e},filter:function n(r,e){return u.fromArray(this.get("list->array")(e).filter(r))},odd:function n(r){return r%2===1},even:function n(r){return r%2===0},apply:function n(r,e){var t=this.get("list->array")(e);return r.apply(null,t)},map:function n(r,e){var t=this.get("list->array")(e).map(r);if(t.length){return u.fromArray(t)}else{return l}},reduce:function n(r,e){var t=this.get("list->array")(e);return t.reduce(function(n,e){return r(n,e)},l)},"*":function n(){for(var r=arguments.length,e=Array(r),t=0;t<r;t++){e[t]=arguments[t]}return e.reduce(function(n,r){return n*r})},"+":function n(){for(var r=arguments.length,e=Array(r),t=0;t<r;t++){e[t]=arguments[t]}return e.reduce(function(n,r){return n+r})},"-":function n(){for(var r=arguments.length,e=Array(r),t=0;t<r;t++){e[t]=arguments[t]}return e.reduce(function(n,r){return n-r})},"/":function n(){for(var r=arguments.length,e=Array(r),t=0;t<r;t++){e[t]=arguments[t]}return e.reduce(function(n,r){return n/r})},"%":function n(r,e){return r%e},"==":function n(r,e){return r===e},">":function n(r,e){return r>e},"<":function n(r,e){return r<e},"<=":function n(r,e){return r<=e},">=":function n(r,e){return r>=e},or:new h(function(n){var r=this.get("list->array")(n);var e=this;return new Promise(function(n){var t;(function i(){function f(r){t=r;if(t){n(r)}i()}var a=r.shift();if(typeof a==="undefined"){if(t){n(t)}else{n(false)}}else{var o=m(a,e);if(o instanceof Promise){o.then(f)}else{f(o)}}})()})}),and:new h(function(n){var r=this.get("list->array")(n);var e=this;return new Promise(function(n){var t;(function i(){function f(r){t=r;if(!t){n(false)}i()}var a=r.shift();if(typeof a==="undefined"){if(t){n(t)}else{n(false)}}else{var o=m(a,e);if(o instanceof Promise){o.then(f)}else{f(o)}}})()})}),"++":new h(function(n){var r=this.get(n.car)+1;this.set(n.car,r);return r}),"--":new h(function(n){var r=this.get(n.car)-1;this.set(n.car,r);return r})});function g(n){if(n.length===1){return n[0]}else{var r=[];var e=g(n.slice(1));for(var t=0;t<e.length;t++){for(var i=0;i<n[0].length;i++){r.push(n[0][i]+e[t])}}return r}}function w(n,r,e){var t=[];for(var i=r;i<=e;++i){var f=[];for(var a=0;a<i;++a){f.push(n)}t=t.concat(g(f))}return t}w(["d","a"],2,5).forEach(function(n){var r=n.split("").reverse();y.set("c"+n+"r",function(n){return r.reduce(function(n,r){if(r==="a"){return n.car}else{return n.cdr}},n)})});function m(n,r){r=r||y;var e;if(typeof n==="undefined"){return}var t=n.car;var i=n.cdr;if(t instanceof u){e=m(t,r);if(typeof e!=="function"){throw new Error(r.get("string")(e)+" is not a function")}}if(typeof t==="function"){e=t}if(t instanceof c){e=r.get(t);if(e instanceof h){e=e.invoke(i,r);if(e instanceof d){return e.value}return m(e,r)}else if(typeof e!=="function"){throw new Error("Unknown function `"+t.name+"'")}}if(typeof e==="function"){var f=[];var a=i;while(true){if(a instanceof u){f.push(m(a.car,r));a=a.cdr}else{break}}var o=f.filter(function(n){return n instanceof Promise});if(o.length){return Promise.all(f).then(function(n){return e.apply(r,n)})}return e.apply(r,f)}else if(n instanceof c){e=r.get(n);if(e==="undefined"){throw new Error("Unbound variable `"+n.name+"'")}return e}else{return n}}function b(n){var r=/[()]/;var e=f(n).filter(function(n){return n.match(r)});var t=e.filter(function(n){return n===")"});var i=e.filter(function(n){return n==="("});return t.length===i.length}u.unDry=function(n){return new u(n.car,n.cdr)};u.prototype.toDry=function(){return{value:{car:this.car,cdr:this.cdr}}};s.prototype.toDry=function(){return{value:null}};s.unDry=function(){return l};c.prototype.toDry=function(){return{value:{name:this.name}}};c.unDry=function(n){return new c(n.name)};return{version:"DEV",parse:o,tokenize:f,evaluate:m,Environment:p,global_environment:y,balanced_parenthesis:b,Macro:h,Quote:d,Pair:u,nil:l,Symbol:c}});