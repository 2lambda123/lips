/**@license
 *   __ __                          __
 *  / / \ \       _    _  ___  ___  \ \
 * | |   \ \     | |  | || . \/ __>  | |
 * | |    > \    | |_ | ||  _/\__ \  | |
 * | |   / ^ \   |___||_||_|  <___/  | |
 *  \_\ /_/ \_\                     /_/ v. DEV
 *
 * LIPS is Pretty Simple - Scheme based Powerful LISP in JavaScript
 *
 * Copyright (c) 2018-2020 Jakub T. Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 * includes:
 *
 * unfetch by Jason Miller (@developit) MIT License
 *
 * contentloaded.js
 *
 * Author: Diego Perini (diego.perini at gmail.com)
 * Summary: cross-browser wrapper for DOMContentLoaded
 * Updated: 20101020
 * License: MIT
 * Version: 1.2
 *
 * URL:
 * http://javascript.nwbox.com/ContentLoaded/
 * http://javascript.nwbox.com/ContentLoaded/MIT-LICENSE
 *
 * dist file generated by Babel includes code
 * Copyright (c) 2014-present, Facebook, Inc.
 * released under MIT license
 *
 * build: Wed, 11 Nov 2020 11:21:50 +0000
 */
(function(){"use strict";function _readOnlyError(e){throw new Error('"'+e+'" is read-only')}var readOnlyError=_readOnlyError;function createCommonjsModule(e,r){return r={exports:{}},e(r,r.exports),r.exports}var setPrototypeOf=createCommonjsModule(function(n){function t(e,r){n.exports=t=Object.setPrototypeOf||function e(r,n){r.__proto__=n;return r};return t(e,r)}n.exports=t});function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}var isNativeReflectConstruct=_isNativeReflectConstruct;var construct=createCommonjsModule(function(t){function i(e,r,n){if(isNativeReflectConstruct()){t.exports=i=Reflect.construct}else{t.exports=i=function e(r,n,t){var i=[null];i.push.apply(i,n);var a=Function.bind.apply(r,i);var o=new a;if(t)setPrototypeOf(o,t.prototype);return o}}return i.apply(null,arguments)}t.exports=i});function _arrayWithHoles(e){if(Array.isArray(e))return e}var arrayWithHoles=_arrayWithHoles;function _iterableToArray(e){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(e))return Array.from(e)}var iterableToArray=_iterableToArray;function _arrayLikeToArray(e,r){if(r==null||r>e.length)r=e.length;for(var n=0,t=new Array(r);n<r;n++){t[n]=e[n]}return t}var arrayLikeToArray=_arrayLikeToArray;function _unsupportedIterableToArray(e,r){if(!e)return;if(typeof e==="string")return arrayLikeToArray(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return arrayLikeToArray(e,r)}var unsupportedIterableToArray=_unsupportedIterableToArray;function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var nonIterableRest=_nonIterableRest;function _toArray(e){return arrayWithHoles(e)||iterableToArray(e)||unsupportedIterableToArray(e)||nonIterableRest()}var toArray=_toArray;function _arrayWithoutHoles(e){if(Array.isArray(e))return arrayLikeToArray(e)}var arrayWithoutHoles=_arrayWithoutHoles;function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var nonIterableSpread=_nonIterableSpread;function _toConsumableArray(e){return arrayWithoutHoles(e)||iterableToArray(e)||unsupportedIterableToArray(e)||nonIterableSpread()}var toConsumableArray=_toConsumableArray;var runtime_1=createCommonjsModule(function(e){var r=function(o){var e=Object.prototype;var f=e.hasOwnProperty;var c;var r=typeof Symbol==="function"?Symbol:{};var i=r.iterator||"@@iterator";var n=r.asyncIterator||"@@asyncIterator";var t=r.toStringTag||"@@toStringTag";function a(e,r,n){Object.defineProperty(e,r,{value:n,enumerable:true,configurable:true,writable:true});return e[r]}try{a({},"")}catch(e){a=function(e,r,n){return e[r]=n}}function u(e,r,n,t){var i=r&&r.prototype instanceof s?r:s;var a=Object.create(i.prototype);var o=new j(t||[]);a._invoke=k(e,n,o);return a}o.wrap=u;function l(e,r,n){try{return{type:"normal",arg:e.call(r,n)}}catch(e){return{type:"throw",arg:e}}}var p="suspendedStart";var d="suspendedYield";var m="executing";var h="completed";var v={};function s(){}function _(){}function y(){}var b={};b[i]=function(){return this};var g=Object.getPrototypeOf;var w=g&&g(g(E([])));if(w&&w!==e&&f.call(w,i)){b=w}var L=y.prototype=s.prototype=Object.create(b);_.prototype=L.constructor=y;y.constructor=_;_.displayName=a(y,t,"GeneratorFunction");function x(e){["next","throw","return"].forEach(function(r){a(e,r,function(e){return this._invoke(r,e)})})}o.isGeneratorFunction=function(e){var r=typeof e==="function"&&e.constructor;return r?r===_||(r.displayName||r.name)==="GeneratorFunction":false};o.mark=function(e){if(Object.setPrototypeOf){Object.setPrototypeOf(e,y)}else{e.__proto__=y;a(e,t,"GeneratorFunction")}e.prototype=Object.create(L);return e};o.awrap=function(e){return{__await:e}};function S(u,c){function s(e,r,n,t){var i=l(u[e],u,r);if(i.type==="throw"){t(i.arg)}else{var a=i.arg;var o=a.value;if(o&&typeof o==="object"&&f.call(o,"__await")){return c.resolve(o.__await).then(function(e){s("next",e,n,t)},function(e){s("throw",e,n,t)})}return c.resolve(o).then(function(e){a.value=e;n(a)},function(e){return s("throw",e,n,t)})}}var r;function e(n,t){function e(){return new c(function(e,r){s(n,t,e,r)})}return r=r?r.then(e,e):e()}this._invoke=e}x(S.prototype);S.prototype[n]=function(){return this};o.AsyncIterator=S;o.async=function(e,r,n,t,i){if(i===void 0)i=Promise;var a=new S(u(e,r,n,t),i);return o.isGeneratorFunction(r)?a:a.next().then(function(e){return e.done?e.value:a.next()})};function k(o,u,c){var s=p;return function e(r,n){if(s===m){throw new Error("Generator is already running")}if(s===h){if(r==="throw"){throw n}return A()}c.method=r;c.arg=n;while(true){var t=c.delegate;if(t){var i=P(t,c);if(i){if(i===v)continue;return i}}if(c.method==="next"){c.sent=c._sent=c.arg}else if(c.method==="throw"){if(s===p){s=h;throw c.arg}c.dispatchException(c.arg)}else if(c.method==="return"){c.abrupt("return",c.arg)}s=m;var a=l(o,u,c);if(a.type==="normal"){s=c.done?h:d;if(a.arg===v){continue}return{value:a.arg,done:c.done}}else if(a.type==="throw"){s=h;c.method="throw";c.arg=a.arg}}}}function P(e,r){var n=e.iterator[r.method];if(n===c){r.delegate=null;if(r.method==="throw"){if(e.iterator["return"]){r.method="return";r.arg=c;P(e,r);if(r.method==="throw"){return v}}r.method="throw";r.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var t=l(n,e.iterator,r.arg);if(t.type==="throw"){r.method="throw";r.arg=t.arg;r.delegate=null;return v}var i=t.arg;if(!i){r.method="throw";r.arg=new TypeError("iterator result is not an object");r.delegate=null;return v}if(i.done){r[e.resultName]=i.value;r.next=e.nextLoc;if(r.method!=="return"){r.method="next";r.arg=c}}else{return i}r.delegate=null;return v}x(L);a(L,t,"Generator");L[i]=function(){return this};L.toString=function(){return"[object Generator]"};function N(e){var r={tryLoc:e[0]};if(1 in e){r.catchLoc=e[1]}if(2 in e){r.finallyLoc=e[2];r.afterLoc=e[3]}this.tryEntries.push(r)}function O(e){var r=e.completion||{};r.type="normal";delete r.arg;e.completion=r}function j(e){this.tryEntries=[{tryLoc:"root"}];e.forEach(N,this);this.reset(true)}o.keys=function(n){var t=[];for(var e in n){t.push(e)}t.reverse();return function e(){while(t.length){var r=t.pop();if(r in n){e.value=r;e.done=false;return e}}e.done=true;return e}};function E(r){if(r){var e=r[i];if(e){return e.call(r)}if(typeof r.next==="function"){return r}if(!isNaN(r.length)){var n=-1,t=function e(){while(++n<r.length){if(f.call(r,n)){e.value=r[n];e.done=false;return e}}e.value=c;e.done=true;return e};return t.next=t}}return{next:A}}o.values=E;function A(){return{value:c,done:true}}j.prototype={constructor:j,reset:function(e){this.prev=0;this.next=0;this.sent=this._sent=c;this.done=false;this.delegate=null;this.method="next";this.arg=c;this.tryEntries.forEach(O);if(!e){for(var r in this){if(r.charAt(0)==="t"&&f.call(this,r)&&!isNaN(+r.slice(1))){this[r]=c}}}},stop:function(){this.done=true;var e=this.tryEntries[0];var r=e.completion;if(r.type==="throw"){throw r.arg}return this.rval},dispatchException:function(n){if(this.done){throw n}var t=this;function e(e,r){a.type="throw";a.arg=n;t.next=e;if(r){t.method="next";t.arg=c}return!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];var a=i.completion;if(i.tryLoc==="root"){return e("end")}if(i.tryLoc<=this.prev){var o=f.call(i,"catchLoc");var u=f.call(i,"finallyLoc");if(o&&u){if(this.prev<i.catchLoc){return e(i.catchLoc,true)}else if(this.prev<i.finallyLoc){return e(i.finallyLoc)}}else if(o){if(this.prev<i.catchLoc){return e(i.catchLoc,true)}}else if(u){if(this.prev<i.finallyLoc){return e(i.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(e,r){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc<=this.prev&&f.call(t,"finallyLoc")&&this.prev<t.finallyLoc){var i=t;break}}if(i&&(e==="break"||e==="continue")&&i.tryLoc<=r&&r<=i.finallyLoc){i=null}var a=i?i.completion:{};a.type=e;a.arg=r;if(i){this.method="next";this.next=i.finallyLoc;return v}return this.complete(a)},complete:function(e,r){if(e.type==="throw"){throw e.arg}if(e.type==="break"||e.type==="continue"){this.next=e.arg}else if(e.type==="return"){this.rval=this.arg=e.arg;this.method="return";this.next="end"}else if(e.type==="normal"&&r){this.next=r}return v},finish:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.finallyLoc===e){this.complete(n.completion,n.afterLoc);O(n);return v}}},catch:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc===e){var t=n.completion;if(t.type==="throw"){var i=t.arg;O(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){this.delegate={iterator:E(e),resultName:r,nextLoc:n};if(this.method==="next"){this.arg=c}return v}};return o}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}});var regenerator=runtime_1;function asyncGeneratorStep(e,r,n,t,i,a,o){try{var u=e[a](o);var c=u.value}catch(e){n(e);return}if(u.done){r(c)}else{Promise.resolve(c).then(t,i)}}function _asyncToGenerator(u){return function(){var e=this,o=arguments;return new Promise(function(r,n){var t=u.apply(e,o);function i(e){asyncGeneratorStep(t,r,n,i,a,"next",e)}function a(e){asyncGeneratorStep(t,r,n,i,a,"throw",e)}i(undefined)})}}var asyncToGenerator=_asyncToGenerator;function _classCallCheck(e,r){if(!(e instanceof r)){throw new TypeError("Cannot call a class as a function")}}var classCallCheck=_classCallCheck;function _defineProperties(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||false;t.configurable=true;if("value"in t)t.writable=true;Object.defineProperty(e,t.key,t)}}function _createClass(e,r,n){if(r)_defineProperties(e.prototype,r);if(n)_defineProperties(e,n);return e}var createClass=_createClass;function _defineProperty(e,r,n){if(r in e){Object.defineProperty(e,r,{value:n,enumerable:true,configurable:true,writable:true})}else{e[r]=n}return e}var defineProperty=_defineProperty;function _objectWithoutPropertiesLoose(e,r){if(e==null)return{};var n={};var t=Object.keys(e);var i,a;for(a=0;a<t.length;a++){i=t[a];if(r.indexOf(i)>=0)continue;n[i]=e[i]}return n}var objectWithoutPropertiesLoose=_objectWithoutPropertiesLoose;function _objectWithoutProperties(e,r){if(e==null)return{};var n=objectWithoutPropertiesLoose(e,r);var t,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++){t=a[i];if(r.indexOf(t)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,t))continue;n[t]=e[t]}}return n}var objectWithoutProperties=_objectWithoutProperties;function _iterableToArrayLimit(e,r){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(e)))return;var n=[];var t=true;var i=false;var a=undefined;try{for(var o=e[Symbol.iterator](),u;!(t=(u=o.next()).done);t=true){n.push(u.value);if(r&&n.length===r)break}}catch(e){i=true;a=e}finally{try{if(!t&&o["return"]!=null)o["return"]()}finally{if(i)throw a}}return n}var iterableToArrayLimit=_iterableToArrayLimit;function _slicedToArray(e,r){return arrayWithHoles(e)||iterableToArrayLimit(e,r)||unsupportedIterableToArray(e,r)||nonIterableRest()}var slicedToArray=_slicedToArray;var _typeof_1=createCommonjsModule(function(r){function n(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){r.exports=n=function e(r){return typeof r}}else{r.exports=n=function e(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r}}return n(e)}r.exports=n});function _createForOfIteratorHelper(r,e){var n;if(typeof Symbol==="undefined"||r[Symbol.iterator]==null){if(Array.isArray(r)||(n=_unsupportedIterableToArray$1(r))||e&&r&&typeof r.length==="number"){if(n)r=n;var t=0;var i=function e(){};return{s:i,n:function e(){if(t>=r.length)return{done:true};return{done:false,value:r[t++]}},e:function e(r){throw r},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a=true,o=false,u;return{s:function e(){n=r[Symbol.iterator]()},n:function e(){var r=n.next();a=r.done;return r},e:function e(r){o=true;u=r},f:function e(){try{if(!a&&n["return"]!=null)n["return"]()}finally{if(o)throw u}}}}function _unsupportedIterableToArray$1(e,r){if(!e)return;if(typeof e==="string")return _arrayLikeToArray$1(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray$1(e,r)}function _arrayLikeToArray$1(e,r){if(r==null||r>e.length)r=e.length;for(var n=0,t=new Array(r);n<r;n++){t[n]=e[n]}return t}function ownKeys(r,e){var n=Object.keys(r);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(r);if(e)t=t.filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable});n.push.apply(n,t)}return n}function _objectSpread(r){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};if(e%2){ownKeys(Object(n),true).forEach(function(e){defineProperty(r,e,n[e])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(r,Object.getOwnPropertyDescriptors(n))}else{ownKeys(Object(n)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))})}}return r}(function(r,n){if(typeof define==="function"&&define.amd){define(["bn.js"],function(e){return r.lips=n(r,e)})}else if((typeof module==="undefined"?"undefined":_typeof_1(module))==="object"&&module.exports){module.exports=n(r,require("bn.js"))}else{r.lips=n(r,r.BN)}})(typeof global!=="undefined"?global:self,function(root,BN,undefined$1){function contentLoaded(n,t){var i=false,e=true,a=n.document,o=a.documentElement,r=a.addEventListener,u=r?"addEventListener":"attachEvent",c=r?"removeEventListener":"detachEvent",s=r?"":"on",f=function e(r){if(r.type=="readystatechange"&&a.readyState!="complete")return;(r.type=="load"?n:a)[c](s+r.type,e,false);if(!i&&(i=true))t.call(n,r.type||r)},l=function r(){try{o.doScroll("left")}catch(e){setTimeout(r,50);return}f("poll")};if(a.readyState=="complete")t.call(n,"lazy");else{if(!r&&o.doScroll){try{e=!n.frameElement}catch(e){}if(e)l()}a[u](s+"DOMContentLoaded",f,false);a[u](s+"readystatechange",f,false);n[u](s+"load",f,false)}}function is_debug(){return user_env.get("DEBUG",{throwError:false})}if(!root.fetch){root.fetch=function(i,a){a=a||{};return new Promise(function(e,r){var n=new XMLHttpRequest;n.open(a.method||"get",i,true);for(var t in a.headers){n.setRequestHeader(t,a.headers[t])}n.withCredentials=a.credentials=="include";n.onload=function(){e(u())};n.onerror=r;n.send(a.body||null);function u(){var t=[],i=[],a={},o;n.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,r,n){t.push(r=r.toLowerCase());i.push([r,n]);o=a[r];a[r]=o?"".concat(o,",").concat(n):n});return{ok:(n.status/100|0)==2,status:n.status,statusText:n.statusText,url:n.responseURL,clone:u,text:function e(){return Promise.resolve(n.responseText)},json:function e(){return Promise.resolve(n.responseText).then(JSON.parse)},blob:function e(){return Promise.resolve(new Blob([n.response]))},headers:{keys:function e(){return t},entries:function e(){return i},get:function e(r){return a[r.toLowerCase()]},has:function e(r){return r.toLowerCase()in a}}}}})}}function num_mnemicic_re(e){return e?"(?:#".concat(e,"(?:#[ie])?|#[ie]#").concat(e,")"):"(?:#[ie])?"}function gen_rational_re(e,r){return"".concat(num_mnemicic_re(e),"[+-]?").concat(r,"+/").concat(r,"+")}function gen_complex_re(e,r){return"".concat(num_mnemicic_re(e),"(?:[+-]?(?:").concat(r,"+/").concat(r,"+|").concat(r,"+))?(?:[+-]i|[+-]?(?:").concat(r,"+/").concat(r,"+|").concat(r,"+)i)(?=[()[\\]\\s]|$)")}function gen_integer_re(e,r){return"".concat(num_mnemicic_re(e),"[+-]?").concat(r,"+")}var re_re=/^\/((?:\\\/|[^/]|\[[^\]]*\/[^\]]*\])+)\/([gimy]*)$/;var float_stre="(?:[-+]?(?:[0-9]+(?:[eE][-+]?[0-9]+)|(?:\\.[0-9]+|[0-9]+\\.[0-9]+)(?:[eE][-+]?[0-9]+)?)|[0-9]+\\.)";var complex_float_stre="(?:#[ie])?(?:[+-]?(?:[0-9]+/[0-9]+|".concat(float_stre,"|[+-]?[0-9]+))?(?:").concat(float_stre,"|[+-](?:[0-9]+/[0-9]+|[0-9]+))i");var float_re=new RegExp("^(#[ie])?".concat(float_stre,"$"),"i");function make_complex_match_re(e,r){var n=e==="x"?"(?!\\+|".concat(r,")"):"(?!\\.|".concat(r,")");var t="";if(e===""){t="(?:[-+]?(?:[0-9]+(?:[eE][-+]?[0-9]+)|(?:\\.[0-9]+|[0-9]+\\.[0-9]+(?![0-9]))(?:[eE][-+]?[0-9]+)?))"}return new RegExp("^((?:".concat(t,"|[+-]?").concat(r,"+/").concat(r,"+(?!").concat(r,")|[+-]?").concat(r,"+").concat(n,")?)(").concat(t,"|[+-]?").concat(r,"+/").concat(r,"+|[+-]?").concat(r,"+|[+-])i$"),"i")}var complex_list_re=function(){var a={};[[10,"","[0-9]"],[16,"x","[0-9a-fA-F]"],[8,"o","[0-7]"],[2,"b","[01]"]].forEach(function(e){var r=slicedToArray(e,3),n=r[0],t=r[1],i=r[2];a[n]=make_complex_match_re(t,i)});return a}();var characters={alarm:"",backspace:"\b",delete:"",escape:"",newline:"\n",null:"\0",return:"\r",space:" ",tab:"\t"};var character_symbols=Object.keys(characters).join("|");var char_sre_re="#\\\\(?:x[0-9a-f]+|".concat(character_symbols,"|[\\s\\S])");var char_re=new RegExp("^".concat(char_sre_re,"$"),"i");function make_num_stre(i){var e=[["o","[0-7]"],["x","[0-9a-fA-F]"],["b","[01]"],["","[0-9]"]];var r=e.map(function(e){var r=slicedToArray(e,2),n=r[0],t=r[1];return i(n,t)}).join("|");if(i===gen_complex_re){r=complex_float_stre+"|"+r}return r}function make_type_re(e){return new RegExp("^(?:"+make_num_stre(e)+")$","i")}var complex_re=make_type_re(gen_complex_re);var rational_re=make_type_re(gen_rational_re);var int_re=make_type_re(gen_integer_re);var int_bare_re=new RegExp("^(?:"+gen_integer_re("","[0-9a-f]")+")$","i");var rational_bare_re=new RegExp("^(?:"+gen_rational_re("","[0-9a-f]")+")$","i");var complex_bare_re=new RegExp("^(?:"+gen_complex_re("","[0-9a-f]")+")$","i");var complex_bare_match_re=make_complex_match_re("","[0-9a-fA-F]");var pre_num_parse_re=/((?:#[xobie]){0,2})(.*)/i;function num_pre_parse(e){var r=e.match(pre_num_parse_re);var n={};if(r[1]){var t=r[1].replace(/#/g,"").toLowerCase().split("");if(t.includes("x")){n.radix=16}else if(t.includes("o")){n.radix=8}else if(t.includes("b")){n.radix=2}if(t.includes("i")){n.inexact=true}if(t.includes("e")){n.exact=true}}n.number=r[2];return n}function parse_rational(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:10;var n=num_pre_parse(e);var t=n.number.split("/");var i=LRational({num:LNumber([t[0],n.radix||r]),denom:LNumber([t[1],n.radix||r])});if(n.inexact){return i.valueOf()}else{return i}}function parse_integer(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:10;var n=num_pre_parse(e);if(n.inexact){return LFloat(parseInt(n.number,n.radix||r))}return LNumber([n.number,n.radix||r])}function parse_character(e){var r=e.match(/#\\x([0-9a-f]+)$/i);var n;if(r){var t=parseInt(r[1],16);n=String.fromCodePoint(t)}else{r=e.match(/#\\(.+)$/);if(r){n=r[1]}}if(n){return LCharacter(n)}}function parse_complex(e){var i=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:10;function r(e){var r;if(e==="+"){r=LNumber(1)}else if(e==="-"){r=LNumber(-1)}else if(e.match(int_bare_re)){r=LNumber([e,i])}else if(e.match(rational_bare_re)){var n=e.split("/");r=LRational({num:LNumber([n[0],i]),denom:LNumber([n[1],i])})}else if(e.match(float_re)){var t=LFloat(parseFloat(e));if(a.exact){return t.toRational()}return t}else{throw new Error("Internal Parser Error")}if(a.inexact){return LFloat(r.valueOf())}return r}var a=num_pre_parse(e);i=a.radix||i;var n;var t=a.number.match(complex_bare_match_re);if(i!==10&&t){n=t}else{n=a.number.match(complex_list_re[i])}var o,u;u=r(n[2]);if(n[1]){o=r(n[1])}else if(u instanceof LFloat){o=LFloat(0)}else{o=LNumber(0)}return LComplex({im:u,re:o})}function is_int(e){return parseInt(e.toString(),10)===e}function parse_big_int(e){var r=e.match(/^(([-+]?[0-9]*)(?:\.([0-9]+))?)e([-+]?[0-9]+)/i);if(r){var n=parseInt(r[4],10);var t;var i=r[1].replace(/[-+]?([0-9]*)\..+$/,"$1").length;var a=r[3]&&r[3].length;if(i<Math.abs(n)){t=LNumber([r[1].replace(/\./,""),10]);if(a){n-=a}}}return{exponent:n,mantisa:t}}function parse_float(e){var r=num_pre_parse(e);var n=parseFloat(r.number);var t=(r.number.match(/\.0$/)||!r.number.match(/\./))&&!r.number.match(/e/i);if(!r.inexact){if(r.exact&&t){return LNumber(n)}if(is_int(n)&&r.number.match(/e\+?[0-9]/i)){return LNumber(n)}var i=parse_big_int(r.number),a=i.mantisa,o=i.exponent;if(a!==undefined$1&&o!==undefined$1){var u=LNumber(10).pow(LNumber(Math.abs(o)));if(r.exact&&o<0){return LRational({num:a,denom:u})}else if(o>0){return LNumber(a).mul(u)}}}n=LFloat(n);if(r.exact){return n.toRational()}return n}function parse_string(e){var r=/([^\\\n])(\\(?:\\{2})*)(?!x[0-9A-F]+)(?!u[0-9A-F]{2,4})(.)/gi;e=e.replace(r,function(e,r,n,t){if(!['"',"/","b","f","n","\\","r","t","x"].includes(t)){n=n.substring(1).replace(/\\\\/,"\\")}return e}).replace(/\\x([0-9a-f]+);/gi,function(e,r){return"\\u"+r.padStart(4,"0")}).replace(/\n/g,"\\n");var n=e.match(/(\\*)(\\x[0-9A-F])/i);if(n&&n[1].length%2===0){throw new Error("Invalid string literal, unclosed ".concat(n[2]))}try{return LString(JSON.parse(e))}catch(e){throw new Error("Invalid string literal")}}function parse_symbol(e){if(e.match(/^\|.*\|$/)){e=e.replace(/(^\|)|(\|$)/g,"");var n={t:"\t",r:"\r",n:"\n"};e=e.replace(/\\(x[^;]+);/g,function(e,r){return String.fromCharCode(parseInt("0"+r,16))}).replace(/\\(.)/g,function(e,r){return n[r]||r})}return new LSymbol(e)}function parse_argument(e){var r=e.match(re_re);if(r){return new RegExp(r[1],r[2])}else if(e.match(/^"/)){return parse_string(e)}else if(e.match(char_re)){return parse_character(e)}else if(e.match(rational_re)){return parse_rational(e)}else if(e.match(complex_re)){return parse_complex(e)}else if(e.match(int_re)){return parse_integer(e)}else if(e.match(float_re)){return parse_float(e)}else if(e==="nil"){return nil}else if(["true","#t"].includes(e)){return true}else if(["false","#f"].includes(e)){return false}else{return parse_symbol(e)}}function is_symbol_string(e){return!(["(",")"].includes(e)||e.match(re_re)||e.match(/^"[\s\S]+"$/)||e.match(int_re)||e.match(float_re)||e.match(complex_re)||e.match(rational_re)||["#t","#f","nil","true","false"].includes(e))}var pre_parse_re=/("(?:\\[\S\s]|[^"])*"?|\/(?! )[^\n\/\\]*(?:\\[\S\s][^\n\/\\]*)*\/[gimy]*(?=[\s[\]()]|$)|\|[^|\s\n]+\||#;|;.*|#\|(?!\|#)[\s\S]*\|#)/g;var string_re=/"(?:\\[\S\s]|[^"])*"?/g;var num_stre=[gen_complex_re,gen_rational_re,gen_integer_re].map(make_num_stre).join("|");function make_tokens_re(){var e=specials.names().sort(function(e,r){return r.length-e.length||e.localeCompare(r)}).map(escape_regex).join("|");return new RegExp("(".concat(char_sre_re,"|#f|#t|#;|(?:").concat(num_stre,")(?=$|[\\n\\s()[\\]])|\\[|\\]|\\(|\\)|\\|[^|]+\\||;.*|(?:#[ei])?").concat(float_stre,"(?=$|[\\n\\s()[\\]])|\\n|\\.{2,}|'(?=#[ft]|(?:#[xiobe]){1,2}|#\\\\)|(?!#:)(?:").concat(e,")|[^(\\s)[\\]]+)"),"gim")}function last_item(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:1;return e[e.length-r]}function escape_regex(e){if(typeof e==="string"){var r=/([-\\^$[\]()+{}?*.|])/g;return e.replace(r,"\\$1")}}function Stack(){this.data=[]}Stack.prototype.push=function(e){this.data.push(e)};Stack.prototype.top=function(){return this.data[this.data.length-1]};Stack.prototype.pop=function(){return this.data.pop()};Stack.prototype.is_empty=function(){return!this.data.length};function tokens(e){var a=make_tokens_re();e=e.replace(/\n\r|\r/g,"\n");var o=0;var u=0;var c=[];var s=[];var f=0;e.split(pre_parse_re).filter(Boolean).forEach(function(e){if(e.match(pre_parse_re)){f=0;if(s.length){var r=last_item(s);if(r.token.match(/\n/)){var n=r.token.split("\n").pop();f+=n.length}else{f+=r.token.length}f+=r.col}var t={col:f,line:u,token:e,offset:o};c.push(t);s.push(t);o+=e.length;f+=e.length;u+=(e.match("\n")||[]).length;return}var i=e.split(a).filter(Boolean);i.forEach(function(e){var r={col:f,line:u,token:e,offset:o};f+=e.length;o+=e.length;c.push(r);s.push(r);if(e==="\n"){++u;s=[];f=0}})});return c}function multiline_formatter(e){var r=e.token,n=objectWithoutProperties(e,["token"]);if(r.match(/^"[\s\S]+"$/)&&r.match(/\n/)){var t=new RegExp("^ {1,"+(e.col+1)+"}","mg");r=r.replace(t,"")}return _objectSpread({token:r},n)}function Thunk(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:function(){};this.fn=e;this.cont=r}Thunk.prototype.toString=function(){return"#<Thunk>"};function trampoline(t){return function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}return unwind(t.apply(this,r))}}function unwind(e){while(e instanceof Thunk){var r=e;e=e.fn();if(!(e instanceof Thunk)){r.cont()}}return e}function tokenize(e,r){var n=arguments.length>2&&arguments[2]!==undefined$1?arguments[2]:multiline_formatter;if(e instanceof LString){e=e.toString()}if(r){return tokens(e).map(n)}else{var t=tokens(e).map(function(e){var r=n(e);if(!r||typeof r.token!=="string"){throw new Error("[tokenize] Invalid formatter wrong return object")}if(r.token==="#\\ "){return r.token}return r.token.trim()}).filter(function(e){return e&&!e.match(/^;/)&&!e.match(/^#\|[\s\S]*\|#$/)});return strip_s_comments(t)}}function strip_s_comments(e){var r=0;var n=null;var t=[];for(var i=0;i<e.length;++i){var a=e[i];if(a==="#;"){if(["(","["].includes(e[i+1])){r=1;n=i}else{t.push([i,i+2])}i+=1;continue}if(n!==null){if([")","]"].includes(a)){r--}else if(["(","["].includes(a)){r++}if(r===0){t.push([n,i+1]);n=null}}}e=e.slice();t.reverse();for(var o=0,u=t;o<u.length;o++){var c=slicedToArray(u[o],2),s=c[0],f=c[1];e.splice(s,f-s)}return e}var specials={LITERAL:Symbol["for"]("literal"),SPLICE:Symbol["for"]("splice"),names:function e(){return Object.keys(this._specials)},type:function e(r){return this.get(r).type},get:function e(r){return this._specials[r]},remove:function e(r){delete this._specials[r]},append:function e(r,n,t){this._specials[r]={seq:r,symbol:n,type:t}},_specials:{}};function is_literal(e){return specials.type(e)===specials.LITERAL}var defined_specials=[["'",new LSymbol("quote"),specials.LITERAL],["`",new LSymbol("quasiquote"),specials.LITERAL],[",@",new LSymbol("unquote-splicing"),specials.LITERAL],[",",new LSymbol("unquote"),specials.LITERAL]];Object.defineProperty(specials,"builtin",{writable:false,value:defined_specials.map(function(e){return e[0]})});defined_specials.forEach(function(e){var r=slicedToArray(e,3),n=r[0],t=r[1],i=r[2];specials.append(n,t,i)});var Parser=function(){function u(e,r){classCallCheck(this,u);if(e instanceof LString){e=e.toString()}if(typeof e==="string"){e=tokenize(e)}this.__tokens__=e;this.__env__=r;this.__i__=0}createClass(u,[{key:"resolve",value:function e(r){return this.__env__&&this.__env__.get(r,{throwError:false})}},{key:"peek",value:function e(){return this.__tokens__[this.__i__]||u.EOS}},{key:"skip",value:function e(){this.__i__++}},{key:"special",value:function e(r){return specials.names().includes(r)}},{key:"builtin",value:function e(r){return specials.builtin.includes(r)}},{key:"read",value:function e(){var r=this.peek();this.skip();return r}},{key:"is_open",value:function e(r){return r==="("||r==="["}},{key:"is_close",value:function e(r){return r===")"||r==="]"}},{key:"read_list",value:function(){var e=asyncToGenerator(regenerator.mark(function e(){var n,t,i,a;return regenerator.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:n=nil,t=n;case 2:if(!(this.__i__<this.__tokens__.length)){r.next=25;break}i=this.peek();if(!this.is_close(i)){r.next=7;break}this.skip();return r.abrupt("break",25);case 7:if(!(i==="."&&n!==nil)){r.next=14;break}this.skip();r.next=11;return this.read_object();case 11:t.cdr=r.sent;r.next=22;break;case 14:r.t0=Pair;r.next=17;return this.read_object();case 17:r.t1=r.sent;r.t2=nil;a=new r.t0(r.t1,r.t2);if(n===nil){n=a}else{t.cdr=a}t=a;case 22:r.next=2;break;case 25:return r.abrupt("return",n);case 26:case"end":return r.stop()}}},e,this)}));function r(){return e.apply(this,arguments)}return r}()},{key:"read_value",value:function e(){var r=this.read();return parse_argument(r)}},{key:"read_object",value:function(){var e=asyncToGenerator(regenerator.mark(function e(){var n,t,i,a,o;return regenerator.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:n=this.peek();if(!(n===u.EOS)){r.next=3;break}return r.abrupt("return",n);case 3:if(!this.special(n)){r.next=18;break}t=specials.get(n);this.skip();r.next=8;return this.read_object();case 8:a=r.sent;if(is_literal(n)){i=new Pair(t.symbol,new Pair(a,nil))}else{i=new Pair(t.symbol,a)}if(!this.builtin(n)){r.next=14;break}return r.abrupt("return",i);case 14:r.next=16;return evaluate(i,{env:this.__env__,error:function e(r){throw r}});case 16:o=r.sent;return r.abrupt("return",quote(o));case 18:if(!this.is_open(n)){r.next=23;break}this.skip();return r.abrupt("return",this.read_list());case 23:return r.abrupt("return",this.read_value());case 24:case"end":return r.stop()}}},e,this)}));function r(){return e.apply(this,arguments)}return r}()}]);return u}();Parser.EOS=Symbol["for"]("EOS");function parse(e,r){return _parse.apply(this,arguments)}function _parse(){_parse=asyncToGenerator(regenerator.mark(function e(n,t){var i,a,o;return regenerator.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:if(!t){if(global_env){t=global_env.get("**interaction-environment**",{throwError:false})}else{t=user_env}}i=new Parser(n,t);a=[];case 3:r.next=6;return i.read_object();case 6:o=r.sent;if(!(o===Parser.EOS)){r.next=9;break}return r.abrupt("break",12);case 9:a.push(o);r.next=3;break;case 12:return r.abrupt("return",a);case 13:case"end":return r.stop()}}},e)}));return _parse.apply(this,arguments)}function unpromise(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:function(e){return e};var n=arguments.length>2&&arguments[2]!==undefined$1?arguments[2]:null;if(e instanceof Array){var t=e.filter(isPromise);if(t.length){return unpromise(Promise.all(t),r,n)}return r(e)}if(isPromise(e)){var i=e.then(r);if(n===null){return i}else{return i["catch"](n)}}return r(e)}function matcher(e,r){if(r instanceof RegExp){return function(e){return String(e).match(r)}}else if(typeof r==="function"){return r}}function doc(e,r,n,t){if(typeof e!=="string"){r=arguments[0];n=arguments[1];t=arguments[2];e=null}if(n){if(t){r.__doc__=n}else{r.__doc__=trim_lines(n)}}if(e){r.__name__=e}else if(r.name){r.__name__=r.name}return r}function trim_lines(e){return e.split("\n").map(function(e){return e.trim()}).join("\n")}function previousSexp(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:1;var n=e.length;if(r<=0){throw Error("previousSexp: Invalid argument sexp = ".concat(r))}e:while(r--&&n>=0){var t=1;while(t>0){var i=e[--n];if(!i){break e}if(i==="("||i.token==="("){t--}else if(i===")"||i.token===")"){t++}}n--}return e.slice(n+1)}function lineIndent(e){if(!e||!e.length){return 0}var r=e.length;if(e[r-1].token==="\n"){return 0}while(--r){if(e[r].token==="\n"){var n=(e[r+1]||{}).token;if(n){return n.length}}}return 0}function match(e,r){return f(e,r)===r.length;function f(n,t){function e(){return a>0&&u>0&&n[a-1]===t[u-1]&&n[a+1]===t[u]}function r(){return n[a]===Symbol["for"]("symbol")&&!is_symbol_string(t[u])}function i(){var e=n[a+1];var r=t[u+1];if(e!==undefined$1&&r!==undefined$1){return f([e],[r])}}var a=0;var o={};for(var u=0;u<t.length;++u){if(typeof n[a]==="undefined"){return u}if(n[a]instanceof Pattern){if(n[a].flag==="+"){var c;while(u<t.length){c=f(n[a].pattern,t.slice(u));if(c===-1){break}u+=c}if(c===-1&&t[u]&&!n[a+1]){return-1}a++;u-=1;continue}else if(n[a].flag==="?"){c=f(n[a].pattern,t.slice(u));if(c===-1){u-=2}else{a++}continue}else if(n[a].flag==="*"){c=f(n[a].pattern,t.slice(u));if(c===-1){u-=1;a++;continue}}}if(n[a]instanceof RegExp){if(!t[u].match(n[a])){return-1}}else if(lips.LString.isString(n[a])){if(n[a].valueOf()!==t[u]){return-1}}else if(_typeof_1(n[a])==="symbol"){if(n[a]===Symbol["for"]("*")){o[a]=o[a]||0;if(["(","["].includes(t[u])){o[a]++}else if([")","]"].includes(t[u])){o[a]--}if(e()){u-=1}else if(typeof n[a+1]!=="undefined"&&o[a]===0&&i()===-1||o[a]>0){continue}}else if(r()){return-1}}else if(n[a]instanceof Array){var s=f(n[a],t.slice(u));if(s===-1||s+u>t.length){return-1}u+=s-1;a++;continue}else{return-1}a++}if(n.length!==a){return-1}return t.length}}function Formatter(e){this._code=e.replace(/\r/g,"")}Formatter.defaults={offset:0,indent:2,exceptions:{specials:[/^(?:#:)?define/,/^(?:#:)?lambda/,/^(?:#:)?let*/,/^(?:#:)?(let|letrec)(-syntax)?$/,/(?:#:)?let-env/,/(?:#:)?syntax-rules/,/(?:#:)?try/,/(?:#:)?catch/,/(?:#:)?while/],shift:{1:["&","#"]}}};Formatter.match=match;Formatter.prototype._options=function e(r){var n=Formatter.defaults;if(typeof r==="undefined"){return Object.assign({},n)}var t=r&&r.exceptions||{};var i=t.specials||[];var a=t.shift||{1:[]};return _objectSpread(_objectSpread(_objectSpread({},n),r),{},{exceptions:{specials:[].concat(toConsumableArray(n.exceptions.specials),toConsumableArray(i)),shift:_objectSpread(_objectSpread({},a),{},{1:[].concat(toConsumableArray(n.exceptions.shift[1]),toConsumableArray(a[1]))})}})};Formatter.prototype.indent=function e(r){var n=tokenize(this._code,true);return this._indent(n,r)};Formatter.exception_shift=function(a,e){function r(e){if(!e.length){return false}if(e.indexOf(a)!==-1){return true}else{var r=e.filter(function(e){return e instanceof RegExp});if(!r.length){return false}var n=_createForOfIteratorHelper(r),t;try{for(n.s();!(t=n.n()).done;){var i=t.value;if(a.match(i)){return true}}}catch(e){n.e(e)}finally{n.f()}}return false}if(r(e.exceptions.specials)){return e.indent}var n=e.exceptions.shift;for(var t=0,i=Object.entries(n);t<i.length;t++){var o=slicedToArray(i[t],2),u=o[0],c=o[1];if(r(c)){return+u}}return-1};Formatter.prototype._indent=function e(r,n){var t=this._options(n);var i=lineIndent(r);var a=previousSexp(r);var o=r[r.length-a.length-1];if(a&&a.length){if(a[0].line>0){t.offset=0}if(a.toString()===r.toString()&&balanced(a)){return t.offset+a[0].col}else if(a.length===1){return t.offset+a[0].col+1}else{var u=-1;if(o){var c=Formatter.exception_shift(o.token,t);if(c!==-1){u=c}}if(u===-1){u=Formatter.exception_shift(a[1].token,t)}if(u!==-1){return t.offset+a[0].col+u}else if(a[0].line<a[1].line){return t.offset+a[0].col+1}else if(a.length>3&&a[1].line===a[3].line){if(a[1].token==="("||a[1].token==="["){return t.offset+a[1].col}return t.offset+a[3].col}else if(a[0].line===a[1].line){return t.offset+t.indent+a[0].col}else{var s=a.slice(2);for(var f=0;f<s.length;++f){var l=s[f];if(l.token.trim()){return l.col}}}}}else{return 0}return i+t.indent};function Ahead(e){this.pattern=e}Ahead.prototype.toString=function(){return"#<pattern(".concat(this.pattern,")>")};Ahead.prototype.match=function(e){return e.match(this.pattern)};function Pattern(e,r){this.pattern=e;this.flag=r}Pattern.prototype.toString=function(){return"#<pattern(".concat(this.pattern," ").concat(this.flag,")>")};Formatter.Pattern=Pattern;Formatter.Ahead=Ahead;var p_o=/[[(]/;var p_e=/[\])]/;var not_p=/[^()[\]]/;var not_close=new Ahead(/[^)\]]/);var open=new Ahead(/[([]/);var glob=Symbol["for"]("*");var sexp=new Pattern([p_o,glob,p_e],"+");var symbol=new Pattern([Symbol["for"]("symbol")],"?");var symbols=new Pattern([Symbol["for"]("symbol")],"*");var identifiers=[p_o,symbols,p_e];var let_value=new Pattern([p_o,Symbol["for"]("symbol"),glob,p_e],"+");var def_lambda_re=keywords_re("define","lambda","syntax-rules");var non_def=/^(?!.*\b(?:[()[\]]|define|let(?:\*|rec|-env|-syntax)?|lambda|syntax-rules)\b).*$/;var let_re=/^(?:#:)?(let(?:\*|rec|-env|-syntax)?)$/;function keywords_re(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}return new RegExp("^(?:#:)?(?:".concat(r.join("|"),")$"))}Formatter.rules=[[[p_o,keywords_re("begin")],1],[[p_o,let_re,symbol,p_o,let_value,p_e],1],[[p_o,keywords_re("define-syntax"),/.+/],1],[[p_o,keywords_re("syntax-rules"),symbol,identifiers],1],[[p_o,keywords_re("syntax-rules"),symbol,identifiers,sexp],1,not_close],[[p_o,non_def,new Pattern([/[^()[\]]/],"+"),sexp],1,not_close],[[p_o,sexp],1,open],[[p_o,keywords_re("lambda"),p_o,p_e],1,not_close],[[p_o,keywords_re("lambda"),p_o,p_e,sexp],1,not_close],[[p_o,keywords_re("lambda","if"),not_p],1,not_close],[[p_o,keywords_re("while"),not_p,sexp],1,not_close],[[p_o,keywords_re("if"),not_p,glob],1],[[p_o,def_lambda_re,p_o,glob,p_e],1,not_close],[[p_o,def_lambda_re,[p_o,glob,p_e],string_re,sexp],1,not_close],[[p_o,def_lambda_re,[p_o,glob,p_e],sexp],1,not_close]];Formatter.prototype["break"]=function(){var e=this._code.replace(/\n[ \t]*/g,"\n ");var r=function e(r){if(r.token.match(string_re)){return r.token}else{return r.token.replace(/\s+/," ")}};var n=tokenize(e,true).map(r).filter(function(e){return e!=="\n"});var t=Formatter.rules;for(var i=1;i<n.length;++i){if(!n[i].trim()){continue}var a=n.slice(0,i);var o={};t.map(function(e){return e[1]}).forEach(function(e){e=e.valueOf();if(!o[e]){o[e]=previousSexp(a,e)}});var u=_createForOfIteratorHelper(t),c;try{for(u.s();!(c=u.n()).done;){var s=slicedToArray(c.value,3),f=s[0],l=s[1],p=s[2];l=l.valueOf();var d=match(f,o[l].filter(function(e){return e.trim()}));var m=n.slice(i).find(function(e){return e.trim()});if(d&&(p instanceof Ahead&&p.match(m)||!p)){n.splice(i,0,"\n");i++;continue}}}catch(e){u.e(e)}finally{u.f()}}this._code=n.join("");return this};Formatter.prototype._spaces=function(e){return new Array(e+1).join(" ")};Formatter.prototype.format=function e(r){var n=this._code.replace(/[ \t]*\n[ \t]*/g,"\n ");var t=tokenize(n,true);var i=this._options(r);var a=0;var o=0;for(var u=0;u<t.length;++u){var c=t[u];if(c.token==="\n"){a=this._indent(t.slice(0,u),i);o+=a;if(t[u+1]){t[u+1].token=this._spaces(a);a--;o--;for(var s=u+2;s<t.length;++s){t[s].offset+=o;t[s].col+=a;if(t[s].token==="\n"){u=s-1;break}}}}}return t.map(function(e){if(e.token.match(string_re)){if(e.token.match(/\n/)){var r=new Array(e.col+1).join(" ");var n=e.token.split("\n");e.token=[n[0]].concat(n.slice(1).map(function(e){return r+e})).join("\n")}}return e.token}).join("")};function flatten(e,r){var n=Object.prototype.toString;var t="[object Array]";var i=[];var a=r&&e||e.slice();var o;if(!e.length){return i}o=a.pop();do{if(n.call(o)===t){a.push.apply(a,o)}else{i.push(o)}}while(a.length&&(o=a.pop())!==undefined$1);i.reverse();return i}function isSymbol(e){return _typeof_1(e)==="symbol"||_typeof_1(e)==="object"&&Object.prototype.toString.call(e)==="[object Symbol]"}function LSymbol(e){if(typeof this!=="undefined"&&this.constructor!==LSymbol||typeof this==="undefined"){return new LSymbol(e)}if(e===undefined$1){console.trace()}this.__name__=e}LSymbol.is=function(e,r){return e instanceof LSymbol&&(r instanceof LSymbol&&e.__name__===r.__name__||typeof r==="string"&&e.__name__===r||r instanceof RegExp&&r.test(e.__name__))};LSymbol.prototype.toJSON=LSymbol.prototype.toString=function(){if(isSymbol(this.__name__)){return this.__name__.toString().replace(/^Symbol\(([^)]+)\)/,"$1")}return this.valueOf()};LSymbol.prototype.valueOf=function(){return this.__name__.valueOf()};LSymbol.prototype.is_gensym=function(){return is_gensym(this.__name__)};function is_gensym(e){if(_typeof_1(e)==="symbol"){return!!e.toString().match(/^Symbol\(#:/)}return false}var gensym=function(){var r=0;return function(){var e=arguments.length>0&&arguments[0]!==undefined$1?arguments[0]:null;if(e instanceof LSymbol){e=e.valueOf()}if(is_gensym(e)){return LSymbol(e)}if(e!==null){return new LSymbol(Symbol("#:".concat(e)))}r++;return new LSymbol(Symbol("#:g".concat(r)))}}();function Nil(){}Nil.prototype.toString=Nil.prototype.toJSON=function(){return"()"};Nil.prototype.valueOf=function(){return undefined$1};Nil.prototype.toObject=function(){return{}};Nil.prototype.append=function(e){return new Pair(e,nil)};Nil.prototype.toArray=function(){return[]};var nil=new Nil;function Pair(e,r){if(typeof this!=="undefined"&&this.constructor!==Pair||typeof this==="undefined"){return new Pair(e,r)}this.car=e;this.cdr=r}function toArray$1(a,o){return function e(r){typecheck(a,r,["pair","nil"]);if(r===nil){return[]}var n=[];var t=r;while(true){if(t instanceof Pair){if(t.haveCycles("cdr")){break}var i=t.car;if(o&&i instanceof Pair){i=this.get(a).call(this,i)}n.push(i);t=t.cdr}else{break}}return n}}Pair.prototype.flatten=function(){return Pair.fromArray(flatten(this.toArray()))};Pair.prototype.length=function(){var e=0;var r=this;while(true){if(!r||r===nil||!(r instanceof Pair)||r.haveCycles("cdr")){break}e++;r=r.cdr}return e};Pair.prototype.clone=function(){var n=new Map;function t(e){if(e instanceof Pair){if(n.has(e)){return n.get(e)}var r=new Pair;n.set(e,r);r.car=t(e.car);r.cdr=t(e.cdr);r.cycles=e.cycles;return r}return e}return t(this)};Pair.prototype.lastPair=function(){var e=this;while(true){if(e.cdr===nil){return e}e=e.cdr}};Pair.prototype.toArray=function(){var e=[];if(this.car instanceof Pair){e.push(this.car.toArray())}else{e.push(this.car.valueOf())}if(this.cdr instanceof Pair){e=e.concat(this.cdr.toArray())}return e};Pair.fromArray=function(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:true;var n=arguments.length>2&&arguments[2]!==undefined$1?arguments[2]:false;if(e instanceof Pair||n&&e instanceof Array&&e.data){return e}if(r===false){var t=nil;for(var i=e.length;i--;){t=new Pair(e[i],t)}return t}if(e.length&&!(e instanceof Array)){e=toConsumableArray(e)}var a=nil;var o=e.length;while(o--){var u=e[o];if(u instanceof Array){u=Pair.fromArray(u,r,n)}else if(typeof u==="string"){u=LString(u)}else if(typeof u==="number"&&!Number.isNaN(u)){u=LNumber(u)}a=new Pair(u,a)}return a};Pair.prototype.toObject=function(){var e=arguments.length>0&&arguments[0]!==undefined$1?arguments[0]:false;var r=this;var n={};while(true){if(r instanceof Pair&&r.car instanceof Pair){var t=r.car;var i=t.car;if(i instanceof LSymbol){i=i.__name__}if(i instanceof LString){i=i.valueOf()}var a=t.cdr;if(a instanceof Pair){a=a.toObject(e)}if(is_native(a)){if(!e){a=a.valueOf()}}n[i]=a;r=r.cdr}else{break}}return n};Pair.fromPairs=function(e){return e.reduce(function(e,r){return new Pair(new Pair(new LSymbol(r[0]),r[1]),e)},nil)};Pair.fromObject=function(r){var e=Object.keys(r).map(function(e){return[e,r[e]]});return Pair.fromPairs(e)};Pair.prototype.reduce=function(e){var r=this;var n=nil;while(true){if(r!==nil){n=e(n,r.car);r=r.cdr}else{break}}return n};Pair.prototype.reverse=function(){if(this.haveCycles()){throw new Error("You can't reverse list that have cycles")}var e=this;var r=nil;while(e!==nil){var n=e.cdr;e.cdr=r;r=e;e=n}return r};Pair.prototype.transform=function(t){function i(e){if(e instanceof Pair){if(e.replace){delete e.replace;return e}var r=t(e.car);if(r instanceof Pair){r=i(r)}var n=t(e.cdr);if(n instanceof Pair){n=i(n)}return new Pair(r,n)}return e}return i(this)};Pair.prototype.map=function(e){if(typeof this.car!=="undefined"){return new Pair(e(this.car),this.cdr===nil?nil:this.cdr.map(e))}else{return nil}};var repr=new Map;function is_plain_object(e){return e&&_typeof_1(e)==="object"&&e.constructor===Object}var props=Object.getOwnPropertyNames(Array.prototype);var array_methods=[];props.forEach(function(e){array_methods.push(Array[e],Array.prototype[e])});function is_array_method(e){e=unbind(e);return array_methods.includes(e)}function lips_function(e){return typeof e==="function"&&(e.__lambda__||e.__doc__)}function user_repr(n){var e=n.constructor||Object;var t=is_plain_object(n);var i;if(repr.has(e)){i=repr.get(e)}else{repr.forEach(function(e,r){r=unbind(r);if(n instanceof r&&(r===Object&&t||r!==Object)){i=e}})}return i}var str_mapping=new Map;[[Number.NEGATIVE_INFINITY,"-inf.0"],[Number.POSITIVE_INFINITY,"+inf.0"],[true,"#t"],[false,"#f"],[null,"null"],[undefined$1,"#<undefined>"]].forEach(function(e){var r=slicedToArray(e,2),n=r[0],t=r[1];str_mapping.set(n,t)});function symbolize(n){if(n&&_typeof_1(n)==="object"){var t={};var e=Object.getOwnPropertySymbols(n);e.forEach(function(e){var r=e.toString().replace(/Symbol\(([^)]+)\)/,"$1");t[r]=toString(n[e])});var r=Object.getOwnPropertyNames(n);r.forEach(function(e){var r=n[e];if(r&&_typeof_1(r)==="object"&&r.constructor===Object){t[e]=symbolize(r)}else{t[e]=toString(r)}});return t}return n}function get_props(e){return Object.keys(e).concat(Object.getOwnPropertySymbols(e))}function toString(e,r,n){if(typeof jQuery!=="undefined"&&e instanceof jQuery.fn.init){return"#<jQuery("+e.length+")>"}if(str_mapping.has(e)){return str_mapping.get(e)}if(e instanceof Error){return e.message}if(e instanceof Pair){var t;if(!n){e.markCycles()}for(var i=arguments.length,a=new Array(i>3?i-3:0),o=3;o<i;o++){a[o-3]=arguments[o]}return(t=e).toString.apply(t,[r].concat(a))}if(Number.isNaN(e)){return"+nan.0"}if(e instanceof LCharacter){if(r){return e.toString()}return e.valueOf()}var u=[RegExp,Nil,LSymbol,LNumber,Macro,Values];for(var c=0,s=u;c<s.length;c++){var f=s[c];if(e instanceof f){return e.toString()}}if(typeof e==="function"){if(isNativeFunction(e)){return"#<procedure(native)>"}if(isNativeFunction(e.toString)){if(typeof e.__name__==="string"){return"#<procedure:".concat(e.__name__,">")}return"#<procedure>"}else{return e.toString()}}if(e instanceof LString){e=e.toString()}if(e===null||typeof e==="string"&&r){return JSON.stringify(e)}if(_typeof_1(e)==="object"){if(typeof e.toString==="function"&&e.toString.__lambda__){return e.toString().valueOf()}var l=e.constructor;if(!l){l=Object}var p;if(typeof l.__class__==="string"){p=l.__class__}else{if(is_prototype(e)){return"#<prototype>"}var d=user_repr(e);if(d){if(typeof d==="function"){return d(e,r)}else{throw new Error("toString: Invalid repr value")}}p=l.name}if(type(e)==="instance"&&!isNativeFunction(l)){p="instance"}if(root.HTMLElement&&e instanceof root.HTMLElement){return"#<HTMLElement(".concat(e.tagName.toLowerCase(),")>")}if(p!==""){return"#<"+p+">"}if(typeof e[Symbol.iterator]==="function"){return"#<iterator>"}return"#<Object>"}if(typeof e!=="string"){return e.toString()}return e}function is_prototype(e){return e&&_typeof_1(e)==="object"&&e.hasOwnProperty&&e.hasOwnProperty("constructor")&&typeof e.constructor==="function"&&e.constructor.prototype===e}Pair.prototype.markCycles=function(){markCycles(this);return this};Pair.prototype.haveCycles=function(){var e=arguments.length>0&&arguments[0]!==undefined$1?arguments[0]:null;if(!e){return this.haveCycles("car")||this.haveCycles("cdr")}return!!(this.cycles&&this.cycles[e])};function markCycles(e){var r=[];var i=[];var a=[];function o(e){if(!r.includes(e)){r.push(e)}}function u(e,r,n,t){if(n instanceof Pair){if(t.includes(n)){if(!a.includes(n)){a.push(n)}if(!e.cycles){e.cycles={}}e.cycles[r]=n;if(!i.includes(e)){i.push(e)}return true}}}var c=trampoline(function e(r,n){if(r instanceof Pair){delete r.ref;delete r.cycles;o(r);n.push(r);var t=u(r,"car",r.car,n);var i=u(r,"cdr",r.cdr,n);if(!t){c(r.car,n.slice())}if(!i){return new Thunk(function(){return e(r.cdr,n.slice())})}}});function n(e,r){if(e.cycles[r]instanceof Pair){var n=t.indexOf(e.cycles[r]);e.cycles[r]="#".concat(n,"#")}}c(e,[]);var t=r.filter(function(e){return a.includes(e)});t.forEach(function(e,r){e.ref="#".concat(r,"=")});i.forEach(function(e){n(e,"car");n(e,"cdr")})}var pair_to_string=function(){var l=function e(r,n){var t=[];if(r.ref){t.push(r.ref+"(")}else if(!n){t.push("(")}return t};var p=function e(r,n){if(is_debug());if(!n||r.ref){return[")"]}return[]};return trampoline(function e(r,n){var t=arguments.length>2&&arguments[2]!==undefined$1?arguments[2]:{};var i=t.nested,a=i===void 0?false:i,o=t.result,u=o===void 0?[]:o,c=t.cont,s=c===void 0?function(){u.push.apply(u,toConsumableArray(p(r,a)))}:c;u.push.apply(u,toConsumableArray(l(r,a)));var f;if(r.cycles&&r.cycles.car){f=r.cycles.car}else{f=toString(r.car,n,true,{result:u,cont:s})}if(f!==undefined$1){u.push(f)}return new Thunk(function(){if(r.cdr instanceof Pair){if(r.cycles&&r.cycles.cdr){u.push(" . ");u.push(r.cycles.cdr)}else{if(r.cdr.ref){u.push(" . ")}else{u.push(" ")}return e(r.cdr,n,{nested:true,result:u,cont:s})}}else if(r.cdr!==nil){u.push(" . ");u.push(toString(r.cdr,n))}},s)})}();Pair.prototype.toString=function(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:{},n=r.nested,t=n===void 0?false:n;if(is_debug()){var i=[];pair_to_string(this,e,{result:i});return i.join("")}var a=[];if(this.ref){a.push(this.ref+"(")}else if(!t){a.push("(")}var o;if(this.cycles&&this.cycles.car){o=this.cycles.car}else{o=toString(this.car,e,true)}if(o!==undefined$1){a.push(o)}if(this.cdr instanceof Pair){if(this.cycles&&this.cycles.cdr){a.push(" . ");a.push(this.cycles.cdr)}else{if(this.cdr.ref){a.push(" . ")}else{a.push(" ")}var u=this.cdr.toString(e,{nested:true});a.push(u)}}else if(this.cdr!==nil){a=a.concat([" . ",toString(this.cdr,e,true)])}if(!t||this.ref){a.push(")")}return a.join("")};Pair.prototype.set=function(e,r){this[e]=r;if(r instanceof Pair){this.markCycles()}};Pair.prototype.append=function(e){if(e instanceof Array){return this.append(Pair.fromArray(e))}var r=this;if(r.car===undefined$1){if(e instanceof Pair){this.car=e.car;this.cdr=e.cdr}else{this.car=e}}else if(e!==nil){while(true){if(r instanceof Pair&&r.cdr!==nil){r=r.cdr}else{break}}r.cdr=e}return this};function abs(e){return e<0?-e:e}function seq_compare(e,r){var n=toArray(r),t=n[0],i=n.slice(1);while(i.length>0){var a=i,o=slicedToArray(a,1),u=o[0];if(!e(t,u)){return false}var c=i;var s=toArray(c);t=s[0];i=s.slice(1)}return true}function equal(e,r){if(typeof e==="function"&&typeof r==="function"){return unbind(e)===unbind(r)}else if(e instanceof LNumber&&r instanceof LNumber){var n;if(e.__type__===r.__type__){if(e.__type__==="complex"){n=e.im.__type__===r.im.__type__&&e.re.__type__===r.re.__type__}else{n=true}return n&&e.cmp(r)===0}return false}else if(typeof e==="number"||typeof r==="number"){e=LNumber(e);r=LNumber(r);return e.__type__===r.__type__&&e.cmp(r)===0}else if(e instanceof LCharacter&&r instanceof LCharacter){return e.__char__===r.__char__}else if(e instanceof LSymbol&&r instanceof LSymbol){return e.__name__===r.__name__}else{return e===r}}function same_atom(e,r){if(type(e)!==type(r)){return false}if(!is_atom(e)){return false}if(e instanceof RegExp){return e.source===r.source}if(e instanceof LString){return e.valueOf()===r.valueOf()}return equal(e,r)}function is_atom(e){return e instanceof LSymbol||LString.isString(e)||e instanceof LCharacter||e instanceof LNumber||e===true||e===false}var truncate=function(){if(Math.trunc){return Math.trunc}else{return function(e){if(e<0){return Math.ceil(e)}else{return Math.floor(e)}}}}();function Macro(e,r,n,t){if(typeof this!=="undefined"&&this.constructor!==Macro||typeof this==="undefined"){return new Macro(e,r)}typecheck("Macro",e,"string",1);typecheck("Macro",r,"function",2);if(n){if(t){this.__doc__=n}else{this.__doc__=trim_lines(n)}}this.__name__=e;this.__fn__=r}Macro.defmacro=function(e,r,n,t){var i=new Macro(e,r,n,t);i.__defmacro__=true;return i};Macro.prototype.invoke=function(e,r,n){var t=r.env,i=r.dynamic_scope,a=r.error;var o={dynamic_scope:i,error:a,macro_expand:n};var u=this.__fn__.call(t,e,o,this.__name__);return u};Macro.prototype.toString=function(){return"#<macro:".concat(this.__name__,">")};var macro="define-macro";var recur_guard=-1e4;function macro_expand(a){return function(){var n=asyncToGenerator(regenerator.mark(function e(n,m){var t,h,i;return regenerator.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=function e(){i=asyncToGenerator(regenerator.mark(function e(n,t,i){var a,o,u,c,s,f,l,p,d;return regenerator.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:if(!(n instanceof Pair&&n.car instanceof LSymbol)){r.next=24;break}if(!n.data){r.next=3;break}return r.abrupt("return",n);case 3:a=i.get(n.car,{throwError:false});if(!(a instanceof Macro&&a.__defmacro__)){r.next=24;break}o=a instanceof Syntax?n:n.cdr;r.next=8;return a.invoke(o,_objectSpread(_objectSpread({},m),{},{env:i}),true);case 8:u=r.sent;if(!(a instanceof Syntax)){r.next=17;break}c=u,s=c.expr,f=c.scope;if(!(s instanceof Pair)){r.next=16;break}if(!(t!==-1&&t<=1||t<recur_guard)){r.next=14;break}return r.abrupt("return",s);case 14:if(t!==-1){t=t-1}return r.abrupt("return",h(s,t,f));case 16:u=s;case 17:if(!(u instanceof LSymbol)){r.next=19;break}return r.abrupt("return",quote(u));case 19:if(!(u instanceof Pair)){r.next=24;break}if(!(t!==-1&&t<=1||t<recur_guard)){r.next=22;break}return r.abrupt("return",u);case 22:if(t!==-1){t=t-1}return r.abrupt("return",h(u,t,i));case 24:l=n.car;if(!(l instanceof Pair)){r.next=29;break}r.next=28;return h(l,t,i);case 28:l=r.sent;case 29:p=n.cdr;if(!(p instanceof Pair)){r.next=34;break}r.next=33;return h(p,t,i);case 33:p=r.sent;case 34:d=new Pair(l,p);return r.abrupt("return",d);case 36:case"end":return r.stop()}}},e)}));return i.apply(this,arguments)};h=function e(r,n,t){return i.apply(this,arguments)};t=m["env"]=this;if(!(n.cdr instanceof Pair&&LNumber.isNumber(n.cdr.car))){r.next=9;break}r.t0=quote;r.next=7;return h(n,n.cdr.car.valueOf(),t);case 7:r.t1=r.sent.car;return r.abrupt("return",(0,r.t0)(r.t1));case 9:if(!a){r.next=15;break}r.t2=quote;r.next=13;return h(n,1,t);case 13:r.t3=r.sent.car;return r.abrupt("return",(0,r.t2)(r.t3));case 15:r.t4=quote;r.next=18;return h(n,-1,t);case 18:r.t5=r.sent.car;return r.abrupt("return",(0,r.t4)(r.t5));case 20:case"end":return r.stop()}}},e,this)}));return function(e,r){return n.apply(this,arguments)}}()}function Syntax(e,r){this.__env__=r;this.__fn__=e;this.__defmacro__=true}Syntax.__merge_env__=Symbol["for"]("merge");Syntax.prototype=Object.create(Macro.prototype);Syntax.prototype.invoke=function(e,r,n){var t=r.error,i=r.env;var a={error:t,env:i,dynamic_scope:this.__env__,macro_expand:n};return this.__fn__.call(i,e,a,this.__name__||"syntax")};Syntax.prototype.constructor=Syntax;Syntax.prototype.toString=function(){if(this.__name__){return"#<syntax:".concat(this.__name__,">")}return"#<syntax>"};Syntax.className="syntax";function extract_patterns(e,r,g,w){var n=arguments.length>4&&arguments[4]!==undefined$1?arguments[4]:{};var L={"...":{symbols:{},lists:[]},symbols:{}};var x=n.expansion,S=n.define;function k(e){if(is_debug()){console.log(e)}}k(g);function P(e,r){var n=arguments.length>2&&arguments[2]!==undefined$1?arguments[2]:[];var t=arguments.length>3&&arguments[3]!==undefined$1?arguments[3]:false;k({code:r&&toString(r,true),pattern:e&&toString(e,true)});if(is_atom(e)&&!(e instanceof LSymbol)){return same_atom(e,r)}if(e instanceof LSymbol&&g.includes(e.valueOf())){var i=x.ref(r);if(LSymbol.is(r,e)){if(typeof i==="undefined"){return true}return i===S||i===global_env}return false}if(e instanceof Pair&&e.car instanceof Pair&&e.car.cdr instanceof Pair&&LSymbol.is(e.car.cdr.car,w)){k(">> 0");if(r===nil){k({pattern:e.toString()});if(e.car.car instanceof LSymbol){if(e.car.cdr instanceof Pair&&LSymbol.is(e.car.cdr.car,w)){var a=e.car.car.valueOf();var o=e.lastPair();if(LSymbol.is(o.car,w)){L["..."].symbols[a]=null;return true}else{return false}}var u=e.car.car.valueOf();if(L["..."].symbols[u]){throw new Error("syntax: named ellipsis can only "+"appear onces")}L["..."].symbols[u]=r}}}if(e instanceof Pair&&e.cdr instanceof Pair&&LSymbol.is(e.cdr.car,w)){if(e.cdr.cdr!==nil){if(e.cdr.cdr instanceof Pair){var c=e.cdr.cdr.length();var s=r.length();var f=r;while(s-1>c){f=f.cdr;s--}var l=f.cdr;f.cdr=nil;if(!P(e.cdr.cdr,l,n,t)){return false}}}if(e.car instanceof LSymbol){var p=e.car.__name__;if(L["..."].symbols[p]&&!n.includes(p)&&!t){throw new Error("syntax: named ellipsis can only appear onces")}k(">> 1");if(r===nil){k(">> 2");if(t){k("NIL");L["..."].symbols[p]=nil}else{k("NULL");L["..."].symbols[p]=null}}else if(r instanceof Pair&&(r.car instanceof Pair||r.car===nil)){k(">> 3 "+t);if(t){if(L["..."].symbols[p]){var d=L["..."].symbols[p];L["..."].symbols[p]=d.append(new Pair(r,nil))}else{L["..."].symbols[p]=new Pair(r,nil)}}else{k(">> 4");L["..."].symbols[p]=new Pair(r,nil)}}else{k(">> 6");if(r instanceof Pair){k(">> 7 "+t);n.push(p);if(!L["..."].symbols[p]){L["..."].symbols[p]=new Pair(r,nil)}else{var m=L["..."].symbols[p];L["..."].symbols[p]=m.append(new Pair(r,nil))}k({IIIIII:L["..."].symbols[p].toString()})}else{k(">> 8");return false}}return true}else if(e.car instanceof Pair){var h=toConsumableArray(n);if(r===nil){k(">> 9");L["..."].lists.push(nil);return true}k(">> 10");var v=r;while(v instanceof Pair){if(!P(e.car,v.car,h,true)){return false}v=v.cdr}return true}return false}if(e instanceof LSymbol){if(LSymbol.is(e,w)){throw new Error("syntax: invalid usage of ellipsis")}k(">> 11");var _=e.__name__;if(g.includes(_)){return true}k({name:_,ellipsis:t});if(t){L["..."].symbols[_]=L["..."].symbols[_]||[];L["..."].symbols[_].push(r)}if(!L.symbols[_]){L.symbols[_]=r}return true}if(e instanceof Pair&&r instanceof Pair){k(">> 12");k({a:12,code:r&&r.toString(),pattern:e.toString()});if(r.cdr===nil){var y=e.car instanceof LSymbol&&e.cdr instanceof LSymbol;if(y){if(!P(e.car,r.car,n,t)){return false}k(">> 12 | 1");var b=e.cdr.valueOf();if(!(b in L.symbols)){L.symbols[b]=nil}b=e.car.valueOf();if(!(b in L.symbols)){L.symbols[b]=r.car}return true}}k("recur");if(P(e.car,r.car,n,t)&&P(e.cdr,r.cdr,n,t)){return true}}else if(e===nil&&(r===nil||r===undefined$1)){return true}else if(e.car instanceof Pair&&LSymbol.is(e.car.car,w)){throw new Error("syntax: invalid usage of ellipsis")}else{return false}}if(P(e,r)){return L}}function clear_gensyms(e,i){function a(r){if(r instanceof Pair){if(!i.length){return r}var e=a(r.car);var n=a(r.cdr);return new Pair(e,n)}else if(r instanceof LSymbol){var t=i.find(function(e){return e.gensym===r});if(t){return LSymbol(t.name)}return r}else{return r}}return a(e)}function transform_syntax(){var e=arguments.length>0&&arguments[0]!==undefined$1?arguments[0]:{};var S=e.bindings,r=e.expr,k=e.scope,i=e.symbols,a=e.names,P=e.ellipsis;var o={};function u(e){if(e instanceof LSymbol){return true}return["string","symbol"].includes(_typeof_1(e))}function N(e){if(!u(e)){var r=type(e);throw new Error("syntax: internal error, need symbol got ".concat(r))}var n=e.valueOf();if(n===P){throw new Error("syntax: internal error, ellipis not transformed")}var t=_typeof_1(n);if(["string","symbol"].includes(t)&&n in S.symbols){return S.symbols[n]}if(i.includes(n)){return LSymbol(n)}return c(n)}function O(e){if(is_debug()){console.log(e)}}function c(e){if(!o[e]){var r=k.ref(e);var n=gensym(e);if(r){var t=k.get(e);k.set(n,t)}a.push({name:e,gensym:n});o[e]=n}return o[e]}function j(e,r,n){var t=arguments.length>3&&arguments[3]!==undefined$1?arguments[3]:function(){};var i=n.nested;O(" ==> "+e.toString());O(r);if(e instanceof LSymbol){var a=e.valueOf();O("[t 1");if(r[a]){if(r[a]instanceof Pair){var o=r[a],u=o.car,c=o.cdr;if(i){var s=u.car,f=u.cdr;if(f!==nil){t(a,new Pair(f,nil))}return s}if(c!==nil){t(a,c)}return u}else if(r[a]instanceof Array){t(a,r[a].slice(1));return r[a][0]}}return N(a)}if(e instanceof Pair){if(e.car instanceof LSymbol&&e.cdr instanceof Pair&&LSymbol.is(e.cdr.car,P)){O("[t 2");var l=e.car.valueOf();var p=r[l];O({name:l,bindings:r,item:p});if(p===null){return}else if(p){O({b:r[l].toString()});if(p instanceof Pair){O("[t 2 Pair "+i);O({______:p.toString()});var d=p.car,m=p.cdr;if(i){if(m!==nil){O("|| next 1");t(l,m)}O({car:d.toString()});return d}else{if(d.cdr!==nil){O("|| next 2");t(l,new Pair(d.cdr,m))}O({car:d.car.toString()});return d.car}}else if(p instanceof Array){O("[t 2 Array "+i);if(i){t(l,p.slice(1));return Pair.fromArray(p)}else{var h=p.slice(1);if(h.length){t(l,h)}return p[0]}}else{return p}}}O("[t 3 recur "+e.toString());var v=j(e.car,r,n,t);var _=j(e.cdr,r,n,t);return new Pair(v,_)}return e}function E(r,n){var e=Object.values(r);var t=Object.getOwnPropertySymbols(r);if(t.length){e.push.apply(e,toConsumableArray(t.map(function(e){return r[e]})))}return e.length&&e.every(function(e){if(e===null){return!n}return e instanceof Pair||e===nil||e instanceof Array&&e.length})}function A(e){return Object.keys(e).concat(Object.getOwnPropertySymbols(e))}function F(i){var e=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:{},r=e.disabled;O("traverse>> "+i.toString());if(i instanceof Pair){if(!r&&i.car instanceof Pair&&LSymbol.is(i.car.car,P)){return F(i.car.cdr,{disabled:true})}if(i.cdr instanceof Pair&&LSymbol.is(i.cdr.car,P)&&!r){O(">> 1");var n=S["..."].symbols;var t=A(n);var a=i.car instanceof LSymbol&&LSymbol.is(i.cdr.cdr.car,P);if(i.car instanceof Pair||a){if(S["..."].lists[0]===nil){return nil}var o=i.car;if(a){o=new Pair(i.car,new Pair(i.cdr.car,nil))}O(">> 2");var u;if(t.length){O(">> 2 (a)");var c=_objectSpread({},n);u=nil;var s=function e(){if(!E(c)){return"break"}var t={};var r=function e(r,n){t[r]=n};var n=j(o,c,{nested:true},r);if(n!==undefined$1){if(a){if(u===nil){u=n}else{u=u.append(n)}}else{u=new Pair(n,u)}}c=t};while(true){var f=s();if(f==="break")break}if(u!==nil&&!a){u=u.reverse()}return u}else{O(">> 3");var l=j(i.car,n,{nested:true});if(l){return new Pair(l,nil)}return nil}}else if(i.car instanceof LSymbol){O(">> 4");if(LSymbol.is(i.cdr.cdr.car,P)){O(">> 4 (a)")}else{O(">> 4 (b)")}var p=i.car.__name__;var d=defineProperty({},p,n[p]);var m=n[p]===null;var h=nil;var v=function e(){if(!E(d,true)){O({bind:d});return"break"}var t={};var r=function e(r,n){t[r]=n;if(is_debug()){console.log({NEWBIND:t[r].toString()})}};var n=j(i,d,{nested:false},r);if(typeof n!=="undefined"){h=new Pair(n,h)}d=t};while(true){var _=v();if(_==="break")break}if(h!==nil){h=h.reverse()}if(i.cdr instanceof Pair){if(i.cdr.cdr instanceof Pair||i.cdr.cdr instanceof LSymbol){var y=F(i.cdr.cdr,{disabled:r});if(m){return y}h.append(y)}}return h}}var b=k.get(i.car,{throwError:false});var g=b instanceof Macro&&b.__name__==="syntax-rules";var w=F(i.car,{disabled:r});var L;if(g){if(i.cdr.car instanceof LSymbol){L=new Pair(F(i.cdr.car,{disabled:r}),new Pair(i.cdr.cdr.car,F(i.cdr.cdr.cdr,{disabled:r})))}else{L=new Pair(i.cdr.car,F(i.cdr.cdr,{disabled:r}))}}else{L=F(i.cdr,{disabled:r})}O({a:true,car:i.car.toString(),cdr:i.cdr.toString(),head:w&&w.toString(),rest:L&&L.toString()});return new Pair(w,L)}if(i instanceof LSymbol){if(r&&LSymbol.is(i,P)){return i}var x=N(i);if(typeof x!=="undefined"){return x}}return i}return F(r,{})}function isNull(e){return typeof e==="undefined"||e===nil||e===null}function isPromise(e){return e instanceof Promise||e&&typeof e!=="undefined"&&typeof e.then==="function"}function box(e){switch(_typeof_1(e)){case"string":return LString(e);case"number":if(!Number.isNaN(e)){return LNumber(e)}}return e}function map_object(t,i){var e=Object.getOwnPropertyNames(t);var r=Object.getOwnPropertySymbols(t);e.concat(r).forEach(function(e){var r=i(t[e]);var n=Object.getOwnPropertyDescriptor(t,e);if(!n||n.writable&&t[e]!==r){t[e]=r}});return t}function unbox(r){var e=[LString,LCharacter,LNumber].some(function(e){return r instanceof e});if(e){return r.valueOf()}if(r instanceof Array){return r.map(unbox)}if(is_plain_object(r)){return map_object(r,unbox)}return r}function patchValue(e,r){if(e instanceof Pair){e.markCycles();return quote(e)}if(typeof e==="function"){if(r){return bind(e,r)}}return box(e)}function unbind(e){if(is_bound(e)){return e[__fn__]}return e}function bind(r,e){if(r[Symbol["for"]("__bound__")]){return r}var n=r.bind(e);var t=Object.getOwnPropertyNames(r).filter(filter_fn_names);t.forEach(function(e){try{n[e]=r[e]}catch(e){}});hidden_prop(n,"__fn__",r);hidden_prop(n,"__context__",e);hidden_prop(n,"__bound__",true);if(isNativeFunction(r)){hidden_prop(n,"__native__",true)}n.valueOf=function(){return r};return n}function is_object_bound(e){return is_bound(e)&&e[Symbol["for"]("__context__")]===Object}function is_bound(e){return!!(typeof e==="function"&&e[__fn__])}function lips_context(e){if(typeof e==="function"){var r=e[__context__];if(r&&(r===lips||r.constructor&&r.constructor.__class__)){return true}}return false}function is_port(e){function r(e){return e instanceof InputPort||e instanceof OutputPort}if(typeof e==="function"){if(r(e)){return true}if(r(e[__context__])){return true}}return false}var __context__=Symbol["for"]("__context__");var __fn__=Symbol["for"]("__fn__");var exluded_names=["name","length","caller","callee","arguments","prototype"];function filter_fn_names(e){return!exluded_names.includes(e)}function hidden_prop(e,r,n){Object.defineProperty(e,Symbol["for"](r),{get:function e(){return n},set:function e(){},configurable:false,enumerable:false})}function setFnLength(r,n){try{Object.defineProperty(r,"length",{get:function e(){return n}});return r}catch(e){var t=new Array(n).fill(0).map(function(e,r){return"a"+r}).join(",");var i=new Function("f","return function(".concat(t,") {\n                return f.apply(this, arguments);\n            };"));return i(r)}}function isNativeFunction(e){var r=Symbol["for"]("__native__");return typeof e==="function"&&e.toString().match(/\{\s*\[native code\]\s*\}/)&&(e.name.match(/^bound /)&&e[r]===true||!e.name.match(/^bound /)&&!e[r])}function let_macro(e){var m;switch(e){case Symbol["for"]("letrec"):m="letrec";break;case Symbol["for"]("let"):m="let";break;case Symbol["for"]("let*"):m="let*";break;default:throw new Error("Invalid let_macro value")}return Macro.defmacro(m,function(r,e){var a=e.dynamic_scope,o=e.error,n=e.macro_expand;var u;if(r.car instanceof LSymbol){if(!(r.cdr.car instanceof Pair||r.cdr.car===nil)){throw new Error("let require list of pairs")}var t;if(r.cdr.car===nil){u=nil;t=nil}else{t=r.cdr.car.map(function(e){return e.car});u=r.cdr.car.map(function(e){return e.cdr.car})}return Pair.fromArray([LSymbol("letrec"),[[r.car,Pair(LSymbol("lambda"),Pair(t,r.cdr.cdr))]],Pair(r.car,u)])}else if(n){return}var c=this;u=this.get("list->array")(r.car);var s=c.inherit(m);var f,l;if(m==="let*"){l=s}else if(m==="let"){f=[]}var p=0;function d(){var e=new Pair(new LSymbol("begin"),r.cdr);return evaluate(e,{env:s,dynamic_scope:a,error:o})}return function r(){var n=u[p++];if(a){a=m==="let*"?s:c}if(!n){if(f&&f.length){var e=f.map(function(e){return e.value});var t=e.filter(isPromise);if(t.length){return Promise.all(e).then(function(e){for(var r=0,n=e.length;r<n;++r){s.set(f[r].name,e[r])}}).then(d)}else{f.forEach(function(e){var r=e.name,n=e.value;s.set(r,n)})}}return d()}else{if(m==="let"){l=c}else if(m==="letrec"){l=s}var i=evaluate(n.cdr.car,{env:l,dynamic_scope:a,error:o});if(m==="let*"){l=s=l.inherit("let*["+p+"]")}if(f){f.push({name:n.car,value:i});return r()}else{return unpromise(i,function(e){s.set(n.car,e);return r()})}}}()})}function pararel(e,c){return new Macro(e,function(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:{},n=r.dynamic_scope,t=r.error;var i=this;if(n){n=this}var a=e;var o=[];while(a instanceof Pair){o.push(evaluate(a.car,{env:i,dynamic_scope:n,error:t}));a=a.cdr}var u=o.filter(isPromise).length;if(u){return Promise.all(o).then(c.bind(this))}else{return c.call(this,o)}})}function guardMathCall(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),t=1;t<r;t++){n[t-1]=arguments[t]}n.forEach(function(e){typecheck("",e,"number")});return e.apply(void 0,n)}function pipe(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++){t[r]=arguments[r]}t.forEach(function(e,r){typecheck("pipe",e,"function",r+1)});return function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}return t.reduce(function(e,r){return[r.apply(void 0,toConsumableArray(e))]},r)[0]}}function compose(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}r.forEach(function(e,r){typecheck("compose",e,"function",r+1)});return pipe.apply(void 0,toConsumableArray(r.reverse()))}function fold(o,u){var c=this;return function e(r,n){typecheck(o,r,"function");for(var t=arguments.length,i=new Array(t>2?t-2:0),a=2;a<t;a++){i[a-2]=arguments[a]}if(i.some(isNull)){if(typeof n==="number"){return LNumber(n)}return n}else{return u.call.apply(u,[c,e,r,n].concat(i))}}}function limitMathOp(e,r){return limit(e+1,curry(guardMathCall,r))}var singleMathOp=curry(limitMathOp,1);var binaryMathOp=curry(limitMathOp,2);function reduceMathOp(t){var i=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:null;return function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}if(i!==null){r=[i].concat(toConsumableArray(r))}return r.reduce(binaryMathOp(t))}}function curry(a){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++){r[n-1]=arguments[n]}typecheck("curry",a,"function");var o=a.length;return function(){var t=r.slice();function i(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}t=t.concat(r);if(t.length>=o){return a.apply(this,t)}else{return i}}return i.apply(this,arguments)}}function limit(t,i){typecheck("limit",i,"function",2);return function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}return i.apply(void 0,toConsumableArray(r.slice(0,t)))}}var native_lambda=parse(tokenize('(lambda ()\n                                          "[native code]"\n                                          (throw "Invalid Invocation"))'))[0];var get=doc(function e(r){if(typeof r==="function"){r=unbind(r)}var n;for(var t=arguments.length,i=new Array(t>1?t-1:0),a=1;a<t;a++){i[a-1]=arguments[a]}var o=i.length;while(i.length){var u=i.shift();var c=unbox(u);if(c==="__code__"&&typeof r==="function"&&typeof r.__code__==="undefined"){n=native_lambda}else{n=r[c]}if(typeof n==="undefined"){if(i.length){throw new Error("Try to get ".concat(i[0]," from undefined"))}return n}else{var s;if(i.length-1<o){s=r}n=patchValue(n,s)}r=n}return n},"(. obj . args)\n        (get obj . args)\n\n        Function use object as based and keep using arguments to get the\n        property of JavaScript object. Arguments need to be a strings.\n        e.g. `(. console \"log\")` if you use any function inside LIPS is\n        will be weakly bind (can be rebind), so you can call this log function\n        without problem unlike in JavaScript when you use\n       `var log = console.log`.\n       `get` is an alias because . don't work in every place, you can't\n        pass it as argument");function LCharacter(e){if(typeof this!=="undefined"&&!(this instanceof LCharacter)||typeof this==="undefined"){return new LCharacter(e)}if(e instanceof LString){e=e.valueOf()}if(e.length>1){e=e.toLowerCase();if(LCharacter.__names__[e]){this.__name__=e;this.__char__=LCharacter.__names__[e]}else{throw new Error("Internal: Unknown named character")}}else{this.__char__=e;var r=LCharacter.__rev_names__[e];if(r){this.__name__=r}}}LCharacter.__names__=characters;LCharacter.__rev_names__={};Object.keys(LCharacter.__names__).forEach(function(e){var r=LCharacter.__names__[e];LCharacter.__rev_names__[r]=e});LCharacter.prototype.toUpperCase=function(){return LCharacter(this.__char__.toUpperCase())};LCharacter.prototype.toLowerCase=function(){return LCharacter(this.__char__.toLowerCase())};LCharacter.prototype.toString=function(){return"#\\"+(this.__name__||this.__char__)};LCharacter.prototype.valueOf=function(){return this.__char__};function LString(e){if(typeof this!=="undefined"&&!(this instanceof LString)||typeof this==="undefined"){return new LString(e)}if(e instanceof Array){this._string=e.map(function(e,r){typecheck("LString",e,"character",r+1);return e.toString()}).join("")}else{this._string=e.valueOf()}}{var ignore=["length","constructor"];var _keys=Object.getOwnPropertyNames(String.prototype).filter(function(e){return!ignore.includes(e)});var wrap=function e(t){return function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}return t.apply(this._string,r)}};var _iterator3=_createForOfIteratorHelper(_keys),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var key=_step3.value;LString.prototype[key]=wrap(String.prototype[key])}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}LString.isString=function(e){return e instanceof LString||typeof e==="string"};LString.prototype.get=function(e){return this._string[e]};LString.prototype.cmp=function(e){typecheck("LStrign::cmp",e,"string");var r=this.valueOf();var n=e.valueOf();if(r<n){return-1}else if(r===n){return 0}else{return 1}};LString.prototype.lower=function(){return LString(this._string.toLowerCase())};LString.prototype.upper=function(){return LString(this._string.toUpperCase())};LString.prototype.set=function(e,r){if(r instanceof LCharacter){r=r.__char__}var n=[];if(e>0){n.push(this._string.substring(0,e))}n.push(r);if(e<this._string.length-1){n.push(this._string.substring(e+1))}this._string=n.join("")};Object.defineProperty(LString.prototype,"length",{get:function e(){return this._string.length}});LString.prototype.clone=function(){return LString(this.valueOf())};LString.prototype.fill=function(e){if(e instanceof LCharacter){e=e.toString()}var r=this._string.length;this._string=new Array(r+1).join(e)};function LNumber(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:false;if(e instanceof LNumber){return e}if(typeof this!=="undefined"&&!(this instanceof LNumber)||typeof this==="undefined"){return new LNumber(e,r)}if(typeof e==="undefined"){throw new Error("Invalid LNumber constructor call")}var n=LNumber.getType(e);if(LNumber.types[n]){return LNumber.types[n](e,r)}var t=e instanceof Array&&LString.isString(e[0])&&LNumber.isNumber(e[1]);if(e instanceof LNumber){return LNumber(e.value)}if(!LNumber.isNumber(e)&&!t){throw new Error("You can't create LNumber from ".concat(type(e)))}if(e===null){e=0}var i;if(t){var a=e,o=slicedToArray(a,2),u=o[0],c=o[1];if(u instanceof LString){u=u.valueOf()}if(c instanceof LNumber){c=c.valueOf()}var s=u.match(/^([+-])/);var f=false;if(s){u=u.replace(/^[+-]/,"");if(s[1]==="-"){f=true}}}if(typeof BigInt!=="undefined"){if(typeof e!=="bigint"){if(t){var l;switch(c){case 8:l="0o";break;case 16:l="0x";break;case 2:l="0b";break;case 10:l="";break}if(typeof l==="undefined"){var p=BigInt(c);i=toConsumableArray(u).map(function(e,r){return BigInt(parseInt(e,c))*Math.pow(p,BigInt(r))}).reduce(function(e,r){return e+r})}else{i=BigInt(l+u)}}else{i=BigInt(e)}if(f){i*=BigInt(-1)}}else{i=e}return LBigInteger(i,true)}else if(typeof BN!=="undefined"&&!(e instanceof BN)){if(e instanceof Array){return LBigInteger(construct(BN,toConsumableArray(e)))}return LBigInteger(new BN(e))}else if(t){this.value=parseInt(u,c)}else{this.value=e}}LNumber.types={float:function e(r){var n=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:false;return new LFloat(r,n)},complex:function e(r){var n=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:false;if(!LNumber.isComplex(r)){r={im:0,re:r}}return new LComplex(r,n)},rational:function e(r){var n=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:false;if(!LNumber.isRational(r)){r={num:r,denom:1}}return new LRational(r,n)}};function LComplex(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:false;if(typeof this!=="undefined"&&!(this instanceof LComplex)||typeof this==="undefined"){return new LComplex(e,r)}if(e instanceof LComplex){return LComplex({im:e.im,re:e.re})}if(LNumber.isNumber(e)&&r){e={im:0,re:e.valueOf()}}else if(!LNumber.isComplex(e)){throw new Error("Invalid constructor call for LComplex")}var n=e.im instanceof LNumber?e.im:LNumber(e.im);var t=e.re instanceof LNumber?e.re:LNumber(e.re);if(n.cmp(0)===0&&!r){return t}this.im=n;this.re=t;this.__type__="complex"}LComplex.prototype=Object.create(LNumber.prototype);LComplex.prototype.constructor=LComplex;LComplex.prototype.toRational=function(e){if(LNumber.isFloat(this.im)&&LNumber.isFloat(this.re)){var r=LFloat(this.im).toRational(e);var n=LFloat(this.re).toRational(e);return LComplex({im:r,re:n})}return this};LComplex.prototype.add=function(e){return this.complex_op(e,function(e,r,n,t){return{re:e.add(r),im:n.add(t)}})};LComplex.prototype.factor=function(){if(this.im instanceof LFloat||this.im instanceof LFloat){var e=this.re,r=this.im;var n,t;if(e instanceof LFloat){n=e.toRational().mul(e.toRational())}else{n=e.mul(e)}if(r instanceof LFloat){t=r.toRational().mul(r.toRational())}else{t=r.mul(r)}return n.add(t)}else{return this.re.mul(this.re).add(this.im.mul(this.im))}};LComplex.prototype.modulus=function(){return this.factor().sqrt()};LComplex.prototype.sqrt=function(){var e=this.modulus();var r,n;if(e.cmp(0)===0){r=n=e}else if(this.re.cmp(0)===1){r=LFloat(.5).mul(e.add(this.re)).sqrt();n=this.im.div(r).div(2)}else{n=LFloat(.5).mul(e.sub(this.re)).sqrt();if(this.im.cmp(0)===-1){n=n.sub()}r=this.im.div(n).div(2)}return LComplex({im:n,re:r})};LComplex.prototype.div=function(e){if(LNumber.isNumber(e)&&!LNumber.isComplex(e)){e=LComplex({im:0,re:e})}else if(!LNumber.isComplex(e)){throw new Error("[LComplex::add] Invalid value")}var r=this.coerce(e),n=slicedToArray(r,2),t=n[0],i=n[1];var a=LComplex({re:i.re,im:i.im.sub()});var o=i.factor().valueOf();var u=t.mul(a);var c=u.re.op("/",o);var s=u.im.op("/",o);return LComplex({re:c,im:s})};LComplex.prototype.sub=function(e){return this.complex_op(e,function(e,r,n,t){return{re:e.sub(r),im:n.sum(t)}})};LComplex.prototype.mul=function(e){return this.complex_op(e,function(e,r,n,t){var i={re:e.mul(r).sub(n.mul(t)),im:e.mul(t).add(r.mul(n))};return i})};LComplex.prototype.complex_op=function(e,r){if(LNumber.isNumber(e)&&!LNumber.isComplex(e)){if(!(e instanceof LNumber)){e=LNumber(e)}var n=e.asType(0);e={im:n,re:e}}else if(!LNumber.isComplex(e)){throw new Error("[LComplex::add] Invalid value")}var t=e.re instanceof LNumber?e.re:this.re.asType(e.re);var i=e.im instanceof LNumber?e.im:this.im.asType(e.im);var a=r(this.re,t,this.im,i);if("im"in a&&"re"in a){var o=LComplex(a,true);return o}return a};LComplex._op={"+":"add","-":"sub","*":"mul","/":"div"};LComplex.prototype._op=function(e,r){var n=LComplex._op[e];return this[n](r)};LComplex.prototype.cmp=function(e){var r=this.coerce(e),n=slicedToArray(r,2),t=n[0],i=n[1];var a=t.re.coerce(i.re),o=slicedToArray(a,2),u=o[0],c=o[1];var s=u.cmp(c);if(s!==0){return s}else{var f=t.im.coerce(i.im),l=slicedToArray(f,2),p=l[0],d=l[1];return p.cmp(d)}};LComplex.prototype.valueOf=function(){};LComplex.prototype.toString=function(){var e;if(this.re.cmp(0)!==0){e=[this.re.toString()]}else{e=[]}e.push(this.im.cmp(0)<0?"-":"+");e.push(this.im.toString().replace(/^-/,""));e.push("i");return e.join("")};function LFloat(e){if(typeof this!=="undefined"&&!(this instanceof LFloat)||typeof this==="undefined"){return new LFloat(e)}if(!LNumber.isNumber(e)){throw new Error("Invalid constructor call for LFloat")}if(e instanceof LNumber){return LFloat(e.valueOf())}if(typeof e==="number"){this.value=e;this.__type__="float"}}LFloat.prototype=Object.create(LNumber.prototype);LFloat.prototype.constructor=LFloat;LFloat.prototype.toString=function(){var e=this.value.toString();if(!LNumber.isFloat(this.value)&&!e.match(/e/i)){return e+".0"}return e.replace(/^([0-9]+)e/,"$1.0e")};LFloat.prototype._op=function(e,r){if(r instanceof LNumber){r=r.value}var n=LNumber._ops[e];if(e==="/"&&this.value===0&&r===0){return NaN}return LFloat(n(this.value,r))};LFloat.prototype.toRational=function(){var e=arguments.length>0&&arguments[0]!==undefined$1?arguments[0]:null;if(e===null){return toRational(this.value.valueOf())}return approxRatio(e.valueOf())(this.value.valueOf())};var toRational=approxRatio(1e-10);function approxRatio(t){return function(e){var r=function e(t,r,n){var i=function e(r,n){return n<t?r:e(n,r%n)};return i(Math.abs(r),Math.abs(n))},n=r(t?t:1/1e4,1,e);return LRational({num:Math.floor(e/n),denom:Math.floor(1/n)})}}function rationalize(e,r){var n=e.sub(r);var t=e.add(r);var i;if(n.cmp(t)>0){i=simplest_rational2(t,n)}else if(t.cmp(n)<=0){i=n}else if(n.cmp(0)>0){i=simplest_rational2(n,t)}else if(r.cmp(0)<0){i=LNumber(simplest_rational2(t.sub(),n.sub())).sub()}else{i=LNumber(0)}if(LNumber.isFloat(r)||LNumber.isFloat(e)){return LFloat(i)}return i}function simplest_rational2(e,r){var n=LNumber(e).floor();var t=LNumber(r).floor();if(e.cmp(n)<1){return n}else if(n.cmp(t)===0){var i=LNumber(1).div(r.sub(t));var a=LNumber(1).div(e.sub(n));return n.add(LNumber(1).div(simplest_rational2(i,a)))}else{return n.add(LNumber(1))}}function LRational(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:false;if(typeof this!=="undefined"&&!(this instanceof LRational)||typeof this==="undefined"){return new LRational(e,r)}if(!LNumber.isRational(e)){throw new Error("Invalid constructor call for LRational")}var n=LNumber(e.num);var t=LNumber(e.denom);if(!r&&t.cmp(0)!==0){var i=n.op("%",t).cmp(0)===0;if(i){return LNumber(n.div(t))}}this.num=n;this.denom=t;this.__type__="rational"}LRational.prototype=Object.create(LNumber.prototype);LRational.prototype.constructor=LRational;LRational.prototype.pow=function(e){var r=e.cmp(0);if(r===0){return LNumber(1)}if(r===-1){e=e.sub();var n=this.denom.pow(e);var t=this.num.pow(e);return LRational({num:n,denom:t})}var i=this;e=e.valueOf();while(e>1){i=i.mul(this);e--}return i};LRational.prototype.sqrt=function(){var e=this.num.sqrt();var r=this.denom.sqrt();if(e instanceof LFloat){e=(readOnlyError("num"),e.toRational())}if(r instanceof LFloat){r=(readOnlyError("denom"),r.toRational())}return LRational({num:e,denom:r})};LRational.prototype.abs=function(){var e=this.num;var r=this.denom;if(e.cmp(0)===-1){e=e.sub()}if(r.cmp(0)!==1){r=r.sub()}return LRational({num:e,denom:r})};LRational.prototype.cmp=function(e){return LNumber(this.valueOf(),true).cmp(e)};LRational.prototype.toString=function(){var e=this.num.gcd(this.denom);var r,n;if(e.cmp(1)!==0){r=this.num.div(e);if(r instanceof LRational){r=LNumber(r.valueOf(true))}n=this.denom.div(e);if(n instanceof LRational){n=LNumber(n.valueOf(true))}}else{r=this.num;n=this.denom}var t=this.cmp(0)<0;if(t){if(r.abs().cmp(n.abs())===0){return r.toString()}}else if(r.cmp(n)===0){return r.toString()}return r.toString()+"/"+n.toString()};LRational.prototype.valueOf=function(e){if(this.denom.cmp(0)===0){if(this.num.cmp(0)<0){return Number.NEGATIVE_INFINITY}return Number.POSITIVE_INFINITY}if(e){return LNumber._ops["/"](this.num.value,this.denom.value)}return LFloat(this.num.valueOf()).div(this.denom.valueOf())};LRational.prototype.mul=function(e){if(!(e instanceof LNumber)){e=LNumber(e)}if(LNumber.isRational(e)){var r=this.num.mul(e.num);var n=this.denom.mul(e.denom);return LRational({num:r,denom:n})}var t=LNumber.coerce(this,e),i=slicedToArray(t,2),a=i[0],o=i[1];return a.mul(o)};LRational.prototype.div=function(e){if(!(e instanceof LNumber)){e=LNumber(e)}if(LNumber.isRational(e)){var r=this.num.mul(e.denom);var n=this.denom.mul(e.num);return LRational({num:r,denom:n})}var t=LNumber.coerce(this,e),i=slicedToArray(t,2),a=i[0],o=i[1];var u=a.div(o);return u};LRational.prototype._op=function(e,r){return this[rev_mapping[e]](r)};LRational.prototype.sub=function(e){if(typeof e==="undefined"){return this.mul(-1)}if(!(e instanceof LNumber)){e=LNumber(e)}if(LNumber.isRational(e)){var r=e.num.sub();var n=e.denom;return this.add(LRational({num:r,denom:n}))}if(!(e instanceof LNumber)){e=LNumber(e).sub()}else{e=e.sub()}var t=LNumber.coerce(this,e),i=slicedToArray(t,2),a=i[0],o=i[1];return a.add(o)};LRational.prototype.add=function(e){if(!(e instanceof LNumber)){e=LNumber(e)}if(LNumber.isRational(e)){var r=this.denom;var n=e.denom;var t=this.num;var i=e.num;var a,o;if(r!==n){o=n.mul(t).add(i.mul(r));a=r.mul(n)}else{o=t.add(i);a=r}return LRational({num:o,denom:a})}if(LNumber.isFloat(e)){return LFloat(this.valueOf()).add(e)}var u=LNumber.coerce(this,e),c=slicedToArray(u,2),s=c[0],f=c[1];return s.add(f)};function LBigInteger(e,r){if(typeof this!=="undefined"&&!(this instanceof LBigInteger)||typeof this==="undefined"){return new LBigInteger(e,r)}if(e instanceof LBigInteger){return LBigInteger(e.value,e._native)}if(!LNumber.isBigInteger(e)){throw new Error("Invalid constructor call for LBigInteger")}this.value=e;this._native=r;this.__type__="bigint"}LBigInteger.prototype=Object.create(LNumber.prototype);LBigInteger.prototype.constructor=LBigInteger;LBigInteger.bn_op={"+":"iadd","-":"isub","*":"imul","/":"idiv","%":"imod","|":"ior","&":"iand","~":"inot","<<":"ishrn",">>":"ishln"};LBigInteger.prototype._op=function(e,r){if(typeof r==="undefined"){if(LNumber.isBN(this.value)){e=LBigInteger.bn_op[e];return LBigInteger(this.value.clone()[e](),false)}return LBigInteger(LNumber._ops[e](this.value),true)}if(LNumber.isBN(this.value)&&LNumber.isBN(r.value)){e=LBigInteger.bn_op[e];return LBigInteger(this.value.clone()[e](r),false)}var n=LNumber._ops[e](this.value,r.value);if(e==="/"){var t=this.op("%",r).cmp(0)===0;if(t){return LNumber(n)}return LRational({num:this,denom:r})}return LBigInteger(n,true)};LBigInteger.prototype.sqrt=function(){var e;var r=this.cmp(0)<0;if(LNumber.isNative(this.value)){e=LNumber(Math.sqrt(r?-this.valueOf():this.valueOf()))}else if(LNumber.isBN(this.value)){e=r?this.value.neg().sqrt():this.value.sqrt()}if(r){return LComplex({re:0,im:e})}return e};LNumber.prototype.gcd=function(e){var r=this.abs();e=e.abs();if(e.cmp(r)===1){var n=r;r=e;e=n}while(true){r=r.rem(e);if(r.cmp(0)===0){return e}e=e.rem(r);if(e.cmp(0)===0){return r}}};LNumber.isFloat=function e(r){return r instanceof LFloat||Number(r)===r&&r%1!==0};LNumber.isNumber=function(e){return e instanceof LNumber||!Number.isNaN(e)&&LNumber.isNative(e)||LNumber.isBN(e)};LNumber.isComplex=function(e){var r=e instanceof LComplex||LNumber.isNumber(e.im)&&LNumber.isNumber(e.re);return r};LNumber.isRational=function(e){return e instanceof LRational||LNumber.isNumber(e.num)&&LNumber.isNumber(e.denom)};LNumber.isNative=function(e){return typeof e==="bigint"||typeof e==="number"};LNumber.isBigInteger=function(e){return e instanceof LBigInteger||typeof e==="bigint"||LNumber.isBN(e)};LNumber.isBN=function(e){return typeof BN!=="undefined"&&e instanceof BN};LNumber.getArgsType=function(e,r){if(e instanceof LFloat||r instanceof LFloat){return LFloat}if(e instanceof LBigInteger||r instanceof LBigInteger){return LBigInteger}return LNumber};LNumber.prototype.toString=LNumber.prototype.toJSON=function(e){if(e>2&&e<36){return this.value.toString(e)}return this.value.toString()};LNumber.prototype.asType=function(e){var r=LNumber.getType(this);return LNumber.types[r]?LNumber.types[r](e):LNumber(e)};LNumber.prototype.isBigNumber=function(){return typeof this.value==="bigint"||typeof BN!=="undefined"&&!(this.value instanceof BN)};["floor","ceil","round"].forEach(function(e){LNumber.prototype[e]=function(){if(this["float"]||LNumber.isFloat(this.value)){return LNumber(Math[e](this.value))}else{return LNumber(Math[e](this.valueOf()))}}});LNumber.prototype.valueOf=function(){if(LNumber.isNative(this.value)){return Number(this.value)}else if(LNumber.isBN(this.value)){return this.value.toNumber()}};var matrix=function(){var e=function e(r,n){return[r,n]};return{bigint:{bigint:e,float:function e(r,n){return[LFloat(r.valueOf()),n]},rational:function e(r,n){return[{num:r,denom:1},n]},complex:function e(r,n){return[{im:0,re:r},n]}},float:{bigint:function e(r,n){return[r,n&&LFloat(n.valueOf())]},float:e,rational:function e(r,n){return[r,n&&LFloat(n.valueOf())]},complex:function e(r,n){return[{re:r,im:LFloat(0)},n]}},complex:{bigint:r("bigint"),float:r("float"),rational:r("rational"),complex:function e(r,n){var t=LNumber.coerce(r.re,n.re),i=slicedToArray(t,2),a=i[0],o=i[1];var u=LNumber.coerce(r.im,n.im),c=slicedToArray(u,2),s=c[0],f=c[1];return[{im:s,re:a},{im:f,re:o}]}},rational:{bigint:function e(r,n){return[r,n&&{num:n,denom:1}]},float:function e(r,n){return[LFloat(r.valueOf()),n]},rational:e,complex:function e(r,n){return[{im:coerce(r.__type__,n.im.__type__,0),re:coerce(r.__type__,n.re.__type__,r)},{im:coerce(r.__type__,n.im.__type__,n.im),re:coerce(r.__type__,n.re.__type__,n.re)}]}}};function r(n){return function(e,r){return[{im:coerce(n,e.im.__type__,e.im),re:coerce(n,e.re.__type__,e.re)},{im:coerce(n,e.im.__type__,0),re:coerce(n,r.__type__,r)}]}}}();function coerce(e,r,n){return matrix[e][r](n)[0]}LNumber.coerce=function(e,r){function n(e){if(e==="integer"){return"bigint"}return e}var t=n(LNumber.getType(e));var i=n(LNumber.getType(r));if(!matrix[t]){throw new Error("LNumber::coerce unknown lhs type ".concat(t))}else if(!matrix[t][i]){throw new Error("LNumber::coerce unknown rhs type ".concat(i))}return matrix[t][i](e,r).map(function(e){return LNumber(e,true)})};LNumber.prototype.coerce=function(e){if(!(typeof e==="number"||e instanceof LNumber)){throw new Error("LNumber: you can't coerce ".concat(type(e)))}if(typeof e==="number"){e=LNumber(e)}return LNumber.coerce(this,e)};LNumber.getType=function(e){if(e instanceof LNumber){return e.__type__}if(LNumber.isFloat(e)){return"float"}if(LNumber.isComplex(e)){return"complex"}if(LNumber.isRational(e)){return"rational"}if(typeof e==="number"){return"integer"}if(typeof BigInt!=="undefined"&&typeof e!=="bigint"||typeof BN!=="undefined"&&!(e instanceof BN)){return"bigint"}};LNumber.prototype.isFloat=function(){return!!(LNumber.isFloat(this.value)||this["float"])};var mapping={add:"+",sub:"-",mul:"*",div:"/",rem:"%",or:"|",and:"&",neg:"~",shl:">>",shr:"<<"};var rev_mapping={};Object.keys(mapping).forEach(function(r){rev_mapping[mapping[r]]=r;LNumber.prototype[r]=function(e){return this.op(mapping[r],e)}});LNumber._ops={"*":function e(r,n){return r*n},"+":function e(r,n){return r+n},"-":function e(r,n){if(typeof n==="undefined"){return-r}return r-n},"/":function e(r,n){return r/n},"%":function e(r,n){return r%n},"|":function e(r,n){return r|n},"&":function e(r,n){return r&n},"~":function e(r){return~r},">>":function e(r,n){return r>>n},"<<":function e(r,n){return r<<n}};LNumber.prototype.op=function(e,r){if(typeof r==="undefined"){return LNumber(LNumber._ops[e](this.valueOf()))}var n=this.coerce(r),t=slicedToArray(n,2),i=t[0],a=t[1];if(i._op){return i._op(e,a)}return LNumber(LNumber._ops[e](i,a))};LNumber.prototype.sqrt=function(){var e=this.valueOf();if(this.cmp(0)<0){return LComplex({re:0,im:Math.sqrt(-e)})}return new LNumber(Math.sqrt(e))};var pow=new Function("a,b","return a**b;");var power_operator_suported=function(){try{pow(1,1);return true}catch(e){return false}}();LNumber.prototype.pow=function(e){if(LNumber.isNative(this.value)){if(power_operator_suported){e.value=pow(this.value,e.value)}else{throw new Error("Power operator not supported")}}else if(LNumber.isBN(this.value)){e.value=this.value.pow(e.value)}else{e.value=Math.pow(this.value,e.value)}return e};LNumber.prototype.abs=function(){var e=this.value;if(LNumber.isNative(this.value)){if(e<0){e=-e}}else if(LNumber.isBN(e)){e.iabs()}return new LNumber(e)};LNumber.prototype.isOdd=function(){if(LNumber.isNative(this.value)){if(this.isBigNumber()){return this.value%BigInt(2)===BigInt(1)}return this.value%2===1}else if(LNumber.isBN(this.value)){return this.value.isOdd()}};LNumber.prototype.isEven=function(){return!this.isOdd()};LNumber.prototype.cmp=function(e){var r=this.coerce(e),n=slicedToArray(r,2),t=n[0],i=n[1];function a(e,r){if(e.value<r.value){return-1}else if(e.value===r.value){return 0}else{return 1}}if(t.__type__==="bigint"){if(LNumber.isNative(t.value)){return a(t,i)}else if(LNumber.isBN(t.value)){return this.value.cmp(i.value)}}else if(t instanceof LFloat){return a(t,i)}};function InputPort(e){if(typeof this!=="undefined"&&!(this instanceof InputPort)||typeof this==="undefined"){return new InputPort(e)}typecheck("InputPort",e,"function");this._index=0;this._in_char=0;this.read=e}InputPort.prototype.read_line=function(){return this.read()};InputPort.prototype.get_next_tokens=function(){if(!this._tokens){this._tokens=tokenize(this._string)}if(typeof this._tokens[this._index]==="undefined"){return eof}var e=0;var r=[];var n=["(",")","[","]"];if(!n.includes(this._tokens[this._index])){return this._tokens[this._index++]}do{var t=this._tokens[this._index];r.push(this._tokens[this._index]);if(t===")"||t==="]"){e--}else if(t==="("||t==="["){e++}this._index++}while(e!==0);return r};InputPort.prototype.read_char=function(){var e=this.peek_char();if(e!==eof){this._in_char++}return e};InputPort.prototype.peek_char=function(){if(this._in_char>=this._string.length){return eof}return LCharacter(this._string[this._in_char])};function OutputPort(e){if(typeof this!=="undefined"&&!(this instanceof OutputPort)||typeof this==="undefined"){return new OutputPort(e)}typecheck("OutputPort",e,"function");this.write=e}OutputPort.prototype.toString=function(){return"#<output-port>"};function OutputStringPort(r){var n=this;if(typeof this!=="undefined"&&!(this instanceof OutputStringPort)||typeof this==="undefined"){return new OutputStringPort(r)}typecheck("OutputStringPort",r,"function");this._buffer=[];this.write=function(e){if(!LString.isString(e)){e=r(e)}else{e=e.valueOf()}n._buffer.push(e)}}OutputStringPort.prototype=Object.create(OutputPort.prototype);OutputStringPort.prototype.getString=function(){return this._buffer.map(function(e){return e.valueOf()}).join("")};OutputStringPort.prototype.constructor=OutputStringPort;function InputStringPort(e){var r=this;if(typeof this!=="undefined"&&!(this instanceof InputStringPort)||typeof this==="undefined"){return new InputStringPort(e)}typecheck("InputStringPort",e,"string");this._string=e.valueOf();this._index=0;this._in_char=0;this.read=function(){return r.get_next_tokens()}}InputStringPort.prototype=Object.create(InputPort.prototype);InputStringPort.prototype.constructor=InputStringPort;InputStringPort.prototype.read_line=function(){var e=this._string.substring(this._in_char);if(!e){return eof}var r=e.match(/([^\n])(?:\n|$)/)[0];this._in_char+=r.length;return r};var eof=new EOF;function EOF(){}EOF.prototype.toString=function(){return"#<eof>"};function Interpreter(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:{};if(typeof this!=="undefined"&&!(this instanceof Interpreter)||typeof this==="undefined"){return new Interpreter(e,r)}if(typeof e==="undefined"){e="anonymous"}this.__env__=user_env.inherit(e,r);var n="**interaction-environment-defaults**";this.__env__.set(n,get_props(r).concat(n))}Interpreter.prototype.exec=function(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:false;var n=arguments.length>2&&arguments[2]!==undefined$1?arguments[2]:null;typecheck("Intepreter::exec",e,"string",1);typecheck("Intepreter::exec",r,"boolean",2);global_env.set("**interaction-environment**",this.__env__);if(n===null){n=this.__env__}return exec(e,n,r?n:false)};Interpreter.prototype.get=function(e){var r=this.__env__.get(e);if(typeof r==="function"){return r.bind(this.__env__)}return r};Interpreter.prototype.set=function(e,r){return this.__env__.set(e,r)};function Environment(e,r,n){if(arguments.length===1){if(_typeof_1(arguments[0])==="object"){e=arguments[0];r=null}else if(typeof arguments[0]==="string"){e={};r={};n=arguments[0]}}this.__docs__=new Map;this.__env__=e;this.__parent__=r;this.__name__=n||"anonymous"}Environment.prototype.list=function(){return get_props(this.__env__)};Environment.prototype.unset=function(e){if(e instanceof LSymbol){e=e.valueOf()}if(e instanceof LString){e=e.valueOf()}delete this.__env__[e]};Environment.prototype.inherit=function(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:{};if(_typeof_1(e)==="object"){r=e}if(!e||_typeof_1(e)==="object"){e="child of "+(this.__name__||"unknown")}return new Environment(r||{},this,e)};Environment.prototype.doc=function(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:null;if(e instanceof LSymbol){e=e.__name__}if(e instanceof LString){e=e.valueOf()}if(r){this.__docs__.set(e,r);return this}if(this.__docs__.has(e)){return this.__docs__.get(e)}if(this.__parent__){return this.__parent__.doc(e)}};Environment.prototype.newFrame=function(e,r){var t=this.inherit("__frame__");t.set("parent.frame",doc("parent.frame",function(){var e=arguments.length>0&&arguments[0]!==undefined$1?arguments[0]:1;e=e.valueOf();var r=t.__parent__;if(!(r instanceof Environment)){return nil}if(e<=0){return r}var n=r.get("parent.frame");return n(e-1)},global_env.__env__["parent.frame"].__doc__));r.callee=e;t.set("arguments",r);return t};Environment.prototype._lookup=function(e){if(e instanceof LSymbol){e=e.__name__}if(e instanceof LString){e=e.valueOf()}if(this.__env__.hasOwnProperty(e)){return Value(this.__env__[e])}if(this.__parent__){return this.__parent__._lookup(e)}};Environment.prototype.toString=function(){return"#<env:"+this.__name__+">"};Environment.prototype.clone=function(){var r=this;var n={};Object.keys(this.__env__).forEach(function(e){n[e]=r.__env__[e]});return new Environment(n,this.__parent__,this.__name__)};Environment.prototype.merge=function(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:"merge";typecheck("Environment::merge",e,"environment");return this.inherit(r,e.__env__)};function Value(e){if(typeof this!=="undefined"&&!(this instanceof Value)||typeof this==="undefined"){return new Value(e)}this.value=e}Value.isUndefined=function(e){return e instanceof Value&&typeof e.value==="undefined"};Value.prototype.valueOf=function(){return this.value};function Values(e){if(e.length){if(e.length===1){return e[0]}}if(typeof this!=="undefined"&&!(this instanceof Values)||typeof this==="undefined"){return new Values(e)}this.__values__=e}Values.prototype.toString=function(){return this.__values__.map(function(e){return toString(e)}).join("\n")};Values.prototype.valueOf=function(){return this.__values__};Environment.prototype.get=function(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:{};var n=r.throwError,t=n===void 0?true:n;var i=e;if(i instanceof LSymbol||i instanceof LString){i=i.valueOf()}var a=this._lookup(i);if(a instanceof Value){if(Value.isUndefined(a)){return undefined$1}return patchValue(a.valueOf())}if(typeof i==="string"){var o=i.split(".").filter(Boolean);if(o.length>0){var u=toArray(o),c=u[0],s=u.slice(1);a=this._lookup(c);if(s.length){try{if(a instanceof Value){a=a.valueOf()}else{a=get(root,c);if(typeof a==="function"){a=unbind(a)}}return get.apply(void 0,[a].concat(toConsumableArray(s)))}catch(e){}}else if(a instanceof Value){return patchValue(a.valueOf())}}a=get(root,i)}if(typeof a!=="undefined"){return a}if(t){throw new Error("Unbound variable `"+i.toString()+"'")}};Environment.prototype.set=function(e,r){var n=arguments.length>2&&arguments[2]!==undefined$1?arguments[2]:null;if(LNumber.isNumber(r)){r=LNumber(r)}if(e instanceof LSymbol){e=e.__name__}if(e instanceof LString){e=e.valueOf()}this.__env__[e]=r;if(n){this.doc(e,n)}return this};Environment.prototype.has=function(e){return this.__env__.hasOwnProperty(e)};Environment.prototype.ref=function(e){var r=this;while(true){if(!r){break}if(r.has(e)){return r}r=r.__parent__}};Environment.prototype.parents=function(){var e=this;var r=[];while(e){r.unshift(e);e=e.__parent__}return r};function quote(e){if(isPromise(e)){return e.then(quote)}if(e instanceof Pair||e instanceof LSymbol){e.data=true}return e}var global_env=new Environment({nil:nil,undefined:undefined$1,true:true,false:false,null:null,NaN:NaN,stdout:new OutputPort(function(){var e;(e=console).log.apply(e,arguments)}),stdin:InputPort(function(){return new Promise(function(e){e(prompt(""))})}),"open-input-string":doc("open-input-string",function(e){typecheck("open-input-string",e,"string");return InputStringPort(e)},"(open-input-string string)\n\n            Function create new string port as input that can be used to\n            read S-exressions from this port using `read` function."),"output-port?":doc("output-port?",function(e){return e instanceof OutputPort},"(output-port? arg)\n\n            Function return true if argument is output port."),"input-port?":doc("input-port?",function(e){return e instanceof InputPort},"(input-port? arg)\n\n            Function return true if argument is input port."),"open-output-string":doc("open-output-string",function(){return OutputStringPort(this.get("repr"))},"(open-output-string)\n\n            Function create new output port that can used to write string into\n            and after finish get the whole string using `get-output-string`"),"get-output-string":doc("get-output-string",function(e){typecheck("get-output-string",e,"output-string-port");return e.getString()},"(get-output-string port)\n\n            Function get full string from string port. If nothing was wrote\n            to given port it will return empty string."),"eof-object?":doc("eof-object?",function(e){return e===eof},"(eof-object? arg)\n\n            Function check if value is eof object, returned from input string\n            port when there are no more data to read."),"peek-char":doc("peek-char",function(e){typecheck("peek-char",e,["input-port","input-string-port"]);return e.peek_char()},"(peek-char port)\n\n            Function get character from string port or EOF object if no more\n            data in string port."),"read-line":doc("read-line",function(e){if(typeof e==="undefined"){e=this.get("stdin")}typecheck("read-line",e,["input-port","input-string-port"]);return e.read_line()},"(read-char port)\n\n            Function read next character from input port."),"read-char":doc("read-char",function(e){if(typeof e==="undefined"){e=this.get("stdin")}typecheck("read-char",e,["input-port","input-string-port"]);return e.read_char()},"(read-char port)\n\n            Function read next character from input port."),read:doc(function(){var r=asyncToGenerator(regenerator.mark(function e(n){var t,i;return regenerator.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:if(!LString.isString(n)){r.next=4;break}r.next=3;return parse(n,this);case 3:return r.abrupt("return",r.sent[0]);case 4:if(n instanceof InputPort){t=n}else{t=this.get("stdin")}r.next=7;return t.read();case 7:i=r.sent;console.log(i);if(!(i===eof)){r.next=11;break}return r.abrupt("return",eof);case 11:r.next=13;return parse(i,this);case 13:return r.abrupt("return",r.sent[0]);case 14:case"end":return r.stop()}}},e,this)}));function e(e){return r.apply(this,arguments)}return e}(),"(read [string])\n\n            Function if used with string will parse the string and return\n            list structure of LIPS code. If called without an argument it\n            will read string from standard input (using browser prompt or\n            user defined way) and call itself with that string (parse is)\n            function can be used together with eval to evaluate code from\n            string"),pprint:doc(function e(r){if(r instanceof Pair){r=new lips.Formatter(r.toString(true))["break"]().format();this.get("display").call(this,r)}else{this.get("write").call(this,r)}this.get("newline").call(this)},"(pprint expression)\n\n           Pretty print list expression, if called with non-pair it just call\n           print function with passed argument."),print:doc(function e(){var r=this;var n=this.get("display");var t=this.get("newline");for(var i=arguments.length,a=new Array(i),o=0;o<i;o++){a[o]=arguments[o]}a.forEach(function(e){n.call(r,e);t.call(r)})},"(print . args)\n\n            Function convert each argument to string and print the result to\n            standard output (by default it's console but it can be defined\n            it user code), the function call newline after printing each arg."),format:doc(function e(r){for(var n=arguments.length,t=new Array(n>1?n-1:0),i=1;i<n;i++){t[i-1]=arguments[i]}typecheck("format",r,"string");var a=/(~[as%~])/g;var o=r.match(/(~[as])/g);if(o&&o.length>t.length){throw new Error("Not enough arguments")}var u=0;var c=this.get("repr");r=r.replace(a,function(e){var r=e[1];if(r==="~"){return"~"}else if(r==="%"){return"\n"}else{var n=t[u++];if(r==="a"){return c(n)}else{return c(n,true)}}});o=r.match(/~([\S])/);if(o){throw new Error("format: Unrecognized escape seqence ".concat(o[1]))}return r},"(format string n1 n2 ...)\n\n            Function accepts string template and replacing any escape sequences\n            by arguments:\n\n            * ~a value as if printed with display\n            * ~s value as if printed with write\n            * ~% newline character\n            * ~~ literal tilde '~' is inserted\n\n            if there missing arguments or other escape character it throw exception."),display:doc(function e(r){var n=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:null;if(n===null){n=this.get("stdout")}var t=this.get("repr")(r);n.write.call(this,t)},"(display arg [port])\n\n            Function send string to standard output or provied port."),error:doc(function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}this.get("display").call(this,n.map(toString).join(""));this.get("newline").call(this)},"(error . args)\n\n            Display error message."),"%same-functions":doc("%same-functions",function(e,r){if(typeof e!=="function"){return false}if(typeof r!=="function"){return false}return unbind(e)===unbind(r)},"(%same-functions a b)\n\n            Helper function that check if two bound functions are the same"),help:doc(new Macro("help",function(e,r){var n=r.dynamic_scope,t=r.error;var i;if(e.car instanceof LSymbol){i=e.car}else if(e.car instanceof Pair&&e.car.car instanceof LSymbol){i=e.car.car}else{var a=this;if(n){n=this}var o=evaluate(e.car,{env:a,error:t,dynamic_scope:n});if(o&&o.__doc__){return o.__doc__}return}var u;var c=this.get(i);u=c&&c.__doc__;if(u){return u}var s=this.ref(i);if(s){u=s.doc(i);if(u){return u}}}),"(help object)\n\n             Macro returns documentation for function or macros including parser\n             macros but only if called with parser macro symbol like (help `).\n             For normal functions and macros you can save the function in variable."),cons:doc(function e(r,n){return new Pair(r,n)},"(cons left right)\n\n            Function return new Pair out of two arguments."),car:doc(function e(r){typecheck("car",r,"pair");return r.car},"(car pair)\n\n            Function returns car (head) of the list/pair."),cdr:doc(function e(r){typecheck("cdr",r,"pair");return r.cdr},"(cdr pair)\n\n            Function returns cdr (tail) of the list/pair."),"set!":doc(new Macro("set!",function(e){var a=this;var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:{},n=r.dynamic_scope,t=r.error;if(n){n=this}var i=this;var o;var u=evaluate(e.cdr.car,{env:this,dynamic_scope:n,error:t});u=resolvePromises(u);function c(r,n,t){if(isPromise(r)){return r.then(function(e){return c(r,e,t)})}if(isPromise(n)){return n.then(function(e){return c(r,e,t)})}if(isPromise(t)){return t.then(function(e){return c(r,n,e)})}i.get("set-obj!").call(i,r,n,t);return t}if(e.car instanceof Pair&&LSymbol.is(e.car.car,".")){var s=e.car.cdr.car;var f=e.car.cdr.cdr.car;var l=evaluate(s,{env:this,dynamic_scope:n,error:t});var p=evaluate(f,{env:this,dynamic_scope:n,error:t});return c(l,p,u)}if(!(e.car instanceof LSymbol)){throw new Error("set! first argument need to be a symbol or "+"dot accessor that evaluate to object.")}var d=e.car.valueOf();o=this.ref(e.car.__name__);return unpromise(u,function(e){if(!o){var r=d.split(".");if(r.length>1){var n=r.pop();var t=r.join(".");var i=a.get(t,{throwError:false});if(i){c(i,n,e);return}}throw new Error("Unbound variable `"+d+"'")}o.set(d,e)})}),"(set! name value)\n\n            Macro that can be used to set the value of the variable (mutate)\n            it search the scope chain until it finds first non emtpy slot and set it."),"unset!":doc(new Macro("set!",function(e){if(!(e.car instanceof LSymbol)){throw new Error("unset! first argument need to be a symbol or "+"dot accessor that evaluate to object.")}var r=e.car;var n=this.ref(r);if(n){delete n.__env__[r.__name__]}}),"(unset! name)\n\n            Function delete specified name from environment."),"set-car!":doc("set-car!",function(e,r){typecheck("set-car!",e,"pair");e.car=r},"(set-car! obj value)\n\n            Function that set car (head) of the list/pair to specified value.\n            It can destroy the list. Old value is lost."),"set-cdr!":doc("set-cdr!",function(e,r){typecheck("set-cdr!",e,"pair");e.cdr=r},"(set-cdr! obj value)\n\n            Function that set cdr (tail) of the list/pair to specified value.\n            It can destroy the list. Old value is lost."),"empty?":doc("empty?",function(e){return typeof e==="undefined"||e===nil},"(empty? object)\n\n            Function return true if value is undfined empty list."),gensym:doc("gensym",gensym,"(gensym)\n\n             Function generate unique symbol, to use with macros as meta name."),load:doc(function e(r){typecheck("load",r,"string");var n=this;if(n.__name__==="__frame__"){n=n.__parent__}var i;if(n===global_env){i=n}else{i=this.get("**interaction-environment**")}var a="**module-path**";var o=global_env.get(a,{throwError:false});r=r.valueOf();if(!r.match(/.[^.]+$/)){r+=".scm"}if(typeof this.get("global",{throwError:false})!=="undefined"){return new Promise(function(n,t){var e=nodeRequire("path");if(o){o=o.valueOf();r=e.join(o,r)}global_env.set(a,e.dirname(r));nodeRequire("fs").readFile(r,function(e,r){if(e){console.log(e);t(e);global_env.set(a,o)}else{exec(r.toString(),i).then(function(){n();global_env.set(a,o)})["catch"](t)}})})}if(o){o=o.valueOf();r=o+"/"+r.replace(/^\.?\/?/,"")}return root.fetch(r).then(function(e){return e.text()}).then(function(e){global_env.set(a,r.replace(/\/[^/]*$/,""));return exec(e,i)}).then(function(){})["finally"](function(){global_env.set(a,o)})},"(load filename)\n\n            Function fetch the file and evaluate its content as LIPS code."),do:doc(new Macro("do",function(){var n=asyncToGenerator(regenerator.mark(function e(n,t){var i,a,o,u,c,s,f,l,p,d,m;return regenerator.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=t.dynamic_scope,a=t.error;o=this;if(i){i=o}u=o.inherit("do");c=n.car;s=n.cdr.car;f=n.cdr.cdr;if(f!==nil){f=new Pair(LSymbol("begin"),f)}l={env:o,dynamic_scope:i,error:a};p=c;case 10:if(!(p!==nil)){r.next=21;break}d=p.car;r.t0=u;r.t1=d.car;r.next=16;return evaluate(d.cdr.car,l);case 16:r.t2=r.sent;r.t0.set.call(r.t0,r.t1,r.t2);p=p.cdr;r.next=10;break;case 21:l={env:u,dynamic_scope:i,error:a};m=regenerator.mark(function e(){var n,t,i,a,o;return regenerator.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:if(!(f!==nil)){r.next=3;break}r.next=3;return lips.evaluate(f,l);case 3:n=c;t={};case 5:if(!(n!==nil)){r.next=15;break}i=n.car;if(!(i.cdr.cdr!==nil)){r.next=12;break}r.next=10;return evaluate(i.cdr.cdr.car,l);case 10:a=r.sent;t[i.car.valueOf()]=a;case 12:n=n.cdr;r.next=5;break;case 15:o=Object.getOwnPropertySymbols(t);Object.keys(t).concat(o).forEach(function(e){u.set(e,t[e])});case 17:case"end":return r.stop()}}},e)});case 23:r.next=25;return evaluate(s.car,l);case 25:if(r.sent){r.next=29;break}return r.delegateYield(m(),"t3",27);case 27:r.next=23;break;case 29:if(!(s.cdr!==nil)){r.next=33;break}r.next=32;return evaluate(s.cdr.car,l);case 32:return r.abrupt("return",r.sent);case 33:case"end":return r.stop()}}},e,this)}));return function(e,r){return n.apply(this,arguments)}}()),"(do ((<var> <init> <next>)) (test expression) . body)\n\n             Iteration macro that evaluate the expression body in scope of the variables.\n             On Eeach loop it increase the variables according to next expression and run\n             test to check if the loop should continue. If test is signle call the macro\n             will not return anything. If the test is pair of expression and value the\n             macro will return that value after finish."),if:doc(new Macro("if",function(n,e){var t=e.dynamic_scope,i=e.error;if(t){t=this}var a=this;var r=function e(r){if(r){return evaluate(n.cdr.car,{env:a,dynamic_scope:t,error:i})}else{return evaluate(n.cdr.cdr.car,{env:a,dynamic_scope:t,error:i})}};if(n===nil){throw new Error("too few expressions for `if`")}var o=evaluate(n.car,{env:a,dynamic_scope:t,error:i});return unpromise(o,r)}),"(if cond true-expr false-expr)\n\n            Macro evaluate condition expression and if the value is true, it\n            evaluate and return true expression if not it evaluate and return\n            false expression"),"let-env":new Macro("let-env",function(r){var e=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:{};var n=e.dynamic_scope,t=e.error;typecheck("let-env",r,"pair");var i=evaluate(r.car,{env:this,dynamic_scope:n,error:t});return unpromise(i,function(e){if(!(e instanceof Environment)){throw new Error("let-env: First argument need to be "+"environment")}return evaluate(Pair(LSymbol("begin"),r.cdr),{env:e,dynamic_scope:n,error:t})})},"(let-env env . body)\n\n            Special macro that evaluate body in context of given environment\n            object."),letrec:doc(let_macro(Symbol["for"]("letrec")),"(letrec ((a value-a) (b value-b)) body)\n\n             Macro that creates new environment, then evaluate and assign values to\n             names and then evaluate the body in context of that environment.\n             Values are evaluated sequentialy and next value can access to\n             previous values/names."),"let*":doc(let_macro(Symbol["for"]("let*")),"(let* ((a value-a) (b value-b)) body)\n\n             Macro similar to `let` but next argument get environment\n             from previous let variable, so they you can define one variable,\n             and use in next argument."),let:doc(let_macro(Symbol["for"]("let")),"(let ((a value-a) (b value-b)) body)\n\n             Macro that creates new environment, then evaluate and assign values to\n             names and then evaluate the body in context of that environment.\n             Values are evaluated sequentialy but you can't access\n             previous values/names when next are evaluated. You can only get them\n             from body of let expression."),"begin*":doc(pararel("begin*",function(e){return e.pop()}),"(begin* . expr)\n\n             This macro is parallel version of begin. It evaluate each expression and\n             if it's a promise it will evaluate it in parallel and return value\n             of last expression."),begin:doc(new Macro("begin",function(e,r){var t=Object.assign({},r);var i=this.get("list->array")(e);if(t.dynamic_scope){t.dynamic_scope=this}t.env=this;var a;return function r(){if(i.length){var e=i.shift();var n=evaluate(e,t);return unpromise(n,function(e){a=e;return r()})}else{return a}}()}),"(begin . args)\n\n             Macro runs list of expression and return valuate of the list one.\n             It can be used in place where you can only have single exression,\n             like if expression."),ignore:new Macro("ignore",function(e,r){var n=r.dynamic_scope,t=r.error;var i={env:this,error:t};if(n){i.dynamic_scope=this}evaluate(new Pair(new LSymbol("begin"),e),i)},"(ignore expression)\n\n            Macro that will evaluate expression and swallow any promises that may\n            be created. It wil run and ignore any value that may be returned by\n            expression. The code should have side effects and/or when it's promise\n            it should resolve to undefined."),define:doc(Macro.defmacro("define",function(n,e){var t=this;if(n.car instanceof Pair&&n.car.car instanceof LSymbol){var r=new Pair(new LSymbol("define"),new Pair(n.car.car,new Pair(new Pair(new LSymbol("lambda"),new Pair(n.car.cdr,n.cdr)))));return r}else if(e.macro_expand){return}if(e.dynamic_scope){e.dynamic_scope=this}e.env=t;var i=n.cdr.car;var a;if(i instanceof Pair){i=evaluate(i,e);a=true}else if(i instanceof LSymbol){i=t.get(i)}typecheck("define",n.car,"symbol");return unpromise(i,function(e){if(t.__name__===Syntax.__merge_env__){t=t.__parent__}if(a&&(typeof e==="function"&&e.__lambda__||e instanceof Syntax)){e.__name__=n.car.valueOf();if(e.__name__ instanceof LString){e.__name__=e.__name__.valueOf()}}var r;if(n.cdr.cdr instanceof Pair&&LString.isString(n.cdr.cdr.car)){r=n.cdr.cdr.car.valueOf()}t.set(n.car,e,r)})}),"(define name expression)\n             (define (function-name . args) body)\n\n             Macro for defining values. It can be used to define variables,\n             or function. If first argument is list it will create function\n             with name beeing first element of the list. The macro evalute\n             code `(define function (lambda args body))`"),"set-obj!":doc("set-obj!",function(e,r,n){var t=_typeof_1(e);if(isNull(e)||t!=="object"&&t!=="function"){var i=typeErrorMessage("set-obj!",type(e),["object","function"]);throw new Error(i)}e=unbind(e);r=r.valueOf();if(arguments.length===2){delete e[r]}else if(is_prototype(e)&&typeof n==="function"){e[r]=unbind(n);e[r].__prototype__=true}else if(typeof n==="function"||is_native(n)){e[r]=n}else{e[r]=n?n.valueOf():n}},"(set-obj! obj key value)\n\n            Function set property of JavaScript object"),"null-environment":doc("null-environment",function(){return global_env.inherit("null")},"(null-environment)\n\n            Function return new base environment with std lib."),values:doc(function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}return Values(n)},"(values a1 a2 ...)\n\n            If called with more then one elment it will create special\n            Values object that can be used in call-with-values function"),"call-with-values":doc("call-with-values",function(e,r){typecheck("call-with-values",e,"function",1);typecheck("call-with-values",r,"function",2);var n=e();if(n instanceof Values){return r.apply(void 0,toConsumableArray(n.valueOf()))}return r(n)},"(call-with-values producer consumer)\n\n            Calls its producer argument with no values and a continuation that,\n            when passed some values, calls the consumer procedure with those\n            values as arguments."),"current-environment":doc("current-environment",function(){if(this.__name__==="__frame__"){return this.__parent__}return this},"(current-environment)\n\n            Function return current environement."),"parent.frame":doc("parent.frame",function(){return user_env},"(parent.frame)\n\n            Return parent environment if called from inside function.\n            If no parent frame found it return nil."),eval:doc("eval",function(e,n){var t=this;typecheck("eval",e,["symbol","pair","array"]);n=n||this;if(e instanceof LSymbol){return n.get(e)}if(e instanceof Pair){return evaluate(e,{env:n,error:function e(r){t.get("error").call(t,r.message);if(r.code){var n=r.code.map(function(e,r){return"[".concat(r+1,"]: ").concat(e)}).join("\n");t.get("error").call(t,n)}}})}if(e instanceof Array){var i=this.get("eval");return e.reduce(function(e,r){return i(r,n)})}},"(eval list)\n\n            Function evalute LIPS code as list structure."),lambda:new Macro("lambda",function(l){var e=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:{},p=e.dynamic_scope,d=e.error;var m=this;var h;if(l.cdr instanceof Pair&&LString.isString(l.cdr.car)&&l.cdr.cdr!==nil){h=l.cdr.car.valueOf()}function v(){var e;if(p){if(!(this instanceof Environment)){e=m}else{e=this}}else{e=m}e=e.inherit("lambda");var r=l.car;var n=0;var t;if(typeof this!=="undefined"){e.set("this",this)}for(var i=arguments.length,a=new Array(i),o=0;o<i;o++){a[o]=arguments[o]}if(this instanceof Environment){var u={throwError:false};e.set("arguments",this.get("arguments",u));e.set("parent.frame",this.get("parent.frame",u))}else{var c=a.slice();c.callee=v;c.env=e;e.set("arguments",c)}if(r instanceof LSymbol||r!==nil){while(true){if(r.car!==nil){if(r instanceof LSymbol){t=quote(Pair.fromArray(a.slice(n),false));e.__env__[r.__name__]=t;break}else{t=a[n];e.__env__[r.car.__name__]=t}}if(r.cdr===nil){break}n++;r=r.cdr}}if(p){p=e}var s=h?l.cdr.cdr:l.cdr;var f=new Pair(new LSymbol("begin"),s);return evaluate(f,{env:e,dynamic_scope:p,error:d})}var r=l.car instanceof Pair?l.car.length():null;v.__code__=new Pair(new LSymbol("lambda"),l);v.__lambda__=true;if(!(l.car instanceof Pair)){return doc(v,h,true)}return doc(setFnLength(v,r),h,true)},"(lambda (a b) body)\n            (lambda args body)\n            (lambda (a b . rest) body)\n\n            Macro lambda create new anonymous function, if first element of the body\n            is string and there is more elements it will be documentation, that can\n            be read using (help fn)"),macroexpand:new Macro("macroexpand",macro_expand()),"macroexpand-1":new Macro("macroexpand-1",macro_expand(true)),"define-macro":doc(new Macro(macro,function(u,e){var c=e.dynamic_scope,s=e.error;if(u.car instanceof Pair&&u.car.car instanceof LSymbol){var r=u.car.car.__name__;var f;if(LString.isString(u.cdr.car)&&u.cdr.cdr instanceof Pair){f=u.cdr.car.valueOf()}var n=Macro.defmacro(r,function(e){var r=new Environment({},this,"defmacro");var n=u.car.cdr;var t=e;while(true){if(n===nil){break}if(n instanceof LSymbol){r.__env__[n.__name__]=t;break}else if(n.car!==nil){if(t===nil){r.__env__[n.car.__name__]=nil}else{if(t.car instanceof Pair){t.car.data=true}r.__env__[n.car.__name__]=t.car}}if(n.cdr===nil){break}if(t!==nil){t=t.cdr}n=n.cdr}if(c){c=r}var i={env:r,dynamic_scope:c,error:s};if(u.cdr instanceof Pair){var a=f?u.cdr.cdr:u.cdr;var o=a.reduce(function(e,r){return evaluate(r,i)});return unpromise(o,function(e){if(_typeof_1(e)==="object"){delete e.data}return e})}},f,true);n.__code__=new Pair(new LSymbol("define-macro"),u);this.set(r,n)}}),"(define-macro (name . args) body)\n\n             Meta macro, macro that create new macros, if return value is list structure\n             it will be evaluated when macro is invoked. You can use quasiquote ` and\n             unquote , and unquote-splicing ,@ inside to create expression that will be\n             evaluated on runtime. Macros works like this: if you pass any expression to\n             macro the arguments will not be evaluated unless macro itself evaluate it.\n             Because of this macro can manipulate expression (arguments) as lists."),"syntax-rules":new Macro("syntax-rules",function(_,e){var y=e.dynamic_scope,b=e.error;var g=this;function w(e){var r=[];while(e!==nil){var n=e.car;r.push(n.valueOf());e=e.cdr}return r}function r(e){while(e!==nil){var r=e.car;if(!(r instanceof LSymbol)){throw new Error("syntax-rules: wrong identifier")}e=e.cdr}}if(_.car instanceof LSymbol){r(_.cdr.car)}else{r(_.car)}var n=new Syntax(function(e,r){var n=r.macro_expand;var t=g.inherit("syntax");if(y){y=t}var i=this;if(i.__name__===Syntax.__merge_env__){var a=Object.getOwnPropertySymbols(i.__env__);a.forEach(function(e){i.__parent__.set(e,i.__env__[e])});i=i.__parent__}var o={env:t,dynamic_scope:y,error:b};var u,c,s;if(_.car instanceof LSymbol){u=_.car;s=w(_.cdr.car);c=_.cdr.cdr}else{u="...";s=w(_.car);c=_.cdr}while(c!==nil){var f=c.car.car;var l=c.car.cdr.car;var p=extract_patterns(f,e,s,u,{expansion:this,define:g});if(p){if(is_debug()){console.log(JSON.stringify(symbolize(p),true,2));console.log("PATTERN: "+f.toString(true));console.log("MACRO: "+e.toString(true))}var d=[];var m=transform_syntax({bindings:p,expr:l,symbols:s,scope:t,lex_scope:i,names:d,ellipsis:u});if(m){l=m}var h=i.merge(t,Syntax.__merge_env__);if(n){return{expr:l,scope:h}}var v=evaluate(l,_objectSpread(_objectSpread({},o),{},{env:h}));return clear_gensyms(v,d)}c=c.cdr}throw new Error("Invalid Syntax ".concat(e.toString(true)))},g);n.__code__=_;return n},"(syntax-rules () (pattern expression) ...)\n\n            Base of Hygienic macro, it will return new syntax expander\n            that works like lisp macros."),quote:doc(new Macro("quote",function(e){return quote(e.car)}),"(quote expression)\n\n             Macro that return single lips expression as data (it don't evaluate its\n             argument). It will return list of pairs if put in front of lips code.\n             And if put in fron of symbol it will return that symbol not value\n             associated with that name."),"unquote-splicing":doc("unquote-splicing",function(){throw new Error("You can't call `unquote-splicing` outside of quasiquote")},"(unquote-splicing code)\n\n            Special form to be used in quasiquote macro, parser is processing special\n            characters ,@ and create call to this pseudo function. It can be used\n            to evalute expression inside and return the value without parenthesis.\n            the value will be joined to the output list structure."),unquote:doc("unquote",function(){throw new Error("You can't call `unquote` outside of quasiquote")},"(unquote code)\n\n            Special form to be used in quasiquote macro, parser is processing special\n            characters , and create call to this pseudo function. It can be used\n            to evalute expression inside and return the value, the output is inserted\n            into list structure created by queasiquote."),quasiquote:Macro.defmacro("quasiquote",function(e,r){var u=r.dynamic_scope,c=r.error;var s=this;if(u){u=s}function a(e){return e instanceof Pair}function f(e,r){var n=arguments.length>2&&arguments[2]!==undefined$1?arguments[2]:a;if(e instanceof Pair){var t=e.car;var i=e.cdr;if(n(t)){t=r(t)}if(n(i)){i=r(i)}if(isPromise(t)||isPromise(i)){return Promise.all([t,i]).then(function(e){var r=slicedToArray(e,2),n=r[0],t=r[1];return new Pair(n,t)})}else{return new Pair(t,i)}}return e}function o(e,r){if(e instanceof Pair){if(r!==nil){e.append(r)}}else{e=new Pair(e,r)}return e}function l(i,e,r){if(e<r){return new Pair(new Pair(i.car.car,d(i.car.cdr,e,r)),nil)}var t=[];return function e(r){var n=evaluate(r.car,{env:s,dynamic_scope:u,error:c});t.push(n);if(r.cdr instanceof Pair){return e(r.cdr)}return unpromise(t,function(n){if(n.some(function(e){return!(e instanceof Pair)})){if(i.cdr instanceof Pair&&LSymbol.is(i.cdr.car,".")&&i.cdr.cdr instanceof Pair&&i.cdr.cdr.cdr===nil){return i.cdr.cdr.car}if(!(i.cdr===nil||i.cdr instanceof Pair)){var e="You can't splice atom inside list";throw new Error(e)}if(n.length>1){var r="You can't splice multiple atoms inside list";throw new Error(r)}if(!(i.cdr instanceof Pair&&n[0]===nil)){return n[0]}}n=n.map(function(e){if(p.has(e)){return e.clone()}else{p.add(e);return e}});var t=d(i.cdr,0,1);if(t===nil&&n[0]===nil){return undefined$1}return unpromise(t,function(e){if(n[0]===nil){return e}if(n.length===1){return o(n[0],e)}var r=n.reduce(function(e,r){return o(e,r)});return o(r,e)})})}(i.car.cdr)}var p=new Set;function d(e,r,n){if(e instanceof Pair){if(LSymbol.is(e.car.car,"unquote-splicing")){return l(e,r+1,n)}if(LSymbol.is(e.car,"quasiquote")){var t=d(e.cdr,r,n+1);return new Pair(e.car,t)}if(LSymbol.is(e.car.car,"unquote")){if(r+2===n&&e.car.cdr instanceof Pair&&e.car.cdr.car instanceof Pair&&LSymbol.is(e.car.cdr.car.car,"unquote-splicing")){var i=e.car.cdr;return new Pair(new Pair(new LSymbol("unquote"),l(i,r+2,n)),nil)}else if(e.car.cdr instanceof Pair&&e.car.cdr.cdr!==nil){if(e.car.cdr.car instanceof Pair){var a=[];return function r(n){if(n===nil){return Pair.fromArray(a)}return unpromise(evaluate(n.car,{env:s,dynamic_scope:u,error:c}),function(e){a.push(e);return r(n.cdr)})}(e.car.cdr)}else{return e.car.cdr}}}if(LSymbol.is(e.car,"quote")){return new Pair(e.car,d(e.cdr,r,n))}if(LSymbol.is(e.car,"unquote")){r++;if(r<n){return new Pair(new LSymbol("unquote"),d(e.cdr,r,n))}if(r>n){throw new Error("You can't call `unquote` outside "+"of quasiquote")}if(e.cdr instanceof Pair){if(e.cdr.cdr!==nil){if(e.cdr.car instanceof Pair){var o=[];return function r(n){if(n===nil){return Pair.fromArray(o)}return unpromise(evaluate(n.car,{env:s,dynamic_scope:u,error:c}),function(e){o.push(e);return r(n.cdr)})}(e.cdr)}else{return e.cdr}}else{return evaluate(e.cdr.car,{env:s,dynamic_scope:u,error:c})}}else{return e.cdr}}return f(e,function(e){return d(e,r,n)})}return e}function n(e){if(e instanceof Pair){delete e.data;if(!e.haveCycles("car")){n(e.car)}if(!e.haveCycles("cdr")){n(e.cdr)}}}var t=d(e.car,0,1);return unpromise(t,function(e){n(e);return quote(e)})},"(quasiquote list ,value ,@value)\n\n            Similar macro to `quote` but inside it you can use special\n            expressions unquote abbreviated to , that will evaluate expresion inside\n            and return its value or unquote-splicing abbreviated to ,@ that will\n            evaluate expression but return value without parenthesis (it will join)\n            the list with its value. Best used with macros but it can be used outside"),clone:doc(function e(r){typecheck("clone",r,"pair");return r.clone()},"(clone list)\n\n            Function return clone of the list."),append:doc(function e(r,n){typecheck("append",r,["nil","pair"]);if(r instanceof Pair){r=r.clone()}return this.get("append!").call(this,r,n)},"(append list item)\n\n            Function will create new list with value appended to the end. It return\n            New list."),"append!":doc("append!",function(e,r){typecheck("append!",e,["pair","nil"]);if(!this.get("list?")(e)){throw new Error("append!: Invalid argument, value is not a list")}if(isNull(r)){return e}if(e===nil){if(r===nil){return nil}return r}return e.append(r)},"(append! name expression)\n\n             Destructive version of append, it modify the list in place. It return\n             original list."),reverse:doc(function e(r){typecheck("reverse",r,["array","pair","nil"]);if(r===nil){return nil}if(r instanceof Pair){var n=this.get("list->array")(r).reverse();return this.get("array->list")(n)}else if(!(r instanceof Array)){throw new Error(typeErrorMessage("reverse",type(r),"array or pair"))}else{return r.reverse()}},"(reverse list)\n\n            Function will reverse the list or array. If value is not a list\n            or array it will throw exception."),nth:doc(function e(r,n){typecheck("nth",r,"number");typecheck("nth",n,["array","pair"]);if(n instanceof Pair){var t=n;var i=0;while(i<r){if(!t.cdr||t.cdr===nil||t.haveCycles("cdr")){return nil}t=t.cdr;i++}return t.car}else if(n instanceof Array){return n[r]}else{throw new Error(typeErrorMessage("nth",type(n),"array or pair",2))}},"(nth index obj)\n\n            Function return nth element of the list or array. If used with different\n            value it will throw exception"),list:doc(function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}return n.reverse().reduce(function(e,r){return new Pair(r,e)},nil)},"(list . args)\n\n            Function create new list out of its arguments."),substring:doc(function e(r,n,t){typecheck("substring",r,"string");typecheck("substring",n,"number");typecheck("substring",t,["number","undefined"]);return r.substring(n.valueOf(),t&&t.valueOf())},"(substring string start end)\n\n            Function return part of the string starting at start ending with end."),concat:doc(function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}n.forEach(function(e,r){return typecheck("concat",e,"string",r+1)});return n.join("")},"(concat . strings)\n\n            Function create new string by joining its arguments"),join:doc(function e(r,n){typecheck("join",r,"string");typecheck("join",n,"pair");return this.get("list->array")(n).join(r)},"(join separator list)\n\n            Function return string by joining elements of the list"),split:doc(function e(r,n){typecheck("split",r,["regex","string"]);typecheck("split",n,"string");return this.get("array->list")(n.split(r))},"(split separator string)\n\n            Function create list by splitting string by separatar that can\n            be a string or regular expression."),replace:doc(function e(r,n,t){typecheck("replace",r,["regex","string"]);typecheck("replace",n,["string","function"]);typecheck("replace",t,"string");return t.replace(r,n)},"(replace pattern replacement string)\n\n            Function change pattern to replacement inside string. Pattern can be string\n            or regex and replacement can be function or string."),match:doc(function e(r,n){typecheck("match",r,["regex","string"]);typecheck("match",n,"string");var t=n.match(r);return t?this.get("array->list")(t):nil},"(match pattern string)\n\n            function return match object from JavaScript as list."),search:doc(function e(r,n){typecheck("search",r,["regex","string"]);typecheck("search",n,"string");return n.search(r)},"(search pattern string)\n\n            Function return first found index of the pattern inside a string"),repr:doc(function e(r,n){return toString(r,n)},"(repr obj)\n\n            Function return string LIPS representation of an object as string."),env:doc(function e(e){e=e||this;var r=Object.keys(e.__env__);var n;if(r.length){n=Pair.fromArray(r)}else{n=nil}if(e.__parent__!==undefined$1){return this.get("env").call(this,e.__parent__).append(n)}return n},"(env obj)\n\n            Function return list values (functions and variables) inside environment."),new:doc("new",function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),t=1;t<r;t++){n[t-1]=arguments[t]}var i=construct(unbind(e),toConsumableArray(n.map(function(e){return unbox(e)})));Object.defineProperty(i,"__instance__",{enumerable:false,get:function e(){return true},set:function e(){},configurable:false});return i},"(new obj . args)\n\n            Function create new JavaScript instance of an object."),typecheck:doc(typecheck,"(typecheck label value type [position])\n\n             Function check type and throw exception if type don't match.\n             Type can be string or list of strings. Position optional argument\n             is used to created proper error message."),"unset-special!":doc("unset-special!",function(e){typecheck("remove-special!",e,"string");delete specials.remove(e.valueOf())},"(unset-special! name)\n\n            Function remove special symbol from parser. Added by `set-special!`,\n            name must be a string."),"set-special!":doc("set-special!",function(e,r){var n=arguments.length>2&&arguments[2]!==undefined$1?arguments[2]:specials.LITERAL;typecheck("set-special!",e,"string",1);typecheck("set-special!",r,"symbol",2);lips.specials.append(e.valueOf(),r,n)},'(set-special! symbol name [type])\n\n            Add special symbol to the list of transforming operators by the parser.\n            e.g.: `(add-special! "#" \'x)` will allow to use `#(1 2 3)` and it will be\n            transformed into (x (1 2 3)) so you can write x macro that will process\n            the list. 3rd argument is optional and it can be constant value\n            lips.specials.SPLICE if this constant is used it will transform\n            `#(1 2 3)` into (x 1 2 3) that is required by # that define vectors.'),get:get,".":get,unbind:doc(unbind,"(unbind fn)\n\n             Function remove bidning from function so you can get props from it."),type:doc(type,"(type object)\n\n             Function return type of an object as string."),debugger:doc("debugger",function(){debugger},"(debugger)\n\n            Function stop JavaScript code in debugger."),in:doc("in",function(e,r){if(e instanceof LSymbol||e instanceof LString){e=e.valueOf()}return e in r},"(in key value)\n\n            Function use is in operator to check if value is in object."),instanceof:doc("instanceof",function(e,r){return r instanceof unbind(e)},"(instanceof type obj)\n\n            Function check of object is instance of object."),"prototype?":doc("prototype?",is_prototype,"(prototype? obj)\n\n             Function check if value is JavaScript Object prototype."),"macro?":doc("macro?",function(e){return e instanceof Macro},"(macro? expression)\n\n            Function check if value is a macro."),"function?":doc("function?",function(e){return typeof e==="function"},"(function? expression)\n\n            Function check if value is a function."),"real?":doc("real?",function(e){if(type(e)!=="number"){return false}if(e instanceof LNumber){return e.isFloat()}return LNumber.isFloat(e)},"(real? number)\n\n            Function check if value is real number."),"number?":doc("number?",LNumber.isNumber,"(number? expression)\n\n             Function check if value is a number"),"string?":doc("string?",function(e){return LString.isString(e)},"(string? expression)\n\n            Function check if value is a string."),"pair?":doc("pair?",function(e){return e instanceof Pair},"(pair? expression)\n\n            Function check if value is a pair or list structure."),"regex?":doc(function(e){return e instanceof RegExp},"(regex? expression)\n\n            Function check if value is regular expression."),"null?":doc("null?",function(e){return isNull(e)},"(null? expression)\n\n            Function check if value is nulish."),"boolean?":doc("boolean?",function(e){return typeof e==="boolean"},"(boolean? expression)\n\n            Function check if value is boolean."),"symbol?":doc("symbol?",function(e){return e instanceof LSymbol},"(symbol? expression)\n\n            Function check if value is LIPS symbol"),"array?":doc("array?",function(e){return e instanceof Array},"(array? expression)\n\n            Function check if value is an arrray."),"object?":doc("object?",function(e){return e!==nil&&e!==null&&!(e instanceof LCharacter)&&!(e instanceof RegExp)&&!(e instanceof LString)&&!(e instanceof Pair)&&!(e instanceof LNumber)&&_typeof_1(e)==="object"&&!(e instanceof Array)},"(object? expression)\n\n            Function check if value is an plain object."),flatten:doc(function e(r){typecheck("flatten",r,"pair");return r.flatten()},"(flatten list)\n\n            Return shallow list from tree structure (pairs)."),"array->list":doc("array->list",function(e){typecheck("array->list",e,"array");return Pair.fromArray(e)},"(array->list array)\n\n            Function convert JavaScript array to LIPS list."),"tree->array":doc("tree->array",toArray$1("tree->array",true),"(tree->array list)\n\n             Function convert LIPS list structure into JavaScript array."),"list->array":doc("list->array",toArray$1("list->array"),"(list->array list)\n\n             Function convert LIPS list into JavaScript array."),apply:doc(function e(r){for(var n=arguments.length,t=new Array(n>1?n-1:0),i=1;i<n;i++){t[i-1]=arguments[i]}typecheck("apply",r,"function",1);var a=t.pop();typecheck("apply",a,["pair","nil"],t.length+2);t=t.concat(this.get("list->array").call(this,a));return r.apply(this,t)},"(apply fn list)\n\n            Function that call function with list of arguments."),length:doc(function e(r){if(!r){return LNumber(0)}if(r instanceof Pair){return LNumber(r.length())}if("length"in r){return LNumber(r.length)}},"(length expression)\n\n            Function return length of the object, the object can be list\n            or any object that have length property."),"string->number":doc("string->number",function(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:10;typecheck("string->number",e,"string",1);typecheck("string->number",r,"number",2);e=e.valueOf();r=r.valueOf();if(e.match(rational_bare_re)||e.match(rational_re)){return parse_rational(e,r)}else if(e.match(complex_bare_re)||e.match(complex_re)){return parse_complex(e,r)}else{var n=r===10&&!e.match(/e/i)||r===16;if(e.match(int_bare_re)&&n||e.match(int_re)){return parse_integer(e,r)}if(e.match(float_re)){return parse_float(e)}}return false},"(string->number number [radix])\n\n           Function convert string to number."),try:doc(new Macro("try",function(a,e){var o=this;var u=e.dynamic_scope,c=e.error;return new Promise(function(i){var e={env:o,error:function e(r){var n=o.inherit("try");n.set(a.cdr.car.cdr.car.car,r);var t={env:n,error:c};if(u){t.dynamic_scope=o}unpromise(evaluate(new Pair(new LSymbol("begin"),a.cdr.car.cdr.cdr),t),function(e){i(e)})}};if(u){e.dynamic_scope=o}var r=evaluate(a.car,e);if(isPromise(r)){r.then(i)["catch"](e.error)}else{i(r)}})}),"(try expr (catch (e) code)"),throw:doc("throw",function(e){throw new Error(e)},"(throw string)\n\n            Throw new expection."),find:doc(function r(n,t){typecheck("find",n,["regex","function"]);typecheck("find",t,["pair","nil"]);if(isNull(t)){return nil}var e=matcher("find",n);return unpromise(e(t.car),function(e){if(e&&e!==nil){return t.car}return r(n,t.cdr)})},"(find fn list)\n            (find regex list)\n\n            Higher order Function find first value for which function return true.\n            If called with regex it will create matcher function."),"for-each":doc("for-each",function(e){var r;typecheck("for-each",e,"function");for(var n=arguments.length,t=new Array(n>1?n-1:0),i=1;i<n;i++){t[i-1]=arguments[i]}t.forEach(function(e,r){typecheck("for-each",e,["pair","nil"],r+1)});var a=(r=this.get("map")).call.apply(r,[this,e].concat(t));if(isPromise(a)){return a.then(function(){})}},"(for-each fn . lists)\n\n            Higher order function that call function `fn` by for each\n            value of the argument. If you provide more then one list as argument\n            it will take each value from each list and call `fn` function\n            with that many argument as number of list arguments."),map:doc(function e(n){var t=this;for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++){i[a-1]=arguments[a]}typecheck("map",n,"function");var o=this.get("list?");i.forEach(function(e,r){typecheck("map",e,["pair","nil"],r+1);if(e instanceof Pair&&!o.call(t,e)){throw new Error("map: argument ".concat(r+1," is not a list"))}});if(i.length===0){return nil}if(i.some(function(e){return e===nil})){return nil}var u=i.map(function(e){return e.car});var c=this.get("parent.frame");var s=this.newFrame(n,u);s.set("parent.frame",c);return unpromise(n.call.apply(n,[s].concat(toConsumableArray(u))),function(r){return unpromise(e.call.apply(e,[t,n].concat(toConsumableArray(i.map(function(e){return e.cdr})))),function(e){return new Pair(r,e)})})},"(map fn . lists)\n\n            Higher order function that call function `fn` by for each\n            value of the argument. If you provide more then one list as argument\n            it will take each value from each list and call `fn` function\n            with that many argument as number of list arguments. The return\n            values of the function call is acumulated in result list and\n            returned by the call to map."),"list?":doc("list?",function(e){var r=e;while(true){if(r===nil){return true}if(!(r instanceof Pair)){return false}if(r.haveCycles("cdr")){return false}r=r.cdr}},'(list? obj)\n\n            Function test if value is proper linked list structure.\n            The car of each pair can be any value. It return false on cycles."'),some:doc(function r(n,t){typecheck("some",n,"function");typecheck("some",t,["pair","nil"]);if(isNull(t)){return false}else{return unpromise(n(t.car),function(e){return e||r(n,t.cdr)})}},"(some fn list)\n\n            Higher order function that call argument on each element of the list.\n            It stops when function fn return true for a value if so it will\n            return true. If none of the values give true, the function return false"),fold:doc("fold",fold("fold",function(e,r,n){for(var t=arguments.length,i=new Array(t>3?t-3:0),a=3;a<t;a++){i[a-3]=arguments[a]}typecheck("fold",r,"function");i.forEach(function(e,r){typecheck("fold",e,["pair","nil"],r+1)});if(i.some(function(e){return e===nil})){return n}var o=e.call.apply(e,[this,r,n].concat(toConsumableArray(i.map(function(e){return e.cdr}))));return unpromise(o,function(e){return r.apply(void 0,toConsumableArray(i.map(function(e){return e.car})).concat([e]))})}),"(fold fn init . lists)\n\n             Function fold is reverse of the reduce. it call function `fn`\n             on each elements of the list and return single value.\n             e.g. it call (fn a1 b1 (fn a2 b2 (fn a3 b3 '())))\n             for: (fold fn '() alist blist"),pluck:doc(function e(){for(var r=arguments.length,a=new Array(r),n=0;n<r;n++){a[n]=arguments[n]}return function(r){a=a.map(function(e){return e instanceof LSymbol?e.__name__:e});if(a.length===0){return nil}else if(a.length===1){var e=a,n=slicedToArray(e,1),t=n[0];return r[t]}var i={};a.forEach(function(e){i[e]=r[e]});return i}},"(pluck . string)\n\n            If called with single string it will return function that will return\n            key from object. If called with more then one argument function will\n            return new object by taking all properties from given object."),reduce:doc("reduce",fold("reduce",function(r,n,e){var t=this;for(var i=arguments.length,a=new Array(i>3?i-3:0),o=3;o<i;o++){a[o-3]=arguments[o]}typecheck("reduce",n,"function");a.forEach(function(e,r){typecheck("reduce",e,["pair","nil"],r+1)});if(a.some(function(e){return e===nil})){return e}return unpromise(n.apply(void 0,toConsumableArray(a.map(function(e){return e.car})).concat([e])),function(e){return r.call.apply(r,[t,n,e].concat(toConsumableArray(a.map(function(e){return e.cdr}))))})}),"(reduce fn init list . lists)\n\n             Higher order function take each element of the list and call\n             the function with result of previous call or init and next element\n             on the list until each element is processed and return single value\n             as result of last call to `fn` function.\n             e.g. it call (fn a3 b3 (fn a2 b2 (fn a1 b1 init)))\n             for (reduce fn init alist blist"),filter:doc(function e(r,n){typecheck("filter",r,["regex","function"]);typecheck("filter",n,["pair","nil"]);var i=this.get("list->array")(n);var a=[];var o=matcher("filter",r);return function r(n){function e(e){if(e&&e!==nil){a.push(t)}return r(++n)}if(n===i.length){return Pair.fromArray(a)}var t=i[n];return unpromise(o(t),e)}(0)},"(filter fn list)\n            (filter regex list)\n\n            Higher order function that call `fn` for each element of the list\n            and return list for only those elements for which funtion return\n            true value. If called with regex it will create matcher function."),compose:doc(compose,"(compose . fns)\n\n             Higher order function and create new function that apply all functions\n             From right to left and return it's value. Reverse of compose.\n             e.g.:\n             ((compose (curry + 2) (curry * 3)) 3)\n             11\n            "),pipe:doc(pipe,"(pipe . fns)\n\n             Higher order function and create new function that apply all functions\n             From left to right and return it's value. Reverse of compose.\n             e.g.:\n             ((pipe (curry + 2) (curry * 3)) 3)\n             15"),curry:doc(curry,"(curry fn . args)\n\n             Higher order function that create curried version of the function.\n             The result function will have parially applied arguments and it\n             will keep returning functions until all arguments are added\n\n             e.g.:\n             (define (add a b c d) (+ a b c d))\n             (define add1 (curry add 1))\n             (define add12 (add 2))\n             (display (add12 3 4))"),gcd:doc(function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}return n.reduce(function(e,r){return e.gcd(r)})},"(gcd n1 n2 ...)\n\n            Function return the greatest common divisor of their arguments."),lcm:doc(function e(){var r=arguments.length,n=abs(arguments.length<=0?undefined$1:arguments[0]);for(var t=1;t<r;t++){var i=abs(t<0||arguments.length<=t?undefined$1:arguments[t]),a=n;while(n&&i){n>i?n%=i:i%=n}n=abs(a*(t<0||arguments.length<=t?undefined$1:arguments[t]))/(n+i)}return LNumber(n)},"(lcm n1 n2 ...)\n\n            Function return the least common multiple of their arguments."),"odd?":doc("odd?",singleMathOp(function(e){return LNumber(e).isOdd()}),"(odd? number)\n\n             Function check if number os odd."),"even?":doc("even?",singleMathOp(function(e){return LNumber(e).isEven()}),"(even? number)\n\n             Function check if number is even."),"*":doc("*",reduceMathOp(function(e,r){return LNumber(e).mul(r)},LNumber(1)),"(* . numbers)\n\n        Multiplicate all numbers passed as arguments. If single value is passed\n        it will return that value."),"+":doc("+",reduceMathOp(function(e,r){return LNumber(e).add(r)},LNumber(0)),"(+ . numbers)\n\n        Sum all numbers passed as arguments. If single value is passed it will\n        return that value."),"-":doc("-",function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}if(r.length===0){throw new Error("-: procedure require at least one argument")}if(r.length===1){return LNumber(r[0]).sub()}if(r.length){return r.reduce(binaryMathOp(function(e,r){return LNumber(e).sub(r)}))}},"(- n1 n2 ...)\n            (- n1)\n\n            Substract number passed as argument. If only one argument is passed\n            it will negate the value."),"/":doc("/",reduceMathOp(function(e,r){return LNumber(e).div(r)}),"(/ . numbers)\n\n             Divide number passed as arguments one by one. If single argument\n             is passed it will return that value."),abs:doc("abs",singleMathOp(function(e){return LNumber(e).abs()}),"(abs number)\n\n             Function create absolute value from number."),truncate:doc("truncate",function(e){if(LNumber.isFloat(e)){if(e instanceof LNumber){e=e.valueOf()}return LFloat(truncate(e))}return e},"(truncate n)\n\n            Function return integer value from real number."),sqrt:doc("sqrt",singleMathOp(function(e){return LNumber(e).sqrt()}),"(sqrt number)\n\n             Function return square root of the number."),"**":doc("**",binaryMathOp(function(e,r){return LNumber(e).pow(r)}),"(** a b)\n\n            Function calculate number a to to the power of b. It can throw\n            exception when ** native operator is not supported."),"1+":doc("1+",singleMathOp(function(e){return LNumber(e).add(1)}),"(1+ number)\n\n             Function add 1 to the number and return result."),"1-":doc(singleMathOp(function(e){return LNumber(e).sub(1)}),"(1- number)\n\n             Function substract 1 from the number and return result."),"%":doc("%",function(e,r){return LNumber(e).rem(r)},"(% n1 n2)\n\n             Function get reminder of it's arguments."),"==":doc("==",function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}return seq_compare(function(e,r){return LNumber(e).cmp(r)===0},r)},"(== x1 x2 x3 ...)\n\n            Function compare its numerical arguments and check if they are equal"),">":doc(">",function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}return seq_compare(function(e,r){return LNumber(e).cmp(r)===1},r)},"(> x1 x2 x3 ...)\n\n            Function compare its numerical arguments and check if they are\n            monotonically increasing"),"<":doc("<",function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}return seq_compare(function(e,r){return LNumber(e).cmp(r)===-1},r)},"(< x1 x2 x3 ...)\n\n            Function compare its numerical arguments and check if they are\n            monotonically decreasing"),"<=":doc(function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}return seq_compare(function(e,r){return[0,-1].includes(LNumber(e).cmp(r))},r)},"(<= x1 x2 x3 ...)\n\n            Function compare its numerical arguments and check if they are\n            monotonically nonincreasing"),">=":doc(">=",function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}return seq_compare(function(e,r){return[0,1].includes(LNumber(e).cmp(r))},r)},"(>= x1 x2 x3 ...)\n\n            Function compare its numerical arguments and check if they are\n            monotonically nondecreasing"),"eq?":doc("eq?",equal,"(eq? a b)\n\n             Function compare two values if they are identical."),or:doc(new Macro("or",function(e,r){var i=r.dynamic_scope,a=r.error;var o=this.get("list->array")(e);var u=this;if(i){i=u}var c;return function r(){function e(e){c=e;if(c){return c}else{return r()}}var n=o.shift();if(typeof n==="undefined"){if(c){return c}else{return false}}else{var t=evaluate(n,{env:u,dynamic_scope:i,error:a});return unpromise(t,e)}}()}),"(or . expressions)\n\n             Macro execute the values one by one and return the one that is truthy value.\n             If there are no expression that evaluate to true it return false."),and:doc(new Macro("and",function(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:{},i=r.dynamic_scope,a=r.error;var o=this.get("list->array")(e);var u=this;if(i){i=u}if(!o.length){return true}var c;return function r(){function e(e){c=e;if(!c){return false}else{return r()}}var n=o.shift();if(typeof n==="undefined"){if(c){return c}else{return false}}else{var t=evaluate(n,{env:u,dynamic_scope:i,error:a});return unpromise(t,e)}}()}),"(and . expressions)\n\n             Macro evalute each expression in sequence if any value return false it will\n             return false. If each value return true it will return the last value.\n             If it's called without arguments it will return true."),"|":doc("|",function(e,r){return LNumber(e).or(r)},"(& a b)\n\n            Function calculate or bit operation."),"&":doc("&",function(e,r){return LNumber(e).and(r)},"(& a b)\n\n            Function calculate and bit operation."),"~":doc("~",function(e){return LNumber(e).neg()},"(~ number)\n\n            Function negate the value."),">>":doc(">>",function(e,r){return LNumber(e).shr(r)},"(>> a b)\n\n            Function right shit the value a by value b."),"<<":doc(function(e,r){return LNumber(e).shl(r)},"(<< a b)\n\n            Function left shit the value a by value b."),not:doc(function e(r){if(isNull(r)){return true}return!r},"(not object)\n\n            Function return negation of the argument.")},undefined$1,"global");var user_env=global_env.inherit("user-env");global_env.set("**interaction-environment**",user_env);(function(){var e={ceil:"ceiling"};["floor","round","ceil"].forEach(function(r){var n=e[r]?e[r]:r;global_env.set(n,doc(n,function(e){typecheck(n,e,"number");if(e instanceof LNumber){return e[r]()}},"(".concat(n," number)\n\n                Function calculate ").concat(n," of a number.")))})})();function allPossibleCases(e){if(e.length===1){return e[0]}else{var r=[];var n=allPossibleCases(e.slice(1));for(var t=0;t<n.length;t++){for(var i=0;i<e[0].length;i++){r.push(e[0][i]+n[t])}}return r}}function combinations(e,r,n){var t=[];for(var i=r;i<=n;++i){var a=[];for(var o=0;o<i;++o){a.push(e)}t=t.concat(allPossibleCases(a))}return t}combinations(["d","a"],2,5).forEach(function(e){var r=e.split("");var n=r.slice().reverse();var t=r.map(function(e){return"(c".concat(e,"r")}).join(" ")+" arg"+")".repeat(r.length);var i="c"+e+"r";global_env.set(i,doc(i,function(e){return n.reduce(function(e,r){typecheck(i,e,"pair");if(r==="a"){return e.car}else{return e.cdr}},e)},"(".concat(i," arg)\n\n            Function calculate ").concat(t)))});function reversseFind(e,r){var n=e.split(path.sep).filter(Boolean);for(var t=n.length;t--;){var i=path.join.apply(path,["/"].concat(toConsumableArray(n.slice(0,t+1))));if(r(i)){return i}}}function nodeModuleFind(e){return reversseFind(e,function(e){return fs.existsSync(path.join(e,"node_modules"))})}if(typeof global!=="undefined"){var nodeRequire=eval("require");var fs=nodeRequire("fs");var path=nodeRequire("path");global_env.set("global",global);global_env.set("require.resolve",doc("require.resolve",function(e){typecheck("require.resolve",e,"string");var r=e.valueOf();return nodeRequire.resolve(r)},"(require.resolve path)\n\n           Return path relative the current module."));global_env.set("require",doc("require",function(r){typecheck("require",r,"string");r=r.valueOf();var e=process.cwd();var n;try{if(r.match(/^\s*\./)){n=nodeRequire(path.join(e,r))}else{var t=nodeModuleFind(e);if(t){n=nodeRequire(path.join(t,"node_modules",r))}else{n=nodeRequire(r)}}}catch(e){n=nodeRequire(r)}return patchValue(n,global)},"(require module)\n\n            Function to be used inside Node.js to import the module."))}else if(typeof window!=="undefined"){global_env.set("window",window)}function typeErrorMessage(e,r,n){var t=arguments.length>3&&arguments[3]!==undefined$1?arguments[3]:null;var i=e?" in expression `".concat(e,"`"):"";if(t!==null){i+=" (argument ".concat(t,")")}if(n instanceof Array){if(n.length===1){n=n[0]}else{var a=n[n.length-1];n=n.slice(0,-1).join(", ")+" or "+a}}return"Expecting ".concat(n,", got ").concat(r).concat(i)}function typecheck(e,r,n){var t=arguments.length>3&&arguments[3]!==undefined$1?arguments[3]:null;e=e.valueOf();var i=type(r).toLowerCase();var a=false;if(n instanceof Pair){n=n.toArray()}if(n instanceof Array){n=n.map(function(e){return e.valueOf()})}if(n instanceof Array){n=n.map(function(e){return e.valueOf().toLowerCase()});if(n.includes(i)){a=true}}else{n=n.valueOf().toLowerCase()}if(!a&&i!==n){throw new Error(typeErrorMessage(e,i,n,t))}}function self_evaluated(e){var r=_typeof_1(e);return["string","function"].includes(r)||e instanceof LSymbol||e instanceof LNumber||e instanceof LString||e instanceof RegExp}function is_native(e){return e instanceof LNumber||e instanceof LString||e instanceof LCharacter}function type(e){var r={pair:Pair,symbol:LSymbol,character:LCharacter,values:Values,macro:Macro,string:LString,array:Array,"native-symbol":Symbol};if(Number.isNaN(e)){return"NaN "}if(e===nil){return"nil"}if(e===null){return"null"}if(e instanceof Syntax){return"syntax"}for(var n=0,t=Object.entries(r);n<t.length;n++){var i=slicedToArray(t[n],2),a=i[0],o=i[1];if(e instanceof o){return a}}if(e instanceof LNumber){return"number"}if(e instanceof RegExp){return"regex"}if(_typeof_1(e)==="object"){if(e.__instance__){e.__instance__=false;if(e.__instance__){return"instance"}}if(e.constructor){if(e.constructor.__class__){return e.constructor.__class__}if(e.constructor===Object&&typeof e[Symbol.iterator]==="function"){return"iterator"}return e.constructor.name.toLowerCase()}}return _typeof_1(e)}function resolvePromises(e){var r=[];n(e);if(r.length){return a(e)}return e;function n(e){if(isPromise(e)){r.push(e)}else if(e instanceof Pair){if(!e.haveCycles("car")){n(e.car)}if(!e.haveCycles("cdr")){n(e.cdr)}}else if(e instanceof Array){e.forEach(n)}}function t(e){return i.apply(this,arguments)}function i(){i=asyncToGenerator(regenerator.mark(function e(n){var t;return regenerator.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:r.t0=Pair;if(!n.haveCycles("car")){r.next=5;break}r.t1=n.car;r.next=8;break;case 5:r.next=7;return a(n.car);case 7:r.t1=r.sent;case 8:r.t2=r.t1;if(!n.haveCycles("cdr")){r.next=13;break}r.t3=n.cdr;r.next=16;break;case 13:r.next=15;return a(n.cdr);case 15:r.t3=r.sent;case 16:r.t4=r.t3;t=new r.t0(r.t2,r.t4);if(n.data){t.data=true}return r.abrupt("return",t);case 20:case"end":return r.stop()}}},e)}));return i.apply(this,arguments)}function a(e){if(e instanceof Array){return Promise.all(e.map(a))}if(e instanceof Pair&&r.length){return t(e)}return e}}function getFunctionArgs(e,r){var n=r.env,t=r.dynamic_scope,i=r.error;var a=[];var o=e;markCycles(o);while(true){if(o instanceof Pair){var u=evaluate(o.car,{env:n,dynamic_scope:t,error:i});if(t){u=unpromise(u,function(e){if(typeof e==="function"&&isNativeFunction(e)){return e.bind(t)}return e})}a.push(u);if(o.haveCycles("cdr")){break}o=o.cdr}else{break}}return resolvePromises(a)}function evaluateSyntax(e,r,n){var t=e.invoke(r,n);return unpromise(resolvePromises(t),function(e){if(e instanceof Pair){e.markCycles()}return quote(e)})}function evaluateMacro(e,r,n){function t(e){if(e instanceof Pair){e.markCycles();return e}return quote(e)}var i=e.invoke(r,n);return unpromise(resolvePromises(i),function e(r){if(r&&r.data||!r||self_evaluated(r)){return r}else{return unpromise(evaluate(r,n),t)}})}function evaluate(r){var e=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:{},i=e.env,a=e.dynamic_scope,n=e.error,o=n===void 0?function(){}:n;try{if(a===true){i=a=i||global_env}else if(i===true){i=a=global_env}else{i=i||global_env}var t={env:i,dynamic_scope:a,error:o};var u;if(isNull(r)){return r}if(r instanceof LSymbol){return i.get(r)}var c=r.car;var s=r.cdr;if(c instanceof Pair){u=resolvePromises(evaluate(c,t));if(isPromise(u)){return u.then(function(e){return evaluate(new Pair(e,r.cdr),t)})}else if(typeof u!=="function"){throw new Error(type(u)+" "+i.get("repr")(u)+" is not a function while evaluating "+r.toString())}}if(c instanceof LSymbol){u=i.get(c);if(u instanceof Syntax){return evaluateSyntax(u,r,t)}else if(u instanceof Macro){return evaluateMacro(u,s,t)}else if(typeof u!=="function"){if(u){var f="".concat(type(u)," `").concat(u,"' is not a function");throw new Error(f)}throw new Error("Unknown function `".concat(c.toString(),"'"))}}else if(typeof c==="function"){u=c}if(typeof u==="function"){var l=getFunctionArgs(s,t);return unpromise(l,function(e){if(is_bound(u)&&!is_object_bound(u)&&(!lips_context(u)||is_port(u))){e=e.map(unbox)}if(u.__lambda__&&!u.__prototype__||is_port(u)){u=unbind(u)}else if(e.some(lips_function)&&!lips_function(u)&&!is_array_method(u)){e=e.map(function(t){if(lips_function(t)){return function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}return unpromise(t.apply(this,r),unbox)}}return t})}var r=e.slice();var n=(a||i).newFrame(u,r);var t=resolvePromises(u.apply(n,e));return unpromise(t,function(e){if(e instanceof Pair){e.markCycles();return quote(e)}if(Number.isNaN(e)){return e}if(typeof e==="number"){return LNumber(e)}if(typeof e==="string"){return LString(e)}return e},o)})}else if(r instanceof LSymbol){u=i.get(r);if(u==="undefined"){}return u}else if(r instanceof Pair){u=c&&c.toString();throw new Error("".concat(type(c)," ").concat(u," is not a function"))}else{return r}}catch(e){o&&o.call(i,e,r)}}function exec(e,r,n){return _exec.apply(this,arguments)}function _exec(){_exec=asyncToGenerator(regenerator.mark(function e(n,t,i){var a,o,u,c;return regenerator.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:if(i===true){t=i=t||user_env}else if(t===true){t=i=user_env}else{t=t||user_env}r.next=3;return parse(n);case 3:a=r.sent;o=[];case 5:if(a.length){r.next=10;break}return r.abrupt("return",o);case 10:u=a.shift();r.next=13;return evaluate(u,{env:t,dynamic_scope:i,error:function e(r,n){if(n){if(!(r.__code__ instanceof Array)){r.__code__=[]}r.__code__.push(n.toString(true))}throw r}});case 13:c=r.sent;o.push(c);case 15:r.next=5;break;case 17:case"end":return r.stop()}}},e)}));return _exec.apply(this,arguments)}function balanced(e){var r={"[":"]","(":")"};var n;if(typeof e==="string"){n=tokenize(e)}else{n=e.map(function(e){return e&&e.token?e.token:e})}var t=Object.keys(r);var i=Object.values(r).concat(t);n=n.filter(function(e){return i.includes(e)});var a=new Stack;var o=_createForOfIteratorHelper(n),u;try{for(o.s();!(u=o.n()).done;){var c=u.value;if(t.includes(c)){a.push(c)}else if(!a.is_empty()){var s=a.top();var f=r[s];if(c===f){a.pop()}else{throw new Error("Syntax error: missing closing ".concat(f))}}else{throw new Error("Syntax error: not matched closing ".concat(c))}}}catch(e){o.e(e)}finally{o.f()}return a.is_empty()}function fworker(e){var r="("+e.toString()+")()";var n=window.URL||window.webkitURL;var t;try{t=new Blob([r],{type:"application/javascript"})}catch(e){var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;t=new i;t.append(r);t=t.getBlob()}return new root.Worker(n.createObjectURL(t))}function Worker(e){this.url=e;var o=this.worker=fworker(function(){var u;var c;self.addEventListener("message",function(e){var t=e.data;var r=t.id;if(t.type!=="RPC"||r===null){return}function i(e){self.postMessage({id:r,type:"RPC",result:e})}function a(e){self.postMessage({id:r,type:"RPC",error:e})}if(t.method==="eval"){if(!c){a("Worker RPC: LIPS not initilized, call init first");return}c.then(function(){var e=slicedToArray(t.params,2),r=e[0],n=e[1];u.exec(r,n).then(function(e){e=e.map(function(e){return e&&e.valueOf()});i(e)})["catch"](function(e){a(e)})})}else if(t.method==="init"){var n=slicedToArray(t.params,1),o=n[0];if(typeof o!=="string"){a("Worker RPC: url is not a string")}else{importScripts("".concat(o,"/src/lips.js"));u=new lips.Interpreter("worker");c=u.exec('(let-env lips.env.__parent__\n                                                        (load "'.concat(o,'/lib/bootstrap.scm")\n                                                        (load "').concat(o,'/lib/R5RS.scm")\n                                                        (load "').concat(o,'/lib/R7RS.scm"))'));c.then(function(){i(true)})}}})});this.rpc=function(){var t=0;return function e(r,n){var a=++t;return new Promise(function(t,i){o.addEventListener("message",function e(r){var n=r.data;if(n&&n.type==="RPC"&&n.id===a){if(n.error){i(n.error)}else{t(n.result)}o.removeEventListener("message",e)}});o.postMessage({type:"RPC",method:r,id:a,params:n})})}}();this.rpc("init",[e])["catch"](function(e){console.error(e)});this.exec=function(e){var r=arguments.length>1&&arguments[1]!==undefined$1?arguments[1]:false;return this.rpc("eval",[e,r])}}Pair.unDry=function(e){return new Pair(e.car,e.cdr)};Pair.prototype.toDry=function(){return{value:{car:this.car,cdr:this.cdr}}};Nil.prototype.toDry=function(){return{value:null}};Nil.unDry=function(){return nil};LSymbol.prototype.toDry=function(){return{value:{name:this.__name__}}};LSymbol.unDry=function(e){return new LSymbol(e.__name__)};function execError(e){console.error(e.message||e);if(e.code){console.error(e.code.map(function(e,r){return"[".concat(r+1,"]: ").concat(e)}))}}function init(){var o=["text/x-lips","text/x-scheme"];if(!window.document){return Promise.resolve()}else{return new Promise(function(i){var a=Array.from(document.querySelectorAll("script"));return function r(){var e=a.shift();if(!e){i()}else{var n=e.getAttribute("type");if(o.includes(n)){var t=e.getAttribute("src");if(t){return root.fetch(t).then(function(e){return e.text()}).then(exec).then(r)["catch"](function(e){execError(e);r()})}else{return exec(e.innerHTML).then(r)["catch"](function(e){execError(e);r()})}}else if(n&&n.match(/lips|lisp/)){console.warn("Expecting "+o.join(" or ")+" found "+n)}return r()}}()})}}if(typeof window!=="undefined"){contentLoaded(window,init)}var banner=function(){var e=LString("Wed, 11 Nov 2020 11:21:50 +0000").valueOf();var r=e==="{{"+"DATE}}"?new Date:new Date(e);var n=function e(r){return r.toString().padStart(2,"0")};var t=r.getFullYear();var i=[t,n(r.getMonth()+1),n(r.getDate())].join("-");var a="\n  __ __                          __\n / / \\ \\       _    _  ___  ___  \\ \\\n| |   \\ \\     | |  | || . \\/ __>  | |\n| |    > \\    | |_ | ||  _/\\__ \\  | |\n| |   / ^ \\   |___||_||_|  <___/  | |\n \\_\\ /_/ \\_\\                     /_/\n\nLIPS Interpreter DEV (".concat(i,") <https://lips.js.org>\nCopyright (c) 2018-").concat(t," Jakub T. Jankiewicz\n\nType (env) to see environment with functions macros and variables.\nYou can also use (help name) to display help for specic function or macro.\n").replace(/^.*\n/,"");return a}();Ahead.__class__="ahead";Pattern.__class__="pattern";Formatter.__class__="formatter";Macro.__class__="macro";Syntax.__class__="syntax";Environment.__class__="environment";InputPort.__class__="input-port";OutputPort.__class__="output-port";OutputStringPort.__class__="output-string-port";InputStringPort.__class__="input-string-port";LNumber.__class__="number";LCharacter.__class__="character";LString.__class__="string";var lips={version:"DEV",banner:banner,date:"Wed, 11 Nov 2020 11:21:50 +0000",exec:exec,parse:parse,tokenize:tokenize,evaluate:evaluate,Environment:Environment,env:user_env,Worker:Worker,Interpreter:Interpreter,balanced_parenthesis:balanced,balancedParenthesis:balanced,balanced:balanced,Macro:Macro,Syntax:Syntax,Pair:Pair,Values:Values,quote:quote,InputPort:InputPort,OutputPort:OutputPort,InputStringPort:InputStringPort,OutputStringPort:OutputStringPort,Formatter:Formatter,specials:specials,repr:repr,nil:nil,LSymbol:LSymbol,LNumber:LNumber,LFloat:LFloat,LComplex:LComplex,LRational:LRational,LBigInteger:LBigInteger,LCharacter:LCharacter,LString:LString,rationalize:rationalize};global_env.set("lips",lips);return lips})})();