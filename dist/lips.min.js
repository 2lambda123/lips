/**@license
 * LIPS is Pretty Simple - simple scheme like lisp in JavaScript - v. DEV
 *
 * Copyright (c) 2018-2019 Jakub T. Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 * includes unfetch by Jason Miller (@developit) MIT License
 *
 * build: Fri, 12 Apr 2019 21:05:29 +0000
 */
(function(){"use strict";function n(e){if(Array.isArray(e))return e}function t(e,r){var n=[];var t=true;var i=false;var o=undefined;try{for(var a=e[Symbol.iterator](),c;!(t=(c=a.next()).done);t=true){n.push(c.value);if(r&&n.length===r)break}}catch(e){i=true;o=e}finally{try{if(!t&&a["return"]!=null)a["return"]()}finally{if(i)throw o}}return n}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function W(e,r){return n(e)||t(e,r)||i()}function o(e,r){o=Object.setPrototypeOf||function e(r,n){r.__proto__=n;return r};return o(e,r)}function a(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function Z(e,r,n){if(a()){Z=Reflect.construct}else{Z=function e(r,n,t){var i=[null];i.push.apply(i,n);var o=Function.bind.apply(r,i);var a=new o;if(t)setPrototypeOf(a,t.prototype);return a}}return Z.apply(null,arguments)}function e(e,r){return r={exports:{}},e(r,r.exports),r.exports}var r=e(function(e){var r=function(o){var e=Object.prototype;var f=e.hasOwnProperty;var u;var r=typeof Symbol==="function"?Symbol:{};var i=r.iterator||"@@iterator";var n=r.asyncIterator||"@@asyncIterator";var t=r.toStringTag||"@@toStringTag";function a(e,r,n,t){var i=r&&r.prototype instanceof c?r:c;var o=Object.create(i.prototype);var a=new N(t||[]);o._invoke=E(e,n,a);return o}o.wrap=a;function s(e,r,n){try{return{type:"normal",arg:e.call(r,n)}}catch(e){return{type:"throw",arg:e}}}var l="suspendedStart";var h="suspendedYield";var p="executing";var v="completed";var d={};function c(){}function y(){}function m(){}var g={};g[i]=function(){return this};var w=Object.getPrototypeOf;var b=w&&w(w(O([])));if(b&&b!==e&&f.call(b,i)){g=b}var x=m.prototype=c.prototype=Object.create(g);y.prototype=x.constructor=m;m.constructor=y;m[t]=y.displayName="GeneratorFunction";function k(e){["next","throw","return"].forEach(function(r){e[r]=function(e){return this._invoke(r,e)}})}o.isGeneratorFunction=function(e){var r=typeof e==="function"&&e.constructor;return r?r===y||(r.displayName||r.name)==="GeneratorFunction":false};o.mark=function(e){if(Object.setPrototypeOf){Object.setPrototypeOf(e,m)}else{e.__proto__=m;if(!(t in e)){e[t]="GeneratorFunction"}}e.prototype=Object.create(x);return e};o.awrap=function(e){return{__await:e}};function _(c){function u(e,r,n,t){var i=s(c[e],c,r);if(i.type==="throw"){t(i.arg)}else{var o=i.arg;var a=o.value;if(a&&typeof a==="object"&&f.call(a,"__await")){return Promise.resolve(a.__await).then(function(e){u("next",e,n,t)},function(e){u("throw",e,n,t)})}return Promise.resolve(a).then(function(e){o.value=e;n(o)},function(e){return u("throw",e,n,t)})}}var r;function e(n,t){function e(){return new Promise(function(e,r){u(n,t,e,r)})}return r=r?r.then(e,e):e()}this._invoke=e}k(_.prototype);_.prototype[n]=function(){return this};o.AsyncIterator=_;o.async=function(e,r,n,t){var i=new _(a(e,r,n,t));return o.isGeneratorFunction(r)?i:i.next().then(function(e){return e.done?e.value:i.next()})};function E(a,c,u){var f=l;return function e(r,n){if(f===p){throw new Error("Generator is already running")}if(f===v){if(r==="throw"){throw n}return P()}u.method=r;u.arg=n;while(true){var t=u.delegate;if(t){var i=A(t,u);if(i){if(i===d)continue;return i}}if(u.method==="next"){u.sent=u._sent=u.arg}else if(u.method==="throw"){if(f===l){f=v;throw u.arg}u.dispatchException(u.arg)}else if(u.method==="return"){u.abrupt("return",u.arg)}f=p;var o=s(a,c,u);if(o.type==="normal"){f=u.done?v:h;if(o.arg===d){continue}return{value:o.arg,done:u.done}}else if(o.type==="throw"){f=v;u.method="throw";u.arg=o.arg}}}}function A(e,r){var n=e.iterator[r.method];if(n===u){r.delegate=null;if(r.method==="throw"){if(e.iterator["return"]){r.method="return";r.arg=u;A(e,r);if(r.method==="throw"){return d}}r.method="throw";r.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var t=s(n,e.iterator,r.arg);if(t.type==="throw"){r.method="throw";r.arg=t.arg;r.delegate=null;return d}var i=t.arg;if(!i){r.method="throw";r.arg=new TypeError("iterator result is not an object");r.delegate=null;return d}if(i.done){r[e.resultName]=i.value;r.next=e.nextLoc;if(r.method!=="return"){r.method="next";r.arg=u}}else{return i}r.delegate=null;return d}k(x);x[t]="Generator";x[i]=function(){return this};x.toString=function(){return"[object Generator]"};function S(e){var r={tryLoc:e[0]};if(1 in e){r.catchLoc=e[1]}if(2 in e){r.finallyLoc=e[2];r.afterLoc=e[3]}this.tryEntries.push(r)}function j(e){var r=e.completion||{};r.type="normal";delete r.arg;e.completion=r}function N(e){this.tryEntries=[{tryLoc:"root"}];e.forEach(S,this);this.reset(true)}o.keys=function(n){var t=[];for(var e in n){t.push(e)}t.reverse();return function e(){while(t.length){var r=t.pop();if(r in n){e.value=r;e.done=false;return e}}e.done=true;return e}};function O(r){if(r){var e=r[i];if(e){return e.call(r)}if(typeof r.next==="function"){return r}if(!isNaN(r.length)){var n=-1,t=function e(){while(++n<r.length){if(f.call(r,n)){e.value=r[n];e.done=false;return e}}e.value=u;e.done=true;return e};return t.next=t}}return{next:P}}o.values=O;function P(){return{value:u,done:true}}N.prototype={constructor:N,reset:function(e){this.prev=0;this.next=0;this.sent=this._sent=u;this.done=false;this.delegate=null;this.method="next";this.arg=u;this.tryEntries.forEach(j);if(!e){for(var r in this){if(r.charAt(0)==="t"&&f.call(this,r)&&!isNaN(+r.slice(1))){this[r]=u}}}},stop:function(){this.done=true;var e=this.tryEntries[0];var r=e.completion;if(r.type==="throw"){throw r.arg}return this.rval},dispatchException:function(n){if(this.done){throw n}var t=this;function e(e,r){o.type="throw";o.arg=n;t.next=e;if(r){t.method="next";t.arg=u}return!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];var o=i.completion;if(i.tryLoc==="root"){return e("end")}if(i.tryLoc<=this.prev){var a=f.call(i,"catchLoc");var c=f.call(i,"finallyLoc");if(a&&c){if(this.prev<i.catchLoc){return e(i.catchLoc,true)}else if(this.prev<i.finallyLoc){return e(i.finallyLoc)}}else if(a){if(this.prev<i.catchLoc){return e(i.catchLoc,true)}}else if(c){if(this.prev<i.finallyLoc){return e(i.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(e,r){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc<=this.prev&&f.call(t,"finallyLoc")&&this.prev<t.finallyLoc){var i=t;break}}if(i&&(e==="break"||e==="continue")&&i.tryLoc<=r&&r<=i.finallyLoc){i=null}var o=i?i.completion:{};o.type=e;o.arg=r;if(i){this.method="next";this.next=i.finallyLoc;return d}return this.complete(o)},complete:function(e,r){if(e.type==="throw"){throw e.arg}if(e.type==="break"||e.type==="continue"){this.next=e.arg}else if(e.type==="return"){this.rval=this.arg=e.arg;this.method="return";this.next="end"}else if(e.type==="normal"&&r){this.next=r}return d},finish:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.finallyLoc===e){this.complete(n.completion,n.afterLoc);j(n);return d}}},catch:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc===e){var t=n.completion;if(t.type==="throw"){var i=t.arg;j(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){this.delegate={iterator:O(e),resultName:r,nextLoc:n};if(this.method==="next"){this.arg=u}return d}};return o}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}});var ee=r;function u(e,r,n,t,i,o,a){try{var c=e[o](a);var u=c.value}catch(e){n(e);return}if(c.done){r(u)}else{Promise.resolve(u).then(t,i)}}function re(c){return function(){var e=this,a=arguments;return new Promise(function(r,n){var t=c.apply(e,a);function i(e){u(t,r,n,i,o,"next",e)}function o(e){u(t,r,n,i,o,"throw",e)}i(undefined)})}}function c(e){if(Array.isArray(e)){for(var r=0,n=new Array(e.length);r<e.length;r++){n[r]=e[r]}return n}}function f(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function ne(e){return c(e)||f(e)||s()}function l(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){l=function e(r){return typeof r}}else{l=function e(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r}}return l(e)}function te(e){if(typeof Symbol==="function"&&l(Symbol.iterator)==="symbol"){te=function e(r){return l(r)}}else{te=function e(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":l(r)}}return te(e)}
/**@license
 * LIPS is Pretty Simple - simple scheme like lisp in JavaScript
 *
 * Copyright (c) 2018-2019 Jakub T. Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 */
/**@license
 * LIPS is Pretty Simple - simple scheme like lisp in JavaScript
 *
 * Copyright (c) 2018-2019 Jakub T. Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 */
(function(r,n){if(typeof define==="function"&&define.amd){define(["bn.js"],function(e){return r.lips=n(r,e)})}else if((typeof module==="undefined"?"undefined":te(module))==="object"&&module.exports){module.exports=n(r,require("bn.js"))}else{r.lips=n(r,r.BN)}})(typeof window!=="undefined"?window:global,function(o,n,h){if(!o.fetch){o.fetch=function(i,o){o=o||{};return new Promise(function(e,r){var n=new XMLHttpRequest;n.open(o.method||"get",i,true);for(var t in o.headers){n.setRequestHeader(t,o.headers[t])}n.withCredentials=o.credentials=="include";n.onload=function(){e(c())};n.onerror=r;n.send(o.body||null);function c(){var t=[],i=[],o={},a;n.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,r,n){t.push(r=r.toLowerCase());i.push([r,n]);a=o[r];o[r]=a?"".concat(a,",").concat(n):n});return{ok:(n.status/100|0)==2,status:n.status,statusText:n.statusText,url:n.responseURL,clone:c,text:function e(){return Promise.resolve(n.responseText)},json:function e(){return Promise.resolve(n.responseText).then(JSON.parse)},blob:function e(){return Promise.resolve(new Blob([n.response]))},headers:{keys:function e(){return t},entries:function e(){return i},get:function e(r){return o[r.toLowerCase()]},has:function e(r){return r.toLowerCase()in o}}}}})}}var t=/^\/((?:\\\/|[^/]|\[[^\]]*\/[^\]]*\])+)\/([gimy]*)$/;var i=/^[-+]?[0-9]+([eE][-+]?[0-9]+)?$/;var a=/^([-+]?((\.[0-9]+|[0-9]+\.[0-9]+)([eE][-+]?[0-9]+)?)|[0-9]+\.)$/;function d(e){function r(e){if(e.match(/^['"]/)){if(e==='""'||e==="''"){return""}var r=e[0];var n=new RegExp("((^|[^\\\\])(?:\\\\\\\\)*)"+r,"g");e=e.replace(n,"$1")}return JSON.parse('"'+e.replace(/\n/g,"\\n")+'"')}var n=e.match(t);if(n){return new RegExp(n[1],n[2])}else if(e.match(/['"]/)){return r(e)}else if(e.match(i)){return L(parseFloat(e))}else if(e.match(a)){return L(parseFloat(e),true)}else if(e==="nil"){return x}else if(e==="true"){return true}else if(e==="false"){return false}else{return new w(e)}}var f=/("(?:\\[\S\s]|[^"])*"|\/(?! )[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|;.*)/g;var s=/("(?:\\[\S\s]|[^"])*"|\/(?! )[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|\(|\)|'|"(?:\\[\S\s]|[^"])+|\n|(?:\\[\S\s]|[^"])*"|;.*|(?:[-+]?(?:(?:\.[0-9]+|[0-9]+\.[0-9]+)(?:[eE][-+]?[0-9]+)?)|[0-9]+\.)[0-9]|\.|,@|,|`|[^(\s)]+)/gim;function l(e){return e[e.length-1]}function c(e){e=e.replace(/\n\r|\r/g,"\n");var i=0;var o=0;var a=[];var c=[];var u=0;e.split(f).filter(Boolean).forEach(function(e){if(e.match(f)){u=0;if(c.length){var r=l(c);if(r.token.match(/\n/)){var n=r.token.split("\n").pop();u+=n.length}else{u+=r.token.length}u+=r.col}var t={col:u,line:o,token:e,offset:i};a.push(t);c.push(t);i+=e.length;u+=e.length;o+=(e.match("\n")||[]).length;return}e.split(s).filter(Boolean).forEach(function(e){var r={col:u,line:o,token:e,offset:i};u+=e.length;i+=e.length;a.push(r);c.push(r);if(e==="\n"){++o;c=[];u=0}})});return a}function p(e,r){if(r){return c(e)}else{return c(e).map(function(e){return e.token.trim()}).filter(function(e){return e&&!e.match(/^;/)})}}var y={"'":new w("quote"),"`":new w("quasiquote"),",":new w("unquote"),",@":new w("unquote-splicing")};function v(e){var o=[];var a=[];var c=null;var u=Object.keys(y);var r=u.map(function(e){return y[e].name});var f=0;var s=false;var l=[];var h=[];var p=0;function v(){var e=o[o.length-1];if(e instanceof Array&&e[0]instanceof w&&r.includes(e[0].name)&&o.length>1){o.pop();if(o[o.length-1].length===1&&o[o.length-1][0]instanceof w){o[o.length-1].push(e)}else if(o[o.length-1].length===0){o[o.length-1]=e}else if(o[o.length-1]instanceof k){if(o[o.length-1].cdr instanceof k){o[o.length-1]=new k(o[o.length-1],k.fromArray(e))}else{o[o.length-1].cdr=k.fromArray(e)}}else{o[o.length-1].push(e)}}}e.forEach(function(e){var r=o[o.length-1];if(u.indexOf(e)!==-1){p++;c=e;o.push([y[c]]);if(!c){h=[]}h.push(c)}else if(e==="("){s=true;f++;if(c){l.push(h);h=[]}o.push([]);c=null;p=0}else if(e==="."&&!s){o[o.length-1]=k.fromArray(r)}else if(e===")"){f--;if(!o.length){throw new Error("Unbalanced parenthesis 1")}if(o.length===1){a.push(o.pop())}else if(o.length>1){var n=o.pop();r=o[o.length-1];if(r instanceof Array){r.push(n)}else if(r instanceof k){r.append(k.fromArray(n))}if(l.length){h=l.pop();while(h.length){v();h.pop()}}else{v()}}if(f===0&&o.length){a.push(o.pop())}}else{s=false;var t=d(e);if(c){while(p--){o[o.length-1][1]=t;t=o.pop()}p=0;c=false}r=o[o.length-1];if(r instanceof k){var i=r;while(true){if(i.cdr===x){if(t instanceof Array){i.cdr=k.fromArray(t)}else{i.cdr=t}break}else{i=i.cdr}}}else if(!o.length){a.push(t)}else{r.push(t)}}});if(o.length){throw new Error("Unbalanced parenthesis 2")}return a.map(function(e){if(e instanceof Array){return k.fromArray(e)}return e})}function m(e){var r=1;var n=e.length;while(r>0){var t=e[--n];if(!t){return}if(t.token==="("){r--}else if(t.token===")"){r++}}return e.slice(n)}function g(e){if(!e||!e.length){return 0}var r=e.length;if(e[r-1].token==="\n"){return 0}while(--r){if(e[r].token==="\n"){var n=(e[r+1]||{}).token;if(n){return n.length}}}return 0}function u(e){this._code=e.replace(/\r/g,"").replace(/\n\s*/g,"\n ");this._tokens=p(this._code,true)}u.defaults={offset:0,indent:2,specials:["define","lambda","let","define-macro"]};u.prototype._options=function e(r){var n=u.defaults;if(typeof r==="undefined"){return Object.assign({},n)}var t=r&&r.specials||[];return Object.assign({},n,r,{specials:n.specials.concat(t)})};u.prototype.indent=function e(r,n){var t=this._options(n);var i=g(r);var o=t.specials;var a=m(r);if(a){if(a[0].line>0){t.offset=0}if(a.length===1){return t.offset+a[0].col+1}else if(o.indexOf(a[1].token)!==-1){return t.offset+a[0].col+t.indent}else if(a[0].line<a[1].line){return t.offset+a[0].col+1}else if(a.length>3&&a[1].line===a[3].line){if(a[1].token==="("){return t.offset+a[1].col}return t.offset+a[3].col}else if(a[0].line===a[1].line){return t.offset+t.indent+a[0].col}else{var c=a.slice(2);for(var u=0;u<c.length;++u){var f=c[u];if(f.token.trim()){return f.col}}}}return i+t.indent};u.prototype._spaces=function(e){return new Array(e+1).join(" ")};u.prototype.format=function e(r){var n=this._options(r);var t=0;var i=0;for(var o=0;o<this._tokens.length;++o){var a=this._tokens[o];if(a.token==="\n"){var c=this._tokens.slice(0,o);t=this.indent(c,n);i+=t;if(this._tokens[o+1]){this._tokens[o+1].token=this._spaces(t);t--;for(var u=o+2;u<this._tokens.length;++u){this._tokens[u].offset+=i;this._tokens[u].col+=t;if(this._tokens[u].token==="\n"){o=u-1;break}}}}}return this._tokens.map(function(e){return e.token}).join("")};function e(e,r){var n=Object.prototype.toString;var t="[object Array]";var i=[];var o=r&&e||e.slice();var a;if(!e.length){return i}a=o.pop();do{if(n.call(a)===t){o.push.apply(o,a)}else{i.push(a)}}while(o.length&&(a=o.pop())!==h);i.reverse();return i}function r(e){return te(e)==="symbol"||te(e)==="object"&&Object.prototype.toString.call(e)==="[object Symbol]"}function w(e){if(typeof this!=="undefined"&&this.constructor!==w||typeof this==="undefined"){return new w(e)}this.name=e}w.is=function(e,r){return e instanceof w&&typeof r==="string"&&e.name===r};w.prototype.toJSON=w.prototype.toString=function(){if(r(this.name)){return this.name.toString()}return this.name};function b(){}b.prototype.toString=function(){return"nil"};var x=new b;function k(e,r){if(typeof this!=="undefined"&&this.constructor!==k||typeof this==="undefined"){return new k(e,r)}this.car=e;this.cdr=r}function _(){return new k(h,x)}k.prototype.flatten=function(){return k.fromArray(e(this.toArray()))};k.prototype.length=function(){if(A(this)){return 0}var e=0;var r=this;while(true){if(!r||r===x||!(r instanceof k)){break}e++;r=r.cdr}return e};k.prototype.clone=function(){var e=this.cdr;var r=this.car;if(r instanceof k){r=r.clone()}if(e instanceof k){e=this.cdr.clone()}return new k(r,e)};k.prototype.toArray=function(){if(this.isEmptyList()){return[]}var e=[];if(this.car instanceof k){e.push(this.car.toArray())}else{e.push(this.car)}if(this.cdr instanceof k){e=e.concat(this.cdr.toArray())}return e};k.prototype.isEmptyList=function(){return typeof this.car==="undefined"&&this.cdr===x};k.fromArray=function(e){if(e instanceof k){return e}if(e.length&&!(e instanceof Array)){e=ne(e)}if(e.length===0){return _()}else{var r;if(e[0]instanceof Array){r=k.fromArray(e[0])}else{r=e[0]}if(e.length===1){return new k(r,x)}else{return new k(r,k.fromArray(e.slice(1)))}}};k.prototype.toObject=function(){var e=this;var r={};while(true){if(e instanceof k&&e.car instanceof k){var n=e.car;var t=n.car;if(t instanceof w){t=t.name}var i=n.cdr;if(i instanceof k){i=i.toObject()}r[t]=i;e=e.cdr}else{break}}return r};k.fromPairs=function(e){return e.reduce(function(e,r){return new k(new k(new w(r[0]),r[1]),e)},x)};k.fromObject=function(r){var e=Object.keys(r).map(function(e){return[e,r[e]]});return k.fromPairs(e)};k.prototype.reduce=function(e){var r=this;var n=x;while(true){if(r!==x){n=e(n,r.car);r=r.cdr}else{break}}return n};k.prototype.reverse=function(){var e=this;var r=x;while(e!==x){var n=e.cdr;e.cdr=r;r=e;e=n}return r};k.prototype.transform=function(t){function i(e){if(e instanceof k){if(e.replace){delete e.replace;return e}var r=t(e.car);if(r instanceof k){r=i(r)}var n=t(e.cdr);if(n instanceof k){n=i(n)}return new k(r,n)}return e}return i(this)};k.prototype.map=function(e){if(typeof this.car!=="undefined"){return new k(e(this.car),A(this.cdr)?x:this.cdr.map(e))}else{return x}};k.prototype.toString=function(){var e=["("];if(this.car!==h){if(typeof this.car==="function"){e.push("<#function "+(this.car.name||"anonymous")+">")}else if(typeof this.car==="string"){e.push(JSON.stringify(this.car))}else if(this.car instanceof w){e.push(this.car.toString())}else if(typeof this.car!=="undefined"){e.push(this.car)}if(this.cdr instanceof k){e.push(" ");e.push(this.cdr.toString().replace(/^\(|\)$/g,""))}else if(typeof this.cdr!=="undefined"&&this.cdr!==x){if(typeof this.cdr==="string"){e=e.concat([" . ",JSON.stringify(this.cdr)])}else{e=e.concat([" . ",this.cdr])}}}e.push(")");return e.join("")};k.prototype.append=function(e){if(e instanceof Array){return this.append(k.fromArray(e))}var r=this;if(r.car===h){if(e instanceof k){this.car=e.car;this.cdr=e.cdr}else{return e}}else{while(true){if(r instanceof k&&r.cdr!==x){r=r.cdr}else{break}}r.cdr=e}return this};function E(e,r){if(e instanceof L&&r instanceof L){return e.cmp(r)===0}else if(typeof e==="number"||typeof r==="number"){return L(e).cmp(L(r))}else if(e instanceof w&&r instanceof w){return e.name===r.name}else{return e===r}}function A(e){return e instanceof k&&e.isEmptyList()||e===x}function S(e,r){if(typeof this!=="undefined"&&this.constructor!==S||typeof this==="undefined"){return new S(e,r)}this.name=e;this.fn=r}S.defmacro=function(e,r){var n=new S(e,r);n.defmacro=true;return n};S.prototype.invoke=function(e,r,n){var t=r.env,i=r.dynamic_scope,o=r.error;var a={dynamic_scope:i,error:o,macro_expand:n};var c=this.fn.call(t,e,a,this.name);return n?F(c):c};S.prototype.toString=function(){return"#<Macro "+this.name+">"};var j="define-macro";function N(o){return function(){var n=re(ee.mark(function e(n,u){var f,s,t,i;return ee.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:t=function e(){t=re(ee.mark(function e(n){var t,i,o,a,c;return ee.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:if(!(n instanceof k&&n.car instanceof w)){r.next=13;break}r.prev=1;t=f.get(n.car);if(!(t instanceof S&&t.defmacro)){r.next=9;break}r.next=6;return t.invoke(n.cdr,u,true);case 6:i=r.sent;if(!(i instanceof k)){r.next=9;break}return r.abrupt("return",i);case 9:r.next=13;break;case 11:r.prev=11;r.t0=r["catch"](1);case 13:o=n.car;if(!(o instanceof k)){r.next=18;break}r.next=17;return s(o);case 17:o=r.sent;case 18:a=n.cdr;if(!(a instanceof k)){r.next=23;break}r.next=22;return s(a);case 22:a=r.sent;case 23:c=new k(o,a);return r.abrupt("return",c);case 25:case"end":return r.stop()}}},e,null,[[1,11]])}));return t.apply(this,arguments)};s=function e(r){return t.apply(this,arguments)};f=u["env"]=this;i=n;if(!o){r.next=12;break}r.t0=F;r.next=8;return s(n);case 8:r.t1=r.sent.car;return r.abrupt("return",(0,r.t0)(r.t1));case 12:r.next=15;return s(n);case 15:i=r.sent;if(!(n.toString()===i.toString())){r.next=18;break}return r.abrupt("break",21);case 18:n=i;r.next=12;break;case 21:return r.abrupt("return",F(i.car));case 22:case"end":return r.stop()}}},e,this)}));return function(e,r){return n.apply(this,arguments)}}()}function O(e){return typeof e==="undefined"||e===x||e===null}function P(d){var e="let"+(d?"*":"");return S.defmacro(e,function(f,e){var s=e.dynamic_scope,l=e.error,r=e.macro_expand;var h;if(f.car instanceof w){if(!(f.cdr.car instanceof k)){throw new Error("let require list of pairs")}var n=f.cdr.car.map(function(e){return e.car});h=f.cdr.car.map(function(e){return e.cdr.car});return k.fromArray([w("let*"),[[f.car,k(w("lambda"),k(n,f.cdr.cdr))]],k(f.car,h)])}else if(r){return}var p=this;h=this.get("list->array")(f.car);var v=p.inherit("let");return new Promise(function(a){var c=[];var u=0;(function e(){var r=h[u++];function n(e){if(e instanceof Promise){c.push(e);return e.then(n)}else if(typeof e==="undefined"){v.set(r.car,x)}else{v.set(r.car,e)}}if(s){s=d?v:p}if(!r){var t=new k(new w("begin"),f.cdr);C(t,{env:v,dynamic_scope:s,error:l}).then(function(e){a(e)})}else{var i=C(r.cdr.car,{env:d?v:p,dynamic_scope:s,error:l});var o=n(i);if(o instanceof Promise){o.then(function(){Promise.all(c).then(e)})}else{e()}}})()})})}function L(e,r){if(e instanceof L){return e}if(typeof this!=="undefined"&&this.constructor!==L||typeof this==="undefined"){return new L(e,r===true?true:h)}if(!L.isNumber(e)){throw new Error("You can't create LNumber from "+te(e))}if(e===null){e=0}if(L.isFloat(e)){this.value=e}else if(r){this.value=e;this.float=true}else if(typeof BigInt!=="undefined"){if(typeof e!=="bigint"){this.value=BigInt(e)}else{this.value=e}}else if(typeof n!=="undefined"&&!(e instanceof n)){this.value=new n(e)}else{this.value=e}}L.isFloat=function e(r){return Number(r)===r&&r%1!==0};L.isNumber=function(e){return e instanceof L||L.isNative(e)||L.isBN(e)};L.isNative=function(e){return typeof e==="bigint"||typeof e==="number"};L.isBN=function(e){return typeof n!=="undefined"&&e instanceof n};L.prototype.toString=L.prototype.toJSON=function(){return this.value.toString()};L.prototype.isBigNumber=function(){return typeof this.value==="bigint"||typeof n!=="undefined"&&!(this.value instanceof n)};["floor","ceil","round"].forEach(function(e){L.prototype[e]=function(){if(this.float||L.isFloat(this.value)){return L(Math[e](this.value))}else{return L(this.value)}}});L.prototype.valueOf=function(){if(L.isNative(this.value)){return Number(this.value)}else if(L.isBN(this.value)){return this.value.toNumber()}};L.prototype.coerce=function(e){if(e===null){e=0}var r;if(e instanceof L){r=e.value}else{r=e}if(L.isFloat(r)){}else if(typeof this.value==="bigint"&&typeof r!=="bigint"){r=BigInt(r)}else if(typeof n!=="undefined"&&this.value instanceof n&&!r instanceof n){r=new n(r)}return L(r)};L.prototype.op=function(e,r){var n={"*":function e(r,n){return r*n},"+":function e(r,n){return r+n},"-":function e(r,n){return r-n},"/":function e(r,n){return r/n},"%":function e(r,n){return r%n},"|":function e(r,n){return r|n},"&":function e(r,n){return r&n},"~":function e(r){return~r},">>":function e(r,n){return r>>n},"<<":function e(r,n){return r<<n}};if(L.isFloat(r)||r instanceof L&&(L.isFloat(r.value)||r.float)||L.isFloat(this.value)||this.float){var t=r instanceof L?r.valueOf():r;return L(n[e](this.valueOf(),t),true)}r=this.coerce(r);if(L.isNative(r.value)&&L.isNative(this.value)){return L(n[e](this.value,r.value))}if(L.isBN(this.value)&&L.isBN(r.value)){var i={"+":"iadd","-":"isub","*":"imul","/":"idiv","%":"imod","|":"ior","&":"iand","~":"inot","<<":"ishrn",">>":"ishln"};e=i[e];return this.value.clone()[e](r,t)}};var q={"+":"add","-":"sub","*":"mul","/":"div","%":"mod","|":"or","&":"and","~":"neg","<<":"shl",">>":"shr"};Object.keys(q).forEach(function(r){L.prototype[q[r]]=function(e){return this.op(r,e)}});L.prototype.sqrt=function(){var e;if(L.isNative(this.value)){e=Math.sqrt(this.value)}else if(L.isBN(this.value)){e=this.value.sqrt()}return new L(e)};L.prototype.pow=function(e){e=this.coerce(e);if(L.isNative(this.value)){try{var r=new Function("a,b","return a**b;");e.value=r(this.value,e.value)}catch(e){throw new Error("Power operator not supported")}}else if(L.isBN(this.value)){e.value=this.value.pow(e.value)}else{e.value=Math.pow(this.value,e.value)}return e};L.prototype.neg=function(){var e=this.value;if(L.isNative(e)){e=-e}else if(L.isBN(e)){e=e.neg()}return new L(e)};L.prototype.abs=function(){var e=this.value;if(L.isNative(this.value)){if(e<0){e=-e}}else if(L.isBN(e)){e.iabs()}return new L(e)};L.prototype.isOdd=function(){if(L.isNative(this.value)){return this.value%2===1}else if(L.isBN(this.value)){return this.value.isOdd()}};L.prototype.isEven=function(){return!this.isOdd()};L.prototype.cmp=function(e){e=this.coerce(e);if(L.isNative(this.value)){if(this.value<e.value){return-1}else if(this.value===e.value){return 0}else{return 1}}else if(L.isBN(this.value)){return this.value.cmp(e.value)}};function B(e,r,n){this.env=e;this.parent=r;this.name=n}B.prototype.inherit=function(e){var r=arguments.length>1&&arguments[1]!==h?arguments[1]:{};if(te(e)==="object"){r=e}if(!e||te(e)==="object"){e="child of "+(this.name||"unknown")}return new B(r||{},this,e)};B.prototype.get=function(e){var r;var n=false;if(e instanceof w){if(e.name in this.env){r=this.env[e.name];n=true}}else if(typeof e==="string"){if(typeof this.env[e]!=="undefined"){r=this.env[e];n=true}}if(n){if(L.isNumber(r)){return L(r)}return r}if(this.parent instanceof B){return this.parent.get(e)}else{var t;if(e instanceof w){t=e.name}else if(typeof e==="string"){t=e}if(t){var i=te(o[t]);if(i==="function"){return o[t].bind(o)}else if(i!=="undefined"){return o[t]}}}t=(t.name||t).toString();throw new Error("Unbound variable `"+t+"'")};B.prototype.set=function(e,r){if(L.isNumber(r)){r=L(r)}if(e instanceof w){e=e.name}this.env[e]=r};B.prototype.has=function(e){return typeof this.env[e]!=="undefined"};B.prototype.ref=function(e){var r=this;while(true){if(!r){break}if(r.has(e)){return r}r=r.parent}};function F(e){if(e instanceof Promise){return e.then(F)}if(e instanceof k||e instanceof w){e.data=true}return e}function R(e,r){this.value=e;this.count=r}R.prototype.toString=function(){return"<#unquote["+this.count+"] "+this.value+">"};var T=function(){var r=0;return function(){var e=arguments.length>0&&arguments[0]!==h?arguments[0]:null;if(e!==null){return new w(o.Symbol("#"+e))}r++;return new w(o.Symbol("#"+r))}}();var I=new B({nil:x,true:true,false:false,stdout:{write:function e(){var r;(r=console).log.apply(r,arguments)}},stdin:{read:function e(){return new Promise(function(e){e(prompt(""))})}},test:function e(){return Promise.resolve(h)},cons:function e(r,n){if(A(n)){n=x}return new k(r,n)},car:function e(r){if(r instanceof k){return r.car}else{throw new Error("argument to car need to be a list")}},cdr:function e(r){if(r instanceof k){return r.cdr}else{throw new Error("argument to cdr need to be a list")}},"set!":new S("set!",function(r){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},n=e.dynamic_scope,t=e.error;if(n){n=this}var i=C(r.cdr.car,{env:this,dynamic_scope:n,error:t});i=$(i);var o;if(r.car instanceof k&&w.is(r.car.car,".")){var a=r.car.cdr.car;var c=r.car.cdr.cdr.car;var u=C(a,{env:this,dynamic_scope:n,error:t});var f=C(c,{env:this,dynamic_scope:n,error:t});if(i instanceof Promise){return i.then(function(e){u[f]=e})}else{u[f]=i;return i}}if(!(r.car instanceof w)){throw new Error("set! first argument need to be a symbol")}o=this.ref(r.car.name);if(!o){o=this}if(i instanceof Promise){return i.then(function(e){return o.set(r.car,e)})}else{o.set(r.car,i)}}),"set-car!":function e(r,n){r.car=n},"set-cdr!":function e(r,n){r.cdr=n},"empty?":function e(r){return typeof r==="undefined"||A(r)},assoc:function e(r,n){if(r instanceof k&&!(n instanceof k)){throw new Error("First argument to assoc new to a key")}var t=n;while(true){if(!(t instanceof k)||this.get("empty?")(t)){break}var i=t.car.car;if(E(i,r)){return t.car}else{t=t.cdr}}return x},gensym:T,load:function e(r){var n=this;o.fetch(r).then(function(e){return e.text()}).then(function(e){n.get("eval")(n.get("read")(e))})},while:new S("while",function(){var n=re(ee.mark(function e(n,t){var i,o,a,c,u,f;return ee.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=t.dynamic_scope,o=t.error;a=this;c=new k(new w("begin"),n.cdr);if(i){i=a}case 4:r.next=7;return C(n.car,{env:a,dynamic_scope:i,error:o});case 7:f=r.sent;if(!(f&&!A(f))){r.next=14;break}r.next=11;return C(c,{env:a,dynamic_scope:i,error:o});case 11:u=r.sent;r.next=15;break;case 14:return r.abrupt("return",u);case 15:r.next=4;break;case 17:case"end":return r.stop()}}},e,this)}));return function(e,r){return n.apply(this,arguments)}}()),if:new S("if",function(i,e){var o=e.dynamic_scope,a=e.error;if(o){o=this}var c=this;var r=function e(r){if(typeof r!=="boolean"){throw new Error("if: value need to be boolean")}if(r){var n=C(i.cdr.car,{env:c,dynamic_scope:o,error:a});if(typeof n==="undefined"){return}return n}else{var t=C(i.cdr.cdr.car,{env:c,dynamic_scope:o,error:a});if(typeof t==="undefined"){return false}return t}};var n=C(i.car,{env:c,dynamic_scope:o,error:a});if(n instanceof Promise){return n.then(r)}else{return r(n)}}),"let*":P(true),let:P(false),begin:new S("begin",function(){var n=re(ee.mark(function e(n,t){var i,o,a,c;return ee.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=t.dynamic_scope,o=t.error;a=this.get("list->array")(n);if(i){i=this}case 3:if(!a.length){r.next=11;break}n=a.shift();r.next=8;return C(n,{env:this,dynamic_scope:i,error:o});case 8:c=r.sent;r.next=12;break;case 11:return r.abrupt("return",c);case 12:r.next=3;break;case 14:case"end":return r.stop()}}},e,this)}));return function(e,r){return n.apply(this,arguments)}}()),timer:new S("timer",function(r){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},n=e.dynamic_scope,t=e.error;var i=this;if(n){n=this}return new Promise(function(e){setTimeout(function(){e(C(r.cdr,{env:i,dynamic_scope:n,error:t}))},r.car)})}),define:S.defmacro("define",function(r,e){var n=this;if(r.car instanceof k&&r.car.car instanceof w){var t=new k(new w("define"),new k(r.car.car,new k(new k(new w("lambda"),new k(r.car.cdr,r.cdr)))));return t}else if(e.macro_expand){return}if(e.dynamic_scope){e.dynamic_scope=this}e.env=n;var i=r.cdr.car;if(i instanceof k){i=C(i,e)}else if(i instanceof w){i=n.get(i)}if(r.car instanceof w){if(i instanceof Promise){return i.then(function(e){n.set(r.car,e)})}else{n.set(r.car,i)}}}),"set-obj":function e(r,n,t){r[n]=t},eval:function e(r){var n=this;if(r instanceof k){return C(r,{env:this,dynamic_scope:this,error:function e(r){return n.get("print")(r.message)}})}if(r instanceof Array){var t;r.forEach(function(e){t=C(e,{env:n,dynamic_scope:n,error:function e(r){return n.get("print")(r.message)}})});return t}},lambda:new S("lambda",function(u){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},f=e.dynamic_scope,s=e.error;var l=this;function r(){var e=(f?this:l).inherit("lambda");var r=u.car;var n=0;var t;if(r instanceof w||!A(r)){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++){o[a]=arguments[a]}while(true){if(r.car!==x){if(r instanceof w){t=k.fromArray(o.slice(n));e.env[r.name]=t;break}else{if(typeof o[n]==="undefined"){t=x}else{t=o[n]}e.env[r.car.name]=t}}if(r.cdr===x){break}n++;r=r.cdr}}if(f){f=e}var c=new k(new w("begin"),u.cdr);return C(c,{env:e,dynamic_scope:f,error:s})}var n=u.car instanceof k?u.car.length():null;if(!(u.car instanceof k)){return r}var t=new Array(n).fill(0).map(function(e,r){return"a"+r}).join(",");var i=new Function("f","return function(".concat(t,") {\n                return f.apply(this, arguments);\n            };"));return i(r)}),macroexpand:new S("macro-expand",N()),"macroexpand-1":new S("macro-expand",N(true)),"define-macro":new S(j,function(c,e){var u=e.dynamic_scope,f=e.error;function s(e){if(e instanceof k){delete e.data}return e}if(c.car instanceof k&&c.car.car instanceof w){var r=c.car.car.name;this.env[r]=S.defmacro(r,function(e,r){var n=r.macro_expand;var t=new B({},this,"defmacro");var i=c.car.cdr;var o=e;while(true){if(i instanceof w){t.env[i.name]=o;break}else if(i.car!==x&&o.car!==x){t.env[i.car.name]=o.car}if(i.cdr===x){break}o=o.cdr;i=i.cdr}if(u){u=t}if(c.cdr instanceof k){var a=c.cdr.reduce(function(e,r){return C(r,{env:t,dynamic_scope:u,error:f})});if(n){return a}a=C(a,{env:t,dynamic_scope:u,error:f});if(a instanceof Promise){return a.then(s)}return s(a)}})}}),quote:new S("quote",function(e){return F(e.car)}),quasiquote:new S("quasiquote",function(e,r){var u=r.dynamic_scope,f=r.error;var s=this;var l=0;if(u){u=s}function h(e){if(e instanceof k){var r;if(w.is(e.car.car,"unquote-splicing")){r=C(e.car.cdr.car,{env:s,dynamic_scope:u,error:f});if(!r instanceof k){throw new Error("Value of unquote-splicing need"+" to be pair")}if(e.cdr instanceof k){if(r instanceof k){r.cdr.append(h(e.cdr))}else{r=new k(r,h(e.cdr))}}return r}if(w.is(e.car,"unquote")){var n=e.cdr;var t=n;var i=t;var o=1;while(w.is(t.car.car,"unquote")){i=t;o++;t=t.car.cdr.car}if(o>l){l=o}if(i===t){if(e.cdr.cdr!==x){return new k(new R(e.cdr.car,o),h(e.cdr.cdr))}else{return new R(e.cdr.car,o)}}else if(i.cdr.cdr!==x){i.car.cdr=new k(new R(t,o),i.cdr===x?x:h(i.cdr.cdr))}else{i.car.cdr=new R(t,o)}return n.car}var a=e.car;var c=e.cdr;if(a instanceof k){a=h(a)}if(c instanceof k){c=h(c)}return new k(a,c)}return e}function t(e){if(e instanceof R){if(l===e.count){return C(e.value,{env:s,dynamic_scope:u,error:f})}else{return new k(new w("unquote"),new k(t(e.value),x))}}if(e instanceof k){var r=e.car;if(r instanceof k||r instanceof R){r=t(r)}var n=e.cdr;if(n instanceof k||n instanceof R){n=t(n)}return new k(r,n)}return e}return F(t(h(e.car)))}),clone:function e(r){return r.clone()},append:function e(r,n){return r.clone().append([n])},reverse:function e(r){if(r instanceof k){var n=this.get("list->array")(r).reverse();return this.get("array->list")(n)}else if(!(r instanceof Array)){throw new Error("Invlid value for reverse")}else{return r.reverse()}},nth:function e(r,n){if(n instanceof k){var t=n;var i=0;while(i<r){if(!t.cdr||t.cdr===x){return x}t=t.cdr;i++}return t.car}else if(n instanceof Array){return n[r]}else{throw new Error("Invalid object for nth")}},"append!":new S("append!",function(e,r){var n=r.dynamic_scope,t=r.error;if(n){n=this}var i=C(e.cdr.car,{env:this,dynamic_scope:n,error:t});return this.get(e.car).append([i])}),list:function e(){return k.fromArray([].slice.call(arguments))},concat:function e(){return[].join.call(arguments,"")},join:function e(r,n){return this.get("list->array")(n).join(r)},split:function e(r,n){return this.get("array->list")(r.split(n))},replace:function e(r,n,t){return r.replace(n,t)},match:function e(r,n){return this.get("array->list")(r.match(n))},search:function e(r,n){return r.search(n)},string:function r(e,n){if(typeof jQuery!=="undefined"&&e instanceof jQuery.fn.init){return"<#jQuery("+e.length+")>"}if(e instanceof L){return e.value.toString()}if(typeof e==="undefined"){return"<#undefined>"}if(typeof e==="function"){if(e.toString().match(/\{\s*\[native code\]\s*\}/)){return"<#function(native)>"}return"<#function>"}if(e===x){return"nil"}if(e instanceof Array){return"["+e.map(function(e){return r(e,true)}).join(", ")+"]"}if(e===null||typeof e==="string"&&n){return JSON.stringify(e)}if(e instanceof k||e instanceof w){return e.toString()}if(te(e)==="object"){var t=e.constructor.name;if(t!==""){return"<#"+t+">"}return"<#Object>"}if(typeof e!=="string"){return e.toString()}return e},env:function e(r){r=r||this;var n=Object.keys(r.env);var t;if(n.length){t=k.fromArray(n)}else{t=x}if(r.parent!==h){return this.get("env").call(this,r.parent).append(t)}return t},new:function e(r){for(var n=arguments.length,t=new Array(n>1?n-1:0),i=1;i<n;i++){t[i-1]=arguments[i]}return Z(r,t)},".":function e(r,n){var t=n instanceof w?n.name:n;var i=r[t];if(typeof i==="function"){return i.bind(r)}return i},type:function e(r){var n={pair:k,symbol:w};var t=Object.entries(n);for(var i=0;i<t.length;i++){var o=W(t[i],2),a=o[0],c=o[1];if(r instanceof c){return a}}if(r instanceof L){if(r.isBigNumber()){return"bigint"}return"number"}return te(r)},instanceof:function e(r,n){return r instanceof n},"number?":L.isNumber,"string?":function e(r){return typeof r==="string"},"pair?":function e(r){return r instanceof k},"regex?":function e(r){return r instanceof RegExp},"null?":function e(r){return O(r)||r instanceof k&&r.isEmptyList()},"boolean?":function e(r){return typeof r==="boolean"},"symbol?":function e(r){return r instanceof w},"array?":function e(r){return r instanceof Array},"object?":function e(r){return r!==null&&te(r)==="object"&&!(r instanceof Array)},read:function r(e){var n=this;if(typeof e==="string"){e=v(p(e));if(e.length){return e[e.length-1]}return _()}return this.get("stdin").read().then(function(e){return r.call(n,e)})},print:function e(){var r,n=this;for(var t=arguments.length,i=new Array(t),o=0;o<t;o++){i[o]=arguments[o]}(r=this.get("stdout")).write.apply(r,ne(i.map(function(e){return n.get("string")(e)})))},flatten:function e(r){return r.flatten()},"array->list":function e(r){return k.fromArray(r)},"list->array":function e(r){if(r instanceof k&&r.isEmptyList()){return[]}var n=[];var t=r;while(true){if(t instanceof k){n.push(t.car);t=t.cdr}else{break}}return n},apply:new S("apply",function(t){var i=this;var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},o=e.dynamic_scope,a=e.error;if(o){o=this}function c(e){if(typeof e!=="function"){var r;if(t.car instanceof w){r="Variable `"+t.car.name+"' is not a function"}else{r="Expression `"+t.car.toString()+"' is not a function"}throw new Error(r)}}var r=function e(r){c(r);var n=C(t.cdr.car,{env:i,dynamic_scope:o,error:a});n=i.get("list->array")(n);if(n.filter(function(e){return e instanceof Promise}).length){return Promise.all(n).then(function(e){return r.apply(i,e)})}else{return r.apply(i,n)}};var n=C(t.car,{env:this,dynamic_scope:o,error:a});if(n instanceof Promise){return n.then(r)}else{return r(n)}}),length:function e(r){if(!r){return L(0)}if(r instanceof k){return L(r.length())}if("length"in r){return L(r.length)}},find:function(){var n=re(ee.mark(function e(n,t){var i,o;return ee.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=this.get("list->array")(t);o=0;case 2:if(!(o<i.length)){r.next=10;break}r.next=5;return n(i[o],o);case 5:if(!r.sent){r.next=7;break}return r.abrupt("return",i[o]);case 7:++o;r.next=2;break;case 10:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),"for-each":function(){var n=re(ee.mark(function e(n,t){var i,o,a;return ee.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=this.get("list->array")(t);o=0;case 2:if(!(o<i.length)){r.next=8;break}a=i[o++];r.next=6;return n(a,o);case 6:r.next=2;break;case 8:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),map:function(){var n=re(ee.mark(function e(n,t){var i,o,a,c;return ee.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=this.get("list->array")(t);o=[];a=0;case 3:if(!(a<i.length)){r.next=12;break}c=i[a++];r.t0=o;r.next=8;return n(c,a);case 8:r.t1=r.sent;r.t0.push.call(r.t0,r.t1);r.next=3;break;case 12:return r.abrupt("return",k.fromArray(o));case 13:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),reduce:function(){var n=re(ee.mark(function e(n,t){var i,o,a,c,u,f=arguments;return ee.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=f.length>2&&f[2]!==h?f[2]:null;o=this.get("list->array")(t);if(!(t.length===0)){r.next=4;break}return r.abrupt("return",x);case 4:a=i;if(i===null){a=o.unshift()}c=0;case 7:if(!(c<o.length)){r.next=14;break}u=o[c++];r.next=11;return n(a,u);case 11:a=r.sent;r.next=7;break;case 14:if(!(typeof a==="number")){r.next=16;break}return r.abrupt("return",L(a));case 16:return r.abrupt("return",a);case 17:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),filter:function(){var n=re(ee.mark(function e(n,t){var i,o,a,c,u;return ee.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=this.get("list->array")(t);o=[];a=0;case 3:if(!(a<i.length)){r.next=11;break}c=i[a++];r.next=7;return n(c,a);case 7:u=r.sent;if(u){o.push(c)}r.next=3;break;case 11:return r.abrupt("return",k.fromArray(o,true));case 12:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),range:function e(r){if(r instanceof L){r=r.valueOf()}return k.fromArray(new Array(r).fill(0).map(function(e,r){return L(r)}))},curry:function e(o){for(var r=arguments.length,n=new Array(r>1?r-1:0),t=1;t<r;t++){n[t-1]=arguments[t]}var a=o.length;return function(){var t=n.slice();function i(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}t=t.concat(r);if(t.length>=a){return o.apply(this,t)}else{return i}}return i.apply(this,arguments)}},odd:function e(r){return L(r).isOdd()},even:function e(r){return L(r).isEvent()},"*":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){return L(e).mul(r)})}},"+":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){if(L.isNumber(e)&&L.isNumber(r)){return L(e).add(r)}else if(typeof e==="string"){throw new Error("To concatenate strings use `concat`")}return e+r})}},"-":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length===1){return L(n[0]).neg()}if(n.length){return n.reduce(function(e,r){return L(e).sub(r)})}},"/":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){return L(e).div(r)})}},abs:function e(r){return L(r).abs()},sqrt:function e(r){if(r instanceof L){return Math.sqrt(r.valueOf())}return Math.sqrt(r)},"**":function e(r,n){return L(r).pow(n)},"1+":function e(r){return L(r).add(1)},"1-":function e(r){return L(r).sub(1)},"++":new S("++",function(e){var r=this.get(e.car);var n=L(r).add(1);this.set(e.car,n);return n}),"--":new S("--",function(e){var r=this.get(e.car);var n=L(r).sub(1);this.set(e.car,n);return n}),"%":function e(r,n){return L(r).mod(n)},"==":function e(r,n){return L(r).cmp(n)===0},">":function e(r,n){return L(r).cmp(n)===1},"<":function e(r,n){return L(r).cmp(n)===-1},"<=":function e(r,n){return[0,-1].includes(L(r).cmp(n))},">=":function e(r,n){return[0,1].includes(L(r).cmp(n))},"eq?":E,or:new S("or",function(e,r){var a=r.dynamic_scope,c=r.error;var u=this.get("list->array")(e);var f=this;if(a){a=f}return new Promise(function(i){var o;(function r(){function e(e){o=e;if(o){i(e)}r()}var n=u.shift();if(typeof n==="undefined"){if(o){i(o)}else{i(false)}}else{var t=C(n,{env:f,dynamic_scope:a,error:c});if(t instanceof Promise){t.then(e)}else{e(t)}}})()})}),and:new S("and",function(e){var r=arguments.length>1&&arguments[1]!==h?arguments[1]:{},a=r.dynamic_scope,c=r.error;var u=this.get("list->array")(e);var f=this;if(a){a=f}return new Promise(function(i){var o;(function r(){function e(e){o=e;if(!o){i(false)}r()}var n=u.shift();if(typeof n==="undefined"){if(o){i(o)}else{i(false)}}else{var t=C(n,{env:f,dynamic_scope:a,error:c});if(t instanceof Promise){t.then(e)}else{e(t)}}})()})}),"|":function e(r,n){return L(r).or(n)},"&":function e(r,n){return L(r).and(n)},"~":function e(r){return L(r).neg()},">>":function e(r,n){return L(r).shr(n)},"<<":function e(r,n){return L(r).shl(n)},not:function e(r){if(A(r)){return true}return!r},"->":function e(r,n){for(var t=arguments.length,i=new Array(t>2?t-2:0),o=2;o<t;o++){i[o-2]=arguments[o]}return r[n].apply(r,i)}},h,"global");["floor","round","ceil"].forEach(function(r){I.set(r,function(e){if(e instanceof L){return e[r]()}throw new Error("".concat(te(e)," ").concat(e.toString()," is not a number"))})});function D(e){if(e.length===1){return e[0]}else{var r=[];var n=D(e.slice(1));for(var t=0;t<n.length;t++){for(var i=0;i<e[0].length;i++){r.push(e[0][i]+n[t])}}return r}}function M(e,r,n){var t=[];for(var i=r;i<=n;++i){var o=[];for(var a=0;a<i;++a){o.push(e)}t=t.concat(D(o))}return t}M(["d","a"],2,5).forEach(function(e){var r=e.split("").reverse();I.set("c"+e+"r",function(e){return r.reduce(function(e,r){if(r==="a"){return e.car}else{return e.cdr}},e)})});if(typeof global!=="undefined"){I.set("global",global)}else if(typeof window!=="undefined"){I.set("window",window)}function G(e){if(typeof e==="string"){return"string"}else if(e instanceof L){return"number"}else if(e instanceof RegExp){return"regex"}else if(typeof e==="boolean"){return"boolean"}else{return"unknown type"}}function $(e){var r=[];n(e);if(r.length){return t(e)}return e;function n(e){if(e instanceof Promise){r.push(e)}else if(e instanceof k){n(e.car);n(e.cdr)}else if(e instanceof Array){e.forEach(n)}}function t(o){if(o instanceof Array){return Promise.all(o.map(t))}if(o instanceof k){var e=t(o.car);var r=t(o.cdr);return Promise.all([e,r]).then(function(e){var r=W(e,2),n=r[0],t=r[1];var i=new k(n,t);if(o.data){F(i)}return i})}else{return o}}}function J(e,r){var n=r.env,t=r.dynamic_scope,i=r.error;var o=[];var a=e;while(true){if(a instanceof k){var c=C(a.car,{env:n,dynamic_scope:t,error:i});if(t){if(c instanceof Promise){c=c.then(function(e){if(typeof e==="function"){return e.bind(t)}return e})}else if(typeof c==="function"){c=c.bind(t)}}o.push(c);a=a.cdr}else{break}}return $(o)}function U(e,r,n){if(r instanceof k){r=r.clone()}var t=e.invoke(r,n);t=$(t,true);if(t&&t.data){return t}else if(t instanceof Promise){return t.then(function(e){if(e&&e.data){return e}return C(e,n)})}return C(t,n)}function C(r){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},n=e.env,t=e.dynamic_scope,i=e.error,o=i===void 0?function(){}:i;try{if(t===true){n=t=n||I}else if(n===true){n=t=I}else{n=n||I}var a={env:n,dynamic_scope:t,error:o};var c;if(O(r)){return r}if(A(r)){return _()}var u=r.car;var f=r.cdr;if(u instanceof k){c=$(C(u,a));if(c instanceof Promise){return c.then(function(e){return C(new k(e,r.cdr),a)})}else if(typeof c!=="function"){throw new Error(n.get("string")(c)+" is not a function")}}if(u instanceof w){c=n.get(u);if(c instanceof S){return U(c,f,a)}else if(typeof c!=="function"){if(c){var s="".concat(G(c)," `").concat(c,"' is not a function");throw new Error(s)}throw new Error("Unknown function `".concat(u.name,"'"))}}else if(typeof u==="function"){c=u}if(typeof c==="function"){var l=J(f,a);if(l instanceof Promise){return l.then(function(e){var r=t||n;return F($(c.apply(r,e)))})}return F($(c.apply(t||n,l)))}else if(r instanceof w){c=n.get(r);if(c==="undefined"){throw new Error("Unbound variable `"+r.name+"'")}return c}else if(r instanceof k){c=u&&u.toString();throw new Error("".concat(G(u)," ").concat(c," is not a function"))}else{return r}}catch(e){o&&o(e,r)}}function H(e,r,n){return Q.apply(this,arguments)}function Q(){Q=re(ee.mark(function e(n,t,i){var o,a,c,u;return ee.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:if(i===true){t=i=t||I}else if(t===true){t=i=I}else{t=t||I}o=v(p(n));a=[];case 3:c=o.shift();if(c){r.next=9;break}return r.abrupt("return",a);case 9:r.next=11;return C(c,{env:t,dynamic_scope:i,error:function e(r,n){r.code=n.toString();throw r}});case 11:u=r.sent;a.push(u);case 13:r.next=3;break;case 15:case"end":return r.stop()}}},e)}));return Q.apply(this,arguments)}function V(r){return function(e){if(!e){return false}return(e.token||e).match(r)}}var Y=V(/[()]/);function z(e){var r=typeof e==="string"?p(e):e;var n=r.filter(Y);var t=n.filter(function(e){return(e.token||e)===")"});var i=n.filter(function(e){return(e.token||e)==="("});return t.length===i.length}k.unDry=function(e){return new k(e.car,e.cdr)};k.prototype.toDry=function(){return{value:{car:this.car,cdr:this.cdr}}};b.prototype.toDry=function(){return{value:null}};b.unDry=function(){return x};w.prototype.toDry=function(){return{value:{name:this.name}}};w.unDry=function(e){return new w(e.name)};function X(){var t="text/x-lips";if(window.document){Array.from(document.querySelectorAll("script")).forEach(function(e){var r=e.getAttribute("type");if(r===t){var n=e.getAttribute("src");if(n){o.fetch(n).then(function(e){return e.text()}).then(H)}else{H(e.innerHTML)}}else if(r&&r.match(/lips|lisp/)){console.warn("Expecting "+t+" found "+r)}})}}function K(r){if(typeof window!=="undefined"){if(window.addEventListener){window.addEventListener("load",r,false)}else if(window.attachEvent){window.attachEvent("onload",r)}else if(typeof window.onload==="function"){(function(e){window.onload=function(){r();e()}})(window.onload)}else{window.onload=r}}}K(function(){setTimeout(X,0)});return{version:"DEV",exec:H,parse:v,tokenize:p,evaluate:C,Environment:B,global_environment:I,env:I,balanced_parenthesis:z,Macro:S,quote:F,Pair:k,Formatter:u,nil:x,maybe_promise:$,Symbol:w,LNumber:L}})})();