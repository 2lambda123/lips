/**@license
 * LIPS is Pretty Simple - version DEV
 *
 * Copyright (c) 2018 Jakub Jankiewicz <http://jcubic.pl/me>
 * Released under the MIT license
 *
 * build: Fri, 11 May 2018 16:13:58 +0000
 */
"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol==="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};function _toConsumableArray(n){if(Array.isArray(n)){for(var e=0,r=Array(n.length);e<n.length;e++){r[e]=n[e]}return r}else{return Array.from(n)}}(function(n,e){if(typeof define==="function"&&define.amd){define([],function(){return n.lips=e()})}else if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&module.exports){module.exports=e()}else{n.lips=e()}})(typeof self!=="undefined"?self:undefined,function(n){var e=/^\/((?:\\\/|[^/]|\[[^\]]*\/[^\]]*\])+)\/([gimy]*)$/;var r=/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/;function t(n){function t(n){if(n.match(/^['"]/)){if(n==='""'||n==="''"){return""}var e=n[0];var r=new RegExp("((^|[^\\\\])(?:\\\\\\\\)*)"+e,"g");n=n.replace(r,"$1")}return JSON.parse('"'+n+'"')}var i=n.match(e);if(i){return new RegExp(i[1],i[2])}else if(n.match(/['"]/)){return t(n)}else if(n.match(/^-?[0-9]+$/)){return parseInt(n,10)}else if(n.match(r)){return parseFloat(n)}else if(n==="nil"){return s}else{return new c(n)}}var i=/("[^"\\]*(?:\\[\S\s][^"\\]*)*"|\/[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|;.*|\(|\)|'|\.|,@|,|`|[^(\s)]+)/gi;function a(n){return n.split("\n").map(function(n){return n.split(i).map(function(n){if(n.match(/^;/)){return null}return n.trim()}).filter(Boolean)}).reduce(function(n,e){return n.concat(e)},[])}var o={"'":new c("quote"),"`":new c("quasiquote"),",":new c("unquote"),",@":new c("unquote-splicing")};function f(n){var e=[];var r=[];var i=null;var a=Object.keys(o);var f=a.map(function(n){return o[n].name});var u=0;var h=false;var d=[];var p=[];function v(){var n=e[e.length-1];if(n instanceof Array&&n[0]instanceof c&&f.includes(n[0].name)&&e.length>1){e.pop();if(e[e.length-1].length===1&&e[e.length-1][0]instanceof c){e[e.length-1].push(n)}else if(e[e.length-1].length===0){e[e.length-1]=n}else if(e[e.length-1]instanceof l){if(e[e.length-1].cdr instanceof l){e[e.length-1]=new l(e[e.length-1],l.fromArray(n))}else{e[e.length-1].cdr=l.fromArray(n)}}else{e[e.length-1].push(n)}}}n.forEach(function(n){var f=e[e.length-1];if(a.indexOf(n)!==-1){i=n;e.push([o[i]]);if(!i){p=[]}p.push(i)}else if(n==="("){h=true;u++;if(i){d.push(p);p=[]}e.push([]);i=null}else if(n==="."&&!h){e[e.length-1]=l.fromArray(f)}else if(n===")"){u--;if(!e.length){throw new Error("Unbalanced parenthesis 1")}if(e.length===1){r.push(e.pop())}else if(e.length>1){var c=e.pop();f=e[e.length-1];if(f instanceof Array){f.push(c)}else if(f instanceof l){f.append(l.fromArray(c))}if(d.length){p=d.pop();while(p.length){v();p.pop()}}else{v()}}if(u===0&&e.length){r.push(e.pop())}}else{h=false;var y=t(n);if(i){e[e.length-1][1]=y;y=e.pop();i=false}f=e[e.length-1];if(f instanceof l){var w=f;while(true){if(w.cdr===s){if(y instanceof Array){w.cdr=l.fromArray(y)}else{w.cdr=y}break}else{w=w.cdr}}}else if(!e.length){r.push(y)}else{f.push(y)}}});if(e.length){console.log({end:e.slice()});throw new Error("Unbalanced parenthesis 2")}return r.map(function(n){if(n instanceof Array){return l.fromArray(n)}return n})}function c(n){this.name=n}c.is=function(n,e){return n instanceof c&&typeof e==="string"&&n.name===e};c.prototype.toJSON=c.prototype.toString=function(){return this.name};function u(){}u.prototype.toString=function(){return"nil"};var s=new u;function l(n,e){this.car=n;this.cdr=e}l.prototype.length=function(){var n=0;var e=this;while(true){if(e===s){break}n++;e=e.cdr}return n};l.prototype.clone=function(){var n;if(this.cdr===s){n=s}else{n=this.cdr.clone()}return new l(this.car,n)};l.prototype.toArray=function(){if(this.cdr===s&&this.car===s){return[]}var n=[];if(this.car instanceof l){n.push(this.car.toArray())}else{n.push(this.car)}if(this.cdr instanceof l){n=n.concat(this.cdr.toArray())}return n};l.fromArray=function(e){if(e instanceof l){return e}if(e.length&&!e instanceof Array){e=[].concat(_toConsumableArray(e))}if(e.length===0){return new l(n,s)}else{var r;if(e[0]instanceof Array){r=l.fromArray(e[0])}else{r=e[0]}if(e.length===1){return new l(r,s)}else{return new l(r,l.fromArray(e.slice(1)))}}};l.prototype.toObject=function(){var n=this;var e={};while(true){if(n instanceof l&&n.car instanceof l){var r=n.car;var t=r.car;if(t instanceof c){t=t.name}e[t]=r.cdr;n=n.cdr}else{break}}return e};l.fromPairs=function(n){return n.reduce(function(n,e){return new l(new l(new c(e[0]),e[1]),n)},s)};l.fromObject=function(n){var e=Object.keys(n).map(function(e){return[e,n[e]]});return l.fromPairs(e)};l.prototype.reduce=function(n){var e=this;var r=s;while(true){if(e!==s){r=n(r,e.car);e=e.cdr}else{break}}return r};l.prototype.reverse=function(){var n=this;var e=s;while(n!==s){var r=n.cdr;n.cdr=e;e=n;n=r}return e};l.prototype.transform=function(n){var e=[];function r(t){if(t instanceof l){if(t.replace){delete t.replace;return t}var i=n(t.car);if(i instanceof l){i=r(i);e.push(i)}var a=n(t.cdr);if(a instanceof l){a=r(a);e.push(a)}return new l(i,a)}return t}return r(this)};l.prototype.toString=function(){var e=["("];if(this.car!==n){if(typeof this.car==="string"){e.push(JSON.stringify(this.car))}else if(typeof this.car!=="undefined"){e.push(this.car)}if(this.cdr instanceof l){e.push(" ");e.push(this.cdr.toString().replace(/^\(|\)$/g,""))}else if(typeof this.cdr!=="undefined"&&this.cdr!==s){if(typeof this.cdr==="string"){e=e.concat([" . ",JSON.stringify(this.cdr)])}else{e=e.concat([" . ",this.cdr])}}}e.push(")");return e.join("")};l.prototype.append=function(e){if(e instanceof Array){return this.append(l.fromArray(e))}var r=this;if(r.car===n){if(e instanceof l){this.car=e.car;this.cdr=e.cdr}else{return e}}else{while(true){if(r instanceof l&&r.cdr!==s){r=r.cdr}else{break}}r.cdr=e}return this};function h(n){this.fn=n}h.prototype.invoke=function(n,e){return this.fn.call(e,n)};function d(n,e){this.env=n;this.parent=e}d.prototype.get=function(n){if(n instanceof c){if(typeof this.env[n.name]!=="undefined"){return this.env[n.name]}}else if(typeof n==="string"){if(typeof this.env[n]!=="undefined"){return this.env[n]}}if(this.parent instanceof d){return this.parent.get(n)}else{var e;if(n instanceof c){e=n.name}else if(typeof n==="string"){e=n}if(e){var r=_typeof(window[e]);if(r==="function"){return window[e].bind(window)}else if(r!=="undefined"){return window[e]}}}};d.prototype.set=function(n,e){this.env[n]=e};function p(n){this.value=n}function v(n,e){this.value=n;this.count=e}v.prototype.toString=function(){return"<#unquote["+this.count+"] "+this.value+">"};function y(n){return new h(function(e){var r=this.get("list->array")(e.car);var t=new d({},this);return new Promise(function(i){var a=[];var o=0;(function f(){var u=r[o++];function s(n){if(n instanceof Promise){a.push(n);return n.then(s)}else{t.set(u.car,n)}}if(!u){var h=new l(new c("begin"),e.cdr);i(new p(E(h,t)))}else{var d=E(u.cdr.car,n?t:this);var v=s(d);if(v instanceof Promise){v.then(function(){Promise.all(a).then(f)})}else{f()}}})()})})}var w=function(){var n=0;return function(){n++;return new c("#"+n)}}();function g(e){var r=arguments.length>1&&arguments[1]!==n?arguments[1]:"GET";var t=arguments.length>2&&arguments[2]!==n?arguments[2]:{};var i=arguments.length>3&&arguments[3]!==n?arguments[3]:null;var a=new XMLHttpRequest;a.open(r,e,true);Object.keys(t).forEach(function(n){a.setRequestHeader(n,t[n])});return new Promise(function(n){a.onreadystatechange=function(){if(a.readyState===4&&a.status===200){n(a.responseText)}};if(i!==null){a.send(i)}else{a.send()}})}var m=new d({nil:s,window:window,true:true,false:false,stdout:{write:function n(){var e;(e=console).log.apply(e,arguments)}},stdin:{read:function n(){return new Promise(function(n){n(prompt(""))})}},cons:function n(e,r){return new l(e,r)},car:function n(e){if(e instanceof l){return e.car}else{throw new Error("argument to car need to be a list")}},cdr:function n(e){if(e instanceof l){return e.cdr}else{throw new Error("argument to cdr need to be a list")}},"set-car":function n(e,r){e.car=r},"set-cdr":function n(e,r){e.cdr=r},assoc:function n(e,r){var t=e;var i=r instanceof c?r.name:r;while(true){var a=t.car.car;if(a instanceof c&&a.name===i||a.name===i){return t.car}else{t=t.cdr}}},gensym:w,load:function n(e){var r=this;g(e).then(function(n){r.get("eval")(r.get("read")(n))})},while:new h(function(n){var e=this;var r=new l(new c("begin"),n.cdr);return new Promise(function(t){var i;(function a(){function o(n){if(n){var o=E(r,e);if(o instanceof Promise){o.then(function(n){i=n;a()})}else{i=o;a()}}else{t(i)}}var f=E(n.car,e);if(f instanceof Promise){f.then(o)}else{o(f)}})()})}),if:new h(function(n){var e=this;var r=function r(t){if(t){var i=E(n.cdr.car,e);if(typeof i==="undefined"){return}return i}else if(n.cdr.cdr.car instanceof l){var a=E(n.cdr.cdr.car,e);if(typeof a==="undefined"){return false}return a}else{return false}};var t=E(n.car,this);if(t instanceof Promise){return t.then(r)}else{return r(t)}}),"let*":y(true),let:y(false),begin:new h(function(n){var e=this;var r=this.get("list->array")(n);return r.reduce(function(n,r){return E(r,e)},0)}),timer:new h(function(n){var e=this;return new Promise(function(r){setTimeout(function(){r(new p(E(n.cdr,e)))},n.car)})}),define:new h(function(n){if(n.car instanceof l&&n.car.car instanceof c){var e=new l(new c("define"),new l(n.car.car,new l(new l(new c("lambda"),new l(n.car.cdr,n.cdr)))));return e}var r=n.cdr.car;if(r instanceof l){r=E(r,this)}if(n.car instanceof c){this.env[n.car.name]=r}}),set:function n(e,r,t){e[r]=t},eval:function n(e){var r=this;if(e instanceof l){return E(e,this)}if(e instanceof Array){var t;e.forEach(function(n){t=E(n,r)});return t}},lambda:new h(function(n){var e=this;return function(){for(var r=arguments.length,t=Array(r),i=0;i<r;i++){t[i]=arguments[i]}var a=new d({},e);var o=n.car;var f=0;var u;while(true){if(o.car!==s){if(o instanceof c){u=l.fromArray(t.slice(f));a.env[o.name]=u;break}else{if(typeof t[f]==="undefined"){u=s}else{u=t[f]}a.env[o.car.name]=u}}if(o.cdr===s){break}f++;o=o.cdr}return E(n.cdr.car,a)}}),defmacro:new h(function(n){if(n.car.car instanceof c){this.env[n.car.car.name]=new h(function(e){var r=new d({},this);var t=n.car.cdr;var i=e;while(true){if(t.car!==s&&i.car!==s){r.env[t.car.name]=i.car}if(t.cdr===s){break}i=i.cdr;t=t.cdr}return E(n.cdr.car,r)})}}),quote:new h(function(n){return new p(n.car)}),quasiquote:new h(function(n){var e=this;var r=0;function t(n){if(n instanceof l){var i;if(c.is(n.car.car,"unquote-splicing")){i=E(n.car.cdr.car,e);if(!i instanceof l){throw new Error("Value of unquote-splicing need"+" to be pair")}if(n.cdr instanceof l){if(i instanceof l){i.cdr.append(t(n.cdr))}else{i=new l(i,t(n.cdr))}}return i}if(c.is(n.car,"unquote")){var a=n.cdr;var o=a;var f=o;var u=1;while(c.is(o.car.car,"unquote")){f=o;u++;o=o.car.cdr.car}if(u>r){r=u}if(f===o){if(n.cdr.cdr!==s){return new l(new v(n.cdr.car,u),n.cdr.cdr)}else{return new v(n.cdr.car,u)}}else if(f.cdr.cdr!==s){f.car.cdr=new l(new v(o,u),f.cdr===s?s:f.cdr.cdr)}else{f.car.cdr=new v(o,u)}return a.car}var h=n.car;if(h instanceof l){h=t(h)}var d=n.cdr;if(d instanceof l){d=t(d)}return new l(h,d)}return n}function i(n){if(n instanceof v){if(r===n.count){return E(n.value,e)}else{return new l(new c("unquote"),new l(i(n.value),s))}}if(n instanceof l){var t=n.car;if(t instanceof l||t instanceof v){t=i(t)}var a=n.cdr;if(a instanceof l||a instanceof v){a=i(a)}return new l(t,a)}return n}return new p(i(t(n.car)))}),clone:function n(e){return e.clone()},append:function n(e,r){return this.get("append!")(e.clone(),r)},"append!":function n(e,r){return e.append(r)},list:function n(){return l.fromArray([].slice.call(arguments))},concat:function n(){return[].join.call(arguments,"")},string:function n(e){if(typeof jQuery!=="undefined"&&e instanceof jQuery.fn.init){return"<#jQuery>"}if(e instanceof h){}if(typeof e==="undefined"){return"<#undefined>"}if(typeof e==="function"){return"<#function>"}if(e===s){return"nil"}if(e instanceof Array||e===null){return JSON.stringify(e)}if(e instanceof l){return e.toString()}if((typeof e==="undefined"?"undefined":_typeof(e))==="object"){var r=e.constructor.name;if(r!==""){return"<#"+r+">"}return"<#Object>"}if(typeof e!=="string"){return e.toString()}return e},env:function e(r){r=r||this;var t=Object.keys(r.env);var i;if(t.length){i=l.fromArray(t)}else{i=s}if(r.parent!==n){return this.get("env").call(this,r.parent).append(i)}return i},".":function n(e,r){var t=r instanceof c?r.name:r;var i=e[t];if(typeof i==="function"){return i.bind(e)}return i},type:function n(e){return typeof e==="undefined"?"undefined":_typeof(e)},instanceof:function n(e,r){return e instanceof r},read:function n(e){var r=this;if(typeof e==="string"){return f(a(e))}return this.get("stdin").read().then(function(n){return r.get("read").call(r,n)})},print:function n(){var e,r=this;for(var t=arguments.length,i=Array(t),a=0;a<t;a++){i[a]=arguments[a]}(e=this.get("stdout")).write.apply(e,_toConsumableArray(i.map(function(n){return r.get("string")(n)})))},"array->list":function n(e){return l.fromArray(e)},"list->array":function n(e){var r=[];var t=e;while(true){if(t instanceof l){r.push(t.car);t=t.cdr}else{break}}return r},filter:function n(e,r){return l.fromArray(this.get("list->array")(r).filter(e))},odd:function n(e){return e%2===1},even:function n(e){return e%2===0},apply:function n(e,r){var t=this.get("list->array")(r);return e.apply(null,t)},map:function n(e,r){var t=this.get("list->array")(r).map(e);if(t.length){return l.fromArray(t)}else{return s}},reduce:function e(r,t){var i=arguments.length>2&&arguments[2]!==n?arguments[2]:null;var a=this.get("list->array")(t);if(i===null){return a.slice(1).reduce(function(n,e){return r(n,e)},a[0])}else{return a.reduce(function(n,e){return r(n,e)},i)}},curry:function n(e){for(var r=arguments.length,t=Array(r>1?r-1:0),i=1;i<r;i++){t[i-1]=arguments[i]}var a=e.length;return function(){var n=t.slice();function r(){for(var t=arguments.length,i=Array(t),o=0;o<t;o++){i[o]=arguments[o]}n=n.concat(i);if(n.length>=a){return e.apply(this,n)}else{return r}}return r.apply(this,arguments)}},range:function n(e){return l.fromArray(new Array(e).fill(0).map(function(n,e){return e}))},"*":function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++){r[t]=arguments[t]}return r.reduce(function(n,e){return n*e})},"+":function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++){r[t]=arguments[t]}return r.reduce(function(n,e){return n+e})},"-":function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++){r[t]=arguments[t]}return r.reduce(function(n,e){return n-e})},"/":function n(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++){r[t]=arguments[t]}return r.reduce(function(n,e){return n/e})},"%":function n(e,r){return e%r},"==":function n(e,r){return e===r},">":function n(e,r){return e>r},"<":function n(e,r){return e<r},"<=":function n(e,r){return e<=r},">=":function n(e,r){return e>=r},or:new h(function(n){var e=this.get("list->array")(n);var r=this;return new Promise(function(n){var t;(function i(){function a(e){t=e;if(t){n(e)}i()}var o=e.shift();if(typeof o==="undefined"){if(t){n(t)}else{n(false)}}else{var f=E(o,r);if(f instanceof Promise){f.then(a)}else{a(f)}}})()})}),and:new h(function(n){var e=this.get("list->array")(n);var r=this;return new Promise(function(n){var t;(function i(){function a(e){t=e;if(!t){n(false)}i()}var o=e.shift();if(typeof o==="undefined"){if(t){n(t)}else{n(false)}}else{var f=E(o,r);if(f instanceof Promise){f.then(a)}else{a(f)}}})()})}),"->":function n(e,r){console.log(r);console.log(e);for(var t=arguments.length,i=Array(t>2?t-2:0),a=2;a<t;a++){i[a-2]=arguments[a]}return e[r].apply(e,i)},"1+":function n(e){return e+1},"1-":function n(e){return e-1},"++":new h(function(n){var e=this.get(n.car)+1;this.set(n.car,e);return e}),"--":new h(function(n){var e=this.get(n.car)-1;this.set(n.car,e);return e})});function A(n){if(n.length===1){return n[0]}else{var e=[];var r=A(n.slice(1));for(var t=0;t<r.length;t++){for(var i=0;i<n[0].length;i++){e.push(n[0][i]+r[t])}}return e}}function b(n,e,r){var t=[];for(var i=e;i<=r;++i){var a=[];for(var o=0;o<i;++o){a.push(n)}t=t.concat(A(a))}return t}b(["d","a"],2,5).forEach(function(n){var e=n.split("").reverse();m.set("c"+n+"r",function(n){return e.reduce(function(n,e){if(e==="a"){return n.car}else{return n.cdr}},n)})});function E(n,e){e=e||m;var r;if(typeof n==="undefined"){return}var t=n.car;var i=n.cdr;if(t instanceof l){r=E(t,e);if(r instanceof Promise){return r.then(function(e){return E(new l(e,n.cdr))})}else if(typeof r!=="function"){throw new Error(e.get("string")(r)+" is not a function")}}if(typeof t==="function"){r=t}if(t instanceof c){r=e.get(t);if(r instanceof h){r=r.invoke(i,e);if(r instanceof p){return r.value}else if(r instanceof Promise){return r.then(function(n){return n.value})}return E(r,e)}else if(typeof r!=="function"){throw new Error("Unknown function `"+t.name+"'")}}if(typeof r==="function"){var a=[];var o=i;while(true){if(o instanceof l){a.push(E(o.car,e));o=o.cdr}else{break}}var f=a.filter(function(n){return n instanceof Promise});if(f.length){return Promise.all(a).then(function(n){return r.apply(e,n)})}return r.apply(e,a)}else if(n instanceof c){r=e.get(n);if(r==="undefined"){throw new Error("Unbound variable `"+n.name+"'")}return r}else{return n}}function P(n,e){return f(a(n)).map(function(n){return E(n,e)})}function S(n){var e=/[()]/;var r=a(n).filter(function(n){return n.match(e)});var t=r.filter(function(n){return n===")"});var i=r.filter(function(n){return n==="("});return t.length===i.length}l.unDry=function(n){return new l(n.car,n.cdr)};l.prototype.toDry=function(){return{value:{car:this.car,cdr:this.cdr}}};u.prototype.toDry=function(){return{value:null}};u.unDry=function(){return s};c.prototype.toDry=function(){return{value:{name:this.name}}};c.unDry=function(n){return new c(n.name)};function k(){var n="text-x/lips";if(window.document){Array.from(document.querySelectorAll("script")).forEach(function(e){var r=e.getAttribute("type");if(r===n){P(e.innerHTML)}else if(r==="text-x/lisp"){console.warn("Expecting "+n+" found "+r)}})}}function q(n){if(typeof window!=="undefined"){if(window.addEventListener){window.addEventListener("load",n,false)}else if(window.attachEvent){window.attachEvent("onload",n)}else if(typeof window.onload==="function"){(function(e){window.onload=function(){n();e()}})(window.onload)}else{window.onload=n}}}q(function(){setTimeout(k,0)});return{version:"DEV",exec:P,parse:f,tokenize:a,evaluate:E,Environment:d,global_environment:m,balanced_parenthesis:S,Macro:h,Quote:p,Pair:l,nil:s,Symbol:c}});