/**@license
 * LIPS is Pretty Simple - version DEV
 *
 * Copyright (c) 2018 Jakub Jankiewicz <http://jcubic.pl/me>
 * Released under the MIT license
 *
 * build: Sun, 16 Sep 2018 09:20:25 +0000
 */
(function(){"use strict";function e(e,r){return r={exports:{}},e(r,r.exports),r.exports}var r=e(function(e){function r(n){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){e.exports=r=function e(r){return typeof r}}else{e.exports=r=function e(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r}}return r(n)}e.exports=r});var n=e(function(e){!function(n){var t=Object.prototype;var i=t.hasOwnProperty;var o;var a=typeof Symbol==="function"?Symbol:{};var u=a.iterator||"@@iterator";var c=a.asyncIterator||"@@asyncIterator";var f=a.toStringTag||"@@toStringTag";var s="object"==="object";var l=n.regeneratorRuntime;if(l){if(s){e.exports=l}return}l=n.regeneratorRuntime=s?e.exports:{};function h(e,r,n,t){var i=r&&r.prototype instanceof w?r:w;var o=Object.create(i.prototype);var a=new q(t||[]);o._invoke=L(e,n,a);return o}l.wrap=h;function v(e,r,n){try{return{type:"normal",arg:e.call(r,n)}}catch(e){return{type:"throw",arg:e}}}var p="suspendedStart";var d="suspendedYield";var y="executing";var m="completed";var g={};function w(){}function b(){}function _(){}var x={};x[u]=function(){return this};var E=Object.getPrototypeOf;var N=E&&E(E(B([])));if(N&&N!==t&&i.call(N,u)){x=N}var A=_.prototype=w.prototype=Object.create(x);b.prototype=A.constructor=_;_.constructor=b;_[f]=b.displayName="GeneratorFunction";function j(e){["next","throw","return"].forEach(function(r){e[r]=function(e){return this._invoke(r,e)}})}l.isGeneratorFunction=function(e){var r=typeof e==="function"&&e.constructor;return r?r===b||(r.displayName||r.name)==="GeneratorFunction":false};l.mark=function(e){if(Object.setPrototypeOf){Object.setPrototypeOf(e,_)}else{e.__proto__=_;if(!(f in e)){e[f]="GeneratorFunction"}}e.prototype=Object.create(A);return e};l.awrap=function(e){return{__await:e}};function k(e){function n(t,o,a,u){var c=v(e[t],e,o);if(c.type==="throw"){u(c.arg)}else{var f=c.arg;var s=f.value;if(s&&r(s)==="object"&&i.call(s,"__await")){return Promise.resolve(s.__await).then(function(e){n("next",e,a,u)},function(e){n("throw",e,a,u)})}return Promise.resolve(s).then(function(e){f.value=e;a(f)},function(e){return n("throw",e,a,u)})}}var t;function o(e,r){function i(){return new Promise(function(t,i){n(e,r,t,i)})}return t=t?t.then(i,i):i()}this._invoke=o}j(k.prototype);k.prototype[c]=function(){return this};l.AsyncIterator=k;l.async=function(e,r,n,t){var i=new k(h(e,r,n,t));return l.isGeneratorFunction(r)?i:i.next().then(function(e){return e.done?e.value:i.next()})};function L(e,r,n){var t=p;return function i(o,a){if(t===y){throw new Error("Generator is already running")}if(t===m){if(o==="throw"){throw a}return R()}n.method=o;n.arg=a;while(true){var u=n.delegate;if(u){var c=O(u,n);if(c){if(c===g)continue;return c}}if(n.method==="next"){n.sent=n._sent=n.arg}else if(n.method==="throw"){if(t===p){t=m;throw n.arg}n.dispatchException(n.arg)}else if(n.method==="return"){n.abrupt("return",n.arg)}t=y;var f=v(e,r,n);if(f.type==="normal"){t=n.done?m:d;if(f.arg===g){continue}return{value:f.arg,done:n.done}}else if(f.type==="throw"){t=m;n.method="throw";n.arg=f.arg}}}}function O(e,r){var n=e.iterator[r.method];if(n===o){r.delegate=null;if(r.method==="throw"){if(e.iterator.return){r.method="return";r.arg=o;O(e,r);if(r.method==="throw"){return g}}r.method="throw";r.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var t=v(n,e.iterator,r.arg);if(t.type==="throw"){r.method="throw";r.arg=t.arg;r.delegate=null;return g}var i=t.arg;if(!i){r.method="throw";r.arg=new TypeError("iterator result is not an object");r.delegate=null;return g}if(i.done){r[e.resultName]=i.value;r.next=e.nextLoc;if(r.method!=="return"){r.method="next";r.arg=o}}else{return i}r.delegate=null;return g}j(A);A[f]="Generator";A[u]=function(){return this};A.toString=function(){return"[object Generator]"};function P(e){var r={tryLoc:e[0]};if(1 in e){r.catchLoc=e[1]}if(2 in e){r.finallyLoc=e[2];r.afterLoc=e[3]}this.tryEntries.push(r)}function S(e){var r=e.completion||{};r.type="normal";delete r.arg;e.completion=r}function q(e){this.tryEntries=[{tryLoc:"root"}];e.forEach(P,this);this.reset(true)}l.keys=function(e){var r=[];for(var n in e){r.push(n)}r.reverse();return function n(){while(r.length){var t=r.pop();if(t in e){n.value=t;n.done=false;return n}}n.done=true;return n}};function B(e){if(e){var r=e[u];if(r){return r.call(e)}if(typeof e.next==="function"){return e}if(!isNaN(e.length)){var n=-1,t=function r(){while(++n<e.length){if(i.call(e,n)){r.value=e[n];r.done=false;return r}}r.value=o;r.done=true;return r};return t.next=t}}return{next:R}}l.values=B;function R(){return{value:o,done:true}}q.prototype={constructor:q,reset:function e(r){this.prev=0;this.next=0;this.sent=this._sent=o;this.done=false;this.delegate=null;this.method="next";this.arg=o;this.tryEntries.forEach(S);if(!r){for(var n in this){if(n.charAt(0)==="t"&&i.call(this,n)&&!isNaN(+n.slice(1))){this[n]=o}}}},stop:function e(){this.done=true;var r=this.tryEntries[0];var n=r.completion;if(n.type==="throw"){throw n.arg}return this.rval},dispatchException:function e(r){if(this.done){throw r}var n=this;function t(e,t){c.type="throw";c.arg=r;n.next=e;if(t){n.method="next";n.arg=o}return!!t}for(var a=this.tryEntries.length-1;a>=0;--a){var u=this.tryEntries[a];var c=u.completion;if(u.tryLoc==="root"){return t("end")}if(u.tryLoc<=this.prev){var f=i.call(u,"catchLoc");var s=i.call(u,"finallyLoc");if(f&&s){if(this.prev<u.catchLoc){return t(u.catchLoc,true)}else if(this.prev<u.finallyLoc){return t(u.finallyLoc)}}else if(f){if(this.prev<u.catchLoc){return t(u.catchLoc,true)}}else if(s){if(this.prev<u.finallyLoc){return t(u.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function e(r,n){for(var t=this.tryEntries.length-1;t>=0;--t){var o=this.tryEntries[t];if(o.tryLoc<=this.prev&&i.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}if(a&&(r==="break"||r==="continue")&&a.tryLoc<=n&&n<=a.finallyLoc){a=null}var u=a?a.completion:{};u.type=r;u.arg=n;if(a){this.method="next";this.next=a.finallyLoc;return g}return this.complete(u)},complete:function e(r,n){if(r.type==="throw"){throw r.arg}if(r.type==="break"||r.type==="continue"){this.next=r.arg}else if(r.type==="return"){this.rval=this.arg=r.arg;this.method="return";this.next="end"}else if(r.type==="normal"&&n){this.next=n}return g},finish:function e(r){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.finallyLoc===r){this.complete(t.completion,t.afterLoc);S(t);return g}}},catch:function e(r){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc===r){var i=t.completion;if(i.type==="throw"){var o=i.arg;S(t)}return o}}throw new Error("illegal catch attempt")},delegateYield:function e(r,n,t){this.delegate={iterator:B(r),resultName:n,nextLoc:t};if(this.method==="next"){this.arg=o}return g}}}(function(){return this||(typeof self==="undefined"?"undefined":r(self))==="object"&&self}()||Function("return this")())});var t=function(){return this||(typeof self==="undefined"?"undefined":r(self))==="object"&&self}()||Function("return this")();var i=t.regeneratorRuntime&&Object.getOwnPropertyNames(t).indexOf("regeneratorRuntime")>=0;var o=i&&t.regeneratorRuntime;t.regeneratorRuntime=undefined;var a=n;if(i){t.regeneratorRuntime=o}else{try{delete t.regeneratorRuntime}catch(e){t.regeneratorRuntime=undefined}}var u=a;function c(e,r,n,t,i,o,a){try{var u=e[o](a);var c=u.value}catch(e){n(e);return}if(u.done){r(c)}else{Promise.resolve(c).then(t,i)}}function f(e){return function(){var r=this,n=arguments;return new Promise(function(t,i){var o=e.apply(r,n);function a(e){c(o,t,i,a,u,"next",e)}function u(e){c(o,t,i,a,u,"throw",e)}a(undefined)})}}var s=f;function l(e){if(Array.isArray(e)){for(var r=0,n=new Array(e.length);r<e.length;r++){n[r]=e[r]}return n}}var h=l;function v(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}var p=v;function d(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var y=d;function m(e){return h(e)||p(e)||y()}var g=m;
/**@license
 * LIPS is Pretty Simple
 *
 * Copyright (c) 2018 Jakub Jankiewicz <http://jcubic.pl/me>
 * Released under the MIT license
 *
 */
/**@license
 * LIPS is Pretty Simple
 *
 * Copyright (c) 2018 Jakub Jankiewicz <http://jcubic.pl/me>
 * Released under the MIT license
 *
 */
(function(e,n){if(typeof define==="function"&&define.amd){define(["bn.js"],function(r){return e.lips=n(e,r)})}else if((typeof module==="undefined"?"undefined":r(module))==="object"&&module.exports){module.exports=n(e,require("bn.js"))}else{e.lips=n(e,e.BN)}})(typeof window!=="undefined"?window:global,function(e,n,t){var i=/^\/((?:\\\/|[^/]|\[[^\]]*\/[^\]]*\])+)\/([gimy]*)$/;var o=/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/;function a(e){function r(e){if(e.match(/^['"]/)){if(e==='""'||e==="''"){return""}var r=e[0];var n=new RegExp("((^|[^\\\\])(?:\\\\\\\\)*)"+r,"g");e=e.replace(n,"$1")}return JSON.parse('"'+e+'"')}var n=e.match(i);if(n){return new RegExp(n[1],n[2])}else if(e.match(/['"]/)){return r(e)}else if(e.match(/^-?[0-9]+$/)){return _(parseInt(e,10))}else if(e.match(o)){return _(parseFloat(e))}else if(e==="nil"){return m}else{return new d(e)}}var c=/("[^"\\]*(?:\\[\S\s][^"\\]*)*"|\/[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|;.*|\(|\)|'|\.|,@|,|`|[^(\s)]+)/gi;function f(e,r){if(r){return l(e)}else{return l(e).map(function(e){return e.token.trim()}).filter(function(e){return e&&!e.match(/^;/)})}}function l(e){var r=0;return e.split("\n").map(function(e,n){var t=0;r+=n===0?0:1;return e.split(c).filter(Boolean).map(function(e){var i={col:t,line:n,token:e,offset:r};t+=e.length;r+=e.length;return i})}).reduce(function(e,r){return e.concat(r)},[])}var h={"'":new d("quote"),"`":new d("quasiquote"),",":new d("unquote"),",@":new d("unquote-splicing")};function v(e){var r=[];var n=[];var t=null;var i=Object.keys(h);var o=i.map(function(e){return h[e].name});var u=0;var c=false;var f=[];var s=[];function l(){var e=r[r.length-1];if(e instanceof Array&&e[0]instanceof d&&o.includes(e[0].name)&&r.length>1){r.pop();if(r[r.length-1].length===1&&r[r.length-1][0]instanceof d){r[r.length-1].push(e)}else if(r[r.length-1].length===0){r[r.length-1]=e}else if(r[r.length-1]instanceof w){if(r[r.length-1].cdr instanceof w){r[r.length-1]=new w(r[r.length-1],w.fromArray(e))}else{r[r.length-1].cdr=w.fromArray(e)}}else{r[r.length-1].push(e)}}}e.forEach(function(e){var o=r[r.length-1];if(i.indexOf(e)!==-1){t=e;r.push([h[t]]);if(!t){s=[]}s.push(t)}else if(e==="("){c=true;u++;if(t){f.push(s);s=[]}r.push([]);t=null}else if(e==="."&&!c){r[r.length-1]=w.fromArray(o)}else if(e===")"){u--;if(!r.length){throw new Error("Unbalanced parenthesis 1")}if(r.length===1){n.push(r.pop())}else if(r.length>1){var v=r.pop();o=r[r.length-1];if(o instanceof Array){o.push(v)}else if(o instanceof w){o.append(w.fromArray(v))}if(f.length){s=f.pop();while(s.length){l();s.pop()}}else{l()}}if(u===0&&r.length){n.push(r.pop())}}else{c=false;var p=a(e);if(t){r[r.length-1][1]=p;p=r.pop();t=false}o=r[r.length-1];if(o instanceof w){var d=o;while(true){if(d.cdr===m){if(p instanceof Array){d.cdr=w.fromArray(p)}else{d.cdr=p}break}else{d=d.cdr}}}else if(!r.length){n.push(p)}else{o.push(p)}}});if(r.length){console.log({end:r.slice()});throw new Error("Unbalanced parenthesis 2")}return n.map(function(e){if(e instanceof Array){return w.fromArray(e)}return e})}function p(e,r){var n=Object.prototype.toString;var i="[object Array]";var o=[];var a=r&&e||e.slice();var u;if(!e.length){return o}u=a.pop();do{if(n.call(u)===i){a.push.apply(a,u)}else{o.push(u)}}while(a.length&&(u=a.pop())!==t);o.reverse();return o}function d(e){this.name=e}d.is=function(e,r){return e instanceof d&&typeof r==="string"&&e.name===r};d.prototype.toJSON=d.prototype.toString=function(){return this.name};function y(){}y.prototype.toString=function(){return"nil"};var m=new y;function w(e,r){this.car=e;this.cdr=r}w.prototype.flatten=function(){return w.fromArray(p(this.toArray()))};w.prototype.length=function(){var e=0;var r=this;while(true){if(r===m){break}e++;r=r.cdr}return e};w.prototype.clone=function(){var e=this.cdr;var r=this.car;if(r instanceof w){r=r.clone()}if(e instanceof w){e=this.cdr.clone()}return new w(r,e)};w.prototype.toArray=function(){if(this.cdr===m&&this.car===m){return[]}var e=[];if(this.car instanceof w){e.push(this.car.toArray())}else{e.push(this.car)}if(this.cdr instanceof w){e=e.concat(this.cdr.toArray())}return e};w.prototype.isEmptyList=function(){return typeof this.car==="undefined"&&this.cdr===m};w.fromArray=function(e){if(e instanceof w){return e}if(e.length&&!e instanceof Array){e=g(e)}if(e.length===0){return new w(t,m)}else{var r;if(e[0]instanceof Array){r=w.fromArray(e[0])}else{r=e[0]}if(e.length===1){return new w(r,m)}else{return new w(r,w.fromArray(e.slice(1)))}}};w.prototype.toObject=function(){var e=this;var r={};while(true){if(e instanceof w&&e.car instanceof w){var n=e.car;var t=n.car;if(t instanceof d){t=t.name}r[t]=n.cdr;e=e.cdr}else{break}}return r};w.fromPairs=function(e){return e.reduce(function(e,r){return new w(new w(new d(r[0]),r[1]),e)},m)};w.fromObject=function(e){var r=Object.keys(e).map(function(r){return[r,e[r]]});return w.fromPairs(r)};w.prototype.reduce=function(e){var r=this;var n=m;while(true){if(r!==m){n=e(n,r.car);r=r.cdr}else{break}}return n};w.prototype.reverse=function(){var e=this;var r=m;while(e!==m){var n=e.cdr;e.cdr=r;r=e;e=n}return r};w.prototype.transform=function(e){function r(n){if(n instanceof w){if(n.replace){delete n.replace;return n}var t=e(n.car);if(t instanceof w){t=r(t)}var i=e(n.cdr);if(i instanceof w){i=r(i)}return new w(t,i)}return n}return r(this)};w.prototype.toString=function(){var e=["("];if(this.car!==t){if(typeof this.car==="function"){e.push("<#function "+(this.car.name||"anonymous")+">")}else if(typeof this.car==="string"){e.push(JSON.stringify(this.car))}else if(typeof this.car!=="undefined"){e.push(this.car)}if(this.cdr instanceof w){e.push(" ");e.push(this.cdr.toString().replace(/^\(|\)$/g,""))}else if(typeof this.cdr!=="undefined"&&this.cdr!==m){if(typeof this.cdr==="string"){e=e.concat([" . ",JSON.stringify(this.cdr)])}else{e=e.concat([" . ",this.cdr])}}}e.push(")");return e.join("")};w.prototype.append=function(e){if(e instanceof Array){return this.append(w.fromArray(e))}var r=this;if(r.car===t){if(e instanceof w){this.car=e.car;this.cdr=e.cdr}else{return e}}else{while(true){if(r instanceof w&&r.cdr!==m){r=r.cdr}else{break}}r.cdr=e}return this};function b(e,r){this.name=e;this.fn=r}b.prototype.invoke=function(e,r,n){var t=n.env,i=n.dynamic_scope,o=n.error;return this.fn.call(t,r,{dynamic_scope:i,error:o},e)};b.prototype.toString=function(){return"#<Macro "+this.name+">"};function _(e){if(e instanceof _){return e}if(typeof this!=="undefined"&&this.constructor!==_||typeof this==="undefined"){return new _(e)}if(!_.isNumber(e)){throw new Error("You can't create LNumber from "+r(e))}if(e===null){e=0}if(_.isFloat(e)){this.value=e}else if(typeof BigInt!=="undefined"){if(typeof e!=="bigint"){this.value=BigInt(e)}else{this.value=e}}else if(typeof n!=="undefined"&&!(e instanceof n)){this.value=new n(e)}else{this.value=e}}_.isFloat=function e(r){return Number(r)===r&&r%1!==0};_.isNumber=function(e){return e instanceof _||_.isNative(e)||_.isBN(e)};_.isNative=function(e){return typeof e==="bigint"||typeof e==="number"};_.isBN=function(e){return typeof n!=="undefined"&&e instanceof n};_.prototype.toString=function(){return this.value.toString()};_.prototype.valueOf=function(){if(_.isNative(this.value)){return Number(this.value)}else if(_.isBN(this.value)){return this.value.toNumber()}};_.prototype.coerce=function(e){if(e===null){e=0}var r;if(e instanceof _){r=e.value}else{r=e}if(_.isFloat(r)){}else if(typeof this.value==="bigint"&&typeof r!=="bigint"){r=BigInt(r)}else if(typeof n!=="undefined"&&this.value instanceof n&&!r instanceof n){r=new n(r)}return _(r)};_.prototype.add=function(e){e=this.coerce(e);if(_.isNative(e.value)){e.value=this.value+e.value}else if(_.isBN(this.value)){e.value.iadd(this.value)}return e};_.prototype.sub=function(e){e=this.coerce(e);if(_.isNative(e.value)){e.value=this.value-e.value}else if(_.isBN(this.value)){e.value.isub(this.value)}return e};_.prototype.mul=function(e){e=this.coerce(e);if(_.isNative(e.value)){e.value=this.value*e.value}else if(_.isBN(this.value)){e.value.imul(this.value)}return e};_.prototype.div=function(e){e=this.coerce(e);if(_.isNative(e.value)){e.value=this.value/e.value}else if(_.isBN(this.value)){e.value.idiv(this.value)}return e};_.prototype.mod=function(e){e=this.coerce(e);if(_.isNative(e.value)){e.value=this.value%e.value}else if(_.isBN(this.value)){e.value.imod(this.value)}return e};_.prototype.sqrt=function(){var e;if(_.isNative(this.value)){e=Math.sqrt(this.value)}else if(_.isBN(this.value)){e=this.value.sqrt()}return new _(e)};_.prototype.pow=function(e){e=this.coerce(e);if(_.isNative(this.value)){try{var r=new Function("a,b","return a**b;");e.value=r(this.value,e.value)}catch(e){throw new Error("Power operator not supported")}}else if(_.isBN(this.value)){e.value=this.value.pow(e.value)}else{e.value=Math.pow(this.value,e.value)}return e};_.prototype.neg=function(){var e=this.value;if(_.isNative(e)){e=-e}else if(_.isBN(e)){e=e.neg()}return new _(e)};_.prototype.abs=function(){var e=this.value;if(_.isNative(this.value)){if(e<0){e=-e}}else if(_.isBN(e)){e.iabs()}return new _(e)};_.prototype.isOdd=function(){if(_.isNative(this.value)){return this.value%2===1}else if(_.isBN(this.value)){return this.value.isOdd()}};_.prototype.isEven=function(){return!this.isOdd()};_.prototype.cmp=function(e){e=this.coerce(e);if(_.isNative(this.value)){if(this.value<e.value){return-1}else if(this.value===e.value){return 0}else{return 1}}else if(_.isBN(this.value)){return this.value.cmp(e.value)}};function x(e,r,n){this.env=e;this.parent=r;this.name=n}x.prototype.inherit=function(e,r){if(typeof e==="string"){r=e;e={}}if(!r){r="child of "+(this.name||"unknown")}return new x(e||{},this,r)};x.prototype.get=function(n){var t;if(n instanceof d){if(typeof this.env[n.name]!=="undefined"){t=this.env[n.name]}}else if(typeof n==="string"){if(typeof this.env[n]!=="undefined"){t=this.env[n]}}if(typeof t!=="undefined"){if(_.isNumber(t)){return _(t)}return t}if(this.parent instanceof x){return this.parent.get(n)}else{var i;if(n instanceof d){i=n.name}else if(typeof n==="string"){i=n}if(i){var o=r(e[i]);if(o==="function"){return e[i].bind(e)}else if(o!=="undefined"){return e[i]}}}throw new Error("Unbound variable `"+(i.name||i)+"'")};x.prototype.set=function(e,r){if(_.isNumber(r)){r=_(r)}if(e instanceof d){e=e.name}this.env[e]=r};function E(e){this.value=e}function N(e,r){this.value=e;this.count=r}N.prototype.toString=function(){return"<#unquote["+this.count+"] "+this.value+">"};function A(e){var r="let"+(e?"*":"");return new b(r,function(r,n){var t=n.dynamic_scope,i=n.error;var o=this;var a=this.get("list->array")(r.car);var u=this.inherit("let");return new Promise(function(n){var c=[];var f=0;(function s(){var l=a[f++];function h(e){if(e instanceof Promise){c.push(e);return e.then(h)}else{u.set(l.car,e)}}if(t){t=e?u:o}if(!l){var v=new w(new d("begin"),r.cdr);S(v,{env:u,dynamic_scope:t,error:i}).then(function(e){n(new E(e))})}else{var p=S(l.cdr.car,{env:e?u:o,dynamic_scope:t,error:i});var y=h(p);if(y instanceof Promise){y.then(function(){Promise.all(c).then(s)})}else{s()}}})()})})}var j=function(){var e=0;return function(){e++;return new d("#"+e)}}();function k(e){var r=arguments.length>1&&arguments[1]!==t?arguments[1]:"GET";var n=arguments.length>2&&arguments[2]!==t?arguments[2]:{};var i=arguments.length>3&&arguments[3]!==t?arguments[3]:null;var o=new XMLHttpRequest;o.open(r,e,true);Object.keys(n).forEach(function(e){o.setRequestHeader(e,n[e])});return new Promise(function(e){o.onreadystatechange=function(){if(o.readyState===4&&o.status===200){e(o.responseText)}};if(i!==null){o.send(i)}else{o.send()}})}var L=new x({nil:m,true:true,false:false,stdout:{write:function e(){var r;(r=console).log.apply(r,arguments)}},stdin:{read:function e(){return new Promise(function(e){e(prompt(""))})}},test:function e(){return Promise.resolve(t)},cons:function e(r,n){return new w(r,n)},car:function e(r){if(r instanceof w){return r.car}else{throw new Error("argument to car need to be a list")}},cdr:function e(r){if(r instanceof w){return r.cdr}else{throw new Error("argument to cdr need to be a list")}},set:new b("set",function(e){var r=arguments.length>1&&arguments[1]!==t?arguments[1]:{},n=r.dynamic_scope,i=r.error;var o;if(e.cdr.car instanceof w){if(n){n=this}o=S(e.cdr.car,{env:this,dynamic_scope:n,error:i})}else{o=e.cdr.car}this.set(e.car,o)}),"set-car":function e(r,n){r.car=n},"set-cdr":function e(r,n){r.cdr=n},assoc:function e(r,n){var t=r;var i=n instanceof d?n.name:n;while(true){var o=t.car.car;if(o instanceof d&&o.name===i||o.name===i){return t.car}else{t=t.cdr}}},gensym:j,load:function e(r){var n=this;k(r).then(function(e){n.get("eval")(n.get("read")(e))})},while:new b("while",function(){var e=s(u.mark(function e(r,n){var t,i,o,a,c,f;return u.wrap(function e(u){while(1){switch(u.prev=u.next){case 0:t=n.dynamic_scope,i=n.error;o=this;a=new w(new d("begin"),r.cdr);if(t){t=o}case 4:u.next=7;return S(r.car,{env:o,dynamic_scope:t,error:i});case 7:f=u.sent;if(!f){u.next=14;break}u.next=11;return S(a,{env:o,dynamic_scope:t,error:i});case 11:c=u.sent;u.next=15;break;case 14:return u.abrupt("return",c);case 15:u.next=4;break;case 17:case"end":return u.stop()}}},e,this)}));return function(r,n){return e.apply(this,arguments)}}()),if:new b("if",function(e){var r=arguments.length>1&&arguments[1]!==t?arguments[1]:{},n=r.dynamic_scope,i=r.error;if(n){n=this}var o=this;var a=function r(t){if(t){var a=S(e.cdr.car,{env:o,dynamic_scope:n,error:i});if(typeof a==="undefined"){return}return a}else if(e.cdr.cdr.car instanceof w){var u=S(e.cdr.cdr.car,{env:o,dynamic_scope:n,error:i});if(typeof u==="undefined"){return false}return u}else{return false}};var u=S(e.car,{env:o,dynamic_scope:n,error:i});if(u instanceof Promise){return u.then(a)}else{return a(u)}}),"let*":A(true),let:A(false),begin:new b("begin",function(){var e=s(u.mark(function e(r,n){var t,i,o,a;return u.wrap(function e(u){while(1){switch(u.prev=u.next){case 0:t=n.dynamic_scope,i=n.error;o=this.get("list->array")(r);if(t){t=this}case 3:if(!o.length){u.next=11;break}r=o.shift();u.next=8;return S(r,{env:this,dynamic_scope:t,error:i});case 8:a=u.sent;u.next=12;break;case 11:return u.abrupt("return",a);case 12:u.next=3;break;case 14:case"end":return u.stop()}}},e,this)}));return function(r,n){return e.apply(this,arguments)}}()),timer:new b("timer",function(e){var r=arguments.length>1&&arguments[1]!==t?arguments[1]:{},n=r.dynamic_scope,i=r.error;var o=this;if(n){n=this}return new Promise(function(r){setTimeout(function(){r(new E(S(e.cdr,{env:o,dynamic_scope:n,error:i})))},e.car)})}),define:new b("define",function(e){var r=this;var n=arguments.length>1&&arguments[1]!==t?arguments[1]:{},i=n.dynamic_scope,o=n.error;if(e.car instanceof w&&e.car.car instanceof d){var a=new w(new d("define"),new w(e.car.car,new w(new w(new d("lambda"),new w(e.car.cdr,e.cdr)))));return a}var u=e.cdr.car;if(u instanceof w){u=S(u,{env:this,dynamic_scope:i,error:o})}if(e.car instanceof d){if(u instanceof Promise){return u.then(function(n){r.set(e.car,n)})}else{this.set(e.car,u)}}}),"set-obj":function e(r,n,t){r[n]=t},eval:function e(r){var n=this;if(r instanceof w){return S(r,{env:this,dynamic_scope:this,error:function e(r){return n.get("print")(r.message)}})}if(r instanceof Array){var t;r.forEach(function(e){t=S(e,{env:n,dynamic_scope:n,error:function e(r){return n.get("print")(r.message)}})});return t}},lambda:new b("lambda",function(e){var r=arguments.length>1&&arguments[1]!==t?arguments[1]:{},n=r.dynamic_scope,i=r.error;var o=this;return function(){var r=(n?this:o).inherit("lambda");var t=e.car;var a=0;var u;if(t instanceof d||!t.isEmptyList()){for(var c=arguments.length,f=new Array(c),s=0;s<c;s++){f[s]=arguments[s]}while(true){if(t.car!==m){if(t instanceof d){u=w.fromArray(f.slice(a));r.env[t.name]=u;break}else{if(typeof f[a]==="undefined"){u=m}else{u=f[a]}r.env[t.car.name]=u}}if(t.cdr===m){break}a++;t=t.cdr}}if(n){n=r}return S(e.cdr.car,{env:r,dynamic_scope:n,error:i})}}),defmacro:new b("defmacro",function(e){var r=arguments.length>1&&arguments[1]!==t?arguments[1]:{},n=r.dynamic_scope,i=r.error;if(e.car.car instanceof d){this.env[e.car.car.name]=new b(function(r){var t=new x({},this,"defmacro");var o=e.car.cdr;var a=r;while(true){if(o.car!==m&&a.car!==m){t.env[o.car.name]=a.car}if(o.cdr===m){break}a=a.cdr;o=o.cdr}if(n){n=t}return S(e.cdr.car,{env:t,dynamic_scope:n,error:i})})}}),quote:new b("quote",function(e){return new E(e.car)}),quasiquote:new b("quasiquote",function(e){var r=arguments.length>1&&arguments[1]!==t?arguments[1]:{},n=r.dynamic_scope,i=r.error;var o=this;var a=0;if(n){n=o}function u(e){if(e instanceof w){var r;if(d.is(e.car.car,"unquote-splicing")){r=S(e.car.cdr.car,{env:o,dynamic_scope:n,error:i});if(!r instanceof w){throw new Error("Value of unquote-splicing need"+" to be pair")}if(e.cdr instanceof w){if(r instanceof w){r.cdr.append(u(e.cdr))}else{r=new w(r,u(e.cdr))}}return r}if(d.is(e.car,"unquote")){var t=e.cdr;var c=t;var f=c;var s=1;while(d.is(c.car.car,"unquote")){f=c;s++;c=c.car.cdr.car}if(s>a){a=s}if(f===c){if(e.cdr.cdr!==m){return new w(new N(e.cdr.car,s),e.cdr.cdr)}else{return new N(e.cdr.car,s)}}else if(f.cdr.cdr!==m){f.car.cdr=new w(new N(c,s),f.cdr===m?m:f.cdr.cdr)}else{f.car.cdr=new N(c,s)}return t.car}var l=e.car;if(l instanceof w){l=u(l)}var h=e.cdr;if(h instanceof w){h=u(h)}return new w(l,h)}return e}function c(e){if(e instanceof N){if(a===e.count){return S(e.value,{env:o})}else{return new w(new d("unquote"),new w(c(e.value),m))}}if(e instanceof w){var r=e.car;if(r instanceof w||r instanceof N){r=c(r)}var n=e.cdr;if(n instanceof w||n instanceof N){n=c(n)}return new w(r,n)}return e}return new E(c(u(e.car)))}),clone:function e(r){return r.clone()},append:function e(r,n){return this.get("append!")(r.clone(),n)},"append!":function e(r,n){return r.append(n)},list:function e(){return w.fromArray([].slice.call(arguments))},concat:function e(){return[].join.call(arguments,"")},join:function e(r,n){return this.get("list->array")(n).join(r)},split:function e(r,n){return this.get("array->list")(r.split(n))},replace:function e(r,n,t){return r.replace(n,t)},match:function e(r,n){return this.get("array->list")(r.match(n))},search:function e(r,n){return r.search(n)},string:function e(n){if(typeof jQuery!=="undefined"&&n instanceof jQuery.fn.init){return"<#jQuery>"}if(n instanceof _){return n.value.toString()}if(typeof n==="undefined"){return"<#undefined>"}if(typeof n==="function"){return"<#function>"}if(n===m){return"nil"}if(n instanceof Array||n===null){return JSON.stringify(n)}if(n instanceof w){return n.toString()}if(r(n)==="object"){var t=n.constructor.name;if(t!==""){return"<#"+t+">"}return"<#Object>"}if(typeof n!=="string"){return n.toString()}return n},env:function e(r){r=r||this;var n=Object.keys(r.env);var i;if(n.length){i=w.fromArray(n)}else{i=m}if(r.parent!==t){return this.get("env").call(this,r.parent).append(i)}return i},".":function e(r,n){var t=n instanceof d?n.name:n;var i=r[t];if(typeof i==="function"){return i.bind(r)}return i},type:function e(n){return r(n)},instanceof:function e(r,n){return r instanceof n},read:function e(r){var n=this;if(typeof r==="string"){return v(f(r))}return this.get("stdin").read().then(function(e){return n.get("read").call(n,e)})},print:function e(){var r,n=this;for(var t=arguments.length,i=new Array(t),o=0;o<t;o++){i[o]=arguments[o]}(r=this.get("stdout")).write.apply(r,g(i.map(function(e){return n.get("string")(e)})))},flatten:function e(r){return r.flatten()},"array->list":function e(r){return w.fromArray(r)},"list->array":function e(r){if(r instanceof w&&r.isEmptyList()){return[]}var n=[];var t=r;while(true){if(t instanceof w){n.push(t.car);t=t.cdr}else{break}}return n},filter:function e(r,n){return w.fromArray(this.get("list->array")(n).filter(r))},apply:new b("apply",function(e){var r=this;var n=arguments.length>1&&arguments[1]!==t?arguments[1]:{},i=n.dynamic_scope,o=n.error;if(i){i=this}var a=S(e.car,{env:this,dynamic_scope:i,error:o});if(typeof a!=="function"){var u;if(e.car instanceof d){u="Variable `"+e.car.name+"' is not a function"}else{u="Expression `"+e.car.toString()+"' is not a function"}throw new Error(u)}var c=S(e.cdr.car,{env:this,dynamic_scope:i,error:o});c=this.get("list->array")(c);if(c.filter(function(e){return e instanceof Promise}).length){return Promise.all(c).then(function(e){return a.apply(r,e)})}else{return a.apply(this,c)}}),map:function e(r,n){var t=this.get("list->array")(n).map(r);if(t.length){return w.fromArray(t)}else{return m}},reduce:function e(r,n){var i=arguments.length>2&&arguments[2]!==t?arguments[2]:null;var o=this.get("list->array")(n);if(i===null){return o.slice(1).reduce(function(e,n){return r(e,n)},o[0])}else{return o.reduce(function(e,n){return r(e,n)},i)}},curry:function e(r){for(var n=arguments.length,t=new Array(n>1?n-1:0),i=1;i<n;i++){t[i-1]=arguments[i]}var o=r.length;return function(){var e=t.slice();function n(){for(var t=arguments.length,i=new Array(t),a=0;a<t;a++){i[a]=arguments[a]}e=e.concat(i);if(e.length>=o){return r.apply(this,e)}else{return n}}return n.apply(this,arguments)}},odd:function e(r){return _(r).isOdd()},even:function e(r){return _(r).isEvent()},range:function e(r){if(r instanceof _){r=r.valueOf()}return w.fromArray(new Array(r).fill(0).map(function(e,r){return _(r)}))},"*":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){return _(e).mul(r)})}},"+":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){if(_.isNumber(e)&&_.isNumber(r)){return _(e).add(r)}else if(typeof e==="string"){throw new Error("To concatenate strings use `concat`")}return e+r})}},"-":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length===1){return _(n[0]).neg()}if(n.length){return n.reduce(function(e,r){return _(e).sub(r)})}},"/":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){return _(e).div(r)})}},abs:function e(r){return _(r).abs()},sqrt:function e(r){if(r instanceof _){return Math.sqrt(r.valueOf())}return Math.sqrt(r)},"**":function e(r,n){return _(r).pow(n)},"1+":function e(r){return _(r).add(1)},"1-":function e(r){return _(r).sub(1)},"++":new b("++",function(e){var r=this.get(e.car);var n=_(r).add(1);this.set(e.car,n);return n}),"--":new b("--",function(e){var r=this.get(e.car);var n=_(r).sub(1);this.set(e.car,n);return n}),"%":function e(r,n){return _(r).mod(n)},"==":function e(r,n){return _(r).cmp(n)===0},">":function e(r,n){return _(r).cmp(n)===1},"<":function e(r,n){return _(r).cmp(n)===-1},"<=":function e(r,n){return[0,-1].includes(_(r).cmp(n))},">=":function e(r,n){[0,1].includes(_(r).cmp(n))},"eq?":function e(r,n){return r===n},or:new b("or",function(e){var r=arguments.length>1&&arguments[1]!==t?arguments[1]:{},n=r.dynamic_scope,i=r.error;var o=this.get("list->array")(e);var a=this;if(n){n=a}return new Promise(function(e){var r;(function t(){function u(n){r=n;if(r){e(n)}t()}var c=o.shift();if(typeof c==="undefined"){if(r){e(r)}else{e(false)}}else{var f=S(c,{env:a,dynamic_scope:n,error:i});if(f instanceof Promise){f.then(u)}else{u(f)}}})()})}),and:new b("and",function(e){var r=arguments.length>1&&arguments[1]!==t?arguments[1]:{},n=r.dynamic_scope,i=r.error;var o=this.get("list->array")(e);var a=this;if(n){n=a}return new Promise(function(e){var r;(function t(){function u(n){r=n;if(!r){e(false)}t()}var c=o.shift();if(typeof c==="undefined"){if(r){e(r)}else{e(false)}}else{var f=S(c,{env:a,dynamic_scope:n,error:i});if(f instanceof Promise){f.then(u)}else{u(f)}}})()})}),not:function e(r){if(r===m){return true}return!r},"->":function e(r,n){for(var t=arguments.length,i=new Array(t>2?t-2:0),o=2;o<t;o++){i[o-2]=arguments[o]}return r[n].apply(r,i)}},t,"global");function O(e){if(e.length===1){return e[0]}else{var r=[];var n=O(e.slice(1));for(var t=0;t<n.length;t++){for(var i=0;i<e[0].length;i++){r.push(e[0][i]+n[t])}}return r}}function P(e,r,n){var t=[];for(var i=r;i<=n;++i){var o=[];for(var a=0;a<i;++a){o.push(e)}t=t.concat(O(o))}return t}P(["d","a"],2,5).forEach(function(e){var r=e.split("").reverse();L.set("c"+e+"r",function(e){return r.reduce(function(e,r){if(r==="a"){return e.car}else{return e.cdr}},e)})});if(typeof global!=="undefined"){L.set("global",global)}else if(typeof window!=="undefined"){L.set("window",window)}function S(e){var r=arguments.length>1&&arguments[1]!==t?arguments[1]:{},n=r.env,i=r.dynamic_scope,o=r.error,a=o===void 0?function(){}:o;try{if(i===true){n=i=n||L}else if(n===true){n=i=L}else{n=n||L}var u;if(typeof e==="undefined"){return}var c=e.car;var f=e.cdr;if(c instanceof w){u=S(c,{env:n,dynamic_scope:i,error:a});if(u instanceof Promise){return u.then(function(r){return S(new w(r,e.cdr),{env:n,dynamic_scope:i,error:a})})}else if(typeof u!=="function"){throw new Error(n.get("string")(u)+" is not a function")}}if(c instanceof d){u=n.get(c);if(u instanceof b){u=u.invoke(c,f,{env:n,dynamic_scope:i,error:a});if(u instanceof E){return u.value}else if(u instanceof Promise){return u.then(function(e){if(e instanceof E){return e.value}return S(e,{env:n,dynamic_scope:i,error:a})})}return S(u,{env:n,dynamic_scope:i,error:a})}else if(typeof u!=="function"){throw new Error("Unknown function `"+c.name+"'")}}else if(typeof c==="function"){u=c}if(typeof u==="function"){var s=[];var l=f;while(true){if(l instanceof w){s.push(S(l.car,{env:n,dynamic_scope:i,error:a}));l=l.cdr}else{break}}var h=s.filter(function(e){return e instanceof Promise});if(h.length){return Promise.all(s).then(function(e){return u.apply(i||n,e)})}return u.apply(i||n,s)}else if(e instanceof d){u=n.get(e);if(u==="undefined"){throw new Error("Unbound variable `"+e.name+"'")}return u}else{return e}}catch(e){a&&a(e)}}function q(e,r,n){if(n===true){r=n=r||L}else if(r===true){r=n=L}else{r=r||L}var t=v(f(e));return new Promise(function(e,i){var o=[];(function a(){function u(e){o.push(e);a()}var c=t.shift();if(!c){e(o)}else{try{var f=S(c,{env:r,dynamic_scope:n,error:function e(r){return i(r)}})}catch(e){return i(e)}if(f instanceof Promise){f.then(u).catch(i)}else{u(f)}}})()})}function B(e){var r=/[()]/;var n=f(e).filter(function(e){return e.match(r)});var t=n.filter(function(e){return e===")"});var i=n.filter(function(e){return e==="("});return t.length===i.length}w.unDry=function(e){return new w(e.car,e.cdr)};w.prototype.toDry=function(){return{value:{car:this.car,cdr:this.cdr}}};y.prototype.toDry=function(){return{value:null}};y.unDry=function(){return m};d.prototype.toDry=function(){return{value:{name:this.name}}};d.unDry=function(e){return new d(e.name)};function R(){var e="text-x/lips";if(window.document){Array.from(document.querySelectorAll("script")).forEach(function(r){var n=r.getAttribute("type");if(n===e){q(r.innerHTML)}else if(n==="text-x/lisp"){console.warn("Expecting "+e+" found "+n)}})}}function F(e){if(typeof window!=="undefined"){if(window.addEventListener){window.addEventListener("load",e,false)}else if(window.attachEvent){window.attachEvent("onload",e)}else if(typeof window.onload==="function"){(function(r){window.onload=function(){e();r()}})(window.onload)}else{window.onload=e}}}F(function(){setTimeout(R,0)});return{version:"DEV",exec:q,parse:v,tokenize:f,evaluate:S,Environment:x,global_environment:L,balanced_parenthesis:B,Macro:b,Quote:E,Pair:w,nil:m,Symbol:d,LNumber:_}})})();