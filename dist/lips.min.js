/**@license
 * LIPS is Pretty Simple - simple scheme like lisp in JavaScript - v. 0.8.1
 *
 * Copyright (c) 2018-2019 Jakub T. Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 * includes unfetch by Jason Miller (@developit) MIT License
 *
 * build: Thu, 04 Apr 2019 10:04:19 +0000
 */
(function(){"use strict";function n(e){if(Array.isArray(e))return e}function t(e,r){var n=[];var t=true;var i=false;var o=undefined;try{for(var a=e[Symbol.iterator](),c;!(t=(c=a.next()).done);t=true){n.push(c.value);if(r&&n.length===r)break}}catch(e){i=true;o=e}finally{try{if(!t&&a["return"]!=null)a["return"]()}finally{if(i)throw o}}return n}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function Q(e,r){return n(e)||t(e,r)||i()}function o(e,r){o=Object.setPrototypeOf||function e(r,n){r.__proto__=n;return r};return o(e,r)}function a(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function Y(e,r,n){if(a()){Y=Reflect.construct}else{Y=function e(r,n,t){var i=[null];i.push.apply(i,n);var o=Function.bind.apply(r,i);var a=new o;if(t)setPrototypeOf(a,t.prototype);return a}}return Y.apply(null,arguments)}function e(e,r){return r={exports:{}},e(r,r.exports),r.exports}var r=e(function(e){var r=function(o){var e=Object.prototype;var f=e.hasOwnProperty;var u;var r=typeof Symbol==="function"?Symbol:{};var i=r.iterator||"@@iterator";var n=r.asyncIterator||"@@asyncIterator";var t=r.toStringTag||"@@toStringTag";function a(e,r,n,t){var i=r&&r.prototype instanceof c?r:c;var o=Object.create(i.prototype);var a=new j(t||[]);o._invoke=_(e,n,a);return o}o.wrap=a;function s(e,r,n){try{return{type:"normal",arg:e.call(r,n)}}catch(e){return{type:"throw",arg:e}}}var l="suspendedStart";var h="suspendedYield";var p="executing";var v="completed";var d={};function c(){}function y(){}function m(){}var w={};w[i]=function(){return this};var g=Object.getPrototypeOf;var b=g&&g(g(P([])));if(b&&b!==e&&f.call(b,i)){w=b}var x=m.prototype=c.prototype=Object.create(w);y.prototype=x.constructor=m;m.constructor=y;m[t]=y.displayName="GeneratorFunction";function k(e){["next","throw","return"].forEach(function(r){e[r]=function(e){return this._invoke(r,e)}})}o.isGeneratorFunction=function(e){var r=typeof e==="function"&&e.constructor;return r?r===y||(r.displayName||r.name)==="GeneratorFunction":false};o.mark=function(e){if(Object.setPrototypeOf){Object.setPrototypeOf(e,m)}else{e.__proto__=m;if(!(t in e)){e[t]="GeneratorFunction"}}e.prototype=Object.create(x);return e};o.awrap=function(e){return{__await:e}};function E(c){function u(e,r,n,t){var i=s(c[e],c,r);if(i.type==="throw"){t(i.arg)}else{var o=i.arg;var a=o.value;if(a&&typeof a==="object"&&f.call(a,"__await")){return Promise.resolve(a.__await).then(function(e){u("next",e,n,t)},function(e){u("throw",e,n,t)})}return Promise.resolve(a).then(function(e){o.value=e;n(o)},function(e){return u("throw",e,n,t)})}}var r;function e(n,t){function e(){return new Promise(function(e,r){u(n,t,e,r)})}return r=r?r.then(e,e):e()}this._invoke=e}k(E.prototype);E.prototype[n]=function(){return this};o.AsyncIterator=E;o.async=function(e,r,n,t){var i=new E(a(e,r,n,t));return o.isGeneratorFunction(r)?i:i.next().then(function(e){return e.done?e.value:i.next()})};function _(a,c,u){var f=l;return function e(r,n){if(f===p){throw new Error("Generator is already running")}if(f===v){if(r==="throw"){throw n}return L()}u.method=r;u.arg=n;while(true){var t=u.delegate;if(t){var i=A(t,u);if(i){if(i===d)continue;return i}}if(u.method==="next"){u.sent=u._sent=u.arg}else if(u.method==="throw"){if(f===l){f=v;throw u.arg}u.dispatchException(u.arg)}else if(u.method==="return"){u.abrupt("return",u.arg)}f=p;var o=s(a,c,u);if(o.type==="normal"){f=u.done?v:h;if(o.arg===d){continue}return{value:o.arg,done:u.done}}else if(o.type==="throw"){f=v;u.method="throw";u.arg=o.arg}}}}function A(e,r){var n=e.iterator[r.method];if(n===u){r.delegate=null;if(r.method==="throw"){if(e.iterator["return"]){r.method="return";r.arg=u;A(e,r);if(r.method==="throw"){return d}}r.method="throw";r.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var t=s(n,e.iterator,r.arg);if(t.type==="throw"){r.method="throw";r.arg=t.arg;r.delegate=null;return d}var i=t.arg;if(!i){r.method="throw";r.arg=new TypeError("iterator result is not an object");r.delegate=null;return d}if(i.done){r[e.resultName]=i.value;r.next=e.nextLoc;if(r.method!=="return"){r.method="next";r.arg=u}}else{return i}r.delegate=null;return d}k(x);x[t]="Generator";x[i]=function(){return this};x.toString=function(){return"[object Generator]"};function S(e){var r={tryLoc:e[0]};if(1 in e){r.catchLoc=e[1]}if(2 in e){r.finallyLoc=e[2];r.afterLoc=e[3]}this.tryEntries.push(r)}function N(e){var r=e.completion||{};r.type="normal";delete r.arg;e.completion=r}function j(e){this.tryEntries=[{tryLoc:"root"}];e.forEach(S,this);this.reset(true)}o.keys=function(n){var t=[];for(var e in n){t.push(e)}t.reverse();return function e(){while(t.length){var r=t.pop();if(r in n){e.value=r;e.done=false;return e}}e.done=true;return e}};function P(r){if(r){var e=r[i];if(e){return e.call(r)}if(typeof r.next==="function"){return r}if(!isNaN(r.length)){var n=-1,t=function e(){while(++n<r.length){if(f.call(r,n)){e.value=r[n];e.done=false;return e}}e.value=u;e.done=true;return e};return t.next=t}}return{next:L}}o.values=P;function L(){return{value:u,done:true}}j.prototype={constructor:j,reset:function(e){this.prev=0;this.next=0;this.sent=this._sent=u;this.done=false;this.delegate=null;this.method="next";this.arg=u;this.tryEntries.forEach(N);if(!e){for(var r in this){if(r.charAt(0)==="t"&&f.call(this,r)&&!isNaN(+r.slice(1))){this[r]=u}}}},stop:function(){this.done=true;var e=this.tryEntries[0];var r=e.completion;if(r.type==="throw"){throw r.arg}return this.rval},dispatchException:function(n){if(this.done){throw n}var t=this;function e(e,r){o.type="throw";o.arg=n;t.next=e;if(r){t.method="next";t.arg=u}return!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];var o=i.completion;if(i.tryLoc==="root"){return e("end")}if(i.tryLoc<=this.prev){var a=f.call(i,"catchLoc");var c=f.call(i,"finallyLoc");if(a&&c){if(this.prev<i.catchLoc){return e(i.catchLoc,true)}else if(this.prev<i.finallyLoc){return e(i.finallyLoc)}}else if(a){if(this.prev<i.catchLoc){return e(i.catchLoc,true)}}else if(c){if(this.prev<i.finallyLoc){return e(i.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(e,r){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc<=this.prev&&f.call(t,"finallyLoc")&&this.prev<t.finallyLoc){var i=t;break}}if(i&&(e==="break"||e==="continue")&&i.tryLoc<=r&&r<=i.finallyLoc){i=null}var o=i?i.completion:{};o.type=e;o.arg=r;if(i){this.method="next";this.next=i.finallyLoc;return d}return this.complete(o)},complete:function(e,r){if(e.type==="throw"){throw e.arg}if(e.type==="break"||e.type==="continue"){this.next=e.arg}else if(e.type==="return"){this.rval=this.arg=e.arg;this.method="return";this.next="end"}else if(e.type==="normal"&&r){this.next=r}return d},finish:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.finallyLoc===e){this.complete(n.completion,n.afterLoc);N(n);return d}}},catch:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc===e){var t=n.completion;if(t.type==="throw"){var i=t.arg;N(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){this.delegate={iterator:P(e),resultName:r,nextLoc:n};if(this.method==="next"){this.arg=u}return d}};return o}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}});var V=r;function u(e,r,n,t,i,o,a){try{var c=e[o](a);var u=c.value}catch(e){n(e);return}if(c.done){r(u)}else{Promise.resolve(u).then(t,i)}}function z(c){return function(){var e=this,a=arguments;return new Promise(function(r,n){var t=c.apply(e,a);function i(e){u(t,r,n,i,o,"next",e)}function o(e){u(t,r,n,i,o,"throw",e)}i(undefined)})}}function c(e){if(Array.isArray(e)){for(var r=0,n=new Array(e.length);r<e.length;r++){n[r]=e[r]}return n}}function f(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function X(e){return c(e)||f(e)||s()}function l(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){l=function e(r){return typeof r}}else{l=function e(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r}}return l(e)}function K(e){if(typeof Symbol==="function"&&l(Symbol.iterator)==="symbol"){K=function e(r){return l(r)}}else{K=function e(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":l(r)}}return K(e)}
/**@license
 * LIPS is Pretty Simple - simple scheme like lisp in JavaScript
 *
 * Copyright (c) 2018-2019 Jakub T. Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 */
/**@license
 * LIPS is Pretty Simple - simple scheme like lisp in JavaScript
 *
 * Copyright (c) 2018-2019 Jakub T. Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 */
(function(r,n){if(typeof define==="function"&&define.amd){define(["bn.js"],function(e){return r.lips=n(r,e)})}else if((typeof module==="undefined"?"undefined":K(module))==="object"&&module.exports){module.exports=n(r,require("bn.js"))}else{r.lips=n(r,r.BN)}})(typeof window!=="undefined"?window:global,function(o,n,h){if(!o.fetch){o.fetch=function(i,o){o=o||{};return new Promise(function(e,r){var n=new XMLHttpRequest;n.open(o.method||"get",i,true);for(var t in o.headers){n.setRequestHeader(t,o.headers[t])}n.withCredentials=o.credentials=="include";n.onload=function(){e(c())};n.onerror=r;n.send(o.body||null);function c(){var t=[],i=[],o={},a;n.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,r,n){t.push(r=r.toLowerCase());i.push([r,n]);a=o[r];o[r]=a?"".concat(a,",").concat(n):n});return{ok:(n.status/100|0)==2,status:n.status,statusText:n.statusText,url:n.responseURL,clone:c,text:function e(){return Promise.resolve(n.responseText)},json:function e(){return Promise.resolve(n.responseText).then(JSON.parse)},blob:function e(){return Promise.resolve(new Blob([n.response]))},headers:{keys:function e(){return t},entries:function e(){return i},get:function e(r){return o[r.toLowerCase()]},has:function e(r){return r.toLowerCase()in o}}}}})}}var t=/^\/((?:\\\/|[^/]|\[[^\]]*\/[^\]]*\])+)\/([gimy]*)$/;var i=/^[-+]?[0-9]+([eE][-+]?[0-9]+)?$/;var a=/^([-+]?((\.[0-9]+|[0-9]+\.[0-9]+)([eE][-+]?[0-9]+)?)|[0-9]+\.)$/;function d(e){function r(e){if(e.match(/^['"]/)){if(e==='""'||e==="''"){return""}var r=e[0];var n=new RegExp("((^|[^\\\\])(?:\\\\\\\\)*)"+r,"g");e=e.replace(n,"$1")}return JSON.parse('"'+e.replace(/\n/g,"\\n")+'"')}var n=e.match(t);if(n){return new RegExp(n[1],n[2])}else if(e.match(/['"]/)){return r(e)}else if(e.match(i)){return N(parseFloat(e))}else if(e.match(a)){return N(parseFloat(e),true)}else if(e==="nil"){return w}else if(e==="true"){return true}else if(e==="false"){return false}else{return new m(e)}}var c=/("(?:\\[\S\s]|[^"])*"|\/(?! )[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|;.*)/g;var u=/("(?:\\[\S\s]|[^"])*"|\/(?! )[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|\(|\)|'|"(?:\\[\S\s]|[^"])+|(?:\\[\S\s]|[^"])*"|;.*|(?:[-+]?(?:(?:\.[0-9]+|[0-9]+\.[0-9]+)(?:[eE][-+]?[0-9]+)?)|[0-9]+\.)[0-9]|\.|,@|,|`|[^(\s)]+)/gim;function f(e){var i=0;var o=0;var a=[];e.split(c).filter(Boolean).forEach(function(e){if(e.match(c)){if(!e.match(/^;/)){var r=(e.split(/\n/),[""]).pop().length;a.push({token:e,col:r,offset:i,line:o});i+=e.length}o+=(e.match("\n")||[]).length;return}e.split("\n").filter(Boolean).forEach(function(e,n){var t=0;e.split(u).filter(Boolean).forEach(function(e){var r={col:t,line:n+o,token:e,offset:i};t+=e.length;i+=e.length;a.push(r)})})});return a}function s(e,r){if(r){return f(e)}else{return f(e).map(function(e){return e.token.trim()}).filter(function(e){return e&&!e.match(/^;/)})}}var y={"'":new m("quote"),"`":new m("quasiquote"),",":new m("unquote"),",@":new m("unquote-splicing")};function l(e){var o=[];var a=[];var c=null;var u=Object.keys(y);var r=u.map(function(e){return y[e].name});var f=0;var s=false;var l=[];var h=[];var p=0;function v(){var e=o[o.length-1];if(e instanceof Array&&e[0]instanceof m&&r.includes(e[0].name)&&o.length>1){o.pop();if(o[o.length-1].length===1&&o[o.length-1][0]instanceof m){o[o.length-1].push(e)}else if(o[o.length-1].length===0){o[o.length-1]=e}else if(o[o.length-1]instanceof g){if(o[o.length-1].cdr instanceof g){o[o.length-1]=new g(o[o.length-1],g.fromArray(e))}else{o[o.length-1].cdr=g.fromArray(e)}}else{o[o.length-1].push(e)}}}e.forEach(function(e){var r=o[o.length-1];if(u.indexOf(e)!==-1){p++;c=e;o.push([y[c]]);if(!c){h=[]}h.push(c)}else if(e==="("){s=true;f++;if(c){l.push(h);h=[]}o.push([]);c=null;p=0}else if(e==="."&&!s){o[o.length-1]=g.fromArray(r)}else if(e===")"){f--;if(!o.length){throw new Error("Unbalanced parenthesis 1")}if(o.length===1){a.push(o.pop())}else if(o.length>1){var n=o.pop();r=o[o.length-1];if(r instanceof Array){r.push(n)}else if(r instanceof g){r.append(g.fromArray(n))}if(l.length){h=l.pop();while(h.length){v();h.pop()}}else{v()}}if(f===0&&o.length){a.push(o.pop())}}else{s=false;var t=d(e);if(c){while(p--){o[o.length-1][1]=t;t=o.pop()}p=0;c=false}r=o[o.length-1];if(r instanceof g){var i=r;while(true){if(i.cdr===w){if(t instanceof Array){i.cdr=g.fromArray(t)}else{i.cdr=t}break}else{i=i.cdr}}}else if(!o.length){a.push(t)}else{r.push(t)}}});if(o.length){console.log({end:o.slice()});throw new Error("Unbalanced parenthesis 2")}return a.map(function(e){if(e instanceof Array){return g.fromArray(e)}return e})}function e(e,r){var n=Object.prototype.toString;var t="[object Array]";var i=[];var o=r&&e||e.slice();var a;if(!e.length){return i}a=o.pop();do{if(n.call(a)===t){o.push.apply(o,a)}else{i.push(a)}}while(o.length&&(a=o.pop())!==h);i.reverse();return i}function r(e){return K(e)==="symbol"||K(e)==="object"&&Object.prototype.toString.call(e)==="[object Symbol]"}function m(e){if(typeof this!=="undefined"&&this.constructor!==m||typeof this==="undefined"){return new m(e)}this.name=e}m.is=function(e,r){return e instanceof m&&typeof r==="string"&&e.name===r};m.prototype.toJSON=m.prototype.toString=function(){if(r(this.name)){return this.name.toString()}return this.name};function p(){}p.prototype.toString=function(){return"nil"};var w=new p;function g(e,r){if(typeof this!=="undefined"&&this.constructor!==g||typeof this==="undefined"){return new g(e,r)}this.car=e;this.cdr=r}function v(){return new g(h,w)}g.prototype.flatten=function(){return g.fromArray(e(this.toArray()))};g.prototype.length=function(){if(x(this)){return 0}var e=0;var r=this;while(true){if(!r||r===w||!(r instanceof g)){break}e++;r=r.cdr}return e};g.prototype.clone=function(){var e=this.cdr;var r=this.car;if(r instanceof g){r=r.clone()}if(e instanceof g){e=this.cdr.clone()}return new g(r,e)};g.prototype.toArray=function(){if(this.isEmptyList()){return[]}var e=[];if(this.car instanceof g){e.push(this.car.toArray())}else{e.push(this.car)}if(this.cdr instanceof g){e=e.concat(this.cdr.toArray())}return e};g.prototype.isEmptyList=function(){return typeof this.car==="undefined"&&this.cdr===w};g.fromArray=function(e){if(e instanceof g){return e}if(e.length&&!(e instanceof Array)){e=X(e)}if(e.length===0){return v()}else{var r;if(e[0]instanceof Array){r=g.fromArray(e[0])}else{r=e[0]}if(e.length===1){return new g(r,w)}else{return new g(r,g.fromArray(e.slice(1)))}}};g.prototype.toObject=function(){var e=this;var r={};while(true){if(e instanceof g&&e.car instanceof g){var n=e.car;var t=n.car;if(t instanceof m){t=t.name}var i=n.cdr;if(i instanceof g){i=i.toObject()}r[t]=i;e=e.cdr}else{break}}return r};g.fromPairs=function(e){return e.reduce(function(e,r){return new g(new g(new m(r[0]),r[1]),e)},w)};g.fromObject=function(r){var e=Object.keys(r).map(function(e){return[e,r[e]]});return g.fromPairs(e)};g.prototype.reduce=function(e){var r=this;var n=w;while(true){if(r!==w){n=e(n,r.car);r=r.cdr}else{break}}return n};g.prototype.reverse=function(){var e=this;var r=w;while(e!==w){var n=e.cdr;e.cdr=r;r=e;e=n}return r};g.prototype.transform=function(t){function i(e){if(e instanceof g){if(e.replace){delete e.replace;return e}var r=t(e.car);if(r instanceof g){r=i(r)}var n=t(e.cdr);if(n instanceof g){n=i(n)}return new g(r,n)}return e}return i(this)};g.prototype.map=function(e){if(typeof this.car!=="undefined"){return new g(e(this.car),x(this.cdr)?w:this.cdr.map(e))}else{return w}};g.prototype.toString=function(){var e=["("];if(this.car!==h){if(typeof this.car==="function"){e.push("<#function "+(this.car.name||"anonymous")+">")}else if(typeof this.car==="string"){e.push(JSON.stringify(this.car))}else if(this.car instanceof m){e.push(this.car.toString())}else if(typeof this.car!=="undefined"){e.push(this.car)}if(this.cdr instanceof g){e.push(" ");e.push(this.cdr.toString().replace(/^\(|\)$/g,""))}else if(typeof this.cdr!=="undefined"&&this.cdr!==w){if(typeof this.cdr==="string"){e=e.concat([" . ",JSON.stringify(this.cdr)])}else{e=e.concat([" . ",this.cdr])}}}e.push(")");return e.join("")};g.prototype.append=function(e){if(e instanceof Array){return this.append(g.fromArray(e))}var r=this;if(r.car===h){if(e instanceof g){this.car=e.car;this.cdr=e.cdr}else{return e}}else{while(true){if(r instanceof g&&r.cdr!==w){r=r.cdr}else{break}}r.cdr=e}return this};function b(e,r){if(e instanceof N&&r instanceof N){return e.cmp(r)===0}else if(typeof e==="number"||typeof r==="number"){return N(e).cmp(N(r))}else if(e instanceof m&&r instanceof m){return e.name===r.name}else{return e===r}}function x(e){return e instanceof g&&e.isEmptyList()||e===w}function k(e,r){if(typeof this!=="undefined"&&this.constructor!==k||typeof this==="undefined"){return new k(e,r)}this.name=e;this.fn=r}k.defmacro=function(e,r){var n=new k(e,r);n.defmacro=true;return n};k.prototype.invoke=function(e,r,n){var t=r.env,i=r.dynamic_scope,o=r.error;var a={dynamic_scope:i,error:o,macro_expand:n};var c=this.fn.call(t,e,a,this.name);return n?L(c):c};k.prototype.toString=function(){return"#<Macro "+this.name+">"};var E="define-macro";function _(o){return function(){var n=z(V.mark(function e(n,u){var f,s,t,i;return V.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:t=function e(){t=z(V.mark(function e(n){var t,i,o,a,c;return V.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:if(!(n instanceof g&&n.car instanceof m)){r.next=13;break}r.prev=1;t=f.get(n.car);if(!(t instanceof k&&t.defmacro)){r.next=9;break}r.next=6;return t.invoke(n.cdr,u,true);case 6:i=r.sent;if(!(i instanceof g)){r.next=9;break}return r.abrupt("return",i);case 9:r.next=13;break;case 11:r.prev=11;r.t0=r["catch"](1);case 13:o=n.car;if(!(o instanceof g)){r.next=18;break}r.next=17;return s(o);case 17:o=r.sent;case 18:a=n.cdr;if(!(a instanceof g)){r.next=23;break}r.next=22;return s(a);case 22:a=r.sent;case 23:c=new g(o,a);return r.abrupt("return",c);case 25:case"end":return r.stop()}}},e,null,[[1,11]])}));return t.apply(this,arguments)};s=function e(r){return t.apply(this,arguments)};f=u["env"]=this;i=n;if(!o){r.next=12;break}r.t0=L;r.next=8;return s(n);case 8:r.t1=r.sent.car;return r.abrupt("return",(0,r.t0)(r.t1));case 12:r.next=15;return s(n);case 15:i=r.sent;if(!(n.toString()===i.toString())){r.next=18;break}return r.abrupt("break",21);case 18:n=i;r.next=12;break;case 21:return r.abrupt("return",L(i.car));case 22:case"end":return r.stop()}}},e,this)}));return function(e,r){return n.apply(this,arguments)}}()}function A(e){return typeof e==="undefined"||e===w||e===null}function S(d){var e="let"+(d?"*":"");return k.defmacro(e,function(f,e){var s=e.dynamic_scope,l=e.error,r=e.macro_expand;var h;if(f.car instanceof m){if(!(f.cdr.car instanceof g)){throw new Error("let require list of pairs")}var n=f.cdr.car.map(function(e){return e.car});h=f.cdr.car.map(function(e){return e.cdr.car});return g.fromArray([m("let*"),[[f.car,g(m("lambda"),g(n,f.cdr.cdr))]],g(f.car,h)])}else if(r){return}var p=this;h=this.get("list->array")(f.car);var v=p.inherit("let");return new Promise(function(a){var c=[];var u=0;(function e(){var r=h[u++];function n(e){if(e instanceof Promise){c.push(e);return e.then(n)}else if(typeof e==="undefined"){v.set(r.car,w)}else{v.set(r.car,e)}}if(s){s=d?v:p}if(!r){var t=new g(new m("begin"),f.cdr);G(t,{env:v,dynamic_scope:s,error:l}).then(function(e){a(e)})}else{var i=G(r.cdr.car,{env:d?v:p,dynamic_scope:s,error:l});var o=n(i);if(o instanceof Promise){o.then(function(){Promise.all(c).then(e)})}else{e()}}})()})})}function N(e,r){if(e instanceof N){return e}if(typeof this!=="undefined"&&this.constructor!==N||typeof this==="undefined"){return new N(e,r===true?true:h)}if(!N.isNumber(e)){throw new Error("You can't create LNumber from "+K(e))}if(e===null){e=0}if(N.isFloat(e)){this.value=e}else if(r){this.value=e;this.float=true}else if(typeof BigInt!=="undefined"){if(typeof e!=="bigint"){this.value=BigInt(e)}else{this.value=e}}else if(typeof n!=="undefined"&&!(e instanceof n)){this.value=new n(e)}else{this.value=e}}N.isFloat=function e(r){return Number(r)===r&&r%1!==0};N.isNumber=function(e){return e instanceof N||N.isNative(e)||N.isBN(e)};N.isNative=function(e){return typeof e==="bigint"||typeof e==="number"};N.isBN=function(e){return typeof n!=="undefined"&&e instanceof n};N.prototype.toString=N.prototype.toJSON=function(){return this.value.toString()};["floor","ceil","round"].forEach(function(e){N.prototype[e]=function(){if(this.float||N.isFloat(this.value)){return N(Math[e](this.value))}else{return N(this.value)}}});N.prototype.valueOf=function(){if(N.isNative(this.value)){return Number(this.value)}else if(N.isBN(this.value)){return this.value.toNumber()}};N.prototype.coerce=function(e){if(e===null){e=0}var r;if(e instanceof N){r=e.value}else{r=e}if(N.isFloat(r)){}else if(typeof this.value==="bigint"&&typeof r!=="bigint"){r=BigInt(r)}else if(typeof n!=="undefined"&&this.value instanceof n&&!r instanceof n){r=new n(r)}return N(r)};N.prototype.op=function(e,r){var n={"*":function e(r,n){return r*n},"+":function e(r,n){return r+n},"-":function e(r,n){return r-n},"/":function e(r,n){return r/n},"%":function e(r,n){return r%n},"|":function e(r,n){return r|n},"&":function e(r,n){return r&n},"~":function e(r){return~r},">>":function e(r,n){return r>>n},"<<":function e(r,n){return r<<n}};if(N.isFloat(r)||r instanceof N&&(N.isFloat(r.value)||r.float)||N.isFloat(this.value)||this.float){var t=r instanceof N?r.valueOf():r;return N(n[e](this.valueOf(),t))}r=this.coerce(r);if(N.isNative(r.value)&&N.isNative(this.value)){return N(n[e](this.value,r.value))}if(N.isBN(this.value)&&N.isBN(r.value)){var i={"+":"iadd","-":"isub","*":"imul","/":"idiv","%":"imod","|":"ior","&":"iand","~":"inot","<<":"ishrn",">>":"ishln"};e=i[e];return this.value.clone()[e](r,t)}};var j={"+":"add","-":"sub","*":"mul","/":"div","%":"mod","|":"or","&":"and","~":"neg","<<":"shl",">>":"shr"};Object.keys(j).forEach(function(r){N.prototype[j[r]]=function(e){return this.op(r,e)}});N.prototype.sqrt=function(){var e;if(N.isNative(this.value)){e=Math.sqrt(this.value)}else if(N.isBN(this.value)){e=this.value.sqrt()}return new N(e)};N.prototype.pow=function(e){e=this.coerce(e);if(N.isNative(this.value)){try{var r=new Function("a,b","return a**b;");e.value=r(this.value,e.value)}catch(e){throw new Error("Power operator not supported")}}else if(N.isBN(this.value)){e.value=this.value.pow(e.value)}else{e.value=Math.pow(this.value,e.value)}return e};N.prototype.neg=function(){var e=this.value;if(N.isNative(e)){e=-e}else if(N.isBN(e)){e=e.neg()}return new N(e)};N.prototype.abs=function(){var e=this.value;if(N.isNative(this.value)){if(e<0){e=-e}}else if(N.isBN(e)){e.iabs()}return new N(e)};N.prototype.isOdd=function(){if(N.isNative(this.value)){return this.value%2===1}else if(N.isBN(this.value)){return this.value.isOdd()}};N.prototype.isEven=function(){return!this.isOdd()};N.prototype.cmp=function(e){e=this.coerce(e);if(N.isNative(this.value)){if(this.value<e.value){return-1}else if(this.value===e.value){return 0}else{return 1}}else if(N.isBN(this.value)){return this.value.cmp(e.value)}};function P(e,r,n){this.env=e;this.parent=r;this.name=n}P.prototype.inherit=function(e){var r=arguments.length>1&&arguments[1]!==h?arguments[1]:{};if(K(e)==="object"){r=e}if(!e||K(e)==="object"){e="child of "+(this.name||"unknown")}return new P(r||{},this,e)};P.prototype.get=function(e){var r;var n=false;if(e instanceof m){if(e.name in this.env){r=this.env[e.name];n=true}}else if(typeof e==="string"){if(typeof this.env[e]!=="undefined"){r=this.env[e];n=true}}if(n){if(N.isNumber(r)){return N(r)}return r}if(this.parent instanceof P){return this.parent.get(e)}else{var t;if(e instanceof m){t=e.name}else if(typeof e==="string"){t=e}if(t){var i=K(o[t]);if(i==="function"){return o[t].bind(o)}else if(i!=="undefined"){return o[t]}}}t=(t.name||t).toString();throw new Error("Unbound variable `"+t+"'")};P.prototype.set=function(e,r){if(N.isNumber(r)){r=N(r)}if(e instanceof m){e=e.name}this.env[e]=r};P.prototype.has=function(e){return typeof this.env[e]!=="undefined"};P.prototype.ref=function(e){var r=this;while(true){if(!r){break}if(r.has(e)){return r}r=r.parent}};function L(e){if(e instanceof Promise){return e.then(L)}if(e instanceof g||e instanceof m){e.data=true}return e}function O(e,r){this.value=e;this.count=r}O.prototype.toString=function(){return"<#unquote["+this.count+"] "+this.value+">"};var q=function(){var r=0;return function(){var e=arguments.length>0&&arguments[0]!==h?arguments[0]:null;if(e!==null){return new m(o.Symbol("#"+e))}r++;return new m(o.Symbol("#"+r))}}();var B=new P({nil:w,true:true,false:false,stdout:{write:function e(){var r;(r=console).log.apply(r,arguments)}},stdin:{read:function e(){return new Promise(function(e){e(prompt(""))})}},test:function e(){return Promise.resolve(h)},cons:function e(r,n){if(x(n)){n=w}return new g(r,n)},car:function e(r){if(r instanceof g){return r.car}else{throw new Error("argument to car need to be a list")}},cdr:function e(r){if(r instanceof g){return r.cdr}else{throw new Error("argument to cdr need to be a list")}},"set!":new k("set!",function(r){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},n=e.dynamic_scope,t=e.error;if(n){n=this}var i=G(r.cdr.car,{env:this,dynamic_scope:n,error:t});i=I(i);var o;if(r.car instanceof g&&m.is(r.car.car,".")){var a=r.car.cdr.car;var c=r.car.cdr.cdr.car;var u=G(a,{env:this,dynamic_scope:n,error:t});var f=G(c,{env:this,dynamic_scope:n,error:t});if(i instanceof Promise){return i.then(function(e){u[f]=e})}else{u[f]=i;return i}}if(!(r.car instanceof m)){throw new Error("set! first argument need to be a symbol")}o=this.ref(r.car.name);if(!o){o=this}if(i instanceof Promise){return i.then(function(e){return o.set(r.car,e)})}else{o.set(r.car,i)}}),"set-car!":function e(r,n){r.car=n},"set-cdr!":function e(r,n){r.cdr=n},"empty?":function e(r){return typeof r==="undefined"||x(r)},assoc:function e(r,n){if(r instanceof g&&!(n instanceof g)){throw new Error("First argument to assoc new to a key")}var t=n;while(true){if(!(t instanceof g)||this.get("empty?")(t)){break}var i=t.car.car;if(b(i,r)){return t.car}else{t=t.cdr}}return w},gensym:q,load:function e(r){var n=this;o.fetch(r).then(function(e){return e.text()}).then(function(e){n.get("eval")(n.get("read")(e))})},while:new k("while",function(){var n=z(V.mark(function e(n,t){var i,o,a,c,u,f;return V.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=t.dynamic_scope,o=t.error;a=this;c=new g(new m("begin"),n.cdr);if(i){i=a}case 4:r.next=7;return G(n.car,{env:a,dynamic_scope:i,error:o});case 7:f=r.sent;if(!(f&&!x(f))){r.next=14;break}r.next=11;return G(c,{env:a,dynamic_scope:i,error:o});case 11:u=r.sent;r.next=15;break;case 14:return r.abrupt("return",u);case 15:r.next=4;break;case 17:case"end":return r.stop()}}},e,this)}));return function(e,r){return n.apply(this,arguments)}}()),if:new k("if",function(i,e){var o=e.dynamic_scope,a=e.error;if(o){o=this}var c=this;var r=function e(r){if(typeof r!=="boolean"){throw new Error("if: value need to be boolean")}if(r){var n=G(i.cdr.car,{env:c,dynamic_scope:o,error:a});if(typeof n==="undefined"){return}return n}else{var t=G(i.cdr.cdr.car,{env:c,dynamic_scope:o,error:a});if(typeof t==="undefined"){return false}return t}};var n=G(i.car,{env:c,dynamic_scope:o,error:a});if(n instanceof Promise){return n.then(r)}else{return r(n)}}),"let*":S(true),let:S(false),begin:new k("begin",function(){var n=z(V.mark(function e(n,t){var i,o,a,c;return V.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=t.dynamic_scope,o=t.error;a=this.get("list->array")(n);if(i){i=this}case 3:if(!a.length){r.next=11;break}n=a.shift();r.next=8;return G(n,{env:this,dynamic_scope:i,error:o});case 8:c=r.sent;r.next=12;break;case 11:return r.abrupt("return",c);case 12:r.next=3;break;case 14:case"end":return r.stop()}}},e,this)}));return function(e,r){return n.apply(this,arguments)}}()),timer:new k("timer",function(r){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},n=e.dynamic_scope,t=e.error;var i=this;if(n){n=this}return new Promise(function(e){setTimeout(function(){e(G(r.cdr,{env:i,dynamic_scope:n,error:t}))},r.car)})}),define:k.defmacro("define",function(r,e){var n=this;if(r.car instanceof g&&r.car.car instanceof m){var t=new g(new m("define"),new g(r.car.car,new g(new g(new m("lambda"),new g(r.car.cdr,r.cdr)))));return t}else if(e.macro_expand){return}if(e.dynamic_scope){e.dynamic_scope=this}e.env=n;var i=r.cdr.car;if(i instanceof g){i=G(i,e)}if(r.car instanceof m){if(i instanceof Promise){return i.then(function(e){n.set(r.car,e)})}else{n.set(r.car,i)}}}),"set-obj":function e(r,n,t){r[n]=t},eval:function e(r){var n=this;if(r instanceof g){return G(r,{env:this,dynamic_scope:this,error:function e(r){return n.get("print")(r.message)}})}if(r instanceof Array){var t;r.forEach(function(e){t=G(e,{env:n,dynamic_scope:n,error:function e(r){return n.get("print")(r.message)}})});return t}},lambda:new k("lambda",function(u){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},f=e.dynamic_scope,s=e.error;var l=this;function r(){var e=(f?this:l).inherit("lambda");var r=u.car;var n=0;var t;if(r instanceof m||!x(r)){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++){o[a]=arguments[a]}while(true){if(r.car!==w){if(r instanceof m){t=g.fromArray(o.slice(n));e.env[r.name]=t;break}else{if(typeof o[n]==="undefined"){t=w}else{t=o[n]}e.env[r.car.name]=t}}if(r.cdr===w){break}n++;r=r.cdr}}if(f){f=e}var c=new g(new m("begin"),u.cdr);return G(c,{env:e,dynamic_scope:f,error:s})}var n=u.car instanceof g?u.car.length():null;if(!(u.car instanceof g)){return r}var t=new Array(n).fill(0).map(function(e,r){return"a"+r}).join(",");var i=new Function("f","return function(".concat(t,") {\n                return f.apply(this, arguments);\n            };"));return i(r)}),macroexpand:new k("macro-expand",_()),"macroexpand-1":new k("macro-expand",_(true)),"define-macro":new k(E,function(c,e){var u=e.dynamic_scope,f=e.error;function s(e){if(e instanceof g){delete e.data}return e}if(c.car instanceof g&&c.car.car instanceof m){var r=c.car.car.name;this.env[r]=k.defmacro(r,function(e,r){var n=r.macro_expand;var t=new P({},this,"defmacro");var i=c.car.cdr;var o=e;while(true){if(i instanceof m){t.env[i.name]=o;break}else if(i.car!==w&&o.car!==w){t.env[i.car.name]=o.car}if(i.cdr===w){break}o=o.cdr;i=i.cdr}if(u){u=t}if(c.cdr instanceof g){var a=c.cdr.reduce(function(e,r){return G(r,{env:t,dynamic_scope:u,error:f})});if(n){return a}a=G(a,{env:t,dynamic_scope:u,error:f});if(a instanceof Promise){return a.then(s)}return s(a)}})}}),quote:new k("quote",function(e){return L(e.car)}),quasiquote:new k("quasiquote",function(e,r){var u=r.dynamic_scope,f=r.error;var s=this;var l=0;if(u){u=s}function h(e){if(e instanceof g){var r;if(m.is(e.car.car,"unquote-splicing")){r=G(e.car.cdr.car,{env:s,dynamic_scope:u,error:f});if(!r instanceof g){throw new Error("Value of unquote-splicing need"+" to be pair")}if(e.cdr instanceof g){if(r instanceof g){r.cdr.append(h(e.cdr))}else{r=new g(r,h(e.cdr))}}return r}if(m.is(e.car,"unquote")){var n=e.cdr;var t=n;var i=t;var o=1;while(m.is(t.car.car,"unquote")){i=t;o++;t=t.car.cdr.car}if(o>l){l=o}if(i===t){if(e.cdr.cdr!==w){return new g(new O(e.cdr.car,o),e.cdr.cdr)}else{return new O(e.cdr.car,o)}}else if(i.cdr.cdr!==w){i.car.cdr=new g(new O(t,o),i.cdr===w?w:i.cdr.cdr)}else{i.car.cdr=new O(t,o)}return n.car}var a=e.car;if(a instanceof g){a=h(a)}var c=e.cdr;if(c instanceof g){c=h(c)}return new g(a,c)}return e}function t(e){if(e instanceof O){if(l===e.count){return G(e.value,{env:s,dynamic_scope:u,error:f})}else{return new g(new m("unquote"),new g(t(e.value),w))}}if(e instanceof g){var r=e.car;if(r instanceof g||r instanceof O){r=t(r)}var n=e.cdr;if(n instanceof g||n instanceof O){n=t(n)}return new g(r,n)}return e}return L(t(h(e.car)))}),clone:function e(r){return r.clone()},append:function e(r,n){return r.clone().append([n])},reverse:function e(r){if(r instanceof g){var n=this.get("list->array")(r).reverse();return this.get("array->list")(n)}else if(!(r instanceof Array)){throw new Error("Invlid value for reverse")}else{return r.reverse()}},nth:function e(r,n){if(n instanceof g){var t=n;var i=0;while(i<r){if(!t.cdr||t.cdr===w){return w}t=t.cdr;i++}return t.car}else if(n instanceof Array){return n[r]}else{throw new Error("Invalid object for nth")}},"append!":new k("append!",function(e,r){var n=r.dynamic_scope,t=r.error;if(n){n=this}var i=G(e.cdr.car,{env:this,dynamic_scope:n,error:t});return this.get(e.car).append([i])}),list:function e(){return g.fromArray([].slice.call(arguments))},concat:function e(){return[].join.call(arguments,"")},join:function e(r,n){return this.get("list->array")(n).join(r)},split:function e(r,n){return this.get("array->list")(r.split(n))},replace:function e(r,n,t){return r.replace(n,t)},match:function e(r,n){return this.get("array->list")(r.match(n))},search:function e(r,n){return r.search(n)},string:function r(e,n){if(typeof jQuery!=="undefined"&&e instanceof jQuery.fn.init){return"<#jQuery("+e.length+")>"}if(e instanceof N){return e.value.toString()}if(typeof e==="undefined"){return"<#undefined>"}if(typeof e==="function"){if(e.toString().match(/\{\s*\[native code\]\s*\}/)){return"<#function(native)>"}return"<#function>"}if(e===w){return"nil"}if(e instanceof Array){return"["+e.map(function(e){return r(e,true)}).join(", ")+"]"}if(e===null||typeof e==="string"&&n){return JSON.stringify(e)}if(e instanceof g){return e.toString()}if(K(e)==="object"){var t=e.constructor.name;if(t!==""){return"<#"+t+">"}return"<#Object>"}if(typeof e!=="string"){return e.toString()}return e},env:function e(r){r=r||this;var n=Object.keys(r.env);var t;if(n.length){t=g.fromArray(n)}else{t=w}if(r.parent!==h){return this.get("env").call(this,r.parent).append(t)}return t},new:function e(r){for(var n=arguments.length,t=new Array(n>1?n-1:0),i=1;i<n;i++){t[i-1]=arguments[i]}return Y(r,t)},".":function e(r,n){var t=n instanceof m?n.name:n;var i=r[t];if(typeof i==="function"){return i.bind(r)}return i},type:function e(r){return K(r)},instanceof:function e(r,n){return r instanceof n},"number?":N.isNumber,"string?":function e(r){return typeof r==="string"},"pair?":function e(r){return r instanceof g},"regex?":function e(r){return r instanceof RegExp},"null?":function e(r){return A(r)||r instanceof g&&r.isEmptyList()},"boolean?":function e(r){return typeof r==="boolean"},"symbol?":function e(r){return r instanceof m},"array?":function e(r){return r instanceof Array},"object?":function e(r){return r!==null&&K(r)==="object"&&!(r instanceof Array)},read:function r(e){var n=this;if(typeof e==="string"){e=l(s(e));if(e.length){return e[e.length-1]}return v()}return this.get("stdin").read().then(function(e){return r.call(n,e)})},print:function e(){var r,n=this;for(var t=arguments.length,i=new Array(t),o=0;o<t;o++){i[o]=arguments[o]}(r=this.get("stdout")).write.apply(r,X(i.map(function(e){return n.get("string")(e)})))},flatten:function e(r){return r.flatten()},"array->list":function e(r){return g.fromArray(r)},"list->array":function e(r){if(r instanceof g&&r.isEmptyList()){return[]}var n=[];var t=r;while(true){if(t instanceof g){n.push(t.car);t=t.cdr}else{break}}return n},apply:new k("apply",function(t){var i=this;var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},o=e.dynamic_scope,a=e.error;if(o){o=this}function c(e){if(typeof e!=="function"){var r;if(t.car instanceof m){r="Variable `"+t.car.name+"' is not a function"}else{r="Expression `"+t.car.toString()+"' is not a function"}throw new Error(r)}}var r=function e(r){c(r);var n=G(t.cdr.car,{env:i,dynamic_scope:o,error:a});n=i.get("list->array")(n);if(n.filter(function(e){return e instanceof Promise}).length){return Promise.all(n).then(function(e){return r.apply(i,e)})}else{return r.apply(i,n)}};var n=G(t.car,{env:this,dynamic_scope:o,error:a});if(n instanceof Promise){return n.then(r)}else{return r(n)}}),length:function e(r){if(!r){return N(0)}if(r instanceof g){return N(r.length())}if("length"in r){return N(r.length)}},find:function(){var n=z(V.mark(function e(n,t){var i,o;return V.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=this.get("list->array")(t);o=0;case 2:if(!(o<i.length)){r.next=10;break}r.next=5;return n(i[o],o);case 5:if(!r.sent){r.next=7;break}return r.abrupt("return",i[o]);case 7:++o;r.next=2;break;case 10:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),"for-each":function(){var n=z(V.mark(function e(n,t){var i,o,a;return V.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=this.get("list->array")(t);o=0;case 2:if(!(o<i.length)){r.next=8;break}a=i[o++];r.next=6;return n(a,o);case 6:r.next=2;break;case 8:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),map:function(){var n=z(V.mark(function e(n,t){var i,o,a,c;return V.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=this.get("list->array")(t);o=[];a=0;case 3:if(!(a<i.length)){r.next=12;break}c=i[a++];r.t0=o;r.next=8;return n(c,a);case 8:r.t1=r.sent;r.t0.push.call(r.t0,r.t1);r.next=3;break;case 12:return r.abrupt("return",g.fromArray(o));case 13:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),reduce:function(){var n=z(V.mark(function e(n,t){var i,o,a,c,u,f=arguments;return V.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=f.length>2&&f[2]!==h?f[2]:null;o=this.get("list->array")(t);if(!(t.length===0)){r.next=4;break}return r.abrupt("return",w);case 4:a=i;if(i===null){a=o.unshift()}c=0;case 7:if(!(c<o.length)){r.next=14;break}u=o[c++];r.next=11;return n(a,u);case 11:a=r.sent;r.next=7;break;case 14:if(!(typeof a==="number")){r.next=16;break}return r.abrupt("return",N(a));case 16:return r.abrupt("return",a);case 17:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),filter:function(){var n=z(V.mark(function e(n,t){var i,o,a,c,u;return V.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=this.get("list->array")(t);o=[];a=0;case 3:if(!(a<i.length)){r.next=11;break}c=i[a++];r.next=7;return n(c,a);case 7:u=r.sent;if(u){o.push(c)}r.next=3;break;case 11:return r.abrupt("return",g.fromArray(o,true));case 12:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),range:function e(r){if(r instanceof N){r=r.valueOf()}return g.fromArray(new Array(r).fill(0).map(function(e,r){return N(r)}))},curry:function e(o){for(var r=arguments.length,n=new Array(r>1?r-1:0),t=1;t<r;t++){n[t-1]=arguments[t]}var a=o.length;return function(){var t=n.slice();function i(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}t=t.concat(r);if(t.length>=a){return o.apply(this,t)}else{return i}}return i.apply(this,arguments)}},odd:function e(r){return N(r).isOdd()},even:function e(r){return N(r).isEvent()},"*":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){return N(e).mul(r)})}},"+":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){if(N.isNumber(e)&&N.isNumber(r)){return N(e).add(r)}else if(typeof e==="string"){throw new Error("To concatenate strings use `concat`")}return e+r})}},"-":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length===1){return N(n[0]).neg()}if(n.length){return n.reduce(function(e,r){return N(e).sub(r)})}},"/":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){return N(e).div(r)})}},abs:function e(r){return N(r).abs()},sqrt:function e(r){if(r instanceof N){return Math.sqrt(r.valueOf())}return Math.sqrt(r)},"**":function e(r,n){return N(r).pow(n)},"1+":function e(r){return N(r).add(1)},"1-":function e(r){return N(r).sub(1)},"++":new k("++",function(e){var r=this.get(e.car);var n=N(r).add(1);this.set(e.car,n);return n}),"--":new k("--",function(e){var r=this.get(e.car);var n=N(r).sub(1);this.set(e.car,n);return n}),"%":function e(r,n){return N(r).mod(n)},"==":function e(r,n){return N(r).cmp(n)===0},">":function e(r,n){return N(r).cmp(n)===1},"<":function e(r,n){return N(r).cmp(n)===-1},"<=":function e(r,n){return[0,-1].includes(N(r).cmp(n))},">=":function e(r,n){return[0,1].includes(N(r).cmp(n))},"eq?":b,or:new k("or",function(e,r){var a=r.dynamic_scope,c=r.error;var u=this.get("list->array")(e);var f=this;if(a){a=f}return new Promise(function(i){var o;(function r(){function e(e){o=e;if(o){i(e)}r()}var n=u.shift();if(typeof n==="undefined"){if(o){i(o)}else{i(false)}}else{var t=G(n,{env:f,dynamic_scope:a,error:c});if(t instanceof Promise){t.then(e)}else{e(t)}}})()})}),and:new k("and",function(e){var r=arguments.length>1&&arguments[1]!==h?arguments[1]:{},a=r.dynamic_scope,c=r.error;var u=this.get("list->array")(e);var f=this;if(a){a=f}return new Promise(function(i){var o;(function r(){function e(e){o=e;if(!o){i(false)}r()}var n=u.shift();if(typeof n==="undefined"){if(o){i(o)}else{i(false)}}else{var t=G(n,{env:f,dynamic_scope:a,error:c});if(t instanceof Promise){t.then(e)}else{e(t)}}})()})}),"|":function e(r,n){return N(r).or(n)},"&":function e(r,n){return N(r).and(n)},"~":function e(r){return N(r).neg()},">>":function e(r,n){return N(r).shr(n)},"<<":function e(r,n){return N(r).shl(n)},not:function e(r){if(x(r)){return true}return!r},"->":function e(r,n){for(var t=arguments.length,i=new Array(t>2?t-2:0),o=2;o<t;o++){i[o-2]=arguments[o]}return r[n].apply(r,i)}},h,"global");["floor","round","ceil"].forEach(function(r){B.set(r,function(e){if(e instanceof N){return e[r]()}throw new Error("".concat(K(e)," ").concat(e.toString()," is not a number"))})});function F(e){if(e.length===1){return e[0]}else{var r=[];var n=F(e.slice(1));for(var t=0;t<n.length;t++){for(var i=0;i<e[0].length;i++){r.push(e[0][i]+n[t])}}return r}}function R(e,r,n){var t=[];for(var i=r;i<=n;++i){var o=[];for(var a=0;a<i;++a){o.push(e)}t=t.concat(F(o))}return t}R(["d","a"],2,5).forEach(function(e){var r=e.split("").reverse();B.set("c"+e+"r",function(e){return r.reduce(function(e,r){if(r==="a"){return e.car}else{return e.cdr}},e)})});if(typeof global!=="undefined"){B.set("global",global)}else if(typeof window!=="undefined"){B.set("window",window)}function T(e){if(typeof e==="string"){return"string"}else if(e instanceof N){return"number"}else if(e instanceof RegExp){return"regex"}else if(typeof e==="boolean"){return"boolean"}else{return"unknown type"}}function I(e){var r=[];n(e);if(r.length){return t(e)}return e;function n(e){if(e instanceof Promise){r.push(e)}else if(e instanceof g){n(e.car);n(e.cdr)}else if(e instanceof Array){e.forEach(n)}}function t(o){if(o instanceof Array){return Promise.all(o.map(t))}if(o instanceof g){var e=t(o.car);var r=t(o.cdr);return Promise.all([e,r]).then(function(e){var r=Q(e,2),n=r[0],t=r[1];var i=new g(n,t);if(o.data){L(i)}return i})}else{return o}}}function M(e,r){var n=r.env,t=r.dynamic_scope,i=r.error;var o=[];var a=e;while(true){if(a instanceof g){var c=G(a.car,{env:n,dynamic_scope:t,error:i});if(t){if(c instanceof Promise){c=c.then(function(e){if(typeof e==="function"){return e.bind(t)}return e})}else if(typeof c==="function"){c=c.bind(t)}}o.push(c);a=a.cdr}else{break}}return I(o)}function D(e,r,n){if(r instanceof g){r=r.clone()}var t=e.invoke(r,n);t=I(t,true);if(t&&t.data){return t}else if(t instanceof Promise){return t.then(function(e){if(e&&e.data){return e}return G(e,n)})}return G(t,n)}function G(r){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},n=e.env,t=e.dynamic_scope,i=e.error,o=i===void 0?function(){}:i;try{if(t===true){n=t=n||B}else if(n===true){n=t=B}else{n=n||B}var a={env:n,dynamic_scope:t,error:o};var c;if(A(r)){return r}if(x(r)){return v()}var u=r.car;var f=r.cdr;if(u instanceof g){c=I(G(u,a));if(c instanceof Promise){return c.then(function(e){return G(new g(e,r.cdr),a)})}else if(typeof c!=="function"){throw new Error(n.get("string")(c)+" is not a function")}}if(u instanceof m){c=n.get(u);if(c instanceof k){return D(c,f,a)}else if(typeof c!=="function"){if(c){var s="".concat(T(c)," `").concat(c,"' is not a function");throw new Error(s)}throw new Error("Unknown function `".concat(u.name,"'"))}}else if(typeof u==="function"){c=u}if(typeof c==="function"){var l=M(f,a);if(l instanceof Promise){return l.then(function(e){var r=t||n;return L(I(c.apply(r,e)))})}return L(I(c.apply(t||n,l)))}else if(r instanceof m){c=n.get(r);if(c==="undefined"){throw new Error("Unbound variable `"+r.name+"'")}return c}else if(r instanceof g){c=u&&u.toString();throw new Error("".concat(T(u)," ").concat(c," is not a function"))}else{return r}}catch(e){o&&o(e,r)}}function $(e,r,n){return J.apply(this,arguments)}function J(){J=z(V.mark(function e(n,t,i){var o,a,c,u;return V.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:if(i===true){t=i=t||B}else if(t===true){t=i=B}else{t=t||B}o=l(s(n));a=[];case 3:c=o.shift();if(c){r.next=9;break}return r.abrupt("return",a);case 9:r.next=11;return G(c,{env:t,dynamic_scope:i,error:function e(r,n){r.code=n.toString();throw r}});case 11:u=r.sent;a.push(u);case 13:r.next=3;break;case 15:case"end":return r.stop()}}},e)}));return J.apply(this,arguments)}function U(e){var r=/[()]/;var n=s(e).filter(function(e){return e.match(r)});var t=n.filter(function(e){return e===")"});var i=n.filter(function(e){return e==="("});return t.length===i.length}g.unDry=function(e){return new g(e.car,e.cdr)};g.prototype.toDry=function(){return{value:{car:this.car,cdr:this.cdr}}};p.prototype.toDry=function(){return{value:null}};p.unDry=function(){return w};m.prototype.toDry=function(){return{value:{name:this.name}}};m.unDry=function(e){return new m(e.name)};function C(){var t="text/x-lips";if(window.document){Array.from(document.querySelectorAll("script")).forEach(function(e){var r=e.getAttribute("type");if(r===t){var n=e.getAttribute("src");if(n){o.fetch(n).then(function(e){return e.text()}).then($)}else{$(e.innerHTML)}}else if(r&&r.match(/lips|lisp/)){console.warn("Expecting "+t+" found "+r)}})}}function H(r){if(typeof window!=="undefined"){if(window.addEventListener){window.addEventListener("load",r,false)}else if(window.attachEvent){window.attachEvent("onload",r)}else if(typeof window.onload==="function"){(function(e){window.onload=function(){r();e()}})(window.onload)}else{window.onload=r}}}H(function(){setTimeout(C,0)});return{version:"0.8.1",exec:$,parse:l,tokenize:s,evaluate:G,Environment:P,global_environment:B,env:B,balanced_parenthesis:U,Macro:k,quote:L,Pair:g,nil:w,maybe_promise:I,Symbol:m,LNumber:N}})})();