/**@license
 * LIPS is Pretty Simple - version DEV
 *
 * Copyright (c) 2018 Jakub Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 * includes unfetch by Jason Miller (@developit) MIT License
 *
 * build: Sun, 07 Oct 2018 15:08:32 +0000
 */
(function(){"use strict";function e(e){if(Array.isArray(e))return e}function r(e,r){var n=[];var t=true;var i=false;var o=undefined;try{for(var a=e[Symbol.iterator](),c;!(t=(c=a.next()).done);t=true){n.push(c.value);if(r&&n.length===r)break}}catch(e){i=true;o=e}finally{try{if(!t&&a["return"]!=null)a["return"]()}finally{if(i)throw o}}return n}function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function t(t,i){return e(t)||r(t,i)||n()}function i(e,r){i=Object.setPrototypeOf||function e(r,n){r.__proto__=n;return r};return i(e,r)}function o(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function a(e,r,n){if(o()){a=Reflect.construct}else{a=function e(r,n,t){var i=[null];i.push.apply(i,n);var o=Function.bind.apply(r,i);var a=new o;if(t)setPrototypeOf(a,t.prototype);return a}}return a.apply(null,arguments)}function c(e,r){return r={exports:{}},e(r,r.exports),r.exports}var u=c(function(e){!function(r){var n=Object.prototype;var t=n.hasOwnProperty;var i;var o=typeof Symbol==="function"?Symbol:{};var a=o.iterator||"@@iterator";var c=o.asyncIterator||"@@asyncIterator";var u=o.toStringTag||"@@toStringTag";var f="object"==="object";var s=r.regeneratorRuntime;if(s){if(f){e.exports=s}return}s=r.regeneratorRuntime=f?e.exports:{};function l(e,r,n,t){var i=r&&r.prototype instanceof w?r:w;var o=Object.create(i.prototype);var a=new L(t||[]);o._invoke=N(e,n,a);return o}s.wrap=l;function h(e,r,n){try{return{type:"normal",arg:e.call(r,n)}}catch(e){return{type:"throw",arg:e}}}var p="suspendedStart";var v="suspendedYield";var d="executing";var y="completed";var m={};function w(){}function g(){}function b(){}var x={};x[a]=function(){return this};var k=Object.getPrototypeOf;var E=k&&k(k(q([])));if(E&&E!==n&&t.call(E,a)){x=E}var _=b.prototype=w.prototype=Object.create(x);g.prototype=_.constructor=b;b.constructor=g;b[u]=g.displayName="GeneratorFunction";function A(e){["next","throw","return"].forEach(function(r){e[r]=function(e){return this._invoke(r,e)}})}s.isGeneratorFunction=function(e){var r=typeof e==="function"&&e.constructor;return r?r===g||(r.displayName||r.name)==="GeneratorFunction":false};s.mark=function(e){if(Object.setPrototypeOf){Object.setPrototypeOf(e,b)}else{e.__proto__=b;if(!(u in e)){e[u]="GeneratorFunction"}}e.prototype=Object.create(_);return e};s.awrap=function(e){return{__await:e}};function S(e){function r(n,i,o,a){var c=h(e[n],e,i);if(c.type==="throw"){a(c.arg)}else{var u=c.arg;var f=u.value;if(f&&typeof f==="object"&&t.call(f,"__await")){return Promise.resolve(f.__await).then(function(e){r("next",e,o,a)},function(e){r("throw",e,o,a)})}return Promise.resolve(f).then(function(e){u.value=e;o(u)},function(e){return r("throw",e,o,a)})}}var n;function i(e,t){function i(){return new Promise(function(n,i){r(e,t,n,i)})}return n=n?n.then(i,i):i()}this._invoke=i}A(S.prototype);S.prototype[c]=function(){return this};s.AsyncIterator=S;s.async=function(e,r,n,t){var i=new S(l(e,r,n,t));return s.isGeneratorFunction(r)?i:i.next().then(function(e){return e.done?e.value:i.next()})};function N(e,r,n){var t=p;return function i(o,a){if(t===d){throw new Error("Generator is already running")}if(t===y){if(o==="throw"){throw a}return R()}n.method=o;n.arg=a;while(true){var c=n.delegate;if(c){var u=P(c,n);if(u){if(u===m)continue;return u}}if(n.method==="next"){n.sent=n._sent=n.arg}else if(n.method==="throw"){if(t===p){t=y;throw n.arg}n.dispatchException(n.arg)}else if(n.method==="return"){n.abrupt("return",n.arg)}t=d;var f=h(e,r,n);if(f.type==="normal"){t=n.done?y:v;if(f.arg===m){continue}return{value:f.arg,done:n.done}}else if(f.type==="throw"){t=y;n.method="throw";n.arg=f.arg}}}}function P(e,r){var n=e.iterator[r.method];if(n===i){r.delegate=null;if(r.method==="throw"){if(e.iterator.return){r.method="return";r.arg=i;P(e,r);if(r.method==="throw"){return m}}r.method="throw";r.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var t=h(n,e.iterator,r.arg);if(t.type==="throw"){r.method="throw";r.arg=t.arg;r.delegate=null;return m}var o=t.arg;if(!o){r.method="throw";r.arg=new TypeError("iterator result is not an object");r.delegate=null;return m}if(o.done){r[e.resultName]=o.value;r.next=e.nextLoc;if(r.method!=="return"){r.method="next";r.arg=i}}else{return o}r.delegate=null;return m}A(_);_[u]="Generator";_[a]=function(){return this};_.toString=function(){return"[object Generator]"};function j(e){var r={tryLoc:e[0]};if(1 in e){r.catchLoc=e[1]}if(2 in e){r.finallyLoc=e[2];r.afterLoc=e[3]}this.tryEntries.push(r)}function O(e){var r=e.completion||{};r.type="normal";delete r.arg;e.completion=r}function L(e){this.tryEntries=[{tryLoc:"root"}];e.forEach(j,this);this.reset(true)}s.keys=function(e){var r=[];for(var n in e){r.push(n)}r.reverse();return function n(){while(r.length){var t=r.pop();if(t in e){n.value=t;n.done=false;return n}}n.done=true;return n}};function q(e){if(e){var r=e[a];if(r){return r.call(e)}if(typeof e.next==="function"){return e}if(!isNaN(e.length)){var n=-1,o=function r(){while(++n<e.length){if(t.call(e,n)){r.value=e[n];r.done=false;return r}}r.value=i;r.done=true;return r};return o.next=o}}return{next:R}}s.values=q;function R(){return{value:i,done:true}}L.prototype={constructor:L,reset:function(e){this.prev=0;this.next=0;this.sent=this._sent=i;this.done=false;this.delegate=null;this.method="next";this.arg=i;this.tryEntries.forEach(O);if(!e){for(var r in this){if(r.charAt(0)==="t"&&t.call(this,r)&&!isNaN(+r.slice(1))){this[r]=i}}}},stop:function(){this.done=true;var e=this.tryEntries[0];var r=e.completion;if(r.type==="throw"){throw r.arg}return this.rval},dispatchException:function(e){if(this.done){throw e}var r=this;function n(n,t){c.type="throw";c.arg=e;r.next=n;if(t){r.method="next";r.arg=i}return!!t}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o];var c=a.completion;if(a.tryLoc==="root"){return n("end")}if(a.tryLoc<=this.prev){var u=t.call(a,"catchLoc");var f=t.call(a,"finallyLoc");if(u&&f){if(this.prev<a.catchLoc){return n(a.catchLoc,true)}else if(this.prev<a.finallyLoc){return n(a.finallyLoc)}}else if(u){if(this.prev<a.catchLoc){return n(a.catchLoc,true)}}else if(f){if(this.prev<a.finallyLoc){return n(a.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(e,r){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&t.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}if(o&&(e==="break"||e==="continue")&&o.tryLoc<=r&&r<=o.finallyLoc){o=null}var a=o?o.completion:{};a.type=e;a.arg=r;if(o){this.method="next";this.next=o.finallyLoc;return m}return this.complete(a)},complete:function(e,r){if(e.type==="throw"){throw e.arg}if(e.type==="break"||e.type==="continue"){this.next=e.arg}else if(e.type==="return"){this.rval=this.arg=e.arg;this.method="return";this.next="end"}else if(e.type==="normal"&&r){this.next=r}return m},finish:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.finallyLoc===e){this.complete(n.completion,n.afterLoc);O(n);return m}}},catch:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc===e){var t=n.completion;if(t.type==="throw"){var i=t.arg;O(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){this.delegate={iterator:q(e),resultName:r,nextLoc:n};if(this.method==="next"){this.arg=i}return m}}}(function(){return this||typeof self==="object"&&self}()||Function("return this")())});var f=function(){return this||typeof self==="object"&&self}()||Function("return this")();var s=f.regeneratorRuntime&&Object.getOwnPropertyNames(f).indexOf("regeneratorRuntime")>=0;var l=s&&f.regeneratorRuntime;f.regeneratorRuntime=undefined;var h=u;if(s){f.regeneratorRuntime=l}else{try{delete f.regeneratorRuntime}catch(e){f.regeneratorRuntime=undefined}}var p=h;function v(e,r,n,t,i,o,a){try{var c=e[o](a);var u=c.value}catch(e){n(e);return}if(c.done){r(u)}else{Promise.resolve(u).then(t,i)}}function d(e){return function(){var r=this,n=arguments;return new Promise(function(t,i){var o=e.apply(r,n);function a(e){v(o,t,i,a,c,"next",e)}function c(e){v(o,t,i,a,c,"throw",e)}a(undefined)})}}function y(e){if(Array.isArray(e)){for(var r=0,n=new Array(e.length);r<e.length;r++){n[r]=e[r]}return n}}function m(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function w(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function g(e){return y(e)||m(e)||w()}function b(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){b=function e(r){return typeof r}}else{b=function e(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r}}return b(e)}function x(e){if(typeof Symbol==="function"&&b(Symbol.iterator)==="symbol"){x=function e(r){return b(r)}}else{x=function e(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":b(r)}}return x(e)}
/**@license
 * LIPS is Pretty Simple
 *
 * Copyright (c) 2018 Jakub Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 */
/**@license
 * LIPS is Pretty Simple
 *
 * Copyright (c) 2018 Jakub Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 */
(function(e,r){if(typeof define==="function"&&define.amd){define(["bn.js"],function(n){return e.lips=r(e,n)})}else if((typeof module==="undefined"?"undefined":x(module))==="object"&&module.exports){module.exports=r(e,require("bn.js"))}else{e.lips=r(e,e.BN)}})(typeof window!=="undefined"?window:global,function(e,r,n){if(!e.fetch){e.fetch=function(e,r){r=r||{};return new Promise(function(n,t){var i=new XMLHttpRequest;i.open(r.method||"get",e,true);for(var o in r.headers){i.setRequestHeader(o,r.headers[o])}i.withCredentials=r.credentials=="include";i.onload=function(){n(a())};i.onerror=t;i.send(r.body||null);function a(){var e=[],r=[],n={},t;i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(i,o,a){e.push(o=o.toLowerCase());r.push([o,a]);t=n[o];n[o]=t?"".concat(t,",").concat(a):a});return{ok:(i.status/100|0)==2,status:i.status,statusText:i.statusText,url:i.responseURL,clone:a,text:function e(){return Promise.resolve(i.responseText)},json:function e(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function e(){return Promise.resolve(new Blob([i.response]))},headers:{keys:function r(){return e},entries:function e(){return r},get:function e(r){return n[r.toLowerCase()]},has:function e(r){return r.toLowerCase()in n}}}}})}}var i=/^\/((?:\\\/|[^/]|\[[^\]]*\/[^\]]*\])+)\/([gimy]*)$/;var o=/^[-+]?[0-9]+([eE][-+]?[0-9]+)?$/;var c=/^([-+]?((\.[0-9]+|[0-9]+\.[0-9]+)([eE][-+]?[0-9]+)?)|[0-9]+\.)$/;function u(e){function r(e){if(e.match(/^['"]/)){if(e==='""'||e==="''"){return""}var r=e[0];var n=new RegExp("((^|[^\\\\])(?:\\\\\\\\)*)"+r,"g");e=e.replace(n,"$1")}return JSON.parse('"'+e.replace(/\n/g,"\\n")+'"')}var n=e.match(i);if(n){return new RegExp(n[1],n[2])}else if(e.match(/['"]/)){return r(e)}else if(e.match(o)){return L(parseFloat(e))}else if(e.match(c)){return L(parseFloat(e),true)}else if(e==="nil"){return E}else if(e==="true"){return true}else if(e==="false"){return false}else{return new b(e)}}var f=/("(?:\\[\S\s]|[^"])*"|\/(?! )[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|;.*)/g;var s=/("(?:\\[\S\s]|[^"])*"|\/(?! )[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|\(|\)|'|"(?:\\[\S\s]|[^"])+|(?:\\[\S\s]|[^"])*"|;.*|(?:[-+]?(?:(?:\.[0-9]+|[0-9]+\.[0-9]+)(?:[eE][-+]?[0-9]+)?)|[0-9]+\.)[0-9]|\.|,@|,|`|[^(\s)]+)/gim;function l(e){var r=0;var n=0;var t=[];e.split(f).filter(Boolean).forEach(function(e){if(e.match(f)){if(!e.match(/^;/)){var i=(e.split(/\n/),[""]).pop().length;t.push({token:e,col:i,offset:r,line:n});r+=e.length}n+=(e.match("\n")||[]).length;return}e.split("\n").filter(Boolean).forEach(function(e,i){var o=0;e.split(s).filter(Boolean).forEach(function(e){var a={col:o,line:i+n,token:e,offset:r};o+=e.length;r+=e.length;t.push(a)})})});return t}function h(e,r){if(r){return l(e)}else{return l(e).map(function(e){return e.token.trim()}).filter(function(e){return e&&!e.match(/^;/)})}}var v={"'":new b("quote"),"`":new b("quasiquote"),",":new b("unquote"),",@":new b("unquote-splicing")};function y(e){var r=[];var n=[];var t=null;var i=Object.keys(v);var o=i.map(function(e){return v[e].name});var a=0;var c=false;var f=[];var s=[];var l=0;function h(){var e=r[r.length-1];if(e instanceof Array&&e[0]instanceof b&&o.includes(e[0].name)&&r.length>1){r.pop();if(r[r.length-1].length===1&&r[r.length-1][0]instanceof b){r[r.length-1].push(e)}else if(r[r.length-1].length===0){r[r.length-1]=e}else if(r[r.length-1]instanceof _){if(r[r.length-1].cdr instanceof _){r[r.length-1]=new _(r[r.length-1],_.fromArray(e))}else{r[r.length-1].cdr=_.fromArray(e)}}else{r[r.length-1].push(e)}}}e.forEach(function(e){var o=r[r.length-1];if(i.indexOf(e)!==-1){l++;t=e;r.push([v[t]]);if(!t){s=[]}s.push(t)}else if(e==="("){c=true;a++;if(t){f.push(s);s=[]}r.push([]);t=null;l=0}else if(e==="."&&!c){r[r.length-1]=_.fromArray(o)}else if(e===")"){a--;if(!r.length){throw new Error("Unbalanced parenthesis 1")}if(r.length===1){n.push(r.pop())}else if(r.length>1){var p=r.pop();o=r[r.length-1];if(o instanceof Array){o.push(p)}else if(o instanceof _){o.append(_.fromArray(p))}if(f.length){s=f.pop();while(s.length){h();s.pop()}}else{h()}}if(a===0&&r.length){n.push(r.pop())}}else{c=false;var d=u(e);if(t){while(l--){r[r.length-1][1]=d;d=r.pop()}l=0;t=false}o=r[r.length-1];if(o instanceof _){var y=o;while(true){if(y.cdr===E){if(d instanceof Array){y.cdr=_.fromArray(d)}else{y.cdr=d}break}else{y=y.cdr}}}else if(!r.length){n.push(d)}else{o.push(d)}}});if(r.length){console.log({end:r.slice()});throw new Error("Unbalanced parenthesis 2")}return n.map(function(e){if(e instanceof Array){return _.fromArray(e)}return e})}function m(e,r){var t=Object.prototype.toString;var i="[object Array]";var o=[];var a=r&&e||e.slice();var c;if(!e.length){return o}c=a.pop();do{if(t.call(c)===i){a.push.apply(a,c)}else{o.push(c)}}while(a.length&&(c=a.pop())!==n);o.reverse();return o}function w(e){return x(e)==="symbol"||x(e)==="object"&&Object.prototype.toString.call(e)==="[object Symbol]"}function b(e){this.name=e}b.is=function(e,r){return e instanceof b&&typeof r==="string"&&e.name===r};b.prototype.toJSON=b.prototype.toString=function(){if(w(this.name)){return this.name.toString()}return this.name};function k(){}k.prototype.toString=function(){return"nil"};var E=new k;function _(e,r){this.car=e;this.cdr=r}function A(){return new _(n,E)}_.prototype.flatten=function(){return _.fromArray(m(this.toArray()))};_.prototype.length=function(){if(N(this)){return 0}var e=0;var r=this;while(true){if(r===E){break}e++;r=r.cdr}return e};_.prototype.clone=function(){var e=this.cdr;var r=this.car;if(r instanceof _){r=r.clone()}if(e instanceof _){e=this.cdr.clone()}return new _(r,e)};_.prototype.toArray=function(){if(this.isEmptyList()){return[]}var e=[];if(this.car instanceof _){e.push(this.car.toArray())}else{e.push(this.car)}if(this.cdr instanceof _){e=e.concat(this.cdr.toArray())}return e};_.prototype.isEmptyList=function(){return typeof this.car==="undefined"&&this.cdr===E};_.fromArray=function(e){if(e instanceof _){return e}if(e.length&&!(e instanceof Array)){e=g(e)}if(e.length===0){return A()}else{var r;if(e[0]instanceof Array){r=_.fromArray(e[0])}else{r=e[0]}if(e.length===1){return new _(r,E)}else{return new _(r,_.fromArray(e.slice(1)))}}};_.prototype.toObject=function(){var e=this;var r={};while(true){if(e instanceof _&&e.car instanceof _){var n=e.car;var t=n.car;if(t instanceof b){t=t.name}var i=n.cdr;if(i instanceof _){i=i.toObject()}r[t]=i;e=e.cdr}else{break}}return r};_.fromPairs=function(e){return e.reduce(function(e,r){return new _(new _(new b(r[0]),r[1]),e)},E)};_.fromObject=function(e){var r=Object.keys(e).map(function(r){return[r,e[r]]});return _.fromPairs(r)};_.prototype.reduce=function(e){var r=this;var n=E;while(true){if(r!==E){n=e(n,r.car);r=r.cdr}else{break}}return n};_.prototype.reverse=function(){var e=this;var r=E;while(e!==E){var n=e.cdr;e.cdr=r;r=e;e=n}return r};_.prototype.transform=function(e){function r(n){if(n instanceof _){if(n.replace){delete n.replace;return n}var t=e(n.car);if(t instanceof _){t=r(t)}var i=e(n.cdr);if(i instanceof _){i=r(i)}return new _(t,i)}return n}return r(this)};_.prototype.toString=function(){var e=["("];if(this.car!==n){if(typeof this.car==="function"){e.push("<#function "+(this.car.name||"anonymous")+">")}else if(typeof this.car==="string"){e.push(JSON.stringify(this.car))}else if(this.car instanceof b){e.push(this.car.toString())}else if(typeof this.car!=="undefined"){e.push(this.car)}if(this.cdr instanceof _){e.push(" ");e.push(this.cdr.toString().replace(/^\(|\)$/g,""))}else if(typeof this.cdr!=="undefined"&&this.cdr!==E){if(typeof this.cdr==="string"){e=e.concat([" . ",JSON.stringify(this.cdr)])}else{e=e.concat([" . ",this.cdr])}}}e.push(")");return e.join("")};_.prototype.append=function(e){if(e instanceof Array){return this.append(_.fromArray(e))}var r=this;if(r.car===n){if(e instanceof _){this.car=e.car;this.cdr=e.cdr}else{return e}}else{while(true){if(r instanceof _&&r.cdr!==E){r=r.cdr}else{break}}r.cdr=e}return this};function S(e,r){if(e instanceof L&&r instanceof L){return e.cmp(r)===0}else if(typeof e==="number"||typeof r==="number"){return L(e).cmp(L(r))}else if(e instanceof b&&r instanceof b){return e.name===r.name}else{return e===r}}function N(e){return e instanceof _&&e.isEmptyList()||e===E}function P(e,r){if(typeof this!=="undefined"&&this.constructor!==P||typeof this==="undefined"){return new P(e,r)}this.name=e;this.fn=r}P.prototype.invoke=function(e,r,n){var t=r.env,i=r.dynamic_scope,o=r.error;return this.fn.call(t,e,{dynamic_scope:i,error:o,macro_expand:n},this.name)};P.prototype.toString=function(){return"#<Macro "+this.name+">"};var j="define-macro";function O(e){return function(){var r=d(p.mark(function r(n,t){var i,o,a,c,u;return p.wrap(function r(f){while(1){switch(f.prev=f.next){case 0:c=function e(r){if(r instanceof _&&r.car instanceof b){var n=i.get(r.car);if(n instanceof P){console.log({name:n.name,defmacro:n.defmacro})}return n instanceof P&&n.defmacro}if(r.car instanceof _&&o(r.car)){return true}if(r.cdr instanceof _&&o(r.cdr)){return true}return false};a=function e(){a=d(p.mark(function e(r){var n,a,c;return p.wrap(function e(u){while(1){switch(u.prev=u.next){case 0:if(!(r instanceof _&&r.car instanceof b)){u.next=5;break}n=i.get(r.car);if(!(n instanceof P&&n.defmacro)){u.next=4;break}return u.abrupt("return",n.invoke(r.cdr,t,true));case 4:return u.abrupt("return",n);case 5:a=r.car;if(!(a instanceof _)){u.next=10;break}u.next=9;return o(a);case 9:a=u.sent;case 10:c=r.cdr;if(!(c instanceof _)){u.next=15;break}u.next=14;return o(c);case 14:c=u.sent;case 15:return u.abrupt("return",new _(a,c));case 16:case"end":return u.stop()}}},e,this)}));return a.apply(this,arguments)};o=function e(r){return a.apply(this,arguments)};i=t["env"]=this;u=n;if(!e){f.next=13;break}f.t0=B;f.next=9;return o(n);case 9:f.t1=f.sent;return f.abrupt("return",(0,f.t0)(f.t1).car);case 13:f.next=16;return o(n);case 16:u=f.sent;if(c(u)){f.next=19;break}return f.abrupt("break",22);case 19:n=u;f.next=13;break;case 22:return f.abrupt("return",B(n).car);case 23:case"end":return f.stop()}}},r,this)}));return function(e,n){return r.apply(this,arguments)}}()}function L(e,t){if(e instanceof L){return e}if(typeof this!=="undefined"&&this.constructor!==L||typeof this==="undefined"){return new L(e,t===true?true:n)}if(!L.isNumber(e)){throw new Error("You can't create LNumber from "+x(e))}if(e===null){e=0}if(L.isFloat(e)){this.value=e}else if(t){this.value=e;this.float=true}else if(typeof BigInt!=="undefined"){if(typeof e!=="bigint"){this.value=BigInt(e)}else{this.value=e}}else if(typeof r!=="undefined"&&!(e instanceof r)){this.value=new r(e)}else{this.value=e}}L.isFloat=function e(r){return Number(r)===r&&r%1!==0};L.isNumber=function(e){return e instanceof L||L.isNative(e)||L.isBN(e)};L.isNative=function(e){return typeof e==="bigint"||typeof e==="number"};L.isBN=function(e){return typeof r!=="undefined"&&e instanceof r};L.prototype.toString=function(){return this.value.toString()};["floor","ceil","round"].forEach(function(e){L.prototype[e]=function(){if(this.float||L.isFloat(this.value)){return L(Math[e](this.value))}else{return L(this.value)}}});L.prototype.valueOf=function(){if(L.isNative(this.value)){return Number(this.value)}else if(L.isBN(this.value)){return this.value.toNumber()}};L.prototype.coerce=function(e){if(e===null){e=0}var n;if(e instanceof L){n=e.value}else{n=e}if(L.isFloat(n)){}else if(typeof this.value==="bigint"&&typeof n!=="bigint"){n=BigInt(n)}else if(typeof r!=="undefined"&&this.value instanceof r&&!n instanceof r){n=new r(n)}return L(n)};L.prototype.op=function(e,r){var n={"*":function e(r,n){return r*n},"+":function e(r,n){return r+n},"-":function e(r,n){return r-n},"/":function e(r,n){return r/n},"%":function e(r,n){return r%n},"|":function e(r,n){return r|n},"&":function e(r,n){return r&n},"~":function e(r){return~r},">>":function e(r,n){return r>>n},"<<":function e(r,n){return r<<n}};if(L.isFloat(r)||r instanceof L&&(L.isFloat(r.value)||r.float)||L.isFloat(this.value)||this.float){var t=r instanceof L?r.valueOf():r;return L(n[e](this.valueOf(),t))}r=this.coerce(r);if(L.isNative(r.value)&&L.isNative(this.value)){return L(n[e](this.value,r.value))}if(L.isBN(this.value)&&L.isBN(r.value)){var i={"+":"iadd","-":"isub","*":"imul","/":"idiv","%":"imod","|":"ior","&":"iand","~":"inot","<<":"ishrn",">>":"ishln"};e=i[e];return this.value.clone()[e](r,t)}};var q={"+":"add","-":"sub","*":"mul","/":"div","%":"mod","|":"or","&":"and","~":"neg","<<":"shl",">>":"shr"};Object.keys(q).forEach(function(e){L.prototype[q[e]]=function(r){return this.op(e,r)}});L.prototype.sqrt=function(){var e;if(L.isNative(this.value)){e=Math.sqrt(this.value)}else if(L.isBN(this.value)){e=this.value.sqrt()}return new L(e)};L.prototype.pow=function(e){e=this.coerce(e);if(L.isNative(this.value)){try{var r=new Function("a,b","return a**b;");e.value=r(this.value,e.value)}catch(e){throw new Error("Power operator not supported")}}else if(L.isBN(this.value)){e.value=this.value.pow(e.value)}else{e.value=Math.pow(this.value,e.value)}return e};L.prototype.neg=function(){var e=this.value;if(L.isNative(e)){e=-e}else if(L.isBN(e)){e=e.neg()}return new L(e)};L.prototype.abs=function(){var e=this.value;if(L.isNative(this.value)){if(e<0){e=-e}}else if(L.isBN(e)){e.iabs()}return new L(e)};L.prototype.isOdd=function(){if(L.isNative(this.value)){return this.value%2===1}else if(L.isBN(this.value)){return this.value.isOdd()}};L.prototype.isEven=function(){return!this.isOdd()};L.prototype.cmp=function(e){e=this.coerce(e);if(L.isNative(this.value)){if(this.value<e.value){return-1}else if(this.value===e.value){return 0}else{return 1}}else if(L.isBN(this.value)){return this.value.cmp(e.value)}};function R(e,r,n){this.env=e;this.parent=r;this.name=n}R.prototype.inherit=function(e){var r=arguments.length>1&&arguments[1]!==n?arguments[1]:{};if(x(e)==="object"){r=e}if(!e||x(e)==="object"){e="child of "+(this.name||"unknown")}return new R(r||{},this,e)};R.prototype.get=function(r){var n;if(r instanceof b){if(typeof this.env[r.name]!=="undefined"){n=this.env[r.name]}}else if(typeof r==="string"){if(typeof this.env[r]!=="undefined"){n=this.env[r]}}if(typeof n!=="undefined"){if(L.isNumber(n)){return L(n)}return n}if(this.parent instanceof R){return this.parent.get(r)}else{var t;if(r instanceof b){t=r.name}else if(typeof r==="string"){t=r}if(t){var i=x(e[t]);if(i==="function"){return e[t].bind(e)}else if(i!=="undefined"){return e[t]}}}throw new Error("Unbound variable `"+(t.name||t)+"'")};R.prototype.set=function(e,r){if(L.isNumber(r)){r=L(r)}if(e instanceof b){e=e.name}this.env[e]=r};R.prototype.has=function(e){return typeof this.env[e]!=="undefined"};R.prototype.ref=function(e){var r=this;while(true){if(!r){break}if(r.has(e)){return r}r=r.parent}};function B(e){if(e instanceof Promise){return e.then(B)}if(e instanceof _||e instanceof b){e.data=true}return e}function F(e,r){this.value=e;this.count=r}F.prototype.toString=function(){return"<#unquote["+this.count+"] "+this.value+">"};function T(e){var r="let"+(e?"*":"");return new P(r,function(r,n){var t=n.dynamic_scope,i=n.error;var o=this;var a=this.get("list->array")(r.car);var c=o.inherit("let");return new Promise(function(n){var u=[];var f=0;(function s(){var l=a[f++];function h(e){if(e instanceof Promise){u.push(e);return e.then(h)}else if(typeof e==="undefined"){c.set(l.car,E)}else{c.set(l.car,e)}}if(t){t=e?c:o}if(!l){var p=new _(new b("begin"),r.cdr);H(p,{env:c,dynamic_scope:t,error:i}).then(function(e){n(e)})}else{var v=H(l.cdr.car,{env:e?c:o,dynamic_scope:t,error:i});var d=h(v);if(d instanceof Promise){d.then(function(){Promise.all(u).then(s)})}else{s()}}})()})})}var D=function(){var r=0;return function(){var t=arguments.length>0&&arguments[0]!==n?arguments[0]:null;if(t!==null){return new b(e.Symbol("#"+t))}r++;return new b(e.Symbol("#"+r))}}();var M=new R({nil:E,true:true,false:false,stdout:{write:function e(){var r;(r=console).log.apply(r,arguments)}},stdin:{read:function e(){return new Promise(function(e){e(prompt(""))})}},test:function e(){return Promise.resolve(n)},cons:function e(r,n){return new _(r,n)},car:function e(r){if(r instanceof _){return r.car}else{throw new Error("argument to car need to be a list")}},cdr:function e(r){if(r instanceof _){return r.cdr}else{throw new Error("argument to cdr need to be a list")}},"set!":new P("set!",function(e){var r=arguments.length>1&&arguments[1]!==n?arguments[1]:{},t=r.dynamic_scope,i=r.error;var o;if(e.cdr.car instanceof _){if(t){t=this}o=H(e.cdr.car,{env:this,dynamic_scope:t,error:i})}else{o=e.cdr.car}var a;if(e.car instanceof _&&b.is(e.car.car,".")){var c=e.car.cdr.car;var u=e.car.cdr.cdr.car;var f=H(c,{env:this,dynamic_scope:t,error:i});var s=H(u,{env:this,dynamic_scope:t,error:i});o=J(o);if(o instanceof Promise){return o.then(function(e){f[s]=e})}else{f[s]=o;return o}}if(!(e.car instanceof b)){throw new Error("set! first argument need to be a symbol")}a=this.ref(e.car.name);if(!a){a=this}o=J(o);if(o instanceof Promise){return o.then(function(r){return a.set(e.car,r)})}else{a.set(e.car,o)}}),"set-car!":function e(r,n){r.car=n},"set-cdr!":function e(r,n){r.cdr=n},"empty?":function e(r){return typeof r==="undefined"||N(r)},assoc:function e(r,n){if(r instanceof _&&!(n instanceof _)){throw new Error("First argument to assoc new to a key")}var t=n;while(true){if(!(t instanceof _)||this.get("empty?")(t)){break}var i=t.car.car;if(S(i,r)){return t.car}else{t=t.cdr}}return E},gensym:D,load:function r(n){var t=this;e.fetch(n).then(function(e){return e.text()}).then(function(e){t.get("eval")(t.get("read")(e))})},while:new P("while",function(){var e=d(p.mark(function e(r,n){var t,i,o,a,c,u;return p.wrap(function e(f){while(1){switch(f.prev=f.next){case 0:t=n.dynamic_scope,i=n.error;o=this;a=new _(new b("begin"),r.cdr);if(t){t=o}case 4:f.next=7;return H(r.car,{env:o,dynamic_scope:t,error:i});case 7:u=f.sent;if(!(u&&!N(u))){f.next=14;break}f.next=11;return H(a,{env:o,dynamic_scope:t,error:i});case 11:c=f.sent;f.next=15;break;case 14:return f.abrupt("return",c);case 15:f.next=4;break;case 17:case"end":return f.stop()}}},e,this)}));return function(r,n){return e.apply(this,arguments)}}()),if:new P("if",function(e,r){var n=r.dynamic_scope,t=r.error;if(n){n=this}var i=this;var o=function r(o){if(o&&!N(o)){var a=H(e.cdr.car,{env:i,dynamic_scope:n,error:t});if(typeof a==="undefined"){return}return a}else{var c=H(e.cdr.cdr.car,{env:i,dynamic_scope:n,error:t});if(typeof c==="undefined"){return false}return c}};var a=H(e.car,{env:i,dynamic_scope:n,error:t});if(a instanceof Promise){return a.then(o)}else{return o(a)}}),"let*":T(true),let:T(false),begin:new P("begin",function(){var e=d(p.mark(function e(r,n){var t,i,o,a;return p.wrap(function e(c){while(1){switch(c.prev=c.next){case 0:t=n.dynamic_scope,i=n.error;o=this.get("list->array")(r);if(t){t=this}case 3:if(!o.length){c.next=11;break}r=o.shift();c.next=8;return H(r,{env:this,dynamic_scope:t,error:i});case 8:a=c.sent;c.next=12;break;case 11:return c.abrupt("return",a);case 12:c.next=3;break;case 14:case"end":return c.stop()}}},e,this)}));return function(r,n){return e.apply(this,arguments)}}()),timer:new P("timer",function(e){var r=arguments.length>1&&arguments[1]!==n?arguments[1]:{},t=r.dynamic_scope,i=r.error;var o=this;if(t){t=this}return new Promise(function(r){setTimeout(function(){r(H(e.cdr,{env:o,dynamic_scope:t,error:i}))},e.car)})}),define:new P("define",function(e){var r=this;var t=arguments.length>1&&arguments[1]!==n?arguments[1]:{},i=t.dynamic_scope,o=t.error;if(e.car instanceof _&&e.car.car instanceof b){var a=new _(new b("define"),new _(e.car.car,new _(new _(new b("lambda"),new _(e.car.cdr,e.cdr)))));return a}var c=e.cdr.car;if(c instanceof _){c=H(c,{env:this,dynamic_scope:i,error:o})}if(e.car instanceof b){if(c instanceof Promise){return c.then(function(n){r.set(e.car,n)})}else{this.set(e.car,c)}}}),"set-obj":function e(r,n,t){r[n]=t},eval:function e(r){var n=this;if(r instanceof _){return H(r,{env:this,dynamic_scope:this,error:function e(r){return n.get("print")(r.message)}})}if(r instanceof Array){var t;r.forEach(function(e){t=H(e,{env:n,dynamic_scope:n,error:function e(r){return n.get("print")(r.message)}})});return t}},lambda:new P("lambda",function(e){var r=arguments.length>1&&arguments[1]!==n?arguments[1]:{},t=r.dynamic_scope,i=r.error;var o=this;return function(){var r=(t?this:o).inherit("lambda");var n=e.car;var a=0;var c;if(n instanceof b||!N(n)){for(var u=arguments.length,f=new Array(u),s=0;s<u;s++){f[s]=arguments[s]}while(true){if(n.car!==E){if(n instanceof b){c=_.fromArray(f.slice(a));r.env[n.name]=c;break}else{if(typeof f[a]==="undefined"){c=E}else{c=f[a]}r.env[n.car.name]=c}}if(n.cdr===E){break}a++;n=n.cdr}}if(t){t=r}var l=new _(new b("begin"),e.cdr);return H(l,{env:r,dynamic_scope:t,error:i})}}),macroexpand:new P("macro-expand",O()),"macroexpand-1":new P("macro-expand",O(true)),"define-macro":new P(j,function(e,r){var n=r.dynamic_scope,t=r.error;function i(e){if(e instanceof _){delete e.data}return e}if(e.car instanceof _&&e.car.car instanceof b){var o=e.car.car.name;this.env[o]=new P(o,function(r,o){var a=o.macro_expand;var c=new R({},this,"defmacro");var u=e.car.cdr;var f=r;while(true){if(u instanceof b){c.env[u.name]=f;break}else if(u.car!==E&&f.car!==E){c.env[u.car.name]=f.car}if(u.cdr===E){break}f=f.cdr;u=u.cdr}if(n){n=c}if(e.cdr instanceof _){var s=e.cdr.reduce(function(e,r){return H(r,{env:c,dynamic_scope:n,error:t})});if(a){return B(s)}s=H(s,{env:c,dynamic_scope:n,error:t});if(s instanceof Promise){return s.then(i)}return i(s)}});this.env[o].defmacro=true}}),quote:new P("quote",function(e){return B(e.car)}),quasiquote:new P("quasiquote",function(e,r){var n=r.dynamic_scope,t=r.error;var i=this;var o=0;if(n){n=i}function a(e){if(e instanceof _){var r;if(b.is(e.car.car,"unquote-splicing")){r=H(e.car.cdr.car,{env:i,dynamic_scope:n,error:t});if(!r instanceof _){throw new Error("Value of unquote-splicing need"+" to be pair")}if(e.cdr instanceof _){if(r instanceof _){r.cdr.append(a(e.cdr))}else{r=new _(r,a(e.cdr))}}return r}if(b.is(e.car,"unquote")){var c=e.cdr;var u=c;var f=u;var s=1;while(b.is(u.car.car,"unquote")){f=u;s++;u=u.car.cdr.car}if(s>o){o=s}if(f===u){if(e.cdr.cdr!==E){return new _(new F(e.cdr.car,s),e.cdr.cdr)}else{return new F(e.cdr.car,s)}}else if(f.cdr.cdr!==E){f.car.cdr=new _(new F(u,s),f.cdr===E?E:f.cdr.cdr)}else{f.car.cdr=new F(u,s)}return c.car}var l=e.car;if(l instanceof _){l=a(l)}var h=e.cdr;if(h instanceof _){h=a(h)}return new _(l,h)}return e}function c(e){if(e instanceof F){if(o===e.count){return H(e.value,{env:i,dynamic_scope:n,error:t})}else{return new _(new b("unquote"),new _(c(e.value),E))}}if(e instanceof _){var r=e.car;if(r instanceof _||r instanceof F){r=c(r)}var a=e.cdr;if(a instanceof _||a instanceof F){a=c(a)}return new _(r,a)}return e}return B(c(a(e.car)))}),clone:function e(r){return r.clone()},append:function e(r,n){return r.clone().append([n])},"append!":new P("append!",function(e,r){var n=r.dynamic_scope,t=r.error;if(n){n=this}var i=H(e.cdr.car,{env:this,dynamic_scope:n,error:t});return this.get(e.car).append([i])}),list:function e(){return _.fromArray([].slice.call(arguments))},concat:function e(){return[].join.call(arguments,"")},join:function e(r,n){return this.get("list->array")(n).join(r)},split:function e(r,n){return this.get("array->list")(r.split(n))},replace:function e(r,n,t){return r.replace(n,t)},match:function e(r,n){return this.get("array->list")(r.match(n))},search:function e(r,n){return r.search(n)},string:function e(r){if(typeof jQuery!=="undefined"&&r instanceof jQuery.fn.init){return"<#jQuery>"}if(r instanceof L){return r.value.toString()}if(typeof r==="undefined"){return"<#undefined>"}if(typeof r==="function"){return"<#function>"}if(r===E){return"nil"}if(r instanceof Array||r===null){return JSON.stringify(r)}if(r instanceof _){return r.toString()}if(x(r)==="object"){var n=r.constructor.name;if(n!==""){return"<#"+n+">"}return"<#Object>"}if(typeof r!=="string"){return r.toString()}return r},env:function e(r){r=r||this;var t=Object.keys(r.env);var i;if(t.length){i=_.fromArray(t)}else{i=E}if(r.parent!==n){return this.get("env").call(this,r.parent).append(i)}return i},new:function e(r){for(var n=arguments.length,t=new Array(n>1?n-1:0),i=1;i<n;i++){t[i-1]=arguments[i]}return a(r,t)},".":function e(r,n){var t=n instanceof b?n.name:n;var i=r[t];if(typeof i==="function"){return i.bind(r)}return i},type:function e(r){return x(r)},instanceof:function e(r,n){return r instanceof n},read:function e(r){var n=this;if(typeof r==="string"){r=y(h(r));if(r.length){return r[r.length-1]}return A()}return this.get("stdin").read().then(function(r){return e.call(n,r)})},print:function e(){var r,n=this;for(var t=arguments.length,i=new Array(t),o=0;o<t;o++){i[o]=arguments[o]}(r=this.get("stdout")).write.apply(r,g(i.map(function(e){return n.get("string")(e)})))},flatten:function e(r){return r.flatten()},"array->list":function e(r){return _.fromArray(r)},"list->array":function e(r){if(r instanceof _&&r.isEmptyList()){return[]}var n=[];var t=r;while(true){if(t instanceof _){n.push(t.car);t=t.cdr}else{break}}return n},apply:new P("apply",function(e){var r=this;var t=arguments.length>1&&arguments[1]!==n?arguments[1]:{},i=t.dynamic_scope,o=t.error;if(i){i=this}function a(r){if(typeof r!=="function"){var n;if(e.car instanceof b){n="Variable `"+e.car.name+"' is not a function"}else{n="Expression `"+e.car.toString()+"' is not a function"}throw new Error(n)}}var c=function n(t){a(t);var c=H(e.cdr.car,{env:r,dynamic_scope:i,error:o});c=r.get("list->array")(c);if(c.filter(function(e){return e instanceof Promise}).length){return Promise.all(c).then(function(e){return t.apply(r,e)})}else{return t.apply(r,c)}};var u=H(e.car,{env:this,dynamic_scope:i,error:o});if(u instanceof Promise){return u.then(c)}else{return c(u)}}),length:function e(r){if(!r){return L(0)}if(r instanceof _){return L(r.length())}if("length"in r){return L(r.length)}},find:function(){var e=d(p.mark(function e(r,n){var t,i;return p.wrap(function e(o){while(1){switch(o.prev=o.next){case 0:t=this.get("list->array")(n);i=0;case 2:if(!(i<t.length)){o.next=10;break}o.next=5;return r(t[i],i);case 5:if(!o.sent){o.next=7;break}return o.abrupt("return",t[i]);case 7:++i;o.next=2;break;case 10:case"end":return o.stop()}}},e,this)}));return function r(n,t){return e.apply(this,arguments)}}(),map:function(){var e=d(p.mark(function e(r,n){var t,i,o,a;return p.wrap(function e(c){while(1){switch(c.prev=c.next){case 0:t=this.get("list->array")(n);i=[];o=0;case 3:if(!(o<t.length)){c.next=12;break}a=t[o++];c.t0=i;c.next=8;return r(a,o);case 8:c.t1=c.sent;c.t0.push.call(c.t0,c.t1);c.next=3;break;case 12:return c.abrupt("return",_.fromArray(i));case 13:case"end":return c.stop()}}},e,this)}));return function r(n,t){return e.apply(this,arguments)}}(),reduce:function(){var e=d(p.mark(function e(r,t){var i,o,a,c,u,f=arguments;return p.wrap(function e(s){while(1){switch(s.prev=s.next){case 0:i=f.length>2&&f[2]!==n?f[2]:null;o=this.get("list->array")(t);if(!(t.length===0)){s.next=4;break}return s.abrupt("return",E);case 4:a=i;if(i===null){a=o.unshift()}c=0;case 7:if(!(c<o.length)){s.next=14;break}u=o[c];s.next=11;return r(a,u);case 11:a=s.sent;s.next=7;break;case 14:if(!(typeof a==="number")){s.next=16;break}return s.abrupt("return",L(a));case 16:return s.abrupt("return",a);case 17:case"end":return s.stop()}}},e,this)}));return function r(n,t){return e.apply(this,arguments)}}(),filter:function(){var e=d(p.mark(function e(r,n){var t,i,o,a,c;return p.wrap(function e(u){while(1){switch(u.prev=u.next){case 0:t=this.get("list->array")(n);i=[];o=0;case 3:if(!(o<t.length)){u.next=11;break}a=t[o++];u.next=7;return r(a,o);case 7:c=u.sent;if(c){i.push(a)}u.next=3;break;case 11:return u.abrupt("return",_.fromArray(i,true));case 12:case"end":return u.stop()}}},e,this)}));return function r(n,t){return e.apply(this,arguments)}}(),range:function e(r){if(r instanceof L){r=r.valueOf()}return _.fromArray(new Array(r).fill(0).map(function(e,r){return L(r)}))},curry:function e(r){for(var n=arguments.length,t=new Array(n>1?n-1:0),i=1;i<n;i++){t[i-1]=arguments[i]}var o=r.length;return function(){var e=t.slice();function n(){for(var t=arguments.length,i=new Array(t),a=0;a<t;a++){i[a]=arguments[a]}e=e.concat(i);if(e.length>=o){return r.apply(this,e)}else{return n}}return n.apply(this,arguments)}},odd:function e(r){return L(r).isOdd()},even:function e(r){return L(r).isEvent()},"*":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){return L(e).mul(r)})}},"+":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){if(L.isNumber(e)&&L.isNumber(r)){return L(e).add(r)}else if(typeof e==="string"){throw new Error("To concatenate strings use `concat`")}return e+r})}},"-":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length===1){return L(n[0]).neg()}if(n.length){return n.reduce(function(e,r){return L(e).sub(r)})}},"/":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){return L(e).div(r)})}},abs:function e(r){return L(r).abs()},sqrt:function e(r){if(r instanceof L){return Math.sqrt(r.valueOf())}return Math.sqrt(r)},"**":function e(r,n){return L(r).pow(n)},"1+":function e(r){return L(r).add(1)},"1-":function e(r){return L(r).sub(1)},"++":new P("++",function(e){var r=this.get(e.car);var n=L(r).add(1);this.set(e.car,n);return n}),"--":new P("--",function(e){var r=this.get(e.car);var n=L(r).sub(1);this.set(e.car,n);return n}),"%":function e(r,n){return L(r).mod(n)},"==":function e(r,n){return L(r).cmp(n)===0},">":function e(r,n){return L(r).cmp(n)===1},"<":function e(r,n){return L(r).cmp(n)===-1},"<=":function e(r,n){return[0,-1].includes(L(r).cmp(n))},">=":function e(r,n){return[0,1].includes(L(r).cmp(n))},"eq?":S,or:new P("or",function(e,r){var n=r.dynamic_scope,t=r.error;var i=this.get("list->array")(e);var o=this;if(n){n=o}return new Promise(function(e){var r;(function a(){function c(n){r=n;if(r){e(n)}a()}var u=i.shift();if(typeof u==="undefined"){if(r){e(r)}else{e(false)}}else{var f=H(u,{env:o,dynamic_scope:n,error:t});if(f instanceof Promise){f.then(c)}else{c(f)}}})()})}),and:new P("and",function(e){var r=arguments.length>1&&arguments[1]!==n?arguments[1]:{},t=r.dynamic_scope,i=r.error;var o=this.get("list->array")(e);var a=this;if(t){t=a}return new Promise(function(e){var r;(function n(){function c(t){r=t;if(!r){e(false)}n()}var u=o.shift();if(typeof u==="undefined"){if(r){e(r)}else{e(false)}}else{var f=H(u,{env:a,dynamic_scope:t,error:i});if(f instanceof Promise){f.then(c)}else{c(f)}}})()})}),"|":function e(r,n){return L(r).or(n)},"&":function e(r,n){return L(r).and(n)},"~":function e(r){return L(r).neg()},">>":function e(r,n){return L(r).shr(n)},"<<":function e(r,n){return L(r).shl(n)},not:function e(r){if(N(r)){return true}return!r},"->":function e(r,n){for(var t=arguments.length,i=new Array(t>2?t-2:0),o=2;o<t;o++){i[o-2]=arguments[o]}return r[n].apply(r,i)}},n,"global");["floor","round","ceil"].forEach(function(e){M.set(e,function(r){if(r instanceof L){return r[e]()}throw new Error("".concat(x(r)," ").concat(r.toString()," is not a number"))})});function G(e){if(e.length===1){return e[0]}else{var r=[];var n=G(e.slice(1));for(var t=0;t<n.length;t++){for(var i=0;i<e[0].length;i++){r.push(e[0][i]+n[t])}}return r}}function I(e,r,n){var t=[];for(var i=r;i<=n;++i){var o=[];for(var a=0;a<i;++a){o.push(e)}t=t.concat(G(o))}return t}I(["d","a"],2,5).forEach(function(e){var r=e.split("").reverse();M.set("c"+e+"r",function(e){return r.reduce(function(e,r){if(r==="a"){return e.car}else{return e.cdr}},e)})});if(typeof global!=="undefined"){M.set("global",global)}else if(typeof window!=="undefined"){M.set("window",window)}function $(e){if(typeof e==="string"){return"string"}else if(e instanceof L){return"number"}else if(e instanceof RegExp){return"regex"}else if(typeof e==="boolean"){return"boolean"}else{return"unknown type"}}function J(e){var r=[];n(e);if(r.length){return i(e)}return e;function n(e){if(e instanceof Promise){r.push(e)}else if(e instanceof _){n(e.car);n(e.cdr)}else if(e instanceof Array){e.forEach(n)}}function i(e){if(e instanceof Array){return Promise.all(e.map(i))}if(e instanceof _){var r=i(e.car);var n=i(e.cdr);return Promise.all([r,n]).then(function(r){var n=t(r,2),i=n[0],o=n[1];var a=new _(i,o);if(e.data){B(a)}return a})}else{return e}}}function U(e,r){var n=r.env,t=r.dynamic_scope,i=r.error;var o=[];var a=e;while(true){if(a instanceof _){o.push(H(a.car,{env:n,dynamic_scope:t,error:i}));a=a.cdr}else{break}}return J(o)}function C(e,r,n){if(r instanceof _){r=r.clone()}var t=e.invoke(r,n);t=J(t,true);if(t&&t.data){return t}else if(t instanceof Promise){return t.then(function(e){if(e&&e.data){return e}return H(e,n)})}return H(t,n)}function H(e){var r=arguments.length>1&&arguments[1]!==n?arguments[1]:{},t=r.env,i=r.dynamic_scope,o=r.error,a=o===void 0?function(){}:o;try{if(i===true){t=i=t||M}else if(t===true){t=i=M}else{t=t||M}var c={env:t,dynamic_scope:i,error:a};var u;if(typeof e==="undefined"||e===E||e===null){return e}if(N(e)){return A()}var f=e.car;var s=e.cdr;if(f instanceof _){u=J(H(f,c));if(u instanceof Promise){return u.then(function(r){return H(new _(r,e.cdr),c)})}else if(typeof u!=="function"){throw new Error(t.get("string")(u)+" is not a function")}}if(f instanceof b){u=t.get(f);if(u instanceof P){return C(u,s,c)}else if(typeof u!=="function"){if(u){var l="".concat($(u)," `").concat(u,"' is not a function");throw new Error(l)}throw new Error("Unknown function `".concat(f.name,"'"))}}else if(typeof f==="function"){u=f}if(typeof u==="function"){var h=U(s,c);if(h instanceof Promise){return h.then(function(e){var r=i||t;return B(J(u.apply(r,e)))})}return B(J(u.apply(i||t,h)))}else if(e instanceof b){u=t.get(e);if(u==="undefined"){throw new Error("Unbound variable `"+e.name+"'")}return u}else if(e instanceof _){u=f&&f.toString();throw new Error("".concat($(f)," ").concat(u," is not a function"))}else{return e}}catch(e){a&&a(e)}}function Q(e,r,n){if(n===true){r=n=r||M}else if(r===true){r=n=M}else{r=r||M}var t=y(h(e));return new Promise(function(e,i){var o=[];(function(){var a=d(p.mark(function a(){var c,u;return p.wrap(function a(f){while(1){switch(f.prev=f.next){case 0:c=t.shift();if(c){f.next=5;break}e(o);f.next=16;break;case 5:f.prev=5;f.next=8;return H(c,{env:r,dynamic_scope:n,error:function e(r){i(r);throw r}});case 8:u=f.sent;f.next=14;break;case 11:f.prev=11;f.t0=f["catch"](5);return f.abrupt("return",i(f.t0));case 14:o.push(u);recur();case 16:case"end":return f.stop()}}},a,this,[[5,11]])}));return function e(){return a.apply(this,arguments)}})()()})}function V(e){var r=/[()]/;var n=h(e).filter(function(e){return e.match(r)});var t=n.filter(function(e){return e===")"});var i=n.filter(function(e){return e==="("});return t.length===i.length}_.unDry=function(e){return new _(e.car,e.cdr)};_.prototype.toDry=function(){return{value:{car:this.car,cdr:this.cdr}}};k.prototype.toDry=function(){return{value:null}};k.unDry=function(){return E};b.prototype.toDry=function(){return{value:{name:this.name}}};b.unDry=function(e){return new b(e.name)};function Y(){var r="text/x-lips";if(window.document){Array.from(document.querySelectorAll("script")).forEach(function(n){var t=n.getAttribute("type");if(t===r){var i=n.getAttribute("src");if(i){e.fetch(i).then(function(e){return e.text()}).then(Q)}else{Q(n.innerHTML)}}else if(t&&t.match(/lips|lisp/)){console.warn("Expecting "+r+" found "+t)}})}}function z(e){if(typeof window!=="undefined"){if(window.addEventListener){window.addEventListener("load",e,false)}else if(window.attachEvent){window.attachEvent("onload",e)}else if(typeof window.onload==="function"){(function(r){window.onload=function(){e();r()}})(window.onload)}else{window.onload=e}}}z(function(){setTimeout(Y,0)});return{version:"DEV",exec:Q,parse:y,tokenize:h,evaluate:H,Environment:R,global_environment:M,env:M,balanced_parenthesis:V,Macro:P,quote:B,Pair:_,nil:E,maybe_promise:J,Symbol:b,LNumber:L}})})();