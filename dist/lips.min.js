/**@license
 * LIPS is Pretty Simple - version 0.4.0
 *
 * Copyright (c) 2018 Jakub Jankiewicz <http://jcubic.pl/me>
 * Released under the MIT license
 *
 * build: Sun, 13 May 2018 13:05:02 +0000
 */
"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol==="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};function _toConsumableArray(n){if(Array.isArray(n)){for(var r=0,e=Array(n.length);r<n.length;r++){e[r]=n[r]}return e}else{return Array.from(n)}}(function(n,r){if(typeof define==="function"&&define.amd){define([],function(){return n.lips=r()})}else if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&module.exports){module.exports=r()}else{n.lips=r()}})(typeof self!=="undefined"?self:undefined,function(n){var r=/^\/((?:\\\/|[^/]|\[[^\]]*\/[^\]]*\])+)\/([gimy]*)$/;var e=/^[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?$/;function t(n){function t(n){if(n.match(/^['"]/)){if(n==='""'||n==="''"){return""}var r=n[0];var e=new RegExp("((^|[^\\\\])(?:\\\\\\\\)*)"+r,"g");n=n.replace(e,"$1")}return JSON.parse('"'+n+'"')}var i=n.match(r);if(i){return new RegExp(i[1],i[2])}else if(n.match(/['"]/)){return t(n)}else if(n.match(/^-?[0-9]+$/)){return parseInt(n,10)}else if(n.match(e)){return parseFloat(n)}else if(n==="nil"){return h}else{return new s(n)}}var i=/("[^"\\]*(?:\\[\S\s][^"\\]*)*"|\/[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|;.*|\(|\)|'|\.|,@|,|`|[^(\s)]+)/gi;function a(n,r){if(r){return o(n)}else{return o(n).map(function(n){return n.token.trim()}).filter(function(n){return n&&!n.match(/^;/)})}}function o(n){var r=0;return n.split("\n").map(function(n,e){var t=0;r+=e===0?0:1;return n.split(i).filter(Boolean).map(function(n){var i={col:t,line:e,token:n,offset:r};t+=n.length;r+=n.length;return i})}).reduce(function(n,r){return n.concat(r)},[])}var f={"'":new s("quote"),"`":new s("quasiquote"),",":new s("unquote"),",@":new s("unquote-splicing")};function c(n){var r=[];var e=[];var i=null;var a=Object.keys(f);var o=a.map(function(n){return f[n].name});var c=0;var u=false;var l=[];var p=[];function v(){var n=r[r.length-1];if(n instanceof Array&&n[0]instanceof s&&o.includes(n[0].name)&&r.length>1){r.pop();if(r[r.length-1].length===1&&r[r.length-1][0]instanceof s){r[r.length-1].push(n)}else if(r[r.length-1].length===0){r[r.length-1]=n}else if(r[r.length-1]instanceof d){if(r[r.length-1].cdr instanceof d){r[r.length-1]=new d(r[r.length-1],d.fromArray(n))}else{r[r.length-1].cdr=d.fromArray(n)}}else{r[r.length-1].push(n)}}}n.forEach(function(n){var o=r[r.length-1];if(a.indexOf(n)!==-1){i=n;r.push([f[i]]);if(!i){p=[]}p.push(i)}else if(n==="("){u=true;c++;if(i){l.push(p);p=[]}r.push([]);i=null}else if(n==="."&&!u){r[r.length-1]=d.fromArray(o)}else if(n===")"){c--;if(!r.length){throw new Error("Unbalanced parenthesis 1")}if(r.length===1){e.push(r.pop())}else if(r.length>1){var s=r.pop();o=r[r.length-1];if(o instanceof Array){o.push(s)}else if(o instanceof d){o.append(d.fromArray(s))}if(l.length){p=l.pop();while(p.length){v();p.pop()}}else{v()}}if(c===0&&r.length){e.push(r.pop())}}else{u=false;var y=t(n);if(i){r[r.length-1][1]=y;y=r.pop();i=false}o=r[r.length-1];if(o instanceof d){var w=o;while(true){if(w.cdr===h){if(y instanceof Array){w.cdr=d.fromArray(y)}else{w.cdr=y}break}else{w=w.cdr}}}else if(!r.length){e.push(y)}else{o.push(y)}}});if(r.length){console.log({end:r.slice()});throw new Error("Unbalanced parenthesis 2")}return e.map(function(n){if(n instanceof Array){return d.fromArray(n)}return n})}function u(r,e){var t=Object.prototype.toString;var i="[object Array]";var a=[];var o=e&&r||r.slice();var f;if(!r.length){return a}f=o.pop();do{if(t.call(f)===i){o.push.apply(o,f)}else{a.push(f)}}while(o.length&&(f=o.pop())!==n);a.reverse();return a}function s(n){this.name=n}s.is=function(n,r){return n instanceof s&&typeof r==="string"&&n.name===r};s.prototype.toJSON=s.prototype.toString=function(){return this.name};function l(){}l.prototype.toString=function(){return"nil"};var h=new l;function d(n,r){this.car=n;this.cdr=r}d.prototype[window.Symbol.iterator]=regeneratorRuntime.mark(function n(){var r;return regeneratorRuntime.wrap(function n(e){while(1){switch(e.prev=e.next){case 0:r=this;case 1:if(!true){e.next=9;break}if(!(!r||r===h)){e.next=4;break}return e.abrupt("break",9);case 4:e.next=6;return r.car;case 6:r=r.cdr;e.next=1;break;case 9:case"end":return e.stop()}}},n,this)});d.prototype.flatten=function(){return d.fromArray(u(this.toArray()))};d.prototype.length=function(){var n=0;var r=this;while(true){if(r===h){break}n++;r=r.cdr}return n};d.prototype.clone=function(){var n=this.cdr;var r=this.car;if(r instanceof d){r=r.clone()}if(n instanceof d){n=this.cdr.clone()}return new d(r,n)};d.prototype.toArray=function(){if(this.cdr===h&&this.car===h){return[]}var n=[];if(this.car instanceof d){n.push(this.car.toArray())}else{n.push(this.car)}if(this.cdr instanceof d){n=n.concat(this.cdr.toArray())}return n};d.fromArray=function(r){if(r instanceof d){return r}if(r.length&&!r instanceof Array){r=[].concat(_toConsumableArray(r))}if(r.length===0){return new d(n,h)}else{var e;if(r[0]instanceof Array){e=d.fromArray(r[0])}else{e=r[0]}if(r.length===1){return new d(e,h)}else{return new d(e,d.fromArray(r.slice(1)))}}};d.prototype.toObject=function(){var n=this;var r={};while(true){if(n instanceof d&&n.car instanceof d){var e=n.car;var t=e.car;if(t instanceof s){t=t.name}r[t]=e.cdr;n=n.cdr}else{break}}return r};d.fromPairs=function(n){return n.reduce(function(n,r){return new d(new d(new s(r[0]),r[1]),n)},h)};d.fromObject=function(n){var r=Object.keys(n).map(function(r){return[r,n[r]]});return d.fromPairs(r)};d.prototype.reduce=function(n){var r=this;var e=h;while(true){if(r!==h){e=n(e,r.car);r=r.cdr}else{break}}return e};d.prototype.reverse=function(){var n=this;var r=h;while(n!==h){var e=n.cdr;n.cdr=r;r=n;n=e}return r};d.prototype.transform=function(n){var r=[];function e(t){if(t instanceof d){if(t.replace){delete t.replace;return t}var i=n(t.car);if(i instanceof d){i=e(i);r.push(i)}var a=n(t.cdr);if(a instanceof d){a=e(a);r.push(a)}return new d(i,a)}return t}return e(this)};d.prototype.toString=function(){var r=["("];if(this.car!==n){if(typeof this.car==="string"){r.push(JSON.stringify(this.car))}else if(typeof this.car!=="undefined"){r.push(this.car)}if(this.cdr instanceof d){r.push(" ");r.push(this.cdr.toString().replace(/^\(|\)$/g,""))}else if(typeof this.cdr!=="undefined"&&this.cdr!==h){if(typeof this.cdr==="string"){r=r.concat([" . ",JSON.stringify(this.cdr)])}else{r=r.concat([" . ",this.cdr])}}}r.push(")");return r.join("")};d.prototype.append=function(r){if(r instanceof Array){return this.append(d.fromArray(r))}var e=this;if(e.car===n){if(r instanceof d){this.car=r.car;this.cdr=r.cdr}else{return r}}else{while(true){if(e instanceof d&&e.cdr!==h){e=e.cdr}else{break}}e.cdr=r}return this};function p(n){this.fn=n}p.prototype.invoke=function(n,r){return this.fn.call(r,n)};function v(n,r){this.env=n;this.parent=r}v.prototype.get=function(n){if(n instanceof s){if(typeof this.env[n.name]!=="undefined"){return this.env[n.name]}}else if(typeof n==="string"){if(typeof this.env[n]!=="undefined"){return this.env[n]}}if(this.parent instanceof v){return this.parent.get(n)}else{var r;if(n instanceof s){r=n.name}else if(typeof n==="string"){r=n}if(r){var e=_typeof(window[r]);if(e==="function"){return window[r].bind(window)}else if(e!=="undefined"){return window[r]}}}};v.prototype.set=function(n,r){this.env[n]=r};function y(n){this.value=n}function w(n,r){this.value=n;this.count=r}w.prototype.toString=function(){return"<#unquote["+this.count+"] "+this.value+">"};function g(n){return new p(function(r){var e=this.get("list->array")(r.car);var t=new v({},this);return new Promise(function(i){var a=[];var o=0;(function f(){var c=e[o++];function u(n){if(n instanceof Promise){a.push(n);return n.then(u)}else{t.set(c.car,n)}}if(!c){var l=new d(new s("begin"),r.cdr);i(new y(E(l,t)))}else{var h=E(c.cdr.car,n?t:this);var p=u(h);if(p instanceof Promise){p.then(function(){Promise.all(a).then(f)})}else{f()}}})()})})}var m=function(){var n=0;return function(){n++;return new s("#"+n)}}();function b(r){var e=arguments.length>1&&arguments[1]!==n?arguments[1]:"GET";var t=arguments.length>2&&arguments[2]!==n?arguments[2]:{};var i=arguments.length>3&&arguments[3]!==n?arguments[3]:null;var a=new XMLHttpRequest;a.open(e,r,true);Object.keys(t).forEach(function(n){a.setRequestHeader(n,t[n])});return new Promise(function(n){a.onreadystatechange=function(){if(a.readyState===4&&a.status===200){n(a.responseText)}};if(i!==null){a.send(i)}else{a.send()}})}var A=new v({nil:h,window:window,true:true,false:false,stdout:{write:function n(){var r;(r=console).log.apply(r,arguments)}},stdin:{read:function n(){return new Promise(function(n){n(prompt(""))})}},cons:function n(r,e){return new d(r,e)},car:function n(r){if(r instanceof d){return r.car}else{throw new Error("argument to car need to be a list")}},cdr:function n(r){if(r instanceof d){return r.cdr}else{throw new Error("argument to cdr need to be a list")}},"set-car":function n(r,e){r.car=e},"set-cdr":function n(r,e){r.cdr=e},assoc:function n(r,e){var t=r;var i=e instanceof s?e.name:e;while(true){var a=t.car.car;if(a instanceof s&&a.name===i||a.name===i){return t.car}else{t=t.cdr}}},gensym:m,load:function n(r){var e=this;b(r).then(function(n){e.get("eval")(e.get("read")(n))})},while:new p(function(n){var r=this;var e=new d(new s("begin"),n.cdr);return new Promise(function(t){var i;(function a(){function o(n){if(n){var o=E(e,r);if(o instanceof Promise){o.then(function(n){i=n;a()})}else{i=o;a()}}else{t(i)}}var f=E(n.car,r);if(f instanceof Promise){f.then(o)}else{o(f)}})()})}),if:new p(function(n){var r=this;var e=function e(t){if(t){var i=E(n.cdr.car,r);if(typeof i==="undefined"){return}return i}else if(n.cdr.cdr.car instanceof d){var a=E(n.cdr.cdr.car,r);if(typeof a==="undefined"){return false}return a}else{return false}};var t=E(n.car,this);if(t instanceof Promise){return t.then(e)}else{return e(t)}}),"let*":g(true),let:g(false),begin:new p(function(n){var r=this;var e=this.get("list->array")(n);return e.reduce(function(n,e){return E(e,r)},0)}),timer:new p(function(n){var r=this;return new Promise(function(e){setTimeout(function(){e(new y(E(n.cdr,r)))},n.car)})}),define:new p(function(n){if(n.car instanceof d&&n.car.car instanceof s){var r=new d(new s("define"),new d(n.car.car,new d(new d(new s("lambda"),new d(n.car.cdr,n.cdr)))));return r}var e=n.cdr.car;if(e instanceof d){e=E(e,this)}if(n.car instanceof s){this.env[n.car.name]=e}}),set:function n(r,e,t){r[e]=t},eval:function n(r){var e=this;if(r instanceof d){return E(r,this)}if(r instanceof Array){var t;r.forEach(function(n){t=E(n,e)});return t}},lambda:new p(function(n){var r=this;return function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++){t[i]=arguments[i]}var a=new v({},r);var o=n.car;var f=0;var c;while(true){if(o.car!==h){if(o instanceof s){c=d.fromArray(t.slice(f));a.env[o.name]=c;break}else{if(typeof t[f]==="undefined"){c=h}else{c=t[f]}a.env[o.car.name]=c}}if(o.cdr===h){break}f++;o=o.cdr}return E(n.cdr.car,a)}}),defmacro:new p(function(n){if(n.car.car instanceof s){this.env[n.car.car.name]=new p(function(r){var e=new v({},this);var t=n.car.cdr;var i=r;while(true){if(t.car!==h&&i.car!==h){e.env[t.car.name]=i.car}if(t.cdr===h){break}i=i.cdr;t=t.cdr}return E(n.cdr.car,e)})}}),quote:new p(function(n){return new y(n.car)}),quasiquote:new p(function(n){var r=this;var e=0;function t(n){if(n instanceof d){var i;if(s.is(n.car.car,"unquote-splicing")){i=E(n.car.cdr.car,r);if(!i instanceof d){throw new Error("Value of unquote-splicing need"+" to be pair")}if(n.cdr instanceof d){if(i instanceof d){i.cdr.append(t(n.cdr))}else{i=new d(i,t(n.cdr))}}return i}if(s.is(n.car,"unquote")){var a=n.cdr;var o=a;var f=o;var c=1;while(s.is(o.car.car,"unquote")){f=o;c++;o=o.car.cdr.car}if(c>e){e=c}if(f===o){if(n.cdr.cdr!==h){return new d(new w(n.cdr.car,c),n.cdr.cdr)}else{return new w(n.cdr.car,c)}}else if(f.cdr.cdr!==h){f.car.cdr=new d(new w(o,c),f.cdr===h?h:f.cdr.cdr)}else{f.car.cdr=new w(o,c)}return a.car}var u=n.car;if(u instanceof d){u=t(u)}var l=n.cdr;if(l instanceof d){l=t(l)}return new d(u,l)}return n}function i(n){if(n instanceof w){if(e===n.count){return E(n.value,r)}else{return new d(new s("unquote"),new d(i(n.value),h))}}if(n instanceof d){var t=n.car;if(t instanceof d||t instanceof w){t=i(t)}var a=n.cdr;if(a instanceof d||a instanceof w){a=i(a)}return new d(t,a)}return n}return new y(i(t(n.car)))}),clone:function n(r){return r.clone()},append:function n(r,e){return this.get("append!")(r.clone(),e)},"append!":function n(r,e){return r.append(e)},list:function n(){return d.fromArray([].slice.call(arguments))},concat:function n(){return[].join.call(arguments,"")},join:function n(r,e){return this.get("list->array")(e).join(r)},split:function n(r,e){return this.get("array->list")(r.split(e))},replace:function n(r,e,t){return r.replace(e,t)},match:function n(r,e){return this.get("array->list")(r.match(e))},search:function n(r,e){return r.search(e)},string:function n(r){if(typeof jQuery!=="undefined"&&r instanceof jQuery.fn.init){return"<#jQuery>"}if(r instanceof p){}if(typeof r==="undefined"){return"<#undefined>"}if(typeof r==="function"){return"<#function>"}if(r===h){return"nil"}if(r instanceof Array||r===null){return JSON.stringify(r)}if(r instanceof d){return r.toString()}if((typeof r==="undefined"?"undefined":_typeof(r))==="object"){var e=r.constructor.name;if(e!==""){return"<#"+e+">"}return"<#Object>"}if(typeof r!=="string"){return r.toString()}return r},env:function r(e){e=e||this;var t=Object.keys(e.env);var i;if(t.length){i=d.fromArray(t)}else{i=h}if(e.parent!==n){return this.get("env").call(this,e.parent).append(i)}return i},".":function n(r,e){var t=e instanceof s?e.name:e;var i=r[t];if(typeof i==="function"){return i.bind(r)}return i},type:function n(r){return typeof r==="undefined"?"undefined":_typeof(r)},instanceof:function n(r,e){return r instanceof e},read:function n(r){var e=this;if(typeof r==="string"){return c(a(r))}return this.get("stdin").read().then(function(n){return e.get("read").call(e,n)})},print:function n(){var r,e=this;for(var t=arguments.length,i=Array(t),a=0;a<t;a++){i[a]=arguments[a]}(r=this.get("stdout")).write.apply(r,_toConsumableArray(i.map(function(n){return e.get("string")(n)})))},flatten:function n(r){return r.flatten()},"array->list":function n(r){return d.fromArray(r)},"list->array":function n(r){var e=[];var t=r;while(true){if(t instanceof d){e.push(t.car);t=t.cdr}else{break}}return e},filter:function n(r,e){return d.fromArray(this.get("list->array")(e).filter(r))},odd:function n(r){return r%2===1},even:function n(r){return r%2===0},apply:function n(r,e){var t=this.get("list->array")(e);return r.apply(null,t)},map:function n(r,e){var t=this.get("list->array")(e).map(r);if(t.length){return d.fromArray(t)}else{return h}},reduce:function r(e,t){var i=arguments.length>2&&arguments[2]!==n?arguments[2]:null;var a=this.get("list->array")(t);if(i===null){return a.slice(1).reduce(function(n,r){return e(n,r)},a[0])}else{return a.reduce(function(n,r){return e(n,r)},i)}},curry:function n(r){for(var e=arguments.length,t=Array(e>1?e-1:0),i=1;i<e;i++){t[i-1]=arguments[i]}var a=r.length;return function(){var n=t.slice();function e(){for(var t=arguments.length,i=Array(t),o=0;o<t;o++){i[o]=arguments[o]}n=n.concat(i);if(n.length>=a){return r.apply(this,n)}else{return e}}return e.apply(this,arguments)}},range:function n(r){return d.fromArray(new Array(r).fill(0).map(function(n,r){return r}))},"*":function n(){for(var r=arguments.length,e=Array(r),t=0;t<r;t++){e[t]=arguments[t]}return e.reduce(function(n,r){return n*r})},"+":function n(){for(var r=arguments.length,e=Array(r),t=0;t<r;t++){e[t]=arguments[t]}return e.reduce(function(n,r){return n+r})},"-":function n(){for(var r=arguments.length,e=Array(r),t=0;t<r;t++){e[t]=arguments[t]}return e.reduce(function(n,r){return n-r})},"/":function n(){for(var r=arguments.length,e=Array(r),t=0;t<r;t++){e[t]=arguments[t]}return e.reduce(function(n,r){return n/r})},"%":function n(r,e){return r%e},"==":function n(r,e){return r===e},">":function n(r,e){return r>e},"<":function n(r,e){return r<e},"<=":function n(r,e){return r<=e},">=":function n(r,e){return r>=e},or:new p(function(n){var r=this.get("list->array")(n);var e=this;return new Promise(function(n){var t;(function i(){function a(r){t=r;if(t){n(r)}i()}var o=r.shift();if(typeof o==="undefined"){if(t){n(t)}else{n(false)}}else{var f=E(o,e);if(f instanceof Promise){f.then(a)}else{a(f)}}})()})}),and:new p(function(n){var r=this.get("list->array")(n);var e=this;return new Promise(function(n){var t;(function i(){function a(r){t=r;if(!t){n(false)}i()}var o=r.shift();if(typeof o==="undefined"){if(t){n(t)}else{n(false)}}else{var f=E(o,e);if(f instanceof Promise){f.then(a)}else{a(f)}}})()})}),"->":function n(r,e){console.log(e);console.log(r);for(var t=arguments.length,i=Array(t>2?t-2:0),a=2;a<t;a++){i[a-2]=arguments[a]}return r[e].apply(r,i)},"1+":function n(r){return r+1},"1-":function n(r){return r-1},"++":new p(function(n){var r=this.get(n.car)+1;this.set(n.car,r);return r}),"--":new p(function(n){var r=this.get(n.car)-1;this.set(n.car,r);return r})});function k(n){if(n.length===1){return n[0]}else{var r=[];var e=k(n.slice(1));for(var t=0;t<e.length;t++){for(var i=0;i<n[0].length;i++){r.push(n[0][i]+e[t])}}return r}}function S(n,r,e){var t=[];for(var i=r;i<=e;++i){var a=[];for(var o=0;o<i;++o){a.push(n)}t=t.concat(k(a))}return t}S(["d","a"],2,5).forEach(function(n){var r=n.split("").reverse();A.set("c"+n+"r",function(n){return r.reduce(function(n,r){if(r==="a"){return n.car}else{return n.cdr}},n)})});function E(n,r){r=r||A;var e;if(typeof n==="undefined"){return}var t=n.car;var i=n.cdr;if(t instanceof d){e=E(t,r);if(e instanceof Promise){return e.then(function(r){return E(new d(r,n.cdr))})}else if(typeof e!=="function"){throw new Error(r.get("string")(e)+" is not a function")}}if(typeof t==="function"){e=t}if(t instanceof s){e=r.get(t);if(e instanceof p){e=e.invoke(i,r);if(e instanceof y){return e.value}else if(e instanceof Promise){return e.then(function(n){return n.value})}return E(e,r)}else if(typeof e!=="function"){throw new Error("Unknown function `"+t.name+"'")}}if(typeof e==="function"){var a=[];var o=i;while(true){if(o instanceof d){a.push(E(o.car,r));o=o.cdr}else{break}}var f=a.filter(function(n){return n instanceof Promise});if(f.length){return Promise.all(a).then(function(n){return e.apply(r,n)})}return e.apply(r,a)}else if(n instanceof s){e=r.get(n);if(e==="undefined"){throw new Error("Unbound variable `"+n.name+"'")}return e}else{return n}}function P(n,r){return c(a(n)).map(function(n){return E(n,r)})}function j(n){var r=/[()]/;var e=a(n).filter(function(n){return n.match(r)});var t=e.filter(function(n){return n===")"});var i=e.filter(function(n){return n==="("});return t.length===i.length}d.unDry=function(n){return new d(n.car,n.cdr)};d.prototype.toDry=function(){return{value:{car:this.car,cdr:this.cdr}}};l.prototype.toDry=function(){return{value:null}};l.unDry=function(){return h};s.prototype.toDry=function(){return{value:{name:this.name}}};s.unDry=function(n){return new s(n.name)};function q(){var n="text-x/lips";if(window.document){Array.from(document.querySelectorAll("script")).forEach(function(r){var e=r.getAttribute("type");if(e===n){P(r.innerHTML)}else if(e==="text-x/lisp"){console.warn("Expecting "+n+" found "+e)}})}}function x(n){if(typeof window!=="undefined"){if(window.addEventListener){window.addEventListener("load",n,false)}else if(window.attachEvent){window.attachEvent("onload",n)}else if(typeof window.onload==="function"){(function(r){window.onload=function(){n();r()}})(window.onload)}else{window.onload=n}}}x(function(){setTimeout(q,0)});return{version:"0.4.0",exec:P,parse:c,tokenize:a,evaluate:E,Environment:v,global_environment:A,balanced_parenthesis:j,Macro:p,Quote:y,Pair:d,nil:h,Symbol:s}});