/**@license
 * LIPS is Pretty Simple - simple scheme like lisp in JavaScript - v. DEV
 *
 * Copyright (c) 2018-2019 Jakub T. Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 * includes unfetch by Jason Miller (@developit) MIT License
 *
 * build: Sat, 13 Apr 2019 14:46:25 +0000
 */
(function(){"use strict";function r(e){if(Array.isArray(e))return e}function t(e,n){var r=[];var t=true;var i=false;var o=undefined;try{for(var a=e[Symbol.iterator](),c;!(t=(c=a.next()).done);t=true){r.push(c.value);if(n&&r.length===n)break}}catch(e){i=true;o=e}finally{try{if(!t&&a["return"]!=null)a["return"]()}finally{if(i)throw o}}return r}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function ee(e,n){return r(e)||t(e,n)||i()}function o(e,n){o=Object.setPrototypeOf||function e(n,r){n.__proto__=r;return n};return o(e,n)}function a(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function ne(e,n,r){if(a()){ne=Reflect.construct}else{ne=function e(n,r,t){var i=[null];i.push.apply(i,r);var o=Function.bind.apply(n,i);var a=new o;if(t)setPrototypeOf(a,t.prototype);return a}}return ne.apply(null,arguments)}function e(e,n){return n={exports:{}},e(n,n.exports),n.exports}var n=e(function(e){var n=function(o){var e=Object.prototype;var f=e.hasOwnProperty;var u;var n=typeof Symbol==="function"?Symbol:{};var i=n.iterator||"@@iterator";var r=n.asyncIterator||"@@asyncIterator";var t=n.toStringTag||"@@toStringTag";function a(e,n,r,t){var i=n&&n.prototype instanceof c?n:c;var o=Object.create(i.prototype);var a=new j(t||[]);o._invoke=E(e,r,a);return o}o.wrap=a;function s(e,n,r){try{return{type:"normal",arg:e.call(n,r)}}catch(e){return{type:"throw",arg:e}}}var l="suspendedStart";var h="suspendedYield";var p="executing";var v="completed";var d={};function c(){}function y(){}function m(){}var g={};g[i]=function(){return this};var w=Object.getPrototypeOf;var b=w&&w(w(O([])));if(b&&b!==e&&f.call(b,i)){g=b}var x=m.prototype=c.prototype=Object.create(g);y.prototype=x.constructor=m;m.constructor=y;m[t]=y.displayName="GeneratorFunction";function _(e){["next","throw","return"].forEach(function(n){e[n]=function(e){return this._invoke(n,e)}})}o.isGeneratorFunction=function(e){var n=typeof e==="function"&&e.constructor;return n?n===y||(n.displayName||n.name)==="GeneratorFunction":false};o.mark=function(e){if(Object.setPrototypeOf){Object.setPrototypeOf(e,m)}else{e.__proto__=m;if(!(t in e)){e[t]="GeneratorFunction"}}e.prototype=Object.create(x);return e};o.awrap=function(e){return{__await:e}};function k(c){function u(e,n,r,t){var i=s(c[e],c,n);if(i.type==="throw"){t(i.arg)}else{var o=i.arg;var a=o.value;if(a&&typeof a==="object"&&f.call(a,"__await")){return Promise.resolve(a.__await).then(function(e){u("next",e,r,t)},function(e){u("throw",e,r,t)})}return Promise.resolve(a).then(function(e){o.value=e;r(o)},function(e){return u("throw",e,r,t)})}}var n;function e(r,t){function e(){return new Promise(function(e,n){u(r,t,e,n)})}return n=n?n.then(e,e):e()}this._invoke=e}_(k.prototype);k.prototype[r]=function(){return this};o.AsyncIterator=k;o.async=function(e,n,r,t){var i=new k(a(e,n,r,t));return o.isGeneratorFunction(n)?i:i.next().then(function(e){return e.done?e.value:i.next()})};function E(a,c,u){var f=l;return function e(n,r){if(f===p){throw new Error("Generator is already running")}if(f===v){if(n==="throw"){throw r}return P()}u.method=n;u.arg=r;while(true){var t=u.delegate;if(t){var i=A(t,u);if(i){if(i===d)continue;return i}}if(u.method==="next"){u.sent=u._sent=u.arg}else if(u.method==="throw"){if(f===l){f=v;throw u.arg}u.dispatchException(u.arg)}else if(u.method==="return"){u.abrupt("return",u.arg)}f=p;var o=s(a,c,u);if(o.type==="normal"){f=u.done?v:h;if(o.arg===d){continue}return{value:o.arg,done:u.done}}else if(o.type==="throw"){f=v;u.method="throw";u.arg=o.arg}}}}function A(e,n){var r=e.iterator[n.method];if(r===u){n.delegate=null;if(n.method==="throw"){if(e.iterator["return"]){n.method="return";n.arg=u;A(e,n);if(n.method==="throw"){return d}}n.method="throw";n.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var t=s(r,e.iterator,n.arg);if(t.type==="throw"){n.method="throw";n.arg=t.arg;n.delegate=null;return d}var i=t.arg;if(!i){n.method="throw";n.arg=new TypeError("iterator result is not an object");n.delegate=null;return d}if(i.done){n[e.resultName]=i.value;n.next=e.nextLoc;if(n.method!=="return"){n.method="next";n.arg=u}}else{return i}n.delegate=null;return d}_(x);x[t]="Generator";x[i]=function(){return this};x.toString=function(){return"[object Generator]"};function S(e){var n={tryLoc:e[0]};if(1 in e){n.catchLoc=e[1]}if(2 in e){n.finallyLoc=e[2];n.afterLoc=e[3]}this.tryEntries.push(n)}function N(e){var n=e.completion||{};n.type="normal";delete n.arg;e.completion=n}function j(e){this.tryEntries=[{tryLoc:"root"}];e.forEach(S,this);this.reset(true)}o.keys=function(r){var t=[];for(var e in r){t.push(e)}t.reverse();return function e(){while(t.length){var n=t.pop();if(n in r){e.value=n;e.done=false;return e}}e.done=true;return e}};function O(n){if(n){var e=n[i];if(e){return e.call(n)}if(typeof n.next==="function"){return n}if(!isNaN(n.length)){var r=-1,t=function e(){while(++r<n.length){if(f.call(n,r)){e.value=n[r];e.done=false;return e}}e.value=u;e.done=true;return e};return t.next=t}}return{next:P}}o.values=O;function P(){return{value:u,done:true}}j.prototype={constructor:j,reset:function(e){this.prev=0;this.next=0;this.sent=this._sent=u;this.done=false;this.delegate=null;this.method="next";this.arg=u;this.tryEntries.forEach(N);if(!e){for(var n in this){if(n.charAt(0)==="t"&&f.call(this,n)&&!isNaN(+n.slice(1))){this[n]=u}}}},stop:function(){this.done=true;var e=this.tryEntries[0];var n=e.completion;if(n.type==="throw"){throw n.arg}return this.rval},dispatchException:function(r){if(this.done){throw r}var t=this;function e(e,n){o.type="throw";o.arg=r;t.next=e;if(n){t.method="next";t.arg=u}return!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];var o=i.completion;if(i.tryLoc==="root"){return e("end")}if(i.tryLoc<=this.prev){var a=f.call(i,"catchLoc");var c=f.call(i,"finallyLoc");if(a&&c){if(this.prev<i.catchLoc){return e(i.catchLoc,true)}else if(this.prev<i.finallyLoc){return e(i.finallyLoc)}}else if(a){if(this.prev<i.catchLoc){return e(i.catchLoc,true)}}else if(c){if(this.prev<i.finallyLoc){return e(i.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(e,n){for(var r=this.tryEntries.length-1;r>=0;--r){var t=this.tryEntries[r];if(t.tryLoc<=this.prev&&f.call(t,"finallyLoc")&&this.prev<t.finallyLoc){var i=t;break}}if(i&&(e==="break"||e==="continue")&&i.tryLoc<=n&&n<=i.finallyLoc){i=null}var o=i?i.completion:{};o.type=e;o.arg=n;if(i){this.method="next";this.next=i.finallyLoc;return d}return this.complete(o)},complete:function(e,n){if(e.type==="throw"){throw e.arg}if(e.type==="break"||e.type==="continue"){this.next=e.arg}else if(e.type==="return"){this.rval=this.arg=e.arg;this.method="return";this.next="end"}else if(e.type==="normal"&&n){this.next=n}return d},finish:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===e){this.complete(r.completion,r.afterLoc);N(r);return d}}},catch:function(e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===e){var t=r.completion;if(t.type==="throw"){var i=t.arg;N(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){this.delegate={iterator:O(e),resultName:n,nextLoc:r};if(this.method==="next"){this.arg=u}return d}};return o}(e.exports);try{regeneratorRuntime=n}catch(e){Function("r","regeneratorRuntime = r")(n)}});var re=n;function u(e,n,r,t,i,o,a){try{var c=e[o](a);var u=c.value}catch(e){r(e);return}if(c.done){n(u)}else{Promise.resolve(u).then(t,i)}}function te(c){return function(){var e=this,a=arguments;return new Promise(function(n,r){var t=c.apply(e,a);function i(e){u(t,n,r,i,o,"next",e)}function o(e){u(t,n,r,i,o,"throw",e)}i(undefined)})}}function c(e){if(Array.isArray(e)){for(var n=0,r=new Array(e.length);n<e.length;n++){r[n]=e[n]}return r}}function f(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function ie(e){return c(e)||f(e)||s()}function l(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){l=function e(n){return typeof n}}else{l=function e(n){return n&&typeof Symbol==="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n}}return l(e)}function oe(e){if(typeof Symbol==="function"&&l(Symbol.iterator)==="symbol"){oe=function e(n){return l(n)}}else{oe=function e(n){return n&&typeof Symbol==="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":l(n)}}return oe(e)}
/**@license
 * LIPS is Pretty Simple - simple scheme like lisp in JavaScript
 *
 * Copyright (c) 2018-2019 Jakub T. Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 */
/**@license
 * LIPS is Pretty Simple - simple scheme like lisp in JavaScript
 *
 * Copyright (c) 2018-2019 Jakub T. Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 */
(function(n,r){if(typeof define==="function"&&define.amd){define(["bn.js"],function(e){return n.lips=r(n,e)})}else if((typeof module==="undefined"?"undefined":oe(module))==="object"&&module.exports){module.exports=r(n,require("bn.js"))}else{n.lips=r(n,n.BN)}})(typeof window!=="undefined"?window:global,function(o,r,h){if(!o.fetch){o.fetch=function(i,o){o=o||{};return new Promise(function(e,n){var r=new XMLHttpRequest;r.open(o.method||"get",i,true);for(var t in o.headers){r.setRequestHeader(t,o.headers[t])}r.withCredentials=o.credentials=="include";r.onload=function(){e(c())};r.onerror=n;r.send(o.body||null);function c(){var t=[],i=[],o={},a;r.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,n,r){t.push(n=n.toLowerCase());i.push([n,r]);a=o[n];o[n]=a?"".concat(a,",").concat(r):r});return{ok:(r.status/100|0)==2,status:r.status,statusText:r.statusText,url:r.responseURL,clone:c,text:function e(){return Promise.resolve(r.responseText)},json:function e(){return Promise.resolve(r.responseText).then(JSON.parse)},blob:function e(){return Promise.resolve(new Blob([r.response]))},headers:{keys:function e(){return t},entries:function e(){return i},get:function e(n){return o[n.toLowerCase()]},has:function e(n){return n.toLowerCase()in o}}}}})}}var t=/^\/((?:\\\/|[^/]|\[[^\]]*\/[^\]]*\])+)\/([gimy]*)$/;var i=/^[-+]?[0-9]+([eE][-+]?[0-9]+)?$/;var a=/^([-+]?((\.[0-9]+|[0-9]+\.[0-9]+)([eE][-+]?[0-9]+)?)|[0-9]+\.)$/;function d(e){function n(e){if(e.match(/^['"]/)){if(e==='""'||e==="''"){return""}var n=e[0];var r=new RegExp("((^|[^\\\\])(?:\\\\\\\\)*)"+n,"g");e=e.replace(r,"$1")}return JSON.parse('"'+e.replace(/\n/g,"\\n")+'"')}var r=e.match(t);if(r){return new RegExp(r[1],r[2])}else if(e.match(/['"]/)){return n(e)}else if(e.match(i)){return B(parseFloat(e))}else if(e.match(a)){return B(parseFloat(e),true)}else if(e==="nil"){return x}else if(e==="true"){return true}else if(e==="false"){return false}else{return new w(e)}}var f=/("(?:\\[\S\s]|[^"])*"|\/(?! )[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|;.*)/g;var s=/("(?:\\[\S\s]|[^"])*"|\/(?! )[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|\(|\)|'|"(?:\\[\S\s]|[^"])+|\n|(?:\\[\S\s]|[^"])*"|;.*|(?:[-+]?(?:(?:\.[0-9]+|[0-9]+\.[0-9]+)(?:[eE][-+]?[0-9]+)?)|[0-9]+\.)[0-9]|\.{2,}|\.|,@|,|`|[^(\s)]+)/gim;function l(e){return e[e.length-1]}function c(e){e=e.replace(/\n\r|\r/g,"\n");var i=0;var o=0;var a=[];var c=[];var u=0;e.split(f).filter(Boolean).forEach(function(e){if(e.match(f)){u=0;if(c.length){var n=l(c);if(n.token.match(/\n/)){var r=n.token.split("\n").pop();u+=r.length}else{u+=n.token.length}u+=n.col}var t={col:u,line:o,token:e,offset:i};a.push(t);c.push(t);i+=e.length;u+=e.length;o+=(e.match("\n")||[]).length;return}e.split(s).filter(Boolean).forEach(function(e){var n={col:u,line:o,token:e,offset:i};u+=e.length;i+=e.length;a.push(n);c.push(n);if(e==="\n"){++o;c=[];u=0}})});return a}function p(e,n){if(n){return c(e)}else{return c(e).map(function(e){return e.token.trim()}).filter(function(e){return e&&!e.match(/^;/)})}}var y={"'":new w("quote"),"`":new w("quasiquote"),",":new w("unquote"),",@":new w("unquote-splicing")};function v(e){var o=[];var a=[];var c=null;var u=Object.keys(y);var n=u.map(function(e){return y[e].name});var f=0;var s=false;var l=[];var h=[];var p=0;function v(){var e=o[o.length-1];if(e instanceof Array&&e[0]instanceof w&&n.includes(e[0].name)&&o.length>1){o.pop();if(o[o.length-1].length===1&&o[o.length-1][0]instanceof w){o[o.length-1].push(e)}else if(o[o.length-1].length===0){o[o.length-1]=e}else if(o[o.length-1]instanceof _){if(o[o.length-1].cdr instanceof _){o[o.length-1]=new _(o[o.length-1],_.fromArray(e))}else{o[o.length-1].cdr=_.fromArray(e)}}else{o[o.length-1].push(e)}}}e.forEach(function(e){var n=o[o.length-1];if(u.indexOf(e)!==-1){p++;c=e;o.push([y[c]]);if(!c){h=[]}h.push(c)}else{if(c){l.push(h);h=[]}if(e==="("){s=true;f++;o.push([]);c=null;p=0}else if(e==="."&&!s){o[o.length-1]=_.fromArray(n)}else if(e===")"){f--;if(!o.length){throw new Error("Unbalanced parenthesis")}if(o.length===1){a.push(o.pop())}else if(o.length>1){var r=o.pop();n=o[o.length-1];if(n instanceof Array){n.push(r)}else if(n instanceof _){n.append(_.fromArray(r))}if(l.length){h=l.pop();while(h.length){v();h.pop()}}else{v()}}if(f===0&&o.length){a.push(o.pop())}}else{s=false;var t=d(e);if(c){while(p--){o[o.length-1][1]=t;t=o.pop()}p=0;c=false}n=o[o.length-1];if(n instanceof _){var i=n;while(true){if(i.cdr===x){if(t instanceof Array){i.cdr=_.fromArray(t)}else{i.cdr=t}break}else{i=i.cdr}}}else if(!o.length){a.push(t)}else{n.push(t)}}}});if(o.length){throw new Error("Unbalanced parenthesis 2")}return a.map(function(e){if(e instanceof Array){return _.fromArray(e)}return e})}function m(e){var n=1;var r=e.length;while(n>0){var t=e[--r];if(!t){return}if(t.token==="("){n--}else if(t.token===")"){n++}}return e.slice(r)}function g(e){if(!e||!e.length){return 0}var n=e.length;if(e[n-1].token==="\n"){return 0}while(--n){if(e[n].token==="\n"){var r=(e[n+1]||{}).token;if(r){return r.length}}}return 0}function u(e){this._code=e.replace(/\r/g,"")}u.defaults={offset:0,indent:2,specials:["define","lambda","let","let*","define-macro"]};u.prototype._options=function e(n){var r=u.defaults;if(typeof n==="undefined"){return Object.assign({},r)}var t=n&&n.specials||[];return Object.assign({},r,n,{specials:r.specials.concat(t)})};u.prototype.indent=function e(n){var r=p(this._code,true);return this._indent(r,n)};u.prototype._indent=function e(n,r){var t=this._options(r);var i=g(n);var o=t.specials;var a=m(n);if(a){if(a[0].line>0){t.offset=0}if(a.length===1){return t.offset+a[0].col+1}else if(o.indexOf(a[1].token)!==-1){return t.offset+a[0].col+t.indent}else if(a[0].line<a[1].line){return t.offset+a[0].col+1}else if(a.length>3&&a[1].line===a[3].line){if(a[1].token==="("){return t.offset+a[1].col}return t.offset+a[3].col}else if(a[0].line===a[1].line){return t.offset+t.indent+a[0].col}else{var c=a.slice(2);for(var u=0;u<c.length;++u){var f=c[u];if(f.token.trim()){return f.col}}}}return i+t.indent};u.prototype._spaces=function(e){return new Array(e+1).join(" ")};u.prototype.format=function e(n){var r=this._code.replace(/\n\s*/g,"\n ");var t=p(r,true);var i=this._options(n);var o=0;var a=0;for(var c=0;c<t.length;++c){var u=t[c];if(u.token==="\n"){var f=f.slice(0,c);o=this._indent(f,i);a+=o;if(f[c+1]){f[c+1].token=this._spaces(o);o--;for(var s=c+2;s<f.length;++s){f[s].offset+=a;f[s].col+=o;if(f[s].token==="\n"){c=s-1;break}}}}}return t.map(function(e){return e.token}).join("")};function e(e,n){var r=Object.prototype.toString;var t="[object Array]";var i=[];var o=n&&e||e.slice();var a;if(!e.length){return i}a=o.pop();do{if(r.call(a)===t){o.push.apply(o,a)}else{i.push(a)}}while(o.length&&(a=o.pop())!==h);i.reverse();return i}function n(e){return oe(e)==="symbol"||oe(e)==="object"&&Object.prototype.toString.call(e)==="[object Symbol]"}function w(e){if(typeof this!=="undefined"&&this.constructor!==w||typeof this==="undefined"){return new w(e)}this.name=e}w.is=function(e,n){return e instanceof w&&typeof n==="string"&&e.name===n};w.prototype.toJSON=w.prototype.toString=function(){if(n(this.name)){return this.name.toString()}return this.name};function b(){}b.prototype.toString=function(){return"nil"};var x=new b;function _(e,n){if(typeof this!=="undefined"&&this.constructor!==_||typeof this==="undefined"){return new _(e,n)}this.car=e;this.cdr=n}function k(){return new _(h,x)}_.prototype.flatten=function(){return _.fromArray(e(this.toArray()))};_.prototype.length=function(){if(A(this)){return 0}var e=0;var n=this;while(true){if(!n||n===x||!(n instanceof _)){break}e++;n=n.cdr}return e};_.prototype.clone=function(){var e=this.cdr;var n=this.car;if(n instanceof _){n=n.clone()}if(e instanceof _){e=this.cdr.clone()}return new _(n,e)};_.prototype.toArray=function(){if(this.isEmptyList()){return[]}var e=[];if(this.car instanceof _){e.push(this.car.toArray())}else{e.push(this.car)}if(this.cdr instanceof _){e=e.concat(this.cdr.toArray())}return e};_.prototype.isEmptyList=function(){return typeof this.car==="undefined"&&this.cdr===x};_.fromArray=function(e){if(e instanceof _){return e}if(e.length&&!(e instanceof Array)){e=ie(e)}if(e.length===0){return k()}else{var n;if(e[0]instanceof Array){n=_.fromArray(e[0])}else{n=e[0]}if(e.length===1){return new _(n,x)}else{return new _(n,_.fromArray(e.slice(1)))}}};_.prototype.toObject=function(){var e=this;var n={};while(true){if(e instanceof _&&e.car instanceof _){var r=e.car;var t=r.car;if(t instanceof w){t=t.name}var i=r.cdr;if(i instanceof _){i=i.toObject()}if(i instanceof B){i=i.valueOf()}n[t]=i;e=e.cdr}else{break}}return n};_.fromPairs=function(e){return e.reduce(function(e,n){return new _(new _(new w(n[0]),n[1]),e)},x)};_.fromObject=function(n){var e=Object.keys(n).map(function(e){return[e,n[e]]});return _.fromPairs(e)};_.prototype.reduce=function(e){var n=this;var r=x;while(true){if(n!==x){r=e(r,n.car);n=n.cdr}else{break}}return r};_.prototype.reverse=function(){var e=this;var n=x;while(e!==x){var r=e.cdr;e.cdr=n;n=e;e=r}return n};_.prototype.transform=function(t){function i(e){if(e instanceof _){if(e.replace){delete e.replace;return e}var n=t(e.car);if(n instanceof _){n=i(n)}var r=t(e.cdr);if(r instanceof _){r=i(r)}return new _(n,r)}return e}return i(this)};_.prototype.map=function(e){if(typeof this.car!=="undefined"){return new _(e(this.car),A(this.cdr)?x:this.cdr.map(e))}else{return x}};_.prototype.toString=function(){var e=["("];if(this.car!==h){if(typeof this.car==="function"){e.push("<#function "+(this.car.name||"anonymous")+">")}else if(typeof this.car==="string"){e.push(JSON.stringify(this.car))}else if(this.car instanceof w){e.push(this.car.toString())}else if(typeof this.car!=="undefined"){e.push(this.car)}if(this.cdr instanceof _){e.push(" ");e.push(this.cdr.toString().replace(/^\(|\)$/g,""))}else if(typeof this.cdr!=="undefined"&&this.cdr!==x){if(typeof this.cdr==="string"){e=e.concat([" . ",JSON.stringify(this.cdr)])}else{e=e.concat([" . ",this.cdr])}}}e.push(")");return e.join("")};_.prototype.append=function(e){if(e instanceof Array){return this.append(_.fromArray(e))}var n=this;if(n.car===h){if(e instanceof _){this.car=e.car;this.cdr=e.cdr}else{return e}}else{while(true){if(n instanceof _&&n.cdr!==x){n=n.cdr}else{break}}n.cdr=e}return this};function E(e,n){if(e instanceof B&&n instanceof B){return e.cmp(n)===0}else if(typeof e==="number"||typeof n==="number"){return B(e).cmp(B(n))}else if(e instanceof w&&n instanceof w){return e.name===n.name}else{return e===n}}function A(e){return e instanceof _&&e.isEmptyList()||e===x}function S(e,n){if(typeof this!=="undefined"&&this.constructor!==S||typeof this==="undefined"){return new S(e,n)}this.name=e;this.fn=n}S.defmacro=function(e,n){var r=new S(e,n);r.defmacro=true;return r};S.prototype.invoke=function(e,n,r){var t=n.env,i=n.dynamic_scope,o=n.error;var a={dynamic_scope:i,error:o,macro_expand:r};var c=this.fn.call(t,e,a,this.name);return r?T(c):c};S.prototype.toString=function(){return"#<Macro "+this.name+">"};var N="define-macro";function j(o){return function(){var r=te(re.mark(function e(r,u){var f,s,t,i;return re.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:t=function e(){t=te(re.mark(function e(r){var t,i,o,a,c;return re.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:if(!(r instanceof _&&r.car instanceof w)){n.next=13;break}n.prev=1;t=f.get(r.car);if(!(t instanceof S&&t.defmacro)){n.next=9;break}n.next=6;return t.invoke(r.cdr,u,true);case 6:i=n.sent;if(!(i instanceof _)){n.next=9;break}return n.abrupt("return",i);case 9:n.next=13;break;case 11:n.prev=11;n.t0=n["catch"](1);case 13:o=r.car;if(!(o instanceof _)){n.next=18;break}n.next=17;return s(o);case 17:o=n.sent;case 18:a=r.cdr;if(!(a instanceof _)){n.next=23;break}n.next=22;return s(a);case 22:a=n.sent;case 23:c=new _(o,a);return n.abrupt("return",c);case 25:case"end":return n.stop()}}},e,null,[[1,11]])}));return t.apply(this,arguments)};s=function e(n){return t.apply(this,arguments)};f=u["env"]=this;i=r;if(!o){n.next=12;break}n.t0=T;n.next=8;return s(r);case 8:n.t1=n.sent.car;return n.abrupt("return",(0,n.t0)(n.t1));case 12:n.next=15;return s(r);case 15:i=n.sent;if(!(r.toString()===i.toString())){n.next=18;break}return n.abrupt("break",21);case 18:r=i;n.next=12;break;case 21:return n.abrupt("return",T(i.car));case 22:case"end":return n.stop()}}},e,this)}));return function(e,n){return r.apply(this,arguments)}}()}function O(e){return typeof e==="undefined"||e===x||e===null}function P(e){return typeof e==="function"&&e.toString().match(/\{\s*\[native code\]\s*\}/)}function L(e,o){var a=function e(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++){r[t]=arguments[t]}var i=[].concat(ie(e.__bind.args),r);return e.__bind.fn.apply(o,i)};for(var n=arguments.length,r=new Array(n>2?n-2:0),t=2;t<n;t++){r[t-2]=arguments[t]}a.__bind={args:e.__bind?e.__bind.args.concat(r):r,fn:e.__bind?e.__bind.fn:e};a.apply=function(e,n){return a.__bind.fn.apply(e,n)};a.call=function(e){var n;for(var r=arguments.length,t=new Array(r>1?r-1:0),i=1;i<r;i++){t[i-1]=arguments[i]}return(n=a.__bind.fn).call.apply(n,[e].concat(t))};a.bind=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),t=1;t<n;t++){r[t-1]=arguments[t]}return L.apply(void 0,[a,e].concat(r))};return a}function q(d){var e="let"+(d?"*":"");return S.defmacro(e,function(f,e){var s=e.dynamic_scope,l=e.error,n=e.macro_expand;var h;if(f.car instanceof w){if(!(f.cdr.car instanceof _)){throw new Error("let require list of pairs")}var r=f.cdr.car.map(function(e){return e.car});h=f.cdr.car.map(function(e){return e.cdr.car});return _.fromArray([w("let*"),[[f.car,_(w("lambda"),_(r,f.cdr.cdr))]],_(f.car,h)])}else if(n){return}var p=this;h=this.get("list->array")(f.car);var v=p.inherit("let");return new Promise(function(a){var c=[];var u=0;(function e(){var n=h[u++];function r(e){if(e instanceof Promise){c.push(e);return e.then(r)}else if(typeof e==="undefined"){v.set(n.car,x)}else{v.set(n.car,e)}}if(s){s=d?v:p}if(!n){var t=new _(new w("begin"),f.cdr);Q(t,{env:v,dynamic_scope:s,error:l}).then(function(e){a(e)})}else{var i=Q(n.cdr.car,{env:d?v:p,dynamic_scope:s,error:l});var o=r(i);if(o instanceof Promise){o.then(function(){Promise.all(c).then(e)})}else{e()}}})()})})}function B(e,n){if(e instanceof B){return e}if(typeof this!=="undefined"&&this.constructor!==B||typeof this==="undefined"){return new B(e,n===true?true:h)}if(!B.isNumber(e)){throw new Error("You can't create LNumber from "+oe(e))}if(e===null){e=0}if(B.isFloat(e)){this.value=e}else if(n){this.value=e;this.float=true}else if(typeof BigInt!=="undefined"){if(typeof e!=="bigint"){this.value=BigInt(e)}else{this.value=e}}else if(typeof r!=="undefined"&&!(e instanceof r)){this.value=new r(e)}else{this.value=e}}B.isFloat=function e(n){return Number(n)===n&&n%1!==0};B.isNumber=function(e){return e instanceof B||!Number.isNaN(e)&&B.isNative(e)||B.isBN(e)};B.isNative=function(e){return typeof e==="bigint"||typeof e==="number"};B.isBN=function(e){return typeof r!=="undefined"&&e instanceof r};B.prototype.toString=B.prototype.toJSON=function(){return this.value.toString()};B.prototype.isBigNumber=function(){return typeof this.value==="bigint"||typeof r!=="undefined"&&!(this.value instanceof r)};["floor","ceil","round"].forEach(function(e){B.prototype[e]=function(){if(this.float||B.isFloat(this.value)){return B(Math[e](this.value))}else{return B(this.value)}}});B.prototype.valueOf=function(){if(B.isNative(this.value)){return Number(this.value)}else if(B.isBN(this.value)){return this.value.toNumber()}};B.prototype.coerce=function(e){if(e===null){e=0}var n;if(e instanceof B){n=e.value}else{n=e}if(B.isFloat(n)){}else if(typeof this.value==="bigint"&&typeof n!=="bigint"){n=BigInt(n)}else if(typeof r!=="undefined"&&this.value instanceof r&&!n instanceof r){n=new r(n)}return B(n)};B.prototype.op=function(e,n){var r={"*":function e(n,r){return n*r},"+":function e(n,r){return n+r},"-":function e(n,r){return n-r},"/":function e(n,r){return n/r},"%":function e(n,r){return n%r},"|":function e(n,r){return n|r},"&":function e(n,r){return n&r},"~":function e(n){return~n},">>":function e(n,r){return n>>r},"<<":function e(n,r){return n<<r}};if(B.isFloat(n)||n instanceof B&&(B.isFloat(n.value)||n.float)||B.isFloat(this.value)||this.float){var t=n instanceof B?n.valueOf():n;return B(r[e](this.valueOf(),t),true)}n=this.coerce(n);if(B.isNative(n.value)&&B.isNative(this.value)){return B(r[e](this.value,n.value))}if(B.isBN(this.value)&&B.isBN(n.value)){var i={"+":"iadd","-":"isub","*":"imul","/":"idiv","%":"imod","|":"ior","&":"iand","~":"inot","<<":"ishrn",">>":"ishln"};e=i[e];return this.value.clone()[e](n,t)}};var F={"+":"add","-":"sub","*":"mul","/":"div","%":"mod","|":"or","&":"and","~":"neg","<<":"shl",">>":"shr"};Object.keys(F).forEach(function(n){B.prototype[F[n]]=function(e){return this.op(n,e)}});B.prototype.sqrt=function(){var e;if(B.isNative(this.value)){e=Math.sqrt(this.value)}else if(B.isBN(this.value)){e=this.value.sqrt()}return new B(e)};B.prototype.pow=function(e){e=this.coerce(e);if(B.isNative(this.value)){try{var n=new Function("a,b","return a**b;");e.value=n(this.value,e.value)}catch(e){throw new Error("Power operator not supported")}}else if(B.isBN(this.value)){e.value=this.value.pow(e.value)}else{e.value=Math.pow(this.value,e.value)}return e};B.prototype.neg=function(){var e=this.value;if(B.isNative(e)){e=-e}else if(B.isBN(e)){e=e.neg()}return new B(e)};B.prototype.abs=function(){var e=this.value;if(B.isNative(this.value)){if(e<0){e=-e}}else if(B.isBN(e)){e.iabs()}return new B(e)};B.prototype.isOdd=function(){if(B.isNative(this.value)){return this.value%2===1}else if(B.isBN(this.value)){return this.value.isOdd()}};B.prototype.isEven=function(){return!this.isOdd()};B.prototype.cmp=function(e){e=this.coerce(e);if(B.isNative(this.value)){if(this.value<e.value){return-1}else if(this.value===e.value){return 0}else{return 1}}else if(B.isBN(this.value)){return this.value.cmp(e.value)}};function R(e,n,r){this.env=e;this.parent=n;this.name=r}R.prototype.inherit=function(e){var n=arguments.length>1&&arguments[1]!==h?arguments[1]:{};if(oe(e)==="object"){n=e}if(!e||oe(e)==="object"){e="child of "+(this.name||"unknown")}return new R(n||{},this,e)};R.prototype.get=function(e){var n;var r=false;if(e instanceof w){if(e.name in this.env){n=this.env[e.name];r=true}}else if(typeof e==="string"){if(typeof this.env[e]!=="undefined"){n=this.env[e];r=true}}if(r){if(B.isNumber(n)){return B(n)}if(typeof n==="function"){return L(n,this)}return n}if(this.parent instanceof R){return this.parent.get(e)}else{var t;if(e instanceof w){t=e.name}else if(typeof e==="string"){t=e}if(t){var i=oe(o[t]);if(i==="function"){if(P(o[t])){return o[t].bind(o)}else{return o[t]}}else if(i!=="undefined"){return o[t]}}}t=(t.name||t).toString();throw new Error("Unbound variable `"+t+"'")};R.prototype.set=function(e,n){if(B.isNumber(n)){n=B(n)}if(e instanceof w){e=e.name}this.env[e]=n};R.prototype.has=function(e){return typeof this.env[e]!=="undefined"};R.prototype.ref=function(e){var n=this;while(true){if(!n){break}if(n.has(e)){return n}n=n.parent}};function T(e){if(e instanceof Promise){return e.then(T)}if(e instanceof _||e instanceof w){e.data=true}return e}function I(e,n){this.value=e;this.count=n}I.prototype.toString=function(){return"<#unquote["+this.count+"] "+this.value+">"};var D=function(){var n=0;return function(){var e=arguments.length>0&&arguments[0]!==h?arguments[0]:null;if(e!==null){return new w(o.Symbol("#"+e))}n++;return new w(o.Symbol("#"+n))}}();var M=new R({nil:x,undefined:h,true:true,NaN:NaN,false:false,this:function e(){return this},stdout:{write:function e(){var n;(n=console).log.apply(n,arguments)}},stdin:{read:function e(){return new Promise(function(e){e(prompt(""))})}},test:function e(){return Promise.resolve(h)},cons:function e(n,r){if(A(r)){r=x}return new _(n,r)},car:function e(n){if(n instanceof _){return n.car}else{throw new Error("argument to car need to be a list")}},cdr:function e(n){if(n instanceof _){return n.cdr}else{throw new Error("argument to cdr need to be a list")}},"set!":new S("set!",function(n){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},r=e.dynamic_scope,t=e.error;if(r){r=this}var i=Q(n.cdr.car,{env:this,dynamic_scope:r,error:t});i=U(i);var o;if(n.car instanceof _&&w.is(n.car.car,".")){var a=n.car.cdr.car;var c=n.car.cdr.cdr.car;var u=Q(a,{env:this,dynamic_scope:r,error:t});var f=Q(c,{env:this,dynamic_scope:r,error:t});if(i instanceof Promise){return i.then(function(e){u[f]=e})}else{u[f]=i;return i}}if(!(n.car instanceof w)){throw new Error("set! first argument need to be a symbol")}o=this.ref(n.car.name);if(!o){o=this}if(i instanceof Promise){return i.then(function(e){return o.set(n.car,e)})}else{o.set(n.car,i)}}),"set-car!":function e(n,r){n.car=r},"set-cdr!":function e(n,r){n.cdr=r},"empty?":function e(n){return typeof n==="undefined"||A(n)},assoc:function e(n,r){if(n instanceof _&&!(r instanceof _)){throw new Error("First argument to assoc new to a key")}var t=r;while(true){if(!(t instanceof _)||this.get("empty?")(t)){break}var i=t.car.car;if(E(i,n)){return t.car}else{t=t.cdr}}return x},gensym:D,load:function e(n){var r=this;o.fetch(n).then(function(e){return e.text()}).then(function(e){r.get("eval")(r.get("read")(e))})},while:new S("while",function(){var r=te(re.mark(function e(r,t){var i,o,a,c,u,f;return re.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:i=t.dynamic_scope,o=t.error;a=this;c=new _(new w("begin"),r.cdr);if(i){i=a}case 4:n.next=7;return Q(r.car,{env:a,dynamic_scope:i,error:o});case 7:f=n.sent;if(!(f&&!A(f))){n.next=14;break}n.next=11;return Q(c,{env:a,dynamic_scope:i,error:o});case 11:u=n.sent;n.next=15;break;case 14:return n.abrupt("return",u);case 15:n.next=4;break;case 17:case"end":return n.stop()}}},e,this)}));return function(e,n){return r.apply(this,arguments)}}()),if:new S("if",function(i,e){var o=e.dynamic_scope,a=e.error;if(o){o=this}var c=this;var n=function e(n){if(typeof n!=="boolean"){throw new Error("if: value need to be boolean")}if(n){var r=Q(i.cdr.car,{env:c,dynamic_scope:o,error:a});if(typeof r==="undefined"){return}return r}else{var t=Q(i.cdr.cdr.car,{env:c,dynamic_scope:o,error:a});if(typeof t==="undefined"){return false}return t}};var r=Q(i.car,{env:c,dynamic_scope:o,error:a});if(r instanceof Promise){return r.then(n)}else{return n(r)}}),"let*":q(true),let:q(false),begin:new S("begin",function(){var r=te(re.mark(function e(r,t){var i,o,a,c;return re.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:i=t.dynamic_scope,o=t.error;a=this.get("list->array")(r);if(i){i=this}case 3:if(!a.length){n.next=11;break}r=a.shift();n.next=8;return Q(r,{env:this,dynamic_scope:i,error:o});case 8:c=n.sent;n.next=12;break;case 11:return n.abrupt("return",c);case 12:n.next=3;break;case 14:case"end":return n.stop()}}},e,this)}));return function(e,n){return r.apply(this,arguments)}}()),nop:function e(){},timer:new S("timer",function(n){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},r=e.dynamic_scope,t=e.error;var i=this;if(r){r=this}return new Promise(function(e){setTimeout(function(){e(Q(n.cdr,{env:i,dynamic_scope:r,error:t}))},n.car)})}),define:S.defmacro("define",function(n,e){var r=this;if(n.car instanceof _&&n.car.car instanceof w){var t=new _(new w("define"),new _(n.car.car,new _(new _(new w("lambda"),new _(n.car.cdr,n.cdr)))));return t}else if(e.macro_expand){return}if(e.dynamic_scope){e.dynamic_scope=this}e.env=r;var i=n.cdr.car;if(i instanceof _){i=Q(i,e)}else if(i instanceof w){i=r.get(i)}if(n.car instanceof w){if(i instanceof Promise){return i.then(function(e){r.set(n.car,e)})}else{r.set(n.car,i)}}}),"set-obj":function e(n,r,t){n[r]=t},eval:function e(n){var r=this;if(n instanceof _){return Q(n,{env:this,dynamic_scope:this,error:function e(n){return r.get("print")(n.message)}})}if(n instanceof Array){var t;n.forEach(function(e){t=Q(e,{env:r,dynamic_scope:r,error:function e(n){return r.get("print")(n.message)}})});return t}},lambda:new S("lambda",function(u){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},f=e.dynamic_scope,s=e.error;var l=this;function n(){var e=(f?this:l).inherit("lambda");var n=u.car;var r=0;var t;if(n instanceof w||!A(n)){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++){o[a]=arguments[a]}while(true){if(n.car!==x){if(n instanceof w){t=_.fromArray(o.slice(r));e.env[n.name]=t;break}else{if(typeof o[r]==="undefined"){t=x}else{t=o[r]}e.env[n.car.name]=t}}if(n.cdr===x){break}r++;n=n.cdr}}if(f){f=e}var c=new _(new w("begin"),u.cdr);return Q(c,{env:e,dynamic_scope:f,error:s})}var r=u.car instanceof _?u.car.length():null;if(!(u.car instanceof _)){return n}var t=new Array(r).fill(0).map(function(e,n){return"a"+n}).join(",");var i=new Function("f","return function(".concat(t,") {\n                return f.apply(this, arguments);\n            };"));return i(n)}),macroexpand:new S("macro-expand",j()),"macroexpand-1":new S("macro-expand",j(true)),"define-macro":new S(N,function(c,e){var u=e.dynamic_scope,f=e.error;function s(e){if(e instanceof _){delete e.data}return e}if(c.car instanceof _&&c.car.car instanceof w){var n=c.car.car.name;this.env[n]=S.defmacro(n,function(e,n){var r=n.macro_expand;var t=new R({},this,"defmacro");var i=c.car.cdr;var o=e;while(true){if(i instanceof w){t.env[i.name]=o;break}else if(i.car!==x&&o.car!==x){t.env[i.car.name]=o.car}if(i.cdr===x){break}o=o.cdr;i=i.cdr}if(u){u=t}if(c.cdr instanceof _){var a=c.cdr.reduce(function(e,n){return Q(n,{env:t,dynamic_scope:u,error:f})});if(r){return a}a=Q(a,{env:this,dynamic_scope:u,error:f});if(a instanceof Promise){return a.then(s)}return s(a)}})}}),quote:new S("quote",function(e){return T(e.car)}),quasiquote:new S("quasiquote",function(e,n){var u=n.dynamic_scope,f=n.error;var s=this;var l=0;if(u){u=s}function h(e){if(e instanceof _){var n;if(w.is(e.car.car,"unquote-splicing")){n=Q(e.car.cdr.car,{env:s,dynamic_scope:u,error:f});if(!n instanceof _){throw new Error("Value of unquote-splicing need"+" to be pair")}if(e.cdr instanceof _){if(n instanceof _){n.cdr.append(h(e.cdr))}else{n=new _(n,h(e.cdr))}}return n}if(w.is(e.car,"unquote")){var r=e.cdr;var t=r;var i=t;var o=1;while(w.is(t.car.car,"unquote")){i=t;o++;t=t.car.cdr.car}if(o>l){l=o}if(i===t){if(e.cdr.cdr!==x){return new _(new I(e.cdr.car,o),h(e.cdr.cdr))}else{return new I(e.cdr.car,o)}}else if(i.cdr.cdr!==x){i.car.cdr=new _(new I(t,o),i.cdr===x?x:h(i.cdr.cdr))}else{i.car.cdr=new I(t,o)}return r.car}var a=e.car;var c=e.cdr;if(a instanceof _){a=h(a)}if(c instanceof _){c=h(c)}return new _(a,c)}return e}function t(e){if(e instanceof I){if(l===e.count){return Q(e.value,{env:s,dynamic_scope:u,error:f})}else{return new _(new w("unquote"),new _(t(e.value),x))}}if(e instanceof _){var n=e.car;if(n instanceof _||n instanceof I){n=t(n)}var r=e.cdr;if(r instanceof _||r instanceof I){r=t(r)}return new _(n,r)}return e}return T(t(h(e.car)))}),clone:function e(n){return n.clone()},append:function e(n,r){return n.clone().append([r])},reverse:function e(n){if(n instanceof _){var r=this.get("list->array")(n).reverse();return this.get("array->list")(r)}else if(!(n instanceof Array)){throw new Error("Invlid value for reverse")}else{return n.reverse()}},nth:function e(n,r){if(r instanceof _){var t=r;var i=0;while(i<n){if(!t.cdr||t.cdr===x){return x}t=t.cdr;i++}return t.car}else if(r instanceof Array){return r[n]}else{throw new Error("Invalid object for nth")}},"append!":new S("append!",function(e,n){var r=n.dynamic_scope,t=n.error;if(r){r=this}var i=Q(e.cdr.car,{env:this,dynamic_scope:r,error:t});return this.get(e.car).append([i])}),list:function e(){return _.fromArray([].slice.call(arguments))},concat:function e(){return[].join.call(arguments,"")},join:function e(n,r){return this.get("list->array")(r).join(n)},split:function e(n,r){return this.get("array->list")(n.split(r))},replace:function e(n,r,t){return n.replace(r,t)},match:function e(n,r){return this.get("array->list")(n.match(r))},search:function e(n,r){return n.search(r)},string:function n(e,r){if(typeof jQuery!=="undefined"&&e instanceof jQuery.fn.init){return"<#jQuery("+e.length+")>"}if(e instanceof B){return e.value.toString()}if(typeof e==="undefined"){return"<#undefined>"}if(typeof e==="function"){if(P(e)){return"<#function(native)>"}return"<#function>"}if(e===x){return"nil"}if(e instanceof Array){return"["+e.map(function(e){return n(e,true)}).join(", ")+"]"}if(e===null||typeof e==="string"&&r){return JSON.stringify(e)}if(e instanceof _||e instanceof w){return e.toString()}if(oe(e)==="object"){var t=e.constructor.name;if(t!==""){return"<#"+t+">"}return"<#Object>"}if(typeof e!=="string"){return e.toString()}return e},env:function e(n){n=n||this;var r=Object.keys(n.env);var t;if(r.length){t=_.fromArray(r)}else{t=x}if(n.parent!==h){return this.get("env").call(this,n.parent).append(t)}return t},new:function e(n){for(var r=arguments.length,t=new Array(r>1?r-1:0),i=1;i<r;i++){t[i-1]=arguments[i]}return ne(n,t)},".":function e(n){for(var r=arguments.length,t=new Array(r>1?r-1:0),i=1;i<r;i++){t[i-1]=arguments[i]}var o=t;for(var a=0;a<o.length;a++){var c=o[a];var u=c instanceof w?c.name:c;var f=n[u];if(typeof f==="function"){f=f.bind(n)}n=f}return f},type:function e(n){var r={pair:_,symbol:w};var t=Object.entries(r);for(var i=0;i<t.length;i++){var o=ee(t[i],2),a=o[0],c=o[1];if(n instanceof c){return a}}if(n instanceof B){if(n.isBigNumber()){return"bigint"}return"number"}return oe(n)},instanceof:function e(n,r){return n instanceof r},"number?":B.isNumber,"string?":function e(n){return typeof n==="string"},"pair?":function e(n){return n instanceof _},"regex?":function e(n){return n instanceof RegExp},"null?":function e(n){return O(n)||n instanceof _&&n.isEmptyList()},"boolean?":function e(n){return typeof n==="boolean"},"symbol?":function e(n){return n instanceof w},"array?":function e(n){return n instanceof Array},"object?":function e(n){return n!==null&&oe(n)==="object"&&!(n instanceof Array)},read:function n(e){var r=this;if(typeof e==="string"){e=v(p(e));if(e.length){return e[e.length-1]}return k()}return this.get("stdin").read().then(function(e){return n.call(r,e)})},print:function e(){var n,r=this;for(var t=arguments.length,i=new Array(t),o=0;o<t;o++){i[o]=arguments[o]}(n=this.get("stdout")).write.apply(n,ie(i.map(function(e){return r.get("string")(e)})))},flatten:function e(n){return n.flatten()},"array->list":function e(n){return _.fromArray(n)},"list->array":function e(n){if(n instanceof _&&n.isEmptyList()){return[]}var r=[];var t=n;while(true){if(t instanceof _){r.push(t.car);t=t.cdr}else{break}}return r},apply:new S("apply",function(t){var i=this;var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},o=e.dynamic_scope,a=e.error;if(o){o=this}function c(e){if(typeof e!=="function"){var n;if(t.car instanceof w){n="Variable `"+t.car.name+"' is not a function"}else{n="Expression `"+t.car.toString()+"' is not a function"}throw new Error(n)}}var n=function e(n){c(n);var r=Q(t.cdr.car,{env:i,dynamic_scope:o,error:a});r=i.get("list->array")(r);if(r.filter(function(e){return e instanceof Promise}).length){return Promise.all(r).then(function(e){return n.apply(i,e)})}else{return n.apply(i,r)}};var r=Q(t.car,{env:this,dynamic_scope:o,error:a});if(r instanceof Promise){return r.then(n)}else{return n(r)}}),length:function e(n){if(!n){return B(0)}if(n instanceof _){return B(n.length())}if("length"in n){return B(n.length)}},find:function(){var r=te(re.mark(function e(r,t){var i,o;return re.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:i=this.get("list->array")(t);o=0;case 2:if(!(o<i.length)){n.next=10;break}n.next=5;return r(i[o],o);case 5:if(!n.sent){n.next=7;break}return n.abrupt("return",i[o]);case 7:++o;n.next=2;break;case 10:case"end":return n.stop()}}},e,this)}));function e(e,n){return r.apply(this,arguments)}return e}(),"for-each":function(){var r=te(re.mark(function e(r,t){var i,o,a;return re.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:i=this.get("list->array")(t);o=0;case 2:if(!(o<i.length)){n.next=8;break}a=i[o++];n.next=6;return r(a,o);case 6:n.next=2;break;case 8:case"end":return n.stop()}}},e,this)}));function e(e,n){return r.apply(this,arguments)}return e}(),map:function(){var r=te(re.mark(function e(r,t){var i,o,a,c;return re.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:i=this.get("list->array")(t);o=[];a=0;case 3:if(!(a<i.length)){n.next=12;break}c=i[a++];n.t0=o;n.next=8;return r(c,a);case 8:n.t1=n.sent;n.t0.push.call(n.t0,n.t1);n.next=3;break;case 12:return n.abrupt("return",_.fromArray(o));case 13:case"end":return n.stop()}}},e,this)}));function e(e,n){return r.apply(this,arguments)}return e}(),reduce:function(){var r=te(re.mark(function e(r,t){var i,o,a,c,u,f=arguments;return re.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:i=f.length>2&&f[2]!==h?f[2]:null;o=this.get("list->array")(t);if(!(t.length===0)){n.next=4;break}return n.abrupt("return",x);case 4:a=i;if(i===null){a=o.unshift()}c=0;case 7:if(!(c<o.length)){n.next=14;break}u=o[c++];n.next=11;return r(a,u);case 11:a=n.sent;n.next=7;break;case 14:if(!(typeof a==="number")){n.next=16;break}return n.abrupt("return",B(a));case 16:return n.abrupt("return",a);case 17:case"end":return n.stop()}}},e,this)}));function e(e,n){return r.apply(this,arguments)}return e}(),filter:function(){var r=te(re.mark(function e(r,t){var i,o,a,c,u;return re.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:i=this.get("list->array")(t);o=[];a=0;case 3:if(!(a<i.length)){n.next=11;break}c=i[a++];n.next=7;return r(c,a);case 7:u=n.sent;if(u){o.push(c)}n.next=3;break;case 11:return n.abrupt("return",_.fromArray(o,true));case 12:case"end":return n.stop()}}},e,this)}));function e(e,n){return r.apply(this,arguments)}return e}(),range:function e(n){if(n instanceof B){n=n.valueOf()}return _.fromArray(new Array(n).fill(0).map(function(e,n){return B(n)}))},curry:function e(o){for(var n=arguments.length,r=new Array(n>1?n-1:0),t=1;t<n;t++){r[t-1]=arguments[t]}var a=o.length;return function(){var t=r.slice();function i(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++){n[r]=arguments[r]}t=t.concat(n);if(t.length>=a){return o.apply(this,t)}else{return i}}return i.apply(this,arguments)}},odd:function e(n){return B(n).isOdd()},even:function e(n){return B(n).isEvent()},"*":function e(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++){r[t]=arguments[t]}if(r.length){return r.reduce(function(e,n){return B(e).mul(n)})}},"+":function e(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++){r[t]=arguments[t]}if(r.length){return r.reduce(function(e,n){if(B.isNumber(e)&&B.isNumber(n)){return B(e).add(n)}else if(typeof e==="string"){throw new Error("To concatenate strings use `concat`")}return e+n})}},"-":function e(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++){r[t]=arguments[t]}if(r.length===1){return B(r[0]).neg()}if(r.length){return r.reduce(function(e,n){return B(e).sub(n)})}},"/":function e(){for(var n=arguments.length,r=new Array(n),t=0;t<n;t++){r[t]=arguments[t]}if(r.length){return r.reduce(function(e,n){return B(e).div(n)})}},abs:function e(n){return B(n).abs()},sqrt:function e(n){if(n instanceof B){return Math.sqrt(n.valueOf())}return Math.sqrt(n)},"**":function e(n,r){return B(n).pow(r)},"1+":function e(n){return B(n).add(1)},"1-":function e(n){return B(n).sub(1)},"++":new S("++",function(e){var n=this.get(e.car);var r=B(n).add(1);this.set(e.car,r);return r}),"--":new S("--",function(e){var n=this.get(e.car);var r=B(n).sub(1);this.set(e.car,r);return r}),"%":function e(n,r){return B(n).mod(r)},"==":function e(n,r){return B(n).cmp(r)===0},">":function e(n,r){return B(n).cmp(r)===1},"<":function e(n,r){return B(n).cmp(r)===-1},"<=":function e(n,r){return[0,-1].includes(B(n).cmp(r))},">=":function e(n,r){return[0,1].includes(B(n).cmp(r))},"eq?":E,or:new S("or",function(e,n){var a=n.dynamic_scope,c=n.error;var u=this.get("list->array")(e);var f=this;if(a){a=f}return new Promise(function(i){var o;(function n(){function e(e){o=e;if(o){i(e)}n()}var r=u.shift();if(typeof r==="undefined"){if(o){i(o)}else{i(false)}}else{var t=Q(r,{env:f,dynamic_scope:a,error:c});if(t instanceof Promise){t.then(e)}else{e(t)}}})()})}),and:new S("and",function(e){var n=arguments.length>1&&arguments[1]!==h?arguments[1]:{},a=n.dynamic_scope,c=n.error;var u=this.get("list->array")(e);var f=this;if(a){a=f}return new Promise(function(i){var o;(function n(){function e(e){o=e;if(!o){i(false)}n()}var r=u.shift();if(typeof r==="undefined"){if(o){i(o)}else{i(false)}}else{var t=Q(r,{env:f,dynamic_scope:a,error:c});if(t instanceof Promise){t.then(e)}else{e(t)}}})()})}),"|":function e(n,r){return B(n).or(r)},"&":function e(n,r){return B(n).and(r)},"~":function e(n){return B(n).neg()},">>":function e(n,r){return B(n).shr(r)},"<<":function e(n,r){return B(n).shl(r)},not:function e(n){if(A(n)){return true}return!n},"->":function e(n,r){for(var t=arguments.length,i=new Array(t>2?t-2:0),o=2;o<t;o++){i[o-2]=arguments[o]}return n[r].apply(n,i)}},h,"global");["floor","round","ceil"].forEach(function(n){M.set(n,function(e){if(e instanceof B){return e[n]()}throw new Error("".concat(oe(e)," ").concat(e.toString()," is not a number"))})});function G(e){if(e.length===1){return e[0]}else{var n=[];var r=G(e.slice(1));for(var t=0;t<r.length;t++){for(var i=0;i<e[0].length;i++){n.push(e[0][i]+r[t])}}return n}}function $(e,n,r){var t=[];for(var i=n;i<=r;++i){var o=[];for(var a=0;a<i;++a){o.push(e)}t=t.concat(G(o))}return t}$(["d","a"],2,5).forEach(function(e){var n=e.split("").reverse();M.set("c"+e+"r",function(e){return n.reduce(function(e,n){if(n==="a"){return e.car}else{return e.cdr}},e)})});if(typeof global!=="undefined"){M.set("global",global)}else if(typeof window!=="undefined"){M.set("window",window)}function J(e){if(typeof e==="string"){return"string"}else if(e instanceof B){return"number"}else if(e instanceof RegExp){return"regex"}else if(typeof e==="boolean"){return"boolean"}else{return"unknown type"}}function U(e){var n=[];r(e);if(n.length){return t(e)}return e;function r(e){if(e instanceof Promise){n.push(e)}else if(e instanceof _){r(e.car);r(e.cdr)}else if(e instanceof Array){e.forEach(r)}}function t(o){if(o instanceof Array){return Promise.all(o.map(t))}if(o instanceof _){var e=t(o.car);var n=t(o.cdr);return Promise.all([e,n]).then(function(e){var n=ee(e,2),r=n[0],t=n[1];var i=new _(r,t);if(o.data){T(i)}return i})}else{return o}}}function C(e,n){var r=n.env,t=n.dynamic_scope,i=n.error;var o=[];var a=e;while(true){if(a instanceof _){var c=Q(a.car,{env:r,dynamic_scope:t,error:i});if(t){if(c instanceof Promise){c=c.then(function(e){if(typeof e==="function"){return e.bind(t)}return e})}else if(typeof c==="function"){c=c.bind(t)}}o.push(c);a=a.cdr}else{break}}return U(o)}function H(e,n,r){if(n instanceof _){n=n.clone()}var t=e.invoke(n,r);t=U(t,true);if(t&&t.data){return t}else if(t instanceof Promise){return t.then(function(e){if(e&&e.data){return e}return Q(e,r)})}return Q(t,r)}function Q(n){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},r=e.env,t=e.dynamic_scope,i=e.error,o=i===void 0?function(){}:i;try{if(t===true){r=t=r||M}else if(r===true){r=t=M}else{r=r||M}var a={env:r,dynamic_scope:t,error:o};var c;if(O(n)){return n}if(A(n)){return k()}var u=n.car;var f=n.cdr;if(u instanceof _){c=U(Q(u,a));if(c instanceof Promise){return c.then(function(e){return Q(new _(e,n.cdr),a)})}else if(typeof c!=="function"){throw new Error(r.get("string")(c)+" is not a function")}}if(u instanceof w){c=r.get(u);if(c instanceof S){return H(c,f,a)}else if(typeof c!=="function"){if(c){var s="".concat(J(c)," `").concat(c,"' is not a function");throw new Error(s)}throw new Error("Unknown function `".concat(u.name,"'"))}}else if(typeof u==="function"){c=u}if(typeof c==="function"){var l=C(f,a);if(l instanceof Promise){return l.then(function(e){var n=t||r;return T(U(c.apply(n,e)))})}return T(U(c.apply(t||r,l)))}else if(n instanceof w){c=r.get(n);if(c==="undefined"){throw new Error("Unbound variable `"+n.name+"'")}return c}else if(n instanceof _){c=u&&u.toString();throw new Error("".concat(J(u)," ").concat(c," is not a function"))}else{return n}}catch(e){o&&o(e,n)}}function V(e,n,r){return Y.apply(this,arguments)}function Y(){Y=te(re.mark(function e(r,t,i){var o,a,c,u;return re.wrap(function e(n){while(1){switch(n.prev=n.next){case 0:if(i===true){t=i=t||M}else if(t===true){t=i=M}else{t=t||M}o=v(p(r));a=[];case 3:c=o.shift();if(c){n.next=9;break}return n.abrupt("return",a);case 9:n.next=11;return Q(c,{env:t,dynamic_scope:i,error:function e(n,r){n.code=r.toString();throw n}});case 11:u=n.sent;a.push(u);case 13:n.next=3;break;case 15:case"end":return n.stop()}}},e)}));return Y.apply(this,arguments)}function z(n){return function(e){if(!e){return false}return(e.token||e).match(n)}}var X=z(/[()]/);function K(e){var n=typeof e==="string"?p(e):e;var r=n.filter(X);var t=r.filter(function(e){return(e.token||e)===")"});var i=r.filter(function(e){return(e.token||e)==="("});return t.length===i.length}_.unDry=function(e){return new _(e.car,e.cdr)};_.prototype.toDry=function(){return{value:{car:this.car,cdr:this.cdr}}};b.prototype.toDry=function(){return{value:null}};b.unDry=function(){return x};w.prototype.toDry=function(){return{value:{name:this.name}}};w.unDry=function(e){return new w(e.name)};function W(){var t="text/x-lips";if(window.document){Array.from(document.querySelectorAll("script")).forEach(function(e){var n=e.getAttribute("type");if(n===t){var r=e.getAttribute("src");if(r){o.fetch(r).then(function(e){return e.text()}).then(V)}else{V(e.innerHTML)}}else if(n&&n.match(/lips|lisp/)){console.warn("Expecting "+t+" found "+n)}})}}function Z(n){if(typeof window!=="undefined"){if(window.addEventListener){window.addEventListener("load",n,false)}else if(window.attachEvent){window.attachEvent("onload",n)}else if(typeof window.onload==="function"){(function(e){window.onload=function(){n();e()}})(window.onload)}else{window.onload=n}}}Z(function(){setTimeout(W,0)});return{version:"DEV",exec:V,parse:v,tokenize:p,evaluate:Q,Environment:R,global_environment:M,env:M,balanced_parenthesis:K,Macro:S,quote:T,Pair:_,Formatter:u,nil:x,maybe_promise:U,Symbol:w,LNumber:B}})})();