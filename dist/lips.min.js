/**@license
 * LIPS is Pretty Simple - simple scheme like lisp in JavaScript - v. DEV
 *
 * Copyright (c) 2018-2019 Jakub T. Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 * includes unfetch by Jason Miller (@developit) MIT License
 *
 * build: Thu, 04 Apr 2019 09:59:49 +0000
 */
(function(){"use strict";function n(e){if(Array.isArray(e))return e}function t(e,r){var n=[];var t=true;var i=false;var o=undefined;try{for(var a=e[Symbol.iterator](),c;!(t=(c=a.next()).done);t=true){n.push(c.value);if(r&&n.length===r)break}}catch(e){i=true;o=e}finally{try{if(!t&&a["return"]!=null)a["return"]()}finally{if(i)throw o}}return n}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function X(e,r){return n(e)||t(e,r)||i()}function o(e,r){o=Object.setPrototypeOf||function e(r,n){r.__proto__=n;return r};return o(e,r)}function a(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true}catch(e){return false}}function K(e,r,n){if(a()){K=Reflect.construct}else{K=function e(r,n,t){var i=[null];i.push.apply(i,n);var o=Function.bind.apply(r,i);var a=new o;if(t)setPrototypeOf(a,t.prototype);return a}}return K.apply(null,arguments)}function e(e,r){return r={exports:{}},e(r,r.exports),r.exports}var r=e(function(e){var r=function(o){var e=Object.prototype;var f=e.hasOwnProperty;var u;var r=typeof Symbol==="function"?Symbol:{};var i=r.iterator||"@@iterator";var n=r.asyncIterator||"@@asyncIterator";var t=r.toStringTag||"@@toStringTag";function a(e,r,n,t){var i=r&&r.prototype instanceof c?r:c;var o=Object.create(i.prototype);var a=new j(t||[]);o._invoke=_(e,n,a);return o}o.wrap=a;function s(e,r,n){try{return{type:"normal",arg:e.call(r,n)}}catch(e){return{type:"throw",arg:e}}}var l="suspendedStart";var h="suspendedYield";var p="executing";var v="completed";var d={};function c(){}function y(){}function m(){}var w={};w[i]=function(){return this};var g=Object.getPrototypeOf;var b=g&&g(g(P([])));if(b&&b!==e&&f.call(b,i)){w=b}var x=m.prototype=c.prototype=Object.create(w);y.prototype=x.constructor=m;m.constructor=y;m[t]=y.displayName="GeneratorFunction";function k(e){["next","throw","return"].forEach(function(r){e[r]=function(e){return this._invoke(r,e)}})}o.isGeneratorFunction=function(e){var r=typeof e==="function"&&e.constructor;return r?r===y||(r.displayName||r.name)==="GeneratorFunction":false};o.mark=function(e){if(Object.setPrototypeOf){Object.setPrototypeOf(e,m)}else{e.__proto__=m;if(!(t in e)){e[t]="GeneratorFunction"}}e.prototype=Object.create(x);return e};o.awrap=function(e){return{__await:e}};function E(c){function u(e,r,n,t){var i=s(c[e],c,r);if(i.type==="throw"){t(i.arg)}else{var o=i.arg;var a=o.value;if(a&&typeof a==="object"&&f.call(a,"__await")){return Promise.resolve(a.__await).then(function(e){u("next",e,n,t)},function(e){u("throw",e,n,t)})}return Promise.resolve(a).then(function(e){o.value=e;n(o)},function(e){return u("throw",e,n,t)})}}var r;function e(n,t){function e(){return new Promise(function(e,r){u(n,t,e,r)})}return r=r?r.then(e,e):e()}this._invoke=e}k(E.prototype);E.prototype[n]=function(){return this};o.AsyncIterator=E;o.async=function(e,r,n,t){var i=new E(a(e,r,n,t));return o.isGeneratorFunction(r)?i:i.next().then(function(e){return e.done?e.value:i.next()})};function _(a,c,u){var f=l;return function e(r,n){if(f===p){throw new Error("Generator is already running")}if(f===v){if(r==="throw"){throw n}return O()}u.method=r;u.arg=n;while(true){var t=u.delegate;if(t){var i=A(t,u);if(i){if(i===d)continue;return i}}if(u.method==="next"){u.sent=u._sent=u.arg}else if(u.method==="throw"){if(f===l){f=v;throw u.arg}u.dispatchException(u.arg)}else if(u.method==="return"){u.abrupt("return",u.arg)}f=p;var o=s(a,c,u);if(o.type==="normal"){f=u.done?v:h;if(o.arg===d){continue}return{value:o.arg,done:u.done}}else if(o.type==="throw"){f=v;u.method="throw";u.arg=o.arg}}}}function A(e,r){var n=e.iterator[r.method];if(n===u){r.delegate=null;if(r.method==="throw"){if(e.iterator["return"]){r.method="return";r.arg=u;A(e,r);if(r.method==="throw"){return d}}r.method="throw";r.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var t=s(n,e.iterator,r.arg);if(t.type==="throw"){r.method="throw";r.arg=t.arg;r.delegate=null;return d}var i=t.arg;if(!i){r.method="throw";r.arg=new TypeError("iterator result is not an object");r.delegate=null;return d}if(i.done){r[e.resultName]=i.value;r.next=e.nextLoc;if(r.method!=="return"){r.method="next";r.arg=u}}else{return i}r.delegate=null;return d}k(x);x[t]="Generator";x[i]=function(){return this};x.toString=function(){return"[object Generator]"};function S(e){var r={tryLoc:e[0]};if(1 in e){r.catchLoc=e[1]}if(2 in e){r.finallyLoc=e[2];r.afterLoc=e[3]}this.tryEntries.push(r)}function N(e){var r=e.completion||{};r.type="normal";delete r.arg;e.completion=r}function j(e){this.tryEntries=[{tryLoc:"root"}];e.forEach(S,this);this.reset(true)}o.keys=function(n){var t=[];for(var e in n){t.push(e)}t.reverse();return function e(){while(t.length){var r=t.pop();if(r in n){e.value=r;e.done=false;return e}}e.done=true;return e}};function P(r){if(r){var e=r[i];if(e){return e.call(r)}if(typeof r.next==="function"){return r}if(!isNaN(r.length)){var n=-1,t=function e(){while(++n<r.length){if(f.call(r,n)){e.value=r[n];e.done=false;return e}}e.value=u;e.done=true;return e};return t.next=t}}return{next:O}}o.values=P;function O(){return{value:u,done:true}}j.prototype={constructor:j,reset:function(e){this.prev=0;this.next=0;this.sent=this._sent=u;this.done=false;this.delegate=null;this.method="next";this.arg=u;this.tryEntries.forEach(N);if(!e){for(var r in this){if(r.charAt(0)==="t"&&f.call(this,r)&&!isNaN(+r.slice(1))){this[r]=u}}}},stop:function(){this.done=true;var e=this.tryEntries[0];var r=e.completion;if(r.type==="throw"){throw r.arg}return this.rval},dispatchException:function(n){if(this.done){throw n}var t=this;function e(e,r){o.type="throw";o.arg=n;t.next=e;if(r){t.method="next";t.arg=u}return!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];var o=i.completion;if(i.tryLoc==="root"){return e("end")}if(i.tryLoc<=this.prev){var a=f.call(i,"catchLoc");var c=f.call(i,"finallyLoc");if(a&&c){if(this.prev<i.catchLoc){return e(i.catchLoc,true)}else if(this.prev<i.finallyLoc){return e(i.finallyLoc)}}else if(a){if(this.prev<i.catchLoc){return e(i.catchLoc,true)}}else if(c){if(this.prev<i.finallyLoc){return e(i.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(e,r){for(var n=this.tryEntries.length-1;n>=0;--n){var t=this.tryEntries[n];if(t.tryLoc<=this.prev&&f.call(t,"finallyLoc")&&this.prev<t.finallyLoc){var i=t;break}}if(i&&(e==="break"||e==="continue")&&i.tryLoc<=r&&r<=i.finallyLoc){i=null}var o=i?i.completion:{};o.type=e;o.arg=r;if(i){this.method="next";this.next=i.finallyLoc;return d}return this.complete(o)},complete:function(e,r){if(e.type==="throw"){throw e.arg}if(e.type==="break"||e.type==="continue"){this.next=e.arg}else if(e.type==="return"){this.rval=this.arg=e.arg;this.method="return";this.next="end"}else if(e.type==="normal"&&r){this.next=r}return d},finish:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.finallyLoc===e){this.complete(n.completion,n.afterLoc);N(n);return d}}},catch:function(e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc===e){var t=n.completion;if(t.type==="throw"){var i=t.arg;N(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){this.delegate={iterator:P(e),resultName:r,nextLoc:n};if(this.method==="next"){this.arg=u}return d}};return o}(e.exports);try{regeneratorRuntime=r}catch(e){Function("r","regeneratorRuntime = r")(r)}});var W=r;function u(e,r,n,t,i,o,a){try{var c=e[o](a);var u=c.value}catch(e){n(e);return}if(c.done){r(u)}else{Promise.resolve(u).then(t,i)}}function Z(c){return function(){var e=this,a=arguments;return new Promise(function(r,n){var t=c.apply(e,a);function i(e){u(t,r,n,i,o,"next",e)}function o(e){u(t,r,n,i,o,"throw",e)}i(undefined)})}}function c(e){if(Array.isArray(e)){for(var r=0,n=new Array(e.length);r<e.length;r++){n[r]=e[r]}return n}}function f(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function ee(e){return c(e)||f(e)||s()}function l(e){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){l=function e(r){return typeof r}}else{l=function e(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r}}return l(e)}function re(e){if(typeof Symbol==="function"&&l(Symbol.iterator)==="symbol"){re=function e(r){return l(r)}}else{re=function e(r){return r&&typeof Symbol==="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":l(r)}}return re(e)}
/**@license
 * LIPS is Pretty Simple - simple scheme like lisp in JavaScript
 *
 * Copyright (c) 2018-2019 Jakub T. Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 */
/**@license
 * LIPS is Pretty Simple - simple scheme like lisp in JavaScript
 *
 * Copyright (c) 2018-2019 Jakub T. Jankiewicz <https://jcubic.pl/me>
 * Released under the MIT license
 *
 */
(function(r,n){if(typeof define==="function"&&define.amd){define(["bn.js"],function(e){return r.lips=n(r,e)})}else if((typeof module==="undefined"?"undefined":re(module))==="object"&&module.exports){module.exports=n(r,require("bn.js"))}else{r.lips=n(r,r.BN)}})(typeof window!=="undefined"?window:global,function(o,n,h){if(!o.fetch){o.fetch=function(i,o){o=o||{};return new Promise(function(e,r){var n=new XMLHttpRequest;n.open(o.method||"get",i,true);for(var t in o.headers){n.setRequestHeader(t,o.headers[t])}n.withCredentials=o.credentials=="include";n.onload=function(){e(c())};n.onerror=r;n.send(o.body||null);function c(){var t=[],i=[],o={},a;n.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,r,n){t.push(r=r.toLowerCase());i.push([r,n]);a=o[r];o[r]=a?"".concat(a,",").concat(n):n});return{ok:(n.status/100|0)==2,status:n.status,statusText:n.statusText,url:n.responseURL,clone:c,text:function e(){return Promise.resolve(n.responseText)},json:function e(){return Promise.resolve(n.responseText).then(JSON.parse)},blob:function e(){return Promise.resolve(new Blob([n.response]))},headers:{keys:function e(){return t},entries:function e(){return i},get:function e(r){return o[r.toLowerCase()]},has:function e(r){return r.toLowerCase()in o}}}}})}}var t=/^\/((?:\\\/|[^/]|\[[^\]]*\/[^\]]*\])+)\/([gimy]*)$/;var i=/^[-+]?[0-9]+([eE][-+]?[0-9]+)?$/;var a=/^([-+]?((\.[0-9]+|[0-9]+\.[0-9]+)([eE][-+]?[0-9]+)?)|[0-9]+\.)$/;function d(e){function r(e){if(e.match(/^['"]/)){if(e==='""'||e==="''"){return""}var r=e[0];var n=new RegExp("((^|[^\\\\])(?:\\\\\\\\)*)"+r,"g");e=e.replace(n,"$1")}return JSON.parse('"'+e.replace(/\n/g,"\\n")+'"')}var n=e.match(t);if(n){return new RegExp(n[1],n[2])}else if(e.match(/['"]/)){return r(e)}else if(e.match(i)){return P(parseFloat(e))}else if(e.match(a)){return P(parseFloat(e),true)}else if(e==="nil"){return g}else if(e==="true"){return true}else if(e==="false"){return false}else{return new m(e)}}var u=/("(?:\\[\S\s]|[^"])*"|\/(?! )[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|;.*)/g;var f=/("(?:\\[\S\s]|[^"])*"|\/(?! )[^\/\\]*(?:\\[\S\s][^\/\\]*)*\/[gimy]*(?=\s|\(|\)|$)|\(|\)|'|"(?:\\[\S\s]|[^"])+|(?:\\[\S\s]|[^"])*"|;.*|(?:[-+]?(?:(?:\.[0-9]+|[0-9]+\.[0-9]+)(?:[eE][-+]?[0-9]+)?)|[0-9]+\.)[0-9]|\.|,@|,|`|[^(\s)]+)/gim;function c(e){var o=0;var a=0;var c=[];e.split(u).filter(Boolean).forEach(function(e){if(e.match(u)){if(!e.match(/^;/)){var r=(e.split(/\n/),[""]).pop().length;c.push({token:e,col:r,offset:o+a,line:a});o+=e.length}a+=(e.match("\n")||[]).length;return}e.split("\n").filter(Boolean).forEach(function(e,t){var i=0;e.split(f).filter(Boolean).forEach(function(e){var r=t+a;var n={col:i,line:r,token:e,offset:o+r};i+=e.length;o+=e.length;c.push(n)})})});return c}function p(e,r){if(r){return c(e)}else{return c(e).map(function(e){return e.token.trim()}).filter(function(e){return e&&!e.match(/^;/)})}}var y={"'":new m("quote"),"`":new m("quasiquote"),",":new m("unquote"),",@":new m("unquote-splicing")};function s(e){var o=[];var a=[];var c=null;var u=Object.keys(y);var r=u.map(function(e){return y[e].name});var f=0;var s=false;var l=[];var h=[];var p=0;function v(){var e=o[o.length-1];if(e instanceof Array&&e[0]instanceof m&&r.includes(e[0].name)&&o.length>1){o.pop();if(o[o.length-1].length===1&&o[o.length-1][0]instanceof m){o[o.length-1].push(e)}else if(o[o.length-1].length===0){o[o.length-1]=e}else if(o[o.length-1]instanceof b){if(o[o.length-1].cdr instanceof b){o[o.length-1]=new b(o[o.length-1],b.fromArray(e))}else{o[o.length-1].cdr=b.fromArray(e)}}else{o[o.length-1].push(e)}}}e.forEach(function(e){var r=o[o.length-1];if(u.indexOf(e)!==-1){p++;c=e;o.push([y[c]]);if(!c){h=[]}h.push(c)}else if(e==="("){s=true;f++;if(c){l.push(h);h=[]}o.push([]);c=null;p=0}else if(e==="."&&!s){o[o.length-1]=b.fromArray(r)}else if(e===")"){f--;if(!o.length){throw new Error("Unbalanced parenthesis")}if(o.length===1){a.push(o.pop())}else if(o.length>1){var n=o.pop();r=o[o.length-1];if(r instanceof Array){r.push(n)}else if(r instanceof b){r.append(b.fromArray(n))}if(l.length){h=l.pop();while(h.length){v();h.pop()}}else{v()}}if(f===0&&o.length){a.push(o.pop())}}else{s=false;var t=d(e);if(c){while(p--){o[o.length-1][1]=t;t=o.pop()}p=0;c=false}r=o[o.length-1];if(r instanceof b){var i=r;while(true){if(i.cdr===g){if(t instanceof Array){i.cdr=b.fromArray(t)}else{i.cdr=t}break}else{i=i.cdr}}}else if(!o.length){a.push(t)}else{r.push(t)}}});if(o.length){throw new Error("Unbalanced parenthesis")}return a.map(function(e){if(e instanceof Array){return b.fromArray(e)}return e})}function v(e){var r=1;var n=e.length;while(r>0){var t=e[--n];if(!t){return}if(t.token==="("){r--}else if(t.token===")"){r++}}return e.slice(n)}function e(e,r,n){var t=p(e,true);var i=v(t);var o=e.split("\n");var a=o[o.length-1];var c=a.match(/^(\s*)/);var u=c[1].length||n;var f;if(i){if(i[0].line>0){n=0}if(i.length===1){return n+i[0].col+1}else if(["define","lambda","let"].indexOf(i[1].token)!==-1){return n+i[0].col+r}else if(i[0].line<i[1].line){return n+i[0].col+1}else if(i.length>3&&i[1].line===i[3].line){if(i[1].token==="("){return n+i[1].col}return n+i[3].col}else if(i[0].line===i[1].line){return n+i[1].col}else{var s=i.slice(2);for(f=0;f<s.length;++f){var l=s[f];if(l.token.trim()){return l.col}}}}return u+r}function r(e,r){var n=Object.prototype.toString;var t="[object Array]";var i=[];var o=r&&e||e.slice();var a;if(!e.length){return i}a=o.pop();do{if(n.call(a)===t){o.push.apply(o,a)}else{i.push(a)}}while(o.length&&(a=o.pop())!==h);i.reverse();return i}function l(e){return re(e)==="symbol"||re(e)==="object"&&Object.prototype.toString.call(e)==="[object Symbol]"}function m(e){if(typeof this!=="undefined"&&this.constructor!==m||typeof this==="undefined"){return new m(e)}this.name=e}m.is=function(e,r){return e instanceof m&&typeof r==="string"&&e.name===r};m.prototype.toJSON=m.prototype.toString=function(){if(l(this.name)){return this.name.toString()}return this.name};function w(){}w.prototype.toString=function(){return"nil"};var g=new w;function b(e,r){if(typeof this!=="undefined"&&this.constructor!==b||typeof this==="undefined"){return new b(e,r)}this.car=e;this.cdr=r}function x(){return new b(h,g)}b.prototype.flatten=function(){return b.fromArray(r(this.toArray()))};b.prototype.length=function(){if(E(this)){return 0}var e=0;var r=this;while(true){if(!r||r===g||!(r instanceof b)){break}e++;r=r.cdr}return e};b.prototype.clone=function(){var e=this.cdr;var r=this.car;if(r instanceof b){r=r.clone()}if(e instanceof b){e=this.cdr.clone()}return new b(r,e)};b.prototype.toArray=function(){if(this.isEmptyList()){return[]}var e=[];if(this.car instanceof b){e.push(this.car.toArray())}else{e.push(this.car)}if(this.cdr instanceof b){e=e.concat(this.cdr.toArray())}return e};b.prototype.isEmptyList=function(){return typeof this.car==="undefined"&&this.cdr===g};b.fromArray=function(e){if(e instanceof b){return e}if(e.length&&!(e instanceof Array)){e=ee(e)}if(e.length===0){return x()}else{var r;if(e[0]instanceof Array){r=b.fromArray(e[0])}else{r=e[0]}if(e.length===1){return new b(r,g)}else{return new b(r,b.fromArray(e.slice(1)))}}};b.prototype.toObject=function(){var e=this;var r={};while(true){if(e instanceof b&&e.car instanceof b){var n=e.car;var t=n.car;if(t instanceof m){t=t.name}var i=n.cdr;if(i instanceof b){i=i.toObject()}r[t]=i;e=e.cdr}else{break}}return r};b.fromPairs=function(e){return e.reduce(function(e,r){return new b(new b(new m(r[0]),r[1]),e)},g)};b.fromObject=function(r){var e=Object.keys(r).map(function(e){return[e,r[e]]});return b.fromPairs(e)};b.prototype.reduce=function(e){var r=this;var n=g;while(true){if(r!==g){n=e(n,r.car);r=r.cdr}else{break}}return n};b.prototype.reverse=function(){var e=this;var r=g;while(e!==g){var n=e.cdr;e.cdr=r;r=e;e=n}return r};b.prototype.transform=function(t){function i(e){if(e instanceof b){if(e.replace){delete e.replace;return e}var r=t(e.car);if(r instanceof b){r=i(r)}var n=t(e.cdr);if(n instanceof b){n=i(n)}return new b(r,n)}return e}return i(this)};b.prototype.map=function(e){if(typeof this.car!=="undefined"){return new b(e(this.car),E(this.cdr)?g:this.cdr.map(e))}else{return g}};b.prototype.toString=function(){var e=["("];if(this.car!==h){if(typeof this.car==="function"){e.push("<#function "+(this.car.name||"anonymous")+">")}else if(typeof this.car==="string"){e.push(JSON.stringify(this.car))}else if(this.car instanceof m){e.push(this.car.toString())}else if(typeof this.car!=="undefined"){e.push(this.car)}if(this.cdr instanceof b){e.push(" ");e.push(this.cdr.toString().replace(/^\(|\)$/g,""))}else if(typeof this.cdr!=="undefined"&&this.cdr!==g){if(typeof this.cdr==="string"){e=e.concat([" . ",JSON.stringify(this.cdr)])}else{e=e.concat([" . ",this.cdr])}}}e.push(")");return e.join("")};b.prototype.append=function(e){if(e instanceof Array){return this.append(b.fromArray(e))}var r=this;if(r.car===h){if(e instanceof b){this.car=e.car;this.cdr=e.cdr}else{return e}}else{while(true){if(r instanceof b&&r.cdr!==g){r=r.cdr}else{break}}r.cdr=e}return this};function k(e,r){if(e instanceof P&&r instanceof P){return e.cmp(r)===0}else if(typeof e==="number"||typeof r==="number"){return P(e).cmp(P(r))}else if(e instanceof m&&r instanceof m){return e.name===r.name}else{return e===r}}function E(e){return e instanceof b&&e.isEmptyList()||e===g}function _(e,r){if(typeof this!=="undefined"&&this.constructor!==_||typeof this==="undefined"){return new _(e,r)}this.name=e;this.fn=r}_.defmacro=function(e,r){var n=new _(e,r);n.defmacro=true;return n};_.prototype.invoke=function(e,r,n){var t=r.env,i=r.dynamic_scope,o=r.error;var a={dynamic_scope:i,error:o,macro_expand:n};var c=this.fn.call(t,e,a,this.name);return n?q(c):c};_.prototype.toString=function(){return"#<Macro "+this.name+">"};var A="define-macro";function S(o){return function(){var n=Z(W.mark(function e(n,u){var f,s,t,i;return W.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:t=function e(){t=Z(W.mark(function e(n){var t,i,o,a,c;return W.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:if(!(n instanceof b&&n.car instanceof m)){r.next=13;break}r.prev=1;t=f.get(n.car);if(!(t instanceof _&&t.defmacro)){r.next=9;break}r.next=6;return t.invoke(n.cdr,u,true);case 6:i=r.sent;if(!(i instanceof b)){r.next=9;break}return r.abrupt("return",i);case 9:r.next=13;break;case 11:r.prev=11;r.t0=r["catch"](1);case 13:o=n.car;if(!(o instanceof b)){r.next=18;break}r.next=17;return s(o);case 17:o=r.sent;case 18:a=n.cdr;if(!(a instanceof b)){r.next=23;break}r.next=22;return s(a);case 22:a=r.sent;case 23:c=new b(o,a);return r.abrupt("return",c);case 25:case"end":return r.stop()}}},e,null,[[1,11]])}));return t.apply(this,arguments)};s=function e(r){return t.apply(this,arguments)};f=u["env"]=this;i=n;if(!o){r.next=12;break}r.t0=q;r.next=8;return s(n);case 8:r.t1=r.sent.car;return r.abrupt("return",(0,r.t0)(r.t1));case 12:r.next=15;return s(n);case 15:i=r.sent;if(!(n.toString()===i.toString())){r.next=18;break}return r.abrupt("break",21);case 18:n=i;r.next=12;break;case 21:return r.abrupt("return",q(i.car));case 22:case"end":return r.stop()}}},e,this)}));return function(e,r){return n.apply(this,arguments)}}()}function N(e){return typeof e==="undefined"||e===g||e===null}function j(d){var e="let"+(d?"*":"");return _.defmacro(e,function(f,e){var s=e.dynamic_scope,l=e.error,r=e.macro_expand;var h;if(f.car instanceof m){if(!(f.cdr.car instanceof b)){throw new Error("let require list of pairs")}var n=f.cdr.car.map(function(e){return e.car});h=f.cdr.car.map(function(e){return e.cdr.car});return b.fromArray([m("let*"),[[f.car,b(m("lambda"),b(n,f.cdr.cdr))]],b(f.car,h)])}else if(r){return}var p=this;h=this.get("list->array")(f.car);var v=p.inherit("let");return new Promise(function(a){var c=[];var u=0;(function e(){var r=h[u++];function n(e){if(e instanceof Promise){c.push(e);return e.then(n)}else if(typeof e==="undefined"){v.set(r.car,g)}else{v.set(r.car,e)}}if(s){s=d?v:p}if(!r){var t=new b(new m("begin"),f.cdr);J(t,{env:v,dynamic_scope:s,error:l}).then(function(e){a(e)})}else{var i=J(r.cdr.car,{env:d?v:p,dynamic_scope:s,error:l});var o=n(i);if(o instanceof Promise){o.then(function(){Promise.all(c).then(e)})}else{e()}}})()})})}function P(e,r){if(e instanceof P){return e}if(typeof this!=="undefined"&&this.constructor!==P||typeof this==="undefined"){return new P(e,r===true?true:h)}if(!P.isNumber(e)){throw new Error("You can't create LNumber from "+re(e))}if(e===null){e=0}if(P.isFloat(e)){this.value=e}else if(r){this.value=e;this.float=true}else if(typeof BigInt!=="undefined"){if(typeof e!=="bigint"){this.value=BigInt(e)}else{this.value=e}}else if(typeof n!=="undefined"&&!(e instanceof n)){this.value=new n(e)}else{this.value=e}}P.isFloat=function e(r){return Number(r)===r&&r%1!==0};P.isNumber=function(e){return e instanceof P||P.isNative(e)||P.isBN(e)};P.isNative=function(e){return typeof e==="bigint"||typeof e==="number"};P.isBN=function(e){return typeof n!=="undefined"&&e instanceof n};P.prototype.toString=P.prototype.toJSON=function(){return this.value.toString()};["floor","ceil","round"].forEach(function(e){P.prototype[e]=function(){if(this.float||P.isFloat(this.value)){return P(Math[e](this.value))}else{return P(this.value)}}});P.prototype.valueOf=function(){if(P.isNative(this.value)){return Number(this.value)}else if(P.isBN(this.value)){return this.value.toNumber()}};P.prototype.coerce=function(e){if(e===null){e=0}var r;if(e instanceof P){r=e.value}else{r=e}if(P.isFloat(r)){}else if(typeof this.value==="bigint"&&typeof r!=="bigint"){r=BigInt(r)}else if(typeof n!=="undefined"&&this.value instanceof n&&!r instanceof n){r=new n(r)}return P(r)};P.prototype.op=function(e,r){var n={"*":function e(r,n){return r*n},"+":function e(r,n){return r+n},"-":function e(r,n){return r-n},"/":function e(r,n){return r/n},"%":function e(r,n){return r%n},"|":function e(r,n){return r|n},"&":function e(r,n){return r&n},"~":function e(r){return~r},">>":function e(r,n){return r>>n},"<<":function e(r,n){return r<<n}};if(P.isFloat(r)||r instanceof P&&(P.isFloat(r.value)||r.float)||P.isFloat(this.value)||this.float){var t=r instanceof P?r.valueOf():r;return P(n[e](this.valueOf(),t))}r=this.coerce(r);if(P.isNative(r.value)&&P.isNative(this.value)){return P(n[e](this.value,r.value))}if(P.isBN(this.value)&&P.isBN(r.value)){var i={"+":"iadd","-":"isub","*":"imul","/":"idiv","%":"imod","|":"ior","&":"iand","~":"inot","<<":"ishrn",">>":"ishln"};e=i[e];return this.value.clone()[e](r,t)}};var O={"+":"add","-":"sub","*":"mul","/":"div","%":"mod","|":"or","&":"and","~":"neg","<<":"shl",">>":"shr"};Object.keys(O).forEach(function(r){P.prototype[O[r]]=function(e){return this.op(r,e)}});P.prototype.sqrt=function(){var e;if(P.isNative(this.value)){e=Math.sqrt(this.value)}else if(P.isBN(this.value)){e=this.value.sqrt()}return new P(e)};P.prototype.pow=function(e){e=this.coerce(e);if(P.isNative(this.value)){try{var r=new Function("a,b","return a**b;");e.value=r(this.value,e.value)}catch(e){throw new Error("Power operator not supported")}}else if(P.isBN(this.value)){e.value=this.value.pow(e.value)}else{e.value=Math.pow(this.value,e.value)}return e};P.prototype.neg=function(){var e=this.value;if(P.isNative(e)){e=-e}else if(P.isBN(e)){e=e.neg()}return new P(e)};P.prototype.abs=function(){var e=this.value;if(P.isNative(this.value)){if(e<0){e=-e}}else if(P.isBN(e)){e.iabs()}return new P(e)};P.prototype.isOdd=function(){if(P.isNative(this.value)){return this.value%2===1}else if(P.isBN(this.value)){return this.value.isOdd()}};P.prototype.isEven=function(){return!this.isOdd()};P.prototype.cmp=function(e){e=this.coerce(e);if(P.isNative(this.value)){if(this.value<e.value){return-1}else if(this.value===e.value){return 0}else{return 1}}else if(P.isBN(this.value)){return this.value.cmp(e.value)}};function L(e,r,n){this.env=e;this.parent=r;this.name=n}L.prototype.inherit=function(e){var r=arguments.length>1&&arguments[1]!==h?arguments[1]:{};if(re(e)==="object"){r=e}if(!e||re(e)==="object"){e="child of "+(this.name||"unknown")}return new L(r||{},this,e)};L.prototype.get=function(e){var r;var n=false;if(e instanceof m){if(e.name in this.env){r=this.env[e.name];n=true}}else if(typeof e==="string"){if(typeof this.env[e]!=="undefined"){r=this.env[e];n=true}}if(n){if(P.isNumber(r)){return P(r)}return r}if(this.parent instanceof L){return this.parent.get(e)}else{var t;if(e instanceof m){t=e.name}else if(typeof e==="string"){t=e}if(t){var i=re(o[t]);if(i==="function"){return o[t].bind(o)}else if(i!=="undefined"){return o[t]}}}t=(t.name||t).toString();throw new Error("Unbound variable `"+t+"'")};L.prototype.set=function(e,r){if(P.isNumber(r)){r=P(r)}if(e instanceof m){e=e.name}this.env[e]=r};L.prototype.has=function(e){return typeof this.env[e]!=="undefined"};L.prototype.ref=function(e){var r=this;while(true){if(!r){break}if(r.has(e)){return r}r=r.parent}};function q(e){if(e instanceof Promise){return e.then(q)}if(e instanceof b||e instanceof m){e.data=true}return e}function B(e,r){this.value=e;this.count=r}B.prototype.toString=function(){return"<#unquote["+this.count+"] "+this.value+">"};var F=function(){var r=0;return function(){var e=arguments.length>0&&arguments[0]!==h?arguments[0]:null;if(e!==null){return new m(o.Symbol("#"+e))}r++;return new m(o.Symbol("#"+r))}}();var R=new L({nil:g,true:true,false:false,stdout:{write:function e(){var r;(r=console).log.apply(r,arguments)}},stdin:{read:function e(){return new Promise(function(e){e(prompt(""))})}},test:function e(){return Promise.resolve(h)},cons:function e(r,n){if(E(n)){n=g}return new b(r,n)},car:function e(r){if(r instanceof b){return r.car}else{throw new Error("argument to car need to be a list")}},cdr:function e(r){if(r instanceof b){return r.cdr}else{throw new Error("argument to cdr need to be a list")}},"set!":new _("set!",function(r){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},n=e.dynamic_scope,t=e.error;if(n){n=this}var i=J(r.cdr.car,{env:this,dynamic_scope:n,error:t});i=M(i);var o;if(r.car instanceof b&&m.is(r.car.car,".")){var a=r.car.cdr.car;var c=r.car.cdr.cdr.car;var u=J(a,{env:this,dynamic_scope:n,error:t});var f=J(c,{env:this,dynamic_scope:n,error:t});if(i instanceof Promise){return i.then(function(e){u[f]=e})}else{u[f]=i;return i}}if(!(r.car instanceof m)){throw new Error("set! first argument need to be a symbol")}o=this.ref(r.car.name);if(!o){o=this}if(i instanceof Promise){return i.then(function(e){return o.set(r.car,e)})}else{o.set(r.car,i)}}),"set-car!":function e(r,n){r.car=n},"set-cdr!":function e(r,n){r.cdr=n},"empty?":function e(r){return typeof r==="undefined"||E(r)},assoc:function e(r,n){if(r instanceof b&&!(n instanceof b)){throw new Error("First argument to assoc new to a key")}var t=n;while(true){if(!(t instanceof b)||this.get("empty?")(t)){break}var i=t.car.car;if(k(i,r)){return t.car}else{t=t.cdr}}return g},gensym:F,load:function e(r){var n=this;o.fetch(r).then(function(e){return e.text()}).then(function(e){n.get("eval")(n.get("read")(e))})},while:new _("while",function(){var n=Z(W.mark(function e(n,t){var i,o,a,c,u,f;return W.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=t.dynamic_scope,o=t.error;a=this;c=new b(new m("begin"),n.cdr);if(i){i=a}case 4:r.next=7;return J(n.car,{env:a,dynamic_scope:i,error:o});case 7:f=r.sent;if(!(f&&!E(f))){r.next=14;break}r.next=11;return J(c,{env:a,dynamic_scope:i,error:o});case 11:u=r.sent;r.next=15;break;case 14:return r.abrupt("return",u);case 15:r.next=4;break;case 17:case"end":return r.stop()}}},e,this)}));return function(e,r){return n.apply(this,arguments)}}()),if:new _("if",function(i,e){var o=e.dynamic_scope,a=e.error;if(o){o=this}var c=this;var r=function e(r){if(typeof r!=="boolean"){throw new Error("if: value need to be boolean")}if(r){var n=J(i.cdr.car,{env:c,dynamic_scope:o,error:a});if(typeof n==="undefined"){return}return n}else{var t=J(i.cdr.cdr.car,{env:c,dynamic_scope:o,error:a});if(typeof t==="undefined"){return false}return t}};var n=J(i.car,{env:c,dynamic_scope:o,error:a});if(n instanceof Promise){return n.then(r)}else{return r(n)}}),"let*":j(true),let:j(false),begin:new _("begin",function(){var n=Z(W.mark(function e(n,t){var i,o,a,c;return W.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=t.dynamic_scope,o=t.error;a=this.get("list->array")(n);if(i){i=this}case 3:if(!a.length){r.next=11;break}n=a.shift();r.next=8;return J(n,{env:this,dynamic_scope:i,error:o});case 8:c=r.sent;r.next=12;break;case 11:return r.abrupt("return",c);case 12:r.next=3;break;case 14:case"end":return r.stop()}}},e,this)}));return function(e,r){return n.apply(this,arguments)}}()),timer:new _("timer",function(r){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},n=e.dynamic_scope,t=e.error;var i=this;if(n){n=this}return new Promise(function(e){setTimeout(function(){e(J(r.cdr,{env:i,dynamic_scope:n,error:t}))},r.car)})}),define:_.defmacro("define",function(r,e){var n=this;if(r.car instanceof b&&r.car.car instanceof m){var t=new b(new m("define"),new b(r.car.car,new b(new b(new m("lambda"),new b(r.car.cdr,r.cdr)))));return t}else if(e.macro_expand){return}if(e.dynamic_scope){e.dynamic_scope=this}e.env=n;var i=r.cdr.car;if(i instanceof b){i=J(i,e)}if(r.car instanceof m){if(i instanceof Promise){return i.then(function(e){n.set(r.car,e)})}else{if(i instanceof m){i=n.get(i)}n.set(r.car,i)}}}),"set-obj":function e(r,n,t){r[n]=t},eval:function e(r){var n=this;if(r instanceof b){return J(r,{env:this,dynamic_scope:this,error:function e(r){return n.get("print")(r.message)}})}if(r instanceof Array){var t;r.forEach(function(e){t=J(e,{env:n,dynamic_scope:n,error:function e(r){return n.get("print")(r.message)}})});return t}},lambda:new _("lambda",function(u){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},f=e.dynamic_scope,s=e.error;var l=this;function r(){var e=(f?this:l).inherit("lambda");var r=u.car;var n=0;var t;if(r instanceof m||!E(r)){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++){o[a]=arguments[a]}while(true){if(r.car!==g){if(r instanceof m){t=b.fromArray(o.slice(n));e.env[r.name]=t;break}else{if(typeof o[n]==="undefined"){t=g}else{t=o[n]}e.env[r.car.name]=t}}if(r.cdr===g){break}n++;r=r.cdr}}if(f){f=e}var c=new b(new m("begin"),u.cdr);return J(c,{env:e,dynamic_scope:f,error:s})}var n=u.car instanceof b?u.car.length():null;if(!(u.car instanceof b)){return r}var t=new Array(n).fill(0).map(function(e,r){return"a"+r}).join(",");var i=new Function("f","return function(".concat(t,") {\n                return f.apply(this, arguments);\n            };"));return i(r)}),macroexpand:new _("macro-expand",S()),"macroexpand-1":new _("macro-expand",S(true)),"define-macro":new _(A,function(c,e){var u=e.dynamic_scope,f=e.error;function s(e){if(e instanceof b){delete e.data}return e}if(c.car instanceof b&&c.car.car instanceof m){var r=c.car.car.name;this.env[r]=_.defmacro(r,function(e,r){var n=r.macro_expand;var t=new L({},this,"defmacro");var i=c.car.cdr;var o=e;while(true){if(i instanceof m){t.env[i.name]=o;break}else if(i.car!==g&&o.car!==g){t.env[i.car.name]=o.car}if(i.cdr===g){break}o=o.cdr;i=i.cdr}if(u){u=t}if(c.cdr instanceof b){var a=c.cdr.reduce(function(e,r){return J(r,{env:t,dynamic_scope:u,error:f})});if(n){return a}a=J(a,{env:t,dynamic_scope:u,error:f});if(a instanceof Promise){return a.then(s)}return s(a)}})}}),quote:new _("quote",function(e){return q(e.car)}),quasiquote:new _("quasiquote",function(e,r){var u=r.dynamic_scope,f=r.error;var s=this;var l=0;if(u){u=s}function h(e){if(e instanceof b){var r;if(m.is(e.car.car,"unquote-splicing")){r=J(e.car.cdr.car,{env:s,dynamic_scope:u,error:f});if(!r instanceof b){throw new Error("Value of unquote-splicing need"+" to be pair")}if(e.cdr instanceof b){if(r instanceof b){r.cdr.append(h(e.cdr))}else{r=new b(r,h(e.cdr))}}return r}if(m.is(e.car,"unquote")){var n=e.cdr;var t=n;var i=t;var o=1;while(m.is(t.car.car,"unquote")){i=t;o++;t=t.car.cdr.car}if(o>l){l=o}if(i===t){if(e.cdr.cdr!==g){return new b(new B(e.cdr.car,o),e.cdr.cdr)}else{return new B(e.cdr.car,o)}}else if(i.cdr.cdr!==g){i.car.cdr=new b(new B(t,o),i.cdr===g?g:i.cdr.cdr)}else{i.car.cdr=new B(t,o)}return n.car}var a=e.car;if(a instanceof b){a=h(a)}var c=e.cdr;if(c instanceof b){c=h(c)}return new b(a,c)}return e}function t(e){if(e instanceof B){if(l===e.count){return J(e.value,{env:s,dynamic_scope:u,error:f})}else{return new b(new m("unquote"),new b(t(e.value),g))}}if(e instanceof b){var r=e.car;if(r instanceof b||r instanceof B){r=t(r)}var n=e.cdr;if(n instanceof b||n instanceof B){n=t(n)}return new b(r,n)}return e}return q(t(h(e.car)))}),clone:function e(r){return r.clone()},append:function e(r,n){return r.clone().append([n])},reverse:function e(r){if(r instanceof b){var n=this.get("list->array")(r).reverse();return this.get("array->list")(n)}else if(!(r instanceof Array)){throw new Error("Invlid value for reverse")}else{return r.reverse()}},nth:function e(r,n){if(n instanceof b){var t=n;var i=0;while(i<r){if(!t.cdr||t.cdr===g){return g}t=t.cdr;i++}return t.car}else if(n instanceof Array){return n[r]}else{throw new Error("Invalid object for nth")}},"append!":new _("append!",function(e,r){var n=r.dynamic_scope,t=r.error;if(n){n=this}var i=J(e.cdr.car,{env:this,dynamic_scope:n,error:t});return this.get(e.car).append([i])}),list:function e(){return b.fromArray([].slice.call(arguments))},concat:function e(){return[].join.call(arguments,"")},join:function e(r,n){return this.get("list->array")(n).join(r)},split:function e(r,n){return this.get("array->list")(r.split(n))},replace:function e(r,n,t){return r.replace(n,t)},match:function e(r,n){return this.get("array->list")(r.match(n))},search:function e(r,n){return r.search(n)},string:function r(e,n){if(typeof jQuery!=="undefined"&&e instanceof jQuery.fn.init){return"<#jQuery("+e.length+")>"}if(e instanceof P){return e.value.toString()}if(typeof e==="undefined"){return"<#undefined>"}if(typeof e==="function"){if(e.toString().match(/\{\s*\[native code\]\s*\}/)){return"<#function(native)>"}return"<#function>"}if(e===g){return"nil"}if(e instanceof Array){return"["+e.map(function(e){return r(e,true)}).join(", ")+"]"}if(e===null||typeof e==="string"&&n){return JSON.stringify(e)}if(e instanceof b){return e.toString()}if(re(e)==="object"){var t=e.constructor.name;if(t!==""){return"<#"+t+">"}return"<#Object>"}if(typeof e!=="string"){return e.toString()}return e},env:function e(r){r=r||this;var n=Object.keys(r.env);var t;if(n.length){t=b.fromArray(n)}else{t=g}if(r.parent!==h){return this.get("env").call(this,r.parent).append(t)}return t},new:function e(r){for(var n=arguments.length,t=new Array(n>1?n-1:0),i=1;i<n;i++){t[i-1]=arguments[i]}return K(r,t)},".":function e(r,n){var t=n instanceof m?n.name:n;var i=r[t];if(typeof i==="function"){return i.bind(r)}return i},type:function e(r){return re(r)},instanceof:function e(r,n){return r instanceof n},"number?":P.isNumber,"string?":function e(r){return typeof r==="string"},"pair?":function e(r){return r instanceof b},"regex?":function e(r){return r instanceof RegExp},"null?":function e(r){return N(r)||r instanceof b&&r.isEmptyList()},"boolean?":function e(r){return typeof r==="boolean"},"symbol?":function e(r){return r instanceof m},"array?":function e(r){return r instanceof Array},"object?":function e(r){return r!==null&&re(r)==="object"&&!(r instanceof Array)},read:function r(e){var n=this;if(typeof e==="string"){e=s(p(e));if(e.length){return e[e.length-1]}return x()}return this.get("stdin").read().then(function(e){return r.call(n,e)})},print:function e(){var r,n=this;for(var t=arguments.length,i=new Array(t),o=0;o<t;o++){i[o]=arguments[o]}(r=this.get("stdout")).write.apply(r,ee(i.map(function(e){return n.get("string")(e)})))},flatten:function e(r){return r.flatten()},"array->list":function e(r){return b.fromArray(r)},"list->array":function e(r){if(r instanceof b&&r.isEmptyList()){return[]}var n=[];var t=r;while(true){if(t instanceof b){n.push(t.car);t=t.cdr}else{break}}return n},apply:new _("apply",function(t){var i=this;var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},o=e.dynamic_scope,a=e.error;if(o){o=this}function c(e){if(typeof e!=="function"){var r;if(t.car instanceof m){r="Variable `"+t.car.name+"' is not a function"}else{r="Expression `"+t.car.toString()+"' is not a function"}throw new Error(r)}}var r=function e(r){c(r);var n=J(t.cdr.car,{env:i,dynamic_scope:o,error:a});n=i.get("list->array")(n);if(n.filter(function(e){return e instanceof Promise}).length){return Promise.all(n).then(function(e){return r.apply(i,e)})}else{return r.apply(i,n)}};var n=J(t.car,{env:this,dynamic_scope:o,error:a});if(n instanceof Promise){return n.then(r)}else{return r(n)}}),length:function e(r){if(!r){return P(0)}if(r instanceof b){return P(r.length())}if("length"in r){return P(r.length)}},find:function(){var n=Z(W.mark(function e(n,t){var i,o;return W.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=this.get("list->array")(t);o=0;case 2:if(!(o<i.length)){r.next=10;break}r.next=5;return n(i[o],o);case 5:if(!r.sent){r.next=7;break}return r.abrupt("return",i[o]);case 7:++o;r.next=2;break;case 10:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),"for-each":function(){var n=Z(W.mark(function e(n,t){var i,o,a;return W.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=this.get("list->array")(t);o=0;case 2:if(!(o<i.length)){r.next=8;break}a=i[o++];r.next=6;return n(a,o);case 6:r.next=2;break;case 8:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),map:function(){var n=Z(W.mark(function e(n,t){var i,o,a,c;return W.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=this.get("list->array")(t);o=[];a=0;case 3:if(!(a<i.length)){r.next=12;break}c=i[a++];r.t0=o;r.next=8;return n(c,a);case 8:r.t1=r.sent;r.t0.push.call(r.t0,r.t1);r.next=3;break;case 12:return r.abrupt("return",b.fromArray(o));case 13:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),reduce:function(){var n=Z(W.mark(function e(n,t){var i,o,a,c,u,f=arguments;return W.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=f.length>2&&f[2]!==h?f[2]:null;o=this.get("list->array")(t);if(!(t.length===0)){r.next=4;break}return r.abrupt("return",g);case 4:a=i;if(i===null){a=o.unshift()}c=0;case 7:if(!(c<o.length)){r.next=14;break}u=o[c++];r.next=11;return n(a,u);case 11:a=r.sent;r.next=7;break;case 14:if(!(typeof a==="number")){r.next=16;break}return r.abrupt("return",P(a));case 16:return r.abrupt("return",a);case 17:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),filter:function(){var n=Z(W.mark(function e(n,t){var i,o,a,c,u;return W.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:i=this.get("list->array")(t);o=[];a=0;case 3:if(!(a<i.length)){r.next=11;break}c=i[a++];r.next=7;return n(c,a);case 7:u=r.sent;if(u){o.push(c)}r.next=3;break;case 11:return r.abrupt("return",b.fromArray(o,true));case 12:case"end":return r.stop()}}},e,this)}));function e(e,r){return n.apply(this,arguments)}return e}(),range:function e(r){if(r instanceof P){r=r.valueOf()}return b.fromArray(new Array(r).fill(0).map(function(e,r){return P(r)}))},curry:function e(o){for(var r=arguments.length,n=new Array(r>1?r-1:0),t=1;t<r;t++){n[t-1]=arguments[t]}var a=o.length;return function(){var t=n.slice();function i(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++){r[n]=arguments[n]}t=t.concat(r);if(t.length>=a){return o.apply(this,t)}else{return i}}return i.apply(this,arguments)}},odd:function e(r){return P(r).isOdd()},even:function e(r){return P(r).isEvent()},"*":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){return P(e).mul(r)})}},"+":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){if(P.isNumber(e)&&P.isNumber(r)){return P(e).add(r)}else if(typeof e==="string"){throw new Error("To concatenate strings use `concat`")}return e+r})}},"-":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length===1){return P(n[0]).neg()}if(n.length){return n.reduce(function(e,r){return P(e).sub(r)})}},"/":function e(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++){n[t]=arguments[t]}if(n.length){return n.reduce(function(e,r){return P(e).div(r)})}},abs:function e(r){return P(r).abs()},sqrt:function e(r){if(r instanceof P){return Math.sqrt(r.valueOf())}return Math.sqrt(r)},"**":function e(r,n){return P(r).pow(n)},"1+":function e(r){return P(r).add(1)},"1-":function e(r){return P(r).sub(1)},"++":new _("++",function(e){var r=this.get(e.car);var n=P(r).add(1);this.set(e.car,n);return n}),"--":new _("--",function(e){var r=this.get(e.car);var n=P(r).sub(1);this.set(e.car,n);return n}),"%":function e(r,n){return P(r).mod(n)},"==":function e(r,n){return P(r).cmp(n)===0},">":function e(r,n){return P(r).cmp(n)===1},"<":function e(r,n){return P(r).cmp(n)===-1},"<=":function e(r,n){return[0,-1].includes(P(r).cmp(n))},">=":function e(r,n){return[0,1].includes(P(r).cmp(n))},"eq?":k,or:new _("or",function(e,r){var a=r.dynamic_scope,c=r.error;var u=this.get("list->array")(e);var f=this;if(a){a=f}return new Promise(function(i){var o;(function r(){function e(e){o=e;if(o){i(e)}r()}var n=u.shift();if(typeof n==="undefined"){if(o){i(o)}else{i(false)}}else{var t=J(n,{env:f,dynamic_scope:a,error:c});if(t instanceof Promise){t.then(e)}else{e(t)}}})()})}),and:new _("and",function(e){var r=arguments.length>1&&arguments[1]!==h?arguments[1]:{},a=r.dynamic_scope,c=r.error;var u=this.get("list->array")(e);var f=this;if(a){a=f}return new Promise(function(i){var o;(function r(){function e(e){o=e;if(!o){i(false)}r()}var n=u.shift();if(typeof n==="undefined"){if(o){i(o)}else{i(false)}}else{var t=J(n,{env:f,dynamic_scope:a,error:c});if(t instanceof Promise){t.then(e)}else{e(t)}}})()})}),"|":function e(r,n){return P(r).or(n)},"&":function e(r,n){return P(r).and(n)},"~":function e(r){return P(r).neg()},">>":function e(r,n){return P(r).shr(n)},"<<":function e(r,n){return P(r).shl(n)},not:function e(r){if(E(r)){return true}return!r},"->":function e(r,n){for(var t=arguments.length,i=new Array(t>2?t-2:0),o=2;o<t;o++){i[o-2]=arguments[o]}return r[n].apply(r,i)}},h,"global");["floor","round","ceil"].forEach(function(r){R.set(r,function(e){if(e instanceof P){return e[r]()}throw new Error("".concat(re(e)," ").concat(e.toString()," is not a number"))})});function T(e){if(e.length===1){return e[0]}else{var r=[];var n=T(e.slice(1));for(var t=0;t<n.length;t++){for(var i=0;i<e[0].length;i++){r.push(e[0][i]+n[t])}}return r}}function I(e,r,n){var t=[];for(var i=r;i<=n;++i){var o=[];for(var a=0;a<i;++a){o.push(e)}t=t.concat(T(o))}return t}I(["d","a"],2,5).forEach(function(e){var r=e.split("").reverse();R.set("c"+e+"r",function(e){return r.reduce(function(e,r){if(r==="a"){return e.car}else{return e.cdr}},e)})});if(typeof global!=="undefined"){R.set("global",global)}else if(typeof window!=="undefined"){R.set("window",window)}function D(e){if(typeof e==="string"){return"string"}else if(e instanceof P){return"number"}else if(e instanceof RegExp){return"regex"}else if(typeof e==="boolean"){return"boolean"}else{return"unknown type"}}function M(e){var r=[];n(e);if(r.length){return t(e)}return e;function n(e){if(e instanceof Promise){r.push(e)}else if(e instanceof b){n(e.car);n(e.cdr)}else if(e instanceof Array){e.forEach(n)}}function t(o){if(o instanceof Array){return Promise.all(o.map(t))}if(o instanceof b){var e=t(o.car);var r=t(o.cdr);return Promise.all([e,r]).then(function(e){var r=X(e,2),n=r[0],t=r[1];var i=new b(n,t);if(o.data){q(i)}return i})}else{return o}}}function G(e,r){var n=r.env,t=r.dynamic_scope,i=r.error;var o=[];var a=e;while(true){if(a instanceof b){var c=J(a.car,{env:n,dynamic_scope:t,error:i});if(t){if(c instanceof Promise){c=c.then(function(e){if(typeof e==="function"){return e.bind(t)}return e})}else if(typeof c==="function"){c=c.bind(t)}}o.push(c);a=a.cdr}else{break}}return M(o)}function $(e,r,n){if(r instanceof b){r=r.clone()}var t=e.invoke(r,n);t=M(t,true);if(t&&t.data){return t}else if(t instanceof Promise){return t.then(function(e){if(e&&e.data){return e}return J(e,n)})}return J(t,n)}function J(r){var e=arguments.length>1&&arguments[1]!==h?arguments[1]:{},n=e.env,t=e.dynamic_scope,i=e.error,o=i===void 0?function(){}:i;try{if(t===true){n=t=n||R}else if(n===true){n=t=R}else{n=n||R}var a={env:n,dynamic_scope:t,error:o};var c;if(N(r)){return r}if(E(r)){return x()}var u=r.car;var f=r.cdr;if(u instanceof b){c=M(J(u,a));if(c instanceof Promise){return c.then(function(e){return J(new b(e,r.cdr),a)})}else if(typeof c!=="function"){throw new Error(n.get("string")(c)+" is not a function")}}if(u instanceof m){c=n.get(u);if(c instanceof _){return $(c,f,a)}else if(typeof c!=="function"){if(c){var s="".concat(D(c)," `").concat(c,"' is not a function");throw new Error(s)}throw new Error("Unknown function `".concat(u.name,"'"))}}else if(typeof u==="function"){c=u}if(typeof c==="function"){var l=G(f,a);if(l instanceof Promise){return l.then(function(e){var r=t||n;return q(M(c.apply(r,e)))})}return q(M(c.apply(t||n,l)))}else if(r instanceof m){c=n.get(r);if(c==="undefined"){throw new Error("Unbound variable `"+r.name+"'")}return c}else if(r instanceof b){c=u&&u.toString();throw new Error("".concat(D(u)," ").concat(c," is not a function"))}else{return r}}catch(e){o&&o(e,r)}}function U(e,r,n){return C.apply(this,arguments)}function C(){C=Z(W.mark(function e(n,t,i){var o,a,c,u;return W.wrap(function e(r){while(1){switch(r.prev=r.next){case 0:if(i===true){t=i=t||R}else if(t===true){t=i=R}else{t=t||R}o=s(p(n));a=[];case 3:c=o.shift();if(c){r.next=9;break}return r.abrupt("return",a);case 9:r.next=11;return J(c,{env:t,dynamic_scope:i,error:function e(r,n){r.code=n.toString();throw r}});case 11:u=r.sent;a.push(u);case 13:r.next=3;break;case 15:case"end":return r.stop()}}},e)}));return C.apply(this,arguments)}function H(r){return function(e){if(!e){return false}return(e.token||e).match(r)}}var Q=H(/[()]/);function V(e){var r=typeof e==="string"?p(e):e;var n=r.filter(Q);var t=n.filter(function(e){return(e.token||e)===")"});var i=n.filter(function(e){return(e.token||e)==="("});return t.length===i.length}b.unDry=function(e){return new b(e.car,e.cdr)};b.prototype.toDry=function(){return{value:{car:this.car,cdr:this.cdr}}};w.prototype.toDry=function(){return{value:null}};w.unDry=function(){return g};m.prototype.toDry=function(){return{value:{name:this.name}}};m.unDry=function(e){return new m(e.name)};function Y(){var t="text/x-lips";if(window.document){Array.from(document.querySelectorAll("script")).forEach(function(e){var r=e.getAttribute("type");if(r===t){var n=e.getAttribute("src");if(n){o.fetch(n).then(function(e){return e.text()}).then(U)}else{U(e.innerHTML)}}else if(r&&r.match(/lips|lisp/)){console.warn("Expecting "+t+" found "+r)}})}}function z(r){if(typeof window!=="undefined"){if(window.addEventListener){window.addEventListener("load",r,false)}else if(window.attachEvent){window.attachEvent("onload",r)}else if(typeof window.onload==="function"){(function(e){window.onload=function(){r();e()}})(window.onload)}else{window.onload=r}}}z(function(){setTimeout(Y,0)});return{version:"DEV",exec:U,parse:s,tokenize:p,evaluate:J,Environment:L,global_environment:R,env:R,balanced_parenthesis:V,Macro:_,quote:q,Pair:b,indent:e,nil:g,maybe_promise:M,Symbol:m,LNumber:P}})})();