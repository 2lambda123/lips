<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>LIPS Is Pretty Simple</title>
    <meta name="Description" content=""/>
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png"/>
    <link rel="manifest" href="favicon/site.webmanifest"/>
    <link rel="mask-icon" href="favicon/safari-pinned-tab.svg" color="#5bbad5"/>
    <link rel="shortcut icon" href="favicon/favicon.ico"/>
    <meta name="msapplication-TileColor" content="#ff6600"/>
    <meta name="msapplication-config" content="favicon/browserconfig.xml"/>
    <meta name="theme-color" content="#ffffff"/>
    <!--[if IE]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="https://unpkg.com/jquery.terminal/css/jquery.terminal.min.css" rel="stylesheet"/>
    <link href="https://rawgit.com/jcubic/jquery.terminal/devel/css/jquery.terminal.min.css" rel="stylesheet"/>
    <link href="https://unpkg.com/prismjs/themes/prism-coy.css" rel="stylesheet"/>
    <link href="style.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css?family=Crimson+Text|Play" rel="stylesheet"/>
    
    <meta property="og:locale" content="en_US"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="LIPS Is Pretty Simple"/>
    <meta property="og:description" content="Simple Scheme like lisp in JavaScript"/>
    <meta property="og:url" content="https://jcubic.github.io/lips/"/>
    <meta property="og:site_name" content="lips"/>
    <meta property="og:image" content="https://jcubic.github.io/lips/banner.png"/>

    <meta name="twitter:image" content="https://jcubic.github.io/lips/banner.png"/>
    <meta name="twitter:image:alt" content="Logo and text 'LIPS Is Pretty Simple'"/>
    <meta name="twitter:title" content="LIPS Is Pretty Simple"/>
    <meta name="twitter:description" content="Simple Scheme like lisp in JavaScript"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="@jcubic"/>
    <meta name="twitter:creator" content="@jcubic"/>

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
  <header class="main">
    <a href="/lips/">
      <img src="logo.svg"/>
      <h1>
        LIPS Is Pretty Simple
      </h1>
    </a>
    <nav>
      <ul>
        <li><a href="/lips/#demo">Demo</a></li>
        <li><a href="/lips/docs.html">Docs</a></li>
        <li><a href="/lips/#installation">Installation</a></li>
        <li><a href="https://github.com/jcubic/lips">github</a></li>
      </ul>
    </nav>
  </header>
  <section id="summary">
    <header><h2>Summary</h2></header>
    <p>LIPS is Simple Lisp in JavaScript</p>
    <p>Key features:</p>
    <ul>
      <li>Lisp Macros and backquote,</li>
      <li>Functions in lips are normal javascript functions,</li>
      <li>Easy extension using JavaScript using Macros or functions,</li>
      <li>Regexes are first class objects,</li>
      <li>BigInt support (for browsers that don't have native support you will need <a href="https://github.com/indutny/bn.js/">bn.js</a>,</li>
      <li>Optional dynamic scope,</li>
      <li>Promises are treated as values they resolve to.</li>
    </ul>
  </section>
  <section id="demo">
    <header><h2>Demo</h2></header>
    <div class="tabs">
      <ul>
        <li><a href="#">lexical</a></li>
        <li><a href="#">dynamic</a>
      </ul>
      <div class="panels">
        <div class="term lexical">
        </div>
        <div class="term dynamic">
        </div>
      </div>
    </div>
  </section>
  <section id="installation">
    <header><h2>Installation</h2></header>
    <h3>Node</h3>
    <pre>
npm install @jcubic/lips
    </pre>
    <p>then you code use:</p>
    <pre><code class="language-javascript">
var {exec} = require('@jcubic/lips');
// or
import {exec} from '@jcubic/lips';
    </code></pre>
    <h3>Browser</h3>
    <p>When using in browser you need to include the file</p>
    <pre><code class="language-markup">
&lt;script src="https://unpkg.com/@jcubic/lips"&gt;&lt;/script&gt;
    </code></pre>
    <p>Then you have access to lips object that you can upack with ES6.</p>
    <pre><code class="language-javascript">
var {exec} = lips;
    </code></pre>
    <p>You can use lips.exec to evaluate the code:</p>
    <pre><code class="language-javascript">
exec(string).then(function(results) {
     results.forEach(function(result) {
         console.log(result);
     });
});
    </code></pre>
    <p>
      <strong><code>exec</code></strong> function always return a promise event that any of the expressions
      return promise. The only expression that explicitly return promise is <strong><code>let</code></strong>
      and <strong><code>let*</code></strong>, so you can use <strong><code>fetch</code></strong> and
      <strong><code>json</code></strong> or <strong><code>text</code></strong> in one expression.
    </p>
    <p>Or you can split the process using this functions:</p>
    <pre><code class="language-javascript">
var {evaluate, parse, tokenize, exec} = lips;
parse(tokenize(string)).foEach(function(code) {
    evaluate(code);
});
    </code></pre>
    <p>
      with <strong><code>evaluate</code></strong> you need to check the type if it's Promise you need to wait for it.
    </p>
    <p><strong><code>evaluate</code></strong> function also accept two more arguments:
      <ul>
        <li>first Environment.
            By default it's <strong><code>lips.global_environment</code></strong>. You can use it if you want to
            have separated instances of the interpreter.</li>
        <li>
          Second can be value <strong><code>true</code></strong> or Environment, this argument mean that
          the scope should be dynamic, if you pass Env object in most cases it should be your global object.
        </li>
      </ul>
    </p>
    <p>
      The result of both <strong><code>exec</code></strong> and
      <strong><code>evaluate</code></strong> can also be <strong><code>lips.Pair</code></strong>
      that you can convert to Array using <strong><code>pair.toArray()</code></strong>. If the
      function return number it will be wrapped with <strong><code>lips.LNumber</code></strong>, the
      value will be in value property it will be BigInt, bn.js or normal JavaScript number. To get
      value of the <strong><code>LNumber</code></strong> you can call
      <strong><code>toString()</code></strong> or <strong><code>valueOf()</code></strong> that will
      convert to native number but you may lost precision or its bigness.
    </p>
    <p>You can also create dynamic scope if you call <strong><code>evaluate('code', true)</code></strong>.</p>
    <p>You can also execute LIPS code from script tag, just include code like this</p>
    <pre><code class="language-html">
  &lt;script type="text-x/lips"&gt;
    (print "hello")
    ;; this will load and evaluate external file
    (load "example.lips")
  &lt;script&gt;
    </code></pre>
  </section>
  <footer>
    <p>Copyright (c) 2018 <a href="https://jcubic.pl/me">Jakub Jankiewicz</a></p>
  </footer>
  <script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
  <script src="https://code.jquery.com/jquery-latest.min.js"></script>
  <script src="https://unpkg.com/@jcubic/lips"></script>
  <script src="https://unpkg.com/jquery.terminal/js/jquery.terminal.min.js"></script>
  <script src="https://cdn.rawgit.com/inexorabletash/polyfill/master/keyboard.js"></script>
  <script src="https://unpkg.com/prismjs/prism.js"></script>
  <script src="https://unpkg.com/jquery.terminal/js/prism.js"></script>
  <script src="https://unpkg.com/prismjs/components/prism-scheme.min.js"></script>
  <script src="https://unpkg.com/prismjs/components/prism-javascript.min.js"></script>
  <script src="https://unpkg.com/prismjs/components/prism-markup.min.js"></script>
  <style>
   .token.operator, .token.entity, .token.url, .language-css .token.string, .style .token.string {
       background: inherit;
   }
   .terminal span.token.boolean {
       font-weight: normal !important;
       color: inherit !important;
   }
  </style>
  <script>
   function interpreter(selector, dynamic) {
       $.terminal.syntax("scheme");
       var env = new lips.Environment({
           stdout: {
               write: function() {
                   var args = Array.from(arguments);
                   args.forEach(function(arg) {
                       term.echo(arg, {keepWords: true});
                   });
               }
           },
           stdin: {
               read: function() {
                   return term.read('');
               }
           }
       }, lips.global_environment);
       var position;
       var timer;
       var term = $(selector).terminal(function(code, term) {
           if (!lips.balanced_parenthesis(code)) {
               term.error('Unbalanced parenthesis');
           } else {
               lips.exec(code, env, dynamic).then(function(ret) {
                   ret.forEach(function(ret) {
                       if (ret !== undefined) {
                           env.get('print').call(env, ret);
                       }
                   });
               }).catch(function(e) {
                   term.error(e.message);
               });
           }
       }, {
           name: 'lisp',
           prompt: 'lips> ',
           enabled: false,
           greetings: false,
           keydown: function() {
               if (position) {
                   term.set_position(position);
                   position = false;
               }
           },
           keypress: function(e) {
               var term = this;
               if (e.key == ')') {
                   setTimeout(function() {
                       position = term.get_position();
                       var command = term.get_command().substring(0, position);
                       var len = command.split(/\n/)[0].length;
                       var tokens = lips.tokenize(command, true);
                       var count = 1;
                       var token;
                       var i = tokens.length - 1;
                       while (count > 0) {
                           token = tokens[--i];
                           if (!token) {
                               return;
                           }
                           if (token.token === '(') {
                               count--;
                           } else if (token.token == ')') {
                               count++;
                           }
                       }
                       if (token.token == '(' && count === 0) {
                           clearTimeout(timer);
                           setTimeout(function() {
                               term.set_position(token.offset);
                               timer = setTimeout(function() {
                                   term.set_position(position)
                                   position = false;
                               }, 200);
                           }, 0);
                       }
                   }, 0);
               } else {
                   position = false;
               }
           }
       });
       term.echo('LIPS Demo version ' + lips.version + ' with [[b;#fff;]' +
                 (dynamic ? 'dynamic' : 'lexical') + ' scope]\n' +
                 'type [[b;#fff;](env)] to see environment with ' +
                 'functions macros and variables\n', {formatters: false});
   }
   $(function() {
       interpreter('.term.dynamic', true);
       interpreter('.term.lexical', false);

       function select(li) {
           li = $(li);
           var index = li.index();
           li.addClass('active')
             .siblings().removeClass('active');
           var term = tabs.find('.panels').children().eq(index)
                          .addClass('active');
           term.siblings().removeClass('active');
           return term;
       }
       var tabs = $('.tabs');
       select(tabs.find('ul li:eq(0)'));

       tabs.on('click', 'ul li', function() {
           select(this).terminal().focus();
           return false;
       });
   });
  </script>
</body>
</html>
